<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>念念不忘 必有回响</title>
    <url>/2019/01/01/1/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>​    很久没有提笔写一些东西，之前说的在大学毕业的时候对自己有个清晰和辨识度的总结也耽搁很久，先说说这个博客吧。</p>
<p>​    自己缺点其实挺多的，懒，拖延，不上进，现在想想大学生活都不知道自己都做了什么，走到今天这一步也完全是自己咎由自取自作自受，哈，说的可能有些严重了，但是为什么活得并没有很开心，工作的为什么又没有很快乐。感情失意，职场也一般，但是的确又在实现着自己的价值，希望自己按照自己的心，follow my heart是不是就能收获一些感动。</p>
<p>​    大学四年，匆匆过去，本来是个敲代码的码农，却误打误撞进了网络工程师的坑，很早之前就被人忠告网工不是什么好工作了已经，说不上夕阳产业但也摇摇欲坠了，核心设备的工程师已经饱和，底层只会配vlan的工程师去培训班速成也没什么问题。而自己的定位呢？一瓶子不满，半瓶子咣当。眼高手低，会的太多，会的太杂，什么都略懂一点，就是什么都不会。</p>
<p>​    这个网站最开始的时候使用WordPress建在腾讯云的学生机上，一开始还是Windows系统。后来觉得WordPress实在是太过臃肿，学生机的资源又很紧张，动不动就502，本着不折腾就会睡不着觉的精神，装linux系统，装各种云面板，发现也并没有什么改变，遂转到typecho轻量的博客上面，一直用到毕业吧，也没记什么东西，数据库反而崩溃了几次，导致之前的文章也都找不到了，羞于懒惰的思想，一直没有重新开始记录，最近心血来潮，之前就用过hexo，但是没有管理后台，写东西不是很方便一直没用，最近研究了一下，发现使用typora写东西也是非常的舒服，说干就干，耗时两天把博客又从新搭了起来，同时托管在CODING和GITPAGES上。希望自己能够坚持下来，记录自己学习的历程和成长的经历吧。</p>
<p>​    万事开头难，做一切事情的难点都贵在坚持，一切事情只要做了就还不晚，加油，写到现在也不知道自己写了什么乱七八糟的东西，念念不忘，必有回响，愿大家都能得到自己想要的。</p>
<p>​    </p>
]]></content>
      <categories>
        <category>自嘲</category>
      </categories>
      <tags>
        <tag>自嘲</tag>
      </tags>
  </entry>
  <entry>
    <title>服务器上的 Git - 协议</title>
    <url>/2019/04/24/11/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>到目前为止，你应该已经有办法使用 Git 来完成日常工作。 然而，为了使用 Git 协作功能，你还需要有远程的 Git 仓库。 尽管在技术上你可以从个人仓库进行推送（push）和拉取（pull）来修改内容，但不鼓励使用这种方法，因为一不留心就很容易弄混其他人的进度。 此外，你希望你的合作者们即使在你的电脑未联机时亦能存取仓库 — 拥有一个更可靠的公用仓库十分有用。 因此，与他人合作的最佳方法即是建立一个你与合作者们都有权利访问，且可从那里推送和拉取资料的共用仓库。</p>
<p>架设一台 Git 服务器并不难。 首先，选择你希望服务器使用的通讯协议。 在本章第一节将介绍可用的协议以及各自优缺点。 下面一节将解释使用那些协议的典型设置及如何在你的服务器上运行。 最后，如果你不介意托管你的代码在其他人的服务器，且不想经历设置与维护自己服务器的麻烦，可以试试我们介绍的几个仓库托管服务。</p>
<p>如果你对架设自己的服务器没兴趣，可以跳到本章最后一节去看看如何申请一个代码托管服务的帐户然后继续下一章，我们会在那里讨论分散式源码控制环境的林林总总。</p>
<p>一个远程仓库通常只是一个裸仓库（<em>bare repository</em>）— 即一个没有当前工作目录的仓库。 因为该仓库仅仅作为合作媒介，不需要从磁碟检查快照；存放的只有 Git 的资料。 简单的说，裸仓库就是你工程目录内的 <code>.git</code> 子目录内容，不包含其他资料。</p>
<h2 id="协议"><a href="#协议" class="headerlink" title="协议"></a>协议</h2><p>Git 可以使用四种主要的协议来传输资料：本地协议（Local），HTTP 协议，SSH（Secure Shell）协议及 Git 协议。 在此，我们将会讨论那些协议及哪些情形应该使用（或避免使用）他们。</p>
<h3 id="本地协议"><a href="#本地协议" class="headerlink" title="本地协议"></a>本地协议</h3><p>最基本的就是 <em>本地协议（Local protocol）</em> ，其中的远程版本库就是硬盘内的另一个目录。 这常见于团队每一个成员都对一个共享的文件系统（例如一个挂载的 NFS）拥有访问权，或者比较少见的多人共用同一台电脑的情况。 后者并不理想，因为你的所有代码版本库如果长存于同一台电脑，更可能发生灾难性的损失。</p>
<p>如果你使用共享文件系统，就可以从本地版本库克隆（clone）、推送（push）以及拉取（pull）。 像这样去克隆一个版本库或者增加一个远程到现有的项目中，使用版本库路径作为 URL。 例如，克隆一个本地版本库，可以执行如下的命令：</p>
<figure class="highlight console"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">clone</span> /opt/git/project.git</span></span><br></pre></td></tr></table></figure>

<p>或你可以执行这个命令：</p>
<figure class="highlight console"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">clone</span> file:///opt/git/project.git</span></span><br></pre></td></tr></table></figure>

<p>如果在 URL 开头明确的指定 <code>file://</code>，那么 Git 的行为会略有不同。 如果仅是指定路径，Git 会尝试使用硬链接（hard link）或直接复制所需要的文件。 如果指定 <code>file://</code>，Git 会触发平时用于网路传输资料的进程，那通常是传输效率较低的方法。 指定 <code>file://</code> 的主要目的是取得一个没有外部参考（extraneous references）或对象（object）的干净版本库副本– 通常是在从其他版本控制系统导入后或一些类似情况（参见 <a href="https://git-scm.com/book/zh/v2/ch00/ch10-git-internals">Git 内部原理</a> for maintenance tasks）需要这么做。 在此我们将使用普通路径，因为这样通常更快。</p>
<p>要增加一个本地版本库到现有的 Git 项目，可以执行如下的命令：</p>
<figure class="highlight console"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git remote add local_proj /opt/git/project.git</span></span><br></pre></td></tr></table></figure>

<p>然后，就可以像在网络上一样从远端版本库推送和拉取更新了。</p>
<h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h4><p>基于文件系统的版本库的优点是简单，并且直接使用了现有的文件权限和网络访问权限。 如果你的团队已经有共享文件系统，建立版本库会十分容易。 只需要像设置其他共享目录一样，把一个裸版本库的副本放到大家都可以访问的路径，并设置好读/写的权限，就可以了， 我们会在 <a href="https://git-scm.com/book/zh/v2/ch00/r_git_on_the_server">在服务器上搭建 Git</a> 讨论如何导出一个裸版本库。</p>
<p>这也是快速从别人的工作目录中拉取更新的方法。 如果你和别人一起合作一个项目，他想让你从版本库中拉取更新时，运行类似 <code>git pull /home/john/project</code> 的命令比推送到服务再取回简单多了。</p>
<h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><p>这种方法的缺点是，通常共享文件系统比较难配置，并且比起基本的网络连接访问，这不方便从多个位置访问。 如果你想从家里推送内容，必须先挂载一个远程磁盘，相比网络连接的访问方式，配置不方便，速度也慢。</p>
<p>值得一提的是，如果你使用的是类似于共享挂载的文件系统时，这个方法不一定是最快的。 访问本地版本库的速度与你访问数据的速度是一样的。 在同一个服务器上，如果允许 Git 访问本地硬盘，一般的通过 NFS 访问版本库要比通过 SSH 访问慢。</p>
<p>最终，这个协议并不保护仓库避免意外的损坏。 每一个用户都有“远程”目录的完整 shell 权限，没有方法可以阻止他们修改或删除 Git 内部文件和损坏仓库。</p>
<h3 id="HTTP-协议"><a href="#HTTP-协议" class="headerlink" title="HTTP 协议"></a>HTTP 协议</h3><p>Git 通过 HTTP 通信有两种模式。 在 Git 1.6.6 版本之前只有一个方式可用，十分简单并且通常是只读模式的。 Git 1.6.6 版本引入了一种新的、更智能的协议，让 Git 可以像通过 SSH 那样智能的协商和传输数据。 之后几年，这个新的 HTTP 协议因为其简单、智能变的十分流行。 新版本的 HTTP 协议一般被称为“智能” HTTP 协议，旧版本的一般被称为“哑” HTTP 协议。 我们先了解一下新的“智能” HTTP 协议。</p>
<h4 id="智能（Smart）-HTTP-协议"><a href="#智能（Smart）-HTTP-协议" class="headerlink" title="智能（Smart） HTTP 协议"></a>智能（Smart） HTTP 协议</h4><p>“智能” HTTP 协议的运行方式和 SSH 及 Git 协议类似，只是运行在标准的 HTTP/S 端口上并且可以使用各种 HTTP 验证机制，这意味着使用起来会比 SSH 协议简单的多，比如可以使用 HTTP 协议的用户名／密码的基础授权，免去设置 SSH 公钥。</p>
<p>智能 HTTP 协议或许已经是最流行的使用 Git 的方式了，它即支持像 <code>git://</code> 协议一样设置匿名服务，也可以像 SSH 协议一样提供传输时的授权和加密。 而且只用一个 URL 就可以都做到，省去了为不同的需求设置不同的 URL。 如果你要推送到一个需要授权的服务器上（一般来讲都需要），服务器会提示你输入用户名和密码。 从服务器获取数据时也一样。</p>
<p>事实上，类似 GitHub 的服务，你在网页上看到的 URL （比如， <code>https://github.com/schacon/simplegit[]</code>)，和你在克隆、推送（如果你有权限）时使用的是一样的。</p>
<h4 id="哑（Dumb）-HTTP-协议"><a href="#哑（Dumb）-HTTP-协议" class="headerlink" title="哑（Dumb） HTTP 协议"></a>哑（Dumb） HTTP 协议</h4><p>如果服务器没有提供智能 HTTP 协议的服务，Git 客户端会尝试使用更简单的“哑” HTTP 协议。 哑 HTTP 协议里 web 服务器仅把裸版本库当作普通文件来对待，提供文件服务。 哑 HTTP 协议的优美之处在于设置起来简单。 基本上，只需要把一个裸版本库放在 HTTP 根目录，设置一个叫做 <code>post-update</code> 的挂钩就可以了（见 <a href="https://git-scm.com/book/zh/v2/ch00/r_git_hooks">Git 钩子</a>）。 此时，只要能访问 web 服务器上你的版本库，就可以克隆你的版本库。 下面是设置从 HTTP 访问版本库的方法：</p>
<figure class="highlight console"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> /var/www/htdocs/</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">clone</span> --bare /path/to/git_project gitproject.git</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> gitproject.git</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mv hooks/post-update.sample hooks/post-update</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> chmod a+x hooks/post-update</span></span><br></pre></td></tr></table></figure>

<p>这样就可以了。 Git 自带的 <code>post-update</code> 挂钩会默认执行合适的命令（<code>git update-server-info</code>），来确保通过 HTTP 的获取和克隆操作正常工作。 这条命令会在你通过 SSH 向版本库推送之后被执行；然后别人就可以通过类似下面的命令来克隆：</p>
<figure class="highlight console"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">clone</span> https://example.com/gitproject.git</span></span><br></pre></td></tr></table></figure>

<p>这里我们用了 Apache 里设置了常用的路径 <code>/var/www/htdocs</code>，不过你可以使用任何静态 web 服务器 —— 只需要把裸版本库放到正确的目录下就可以。 Git 的数据是以基本的静态文件形式提供的（详情见 <a href="https://git-scm.com/book/zh/v2/ch00/ch10-git-internals">Git 内部原理</a>）。</p>
<p>通常的，会在可以提供读／写的智能 HTTP 服务和简单的只读的哑 HTTP 服务之间选一个。 极少会将二者混合提供服务。</p>
<h4 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a>优点</h4><p>我们将只关注智能 HTTP 协议的优点。</p>
<p>不同的访问方式只需要一个 URL 以及服务器只在需要授权时提示输入授权信息，这两个简便性让终端用户使用 Git 变得非常简单。 相比 SSH 协议，可以使用用户名／密码授权是一个很大的优势，这样用户就不必须在使用 Git 之前先在本地生成 SSH 密钥对再把公钥上传到服务器。 对非资深的使用者，或者系统上缺少 SSH 相关程序的使用者，HTTP 协议的可用性是主要的优势。 与 SSH 协议类似，HTTP 协议也非常快和高效。</p>
<p>你也可以在 HTTPS 协议上提供只读版本库的服务，如此你在传输数据的时候就可以加密数据；或者，你甚至可以让客户端使用指定的 SSL 证书。</p>
<p>另一个好处是 HTTP/S 协议被广泛使用，一般的企业防火墙都会允许这些端口的数据通过。</p>
<h4 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h4><p>在一些服务器上，架设 HTTP/S 协议的服务端会比 SSH 协议的棘手一些。 除了这一点，用其他协议提供 Git 服务与 “智能” HTTP 协议相比就几乎没有优势了。</p>
<p>如果你在 HTTP 上使用需授权的推送，管理凭证会比使用 SSH 密钥认证麻烦一些。 然而，你可以选择使用凭证存储工具，比如 OSX 的 Keychain 或者 Windows 的凭证管理器。 参考 <a href="https://git-scm.com/book/zh/v2/ch00/r_credential_caching">凭证存储</a> 如何安全地保存 HTTP 密码。</p>
<h3 id="SSH-协议"><a href="#SSH-协议" class="headerlink" title="SSH 协议"></a>SSH 协议</h3><p>架设 Git 服务器时常用 SSH 协议作为传输协议。 因为大多数环境下已经支持通过 SSH 访问 —— 即时没有也比较很容易架设。 SSH 协议也是一个验证授权的网络协议；并且，因为其普遍性，架设和使用都很容易。</p>
<p>通过 SSH 协议克隆版本库，你可以指定一个 <code>ssh://</code> 的 URL：</p>
<figure class="highlight console"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">clone</span> ssh://user@server/project.git</span></span><br></pre></td></tr></table></figure>

<p>或者使用一个简短的 scp 式的写法：</p>
<figure class="highlight console"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">clone</span> user@server:project.git</span></span><br></pre></td></tr></table></figure>

<p>你也可以不指定用户，Git 会使用当前登录的用户名。</p>
<h4 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h4><p>用 SSH 协议的优势有很多。 首先，SSH 架设相对简单 —— SSH 守护进程很常见，多数管理员都有使用经验，并且多数操作系统都包含了它及相关的管理工具。 其次，通过 SSH 访问是安全的 —— 所有传输数据都要经过授权和加密。 最后，与 HTTP/S 协议、Git 协议及本地协议一样，SSH 协议很高效，在传输前也会尽量压缩数据。</p>
<h4 id="缺点-2"><a href="#缺点-2" class="headerlink" title="缺点"></a>缺点</h4><p>SSH 协议的缺点在于你不能通过他实现匿名访问。 即便只要读取数据，使用者也要有通过 SSH 访问你的主机的权限，这使得 SSH 协议不利于开源的项目。 如果你只在公司网络使用，SSH 协议可能是你唯一要用到的协议。 如果你要同时提供匿名只读访问和 SSH 协议，那么你除了为自己推送架设 SSH 服务以外，还得架设一个可以让其他人访问的服务。</p>
<h3 id="Git-协议"><a href="#Git-协议" class="headerlink" title="Git 协议"></a>Git 协议</h3><p>接下来是 Git 协议。 这是包含在 Git 里的一个特殊的守护进程；它监听在一个特定的端口（9418），类似于 SSH 服务，但是访问无需任何授权。 要让版本库支持 Git 协议，需要先创建一个 <code>git-daemon-export-ok</code> 文件 —— 它是 Git 协议守护进程为这个版本库提供服务的必要条件 —— 但是除此之外没有任何安全措施。 要么谁都可以克隆这个版本库，要么谁也不能。 这意味着，通常不能通过 Git 协议推送。 由于没有授权机制，一旦你开放推送操作，意味着网络上知道这个项目 URL 的人都可以向项目推送数据。 不用说，极少会有人这么做。</p>
<h4 id="优点-2"><a href="#优点-2" class="headerlink" title="优点"></a>优点</h4><p>目前，Git 协议是 Git 使用的网络传输协议里最快的。 如果你的项目有很大的访问量，或者你的项目很庞大并且不需要为写进行用户授权，架设 Git 守护进程来提供服务是不错的选择。 它使用与 SSH 相同的数据传输机制，但是省去了加密和授权的开销。</p>
<h4 id="缺点-3"><a href="#缺点-3" class="headerlink" title="缺点"></a>缺点</h4><p>Git 协议缺点是缺乏授权机制。 把 Git 协议作为访问项目版本库的唯一手段是不可取的。 一般的做法里，会同时提供 SSH 或者 HTTPS 协议的访问服务，只让少数几个开发者有推送（写）权限，其他人通过 <code>git://</code> 访问只有读权限。 Git 协议也许也是最难架设的。 它要求有自己的守护进程，这就要配置 <code>xinetd</code>或者其他的程序，这些工作并不简单。 它还要求防火墙开放 9418 端口，但是企业防火墙一般不会开放这个非标准端口。 而大型的企业防火墙通常会封锁这个端口。</p>
]]></content>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>H3C WA4330-ACN的指示灯说明</title>
    <url>/2019/04/24/13/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>WA4330-ACN的指示灯说明如下表所示。</p>
<p>表A-1 指示灯状态说明</p>
<table>
<thead>
<tr>
<th>指示灯</th>
<th>指示灯颜色</th>
<th>指示灯状态</th>
<th>状态说明</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td>橙色</td>
<td>常亮</td>
<td>设备上电启动中</td>
</tr>
<tr>
<td>1Hz闪烁</td>
<td>以太网口或射频口异常（以太网接口down或检测不到射频接口等）</td>
<td></td>
<td></td>
</tr>
<tr>
<td>2Hz闪烁</td>
<td>Blink模式 配置Blink状态检测功能后，关联到AC的Fit AP闪烁指示灯以示关联AC成功</td>
<td></td>
<td></td>
</tr>
<tr>
<td>绿色</td>
<td>常亮</td>
<td>AP未成功注册到AC前一直处于此状态</td>
<td></td>
</tr>
<tr>
<td>1Hz闪烁</td>
<td>2.4G射频接口有客户端在线</td>
<td></td>
<td></td>
</tr>
<tr>
<td>蓝色</td>
<td>常亮</td>
<td>AP已经启动完成并已经注册到AC，正处于待机状态（无客户端在线）</td>
<td></td>
</tr>
<tr>
<td>1Hz闪烁</td>
<td>5G射频接口有客户端在线</td>
<td></td>
<td></td>
</tr>
<tr>
<td>2Hz闪烁</td>
<td>AP正在更新应用程序</td>
<td></td>
<td></td>
</tr>
<tr>
<td>绿蓝交替</td>
<td>1Hz交替闪烁</td>
<td>2.4G和5G射频接口均有客户端在线</td>
<td></td>
</tr>
<tr>
<td>常灭</td>
<td>设备初始化异常</td>
<td></td>
<td></td>
</tr>
</tbody></table>
]]></content>
  </entry>
  <entry>
    <title>100.64.0.1运营商级(Carrier-grade)NAT保留IP地址</title>
    <url>/2019/04/24/14/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>在一次跟踪路由的网络操作时发现自己路由器下一跳路由节点的IP地址比较奇怪，是<code>100.64.0.1</code>。好奇促使我查询了这个IP地址的归属，结果是保留地址，到这里觉得比较奇怪了，按照常理以IPv4为例保留的IP地址一般为以下几种，常用于内网通讯或者特殊用途：</p>
<table>
<thead>
<tr>
<th>地址块</th>
<th>起始</th>
<th>结束</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>10.0.0.0/8</td>
<td>10.0.0.0</td>
<td>10.255.255.255</td>
<td>局域网分配</td>
</tr>
<tr>
<td>172.16.0.0/12</td>
<td>172.16.0.0</td>
<td>172.31.255.255</td>
<td>局域网分配</td>
</tr>
<tr>
<td>192.0.0.0/24</td>
<td>192.168.0.0</td>
<td>192.168.255.255</td>
<td>局域网分配</td>
</tr>
<tr>
<td>169.254.0.0/16</td>
<td>169.254.0.0</td>
<td>169.254.255.255</td>
<td>两台主机对等连接，当Windows获取不到IP地址的时候会自动分配此类地址</td>
</tr>
<tr>
<td>127.0.0.0/8</td>
<td>127.0.0.0</td>
<td>127.255.255.255</td>
<td>回环(loopback)地址，表示本机</td>
</tr>
<tr>
<td>255.255.255.255/32</td>
<td>255.255.255.255</td>
<td>255.255.255.255</td>
<td>广播地址</td>
</tr>
</tbody></table>
<p>这个<code>100.64</code>开头的IP地址又是什么鬼？搜索<a href="https://en.wikipedia.org/wiki/Reserved_IP_addresses">维基百科的Reserved IP Address词条</a>才发现原来教科书上介绍的只是部分保留地址，整个保留地址家族的成员还是比较多的，那么<code>100.64</code>打头的IP地址对应地址块为<code>100.64.0.0/10</code>，地址范围为<code>100.64.0.0</code>~<code>100.127.255.255</code>，共包含有4,194,304个IP地址，这个保留地址也是用于内网，但是这个内网不是一般内网而是<a href="https://en.wikipedia.org/wiki/Carrier-grade_NAT">Carrier-grade NAT</a>，这个英文对应的翻译是“运营商级NAT”。进一步搜索得知2012年4月的 <a href="https://tools.ietf.org/html/rfc6598">RFC 6598</a>(IANA-Reserved IPv4 Prefix for Shared Address Space) 将 <code>100.64.0.0/10</code> (Shared Address Space) 地址块，用于给运营商ISP使用：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">NetRange:       100.64.0.0 - 100.127.255.255</span><br><span class="line">CIDR:           100.64.0.0&#x2F;10</span><br><span class="line">OriginAS:</span><br><span class="line">NetName:        SHARED-ADDRESS-SPACE-RFCTBD-IANA-RESERVED</span><br><span class="line">NetHandle:      NET-100-64-0-0-1</span><br><span class="line">Parent:         NET-100-0-0-0-0</span><br><span class="line">NetType:        IANA Special Use</span><br></pre></td></tr></table></figure>

<p>据此可以推断出电信的黑科技实际上是使用了一个类似路由的设备将我们的网络组织成一个局域网，再通过网址转换NAT技术来实现网络通信，可以这么理解吧，我们以前通过PPPoE拨号获取的是随机分配的公网IP地址，这个IP地址是完全可以被互联网上任何设备访问的无障碍地址，但是现在通过拨号获取的只是一个内网地址，也就是说我们自己的路由器或者电脑拨号连接到了电信运营商的“大路由器”上，再也没有公网IP地址了。</p>
<p>为什么电信要使用这种方式来管理用户上网？首先我们要知道IPv4地址已经告枯竭，2011年2月4日全球顶级IP地址分配机构IANA分配完了最后5个A级地址块，因此IANA宣告IPv4地址告罄。2011年4月15日，APNIC宣布其剩余的可自由分配的IPv4地址已全部分配完毕，亚太地区进入IPv4地址耗尽阶段。随后几个月，中国各大运营商从APNIC以会员资格申请到了最后的几个C，至此各运营商也陷入了IPv4地址耗尽的困境。由于IPv6技术进展缓慢，为了解决IPv4耗尽对电信企业日益增长的用户对于网络需求的影响，NAT444/NAT44的方案由此诞生。</p>
<p>NAT444/NAT44方案说白了就是将过去每个宽带用户独立分配公网IP的方式改为分配内网IP给每个用户，运营商再对接入的用户统一部署NAT设备，NAT的作用就是将用户网络连接发起的内网IP，以端口连接的形式翻译成公网IP，再对外网资源进行连接。这样做以后，可以实现多个用户共享一个IP地址，在技术实现原理上和我们家用的路由器一样，其中NAT444对应传统宽带用户，NAT44则对应3G或者4G移动上网终端。</p>
<p>这样做的好处显而易见，首先延缓了IPv4耗尽对电信业务带来的威胁并进一步为IPv6技术部署留足时间，其次是内网保护，所有接入互联网的主机都不再直接接入，而是出于电信NAT设备的保护之下，没有独立的公网IP，所有端对端的远控软件将会失效，比如以前的灰鸽子木马，由于主机丧失了公网IP，灰鸽子反弹的IP地址将是电信NAT设备所使用的公网IP，黑客无法以此定位到中了灰鸽子木马的具体主机，不过这不影响第三方端口转发的远控软件，比如TeamViewer，但是对传统远控软件杀伤力是巨大的。最后增强了隐私保护，对于远端的网站通过IP地址跟踪等形式采集用户数据，或者以后台记录IP的形式定位用户身份的行为将不再有效，因为这个IP地址可以同一时间段内被大量用户所使用，所以部分广告商可能需要修改广告跟踪代码的相关逻辑，这边顺带说一句并不意味着处于电信NAT保护的用户可以做违法的事情，比较电信公司不是傻瓜，电信级NAT设备会有日志记录系统，所以处于其下的网络设备的上网流量都是得到有效审计的。</p>
<p>这样做的坏处是什么呢？首先丧失了公网IP让极客们的生活失去了不少乐趣，比如原先通过花生壳动态域名解析服务可以定位到我们家的上网设备，然后可以在上面架设一些服务等，从最原始的网站服务（<a href="https://wangye.org/blog/archives/662/">电信封锁了80端口</a>）到远程私有云存储，甚至是个人VPN等等，现在都不能直接使用了，因为动态域名服务解析的IP地址是电信级NAT设备所使用的公网IP，同时也是若干电信用户所共享的IP地址，NAT并不会转发你的请求到特定的电信用户，所以这些服务都失效了，其实这对于安装远程网络监控的公司或者个人带来的麻烦最大，原来只要配置好动态域名解析就可以在任何地方使用网络进行监控查看，现在都不可以了。其次共用IP地址容易让部分网络服务提供商误杀合法用户，比如一位非法的资源滥用电信用户和你在共享同一个公网IP地址，非法的资源滥用者由于滥用某个网络服务商资源从而被加入黑名单，注意这里只有将你们所共享的公网IP地址加入了黑名单，所以导致你这个合法的用户也不能正常使用该网络服务商所提供的资源了。最后这样做的坏处还有影响到电驴等P2P软件的使用，因为处于内网下导致电驴等软件一直是LowID，影响传输速度。</p>
<p>如何解决此问题？要想重新获取公网IP，最后还是要联系电信运营商，不行只有进行投诉解决了。</p>
<p>后来发现这种现象普遍存在，甚至有电信运营商直接分配172或者10开头的内网IP地址，但这种分配方式容易与用户自己的路由器IP地址冲突，所以还是100.64开头这种好一些，毕竟新设立专用于ISP运营的保留地址，个人网络设备占用的可能性较低。</p>
<p>希望IPv6能够尽快全面推广开，从而解决现在尴尬的局面。</p>
<p><strong>参考文档</strong></p>
<ul>
<li><a href="https://v2ex.com/t/96486">电信偷偷把公网IP换成了内网IP</a></li>
<li><a href="http://www.v2ex.com/t/90496">电信不给独立IP了，共享的IP怎么开 SSH 什么的？</a></li>
<li><a href="http://safe.it168.com/a2013/1209/1570/000001570976.shtml">为什么需要运营商级NAT设备？</a></li>
<li><a href="https://blog.gslin.org/archives/2013/01/17/3140/isp-%E6%9E%B6%E8%A8%AD-nat-%E8%A7%A3%E6%B1%BA-ipv4-%E4%B8%8D%E5%A4%A0%E7%9A%84%E5%95%8F%E9%A1%8C/">ISP 架設 NAT 解決 IPv4 不夠的問題…</a></li>
</ul>
]]></content>
      <tags>
        <tag>网络</tag>
      </tags>
  </entry>
  <entry>
    <title>子网掩码、反掩码以及ospf network命令误区</title>
    <url>/2019/04/24/16/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>在学习过程中，难免会有些误区，本文为大家彻底澄清子网掩码、反掩码、通配符掩码以及ospf network命令误区，并介绍一些正确的示例：</p>
<p><strong>1.子网掩码(IP subnet mask)</strong></p>
<p>用途：标识一个IP地址的网络位，主机位</p>
<p>网络设备判断目的IP跟自己是否同一网段的依据。</p>
<p>特点：1和0绝对不可能间隔，1总在0的前面。</p>
<p>网络通信角度，子网掩码只具有本地意义。跟对端没有匹配的硬性要求。</p>
<p>误区：一条链路两端的子网掩码必须一致(是习惯不是必须)</p>
<p>例外：ospf 多路访问网络中，掩码不一致会影响ospf邻居关系建立</p>
<p><img src="https://ws1.sinaimg.cn/large/d3bb92edly1g2h4zfirezj218o0l8gs5.jpg"></p>
<p><strong>2.通配符掩码 wildcard mask</strong></p>
<p>用途：选出一组符合否规则的IP地址</p>
<p>特点：0表匹配，1表示不需要匹配。0和1 的位置根据需求可随意穿插</p>
<p>示例1：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">deny ip 192.168.1.0 0.0.0.255 192.168.2.0 0.0.0.255</span><br><span class="line"></span><br><span class="line">deny ip 192.168.1.2 0.0.0.255 192.168.2.2 0.0.0.255</span><br><span class="line"></span><br><span class="line">deny ip 192.168.1.3 0.0.0.255 192.168.2.3 0.0.0.255</span><br></pre></td></tr></table></figure>

<p>这三跳条目是完全相同的，效果都是阻止192.168.1.x 访问192.168.1.x (x表示任意数字)</p>
<p>红色字体部分对应的是全1，所以是忽略的 ，写什么都无所谓了</p>
<p>实例2：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">deny ip 192.168.1.0 255.0.0.255 192.168.2.0 255.0.0.255</span><br><span class="line"></span><br><span class="line">deny ip 193.168.1.0 255.0.0.255 193.168.2.0 255.0.0.255</span><br><span class="line"></span><br><span class="line">deny ip 194.168.1.0 255.0.0.255 194.168.2.0 255.0.0.255</span><br></pre></td></tr></table></figure>

<p>这三跳条目是完全相同的，效果都是阻止x.168.1.x 访问 x.168.2.x (x表示任意数字)</p>
<p>红色字体部分对应的是全1，所以是忽略的 ，写什么都无所谓了</p>
<p><strong>3. 反掩码(中国式教育的败笔，误人子弟的一个说法，通配符掩码的错误理解)</strong></p>
<p>需求1：阻止192.168.1.0/24 访问 192.168.2.0/24</p>
<p>命令：deny ip 192.168.1.0 0.0.0.255 192.168.2.0 0.0.0.255</p>
<p>看起啦确实是把掩码反过来写正好满足要求，实际上逻辑关系已经变了。只是恰巧蒙对了而已。</p>
<p>少有求知欲的同学都有必要问一下，为什么要把掩码反过来写呢?</p>
<p>如果写成 deny ip 192.168.1.0 255.255.255.0 192.168.2.0 255.255.255.0</p>
<p>严格解读效果是：拒绝 x.x.x.0 访问 x.x.x.0</p>
<p>但是很多版本故作人性化，show run的时候自己给该成了：</p>
<p>deny ip 192.168.1.0 0.0.0.255 192.168.2.0 0.0.0.255</p>
<p>这属于操作系统对客户错误理解的妥协</p>
<p>后期的思科版本不再做此修改</p>
<p>-—————————————————————-</p>
<p>需求2：阻止 X.168.1.x 访问 X.168.2.x</p>
<p>命令：deny ip 192.168.1.0 255.0.0.255 192.168.2.0 255.0.0.255</p>
<p>这个需求用反掩码的逻辑恐怕就行不通了吧? 当然这个需求属于怪异需求。</p>
<p><strong>4.ospf的network命令(非rfc规定，各厂家可以自行设计，以下为大部分厂家逻辑)</strong></p>
<p>正解：</p>
<p>Network + IP + wild card bits</p>
<p>Network 通过 IP 和 wild card bits 筛选出一组IP地址，从而定位出需要开启OSPF的接口(谁拥有其中一个IP地址谁就开启OSPF)</p>
<p>接口开启ospf 含义有二：1. 从该接口收发ospf报文</p>
<p>2.该接口所在的网络对应的路由成为ospf的资源，从其他接口发给邻居(当然ospf发的不是路由条目)</p>
<p>示例：inter f0/1</p>
<p>ip add 10.1.1.1 255.255.255.0</p>
<p>router ospf 1</p>
<p>network 10.1.1.1 0.0.0.255 area 0</p>
<p>这个network命令实际上宣告了10.1.1.0-10.1.1.255 这256个地址。</p>
<p>当然在这个环境下恰好有且仅有一个接口在这个范围内。</p>
<p>也就是说把接口的掩码反过来写正好能且只能宣告一个接口。不会多宣告</p>
<p>如果写成</p>
<p>network 10.1.1.1 0.0.0.0 area 0 效果也完全一样</p>
<p>或者写成</p>
<p>network 10.1.1.2 0.0.0.255 area 0 红色字体部分随便写，效果也是一样的</p>
<p>如果写成</p>
<p>network 0.0.0.0 255.255.255.255 area 0 宣告所有的IP地址，也就是所有的接口</p>
<p>如果写成</p>
<p>network 0.0.0.0 0.0.0.0 area 0 也是宣告所有接口，逻辑上讲不通(这个背过吧)</p>
<p>重大误区：</p>
<p>\1. network 宣告的是路由，影响邻居学习路由的掩码</p>
<p>\2. network IP 后面跟的是反掩码，必须把掩码反过来写，否则会影响路由学习</p>
<p>错误理解示例1：</p>
<p>network 10.1.1.1 0.0.0.0</p>
<p>会导致邻居学到 10.1.1.1/32位的路由(已经遇到好多人跟我纠结这种问题，唉，网络世界，其实难寻知己)</p>
<p>原文博客：<a href="http://blog.sina.com.cn/s/blog_bf5ae9030101cy25.html">http://blog.sina.com.cn/s/blog_bf5ae9030101cy25.html</a></p>
]]></content>
      <tags>
        <tag>路由协议</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux nc命令详解</title>
    <url>/2019/04/24/17/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="什么是nc"><a href="#什么是nc" class="headerlink" title="什么是nc"></a>什么是nc</h1><p>nc是netcat的简写，有着网络界的瑞士军刀美誉。因为它短小精悍、功能实用，被设计为一个简单、可靠的网络工具</p>
<h1 id="nc的作用"><a href="#nc的作用" class="headerlink" title="nc的作用"></a>nc的作用</h1><p>（1）实现任意TCP/UDP端口的侦听，nc可以作为server以TCP或UDP方式侦听指定端口</p>
<p>（2）端口的扫描，nc可以作为client发起TCP或UDP连接</p>
<p>（3）机器之间传输文件</p>
<p>（4）机器之间网络测速                                                                                                                                                                                                                        </p>
<h1 id="nc的控制参数不少，常用的几个参数如下所列："><a href="#nc的控制参数不少，常用的几个参数如下所列：" class="headerlink" title="nc的控制参数不少，常用的几个参数如下所列："></a>nc的控制参数不少，常用的几个参数如下所列：</h1><ol>
<li>-l</li>
</ol>
<p>用于指定nc将处于侦听模式。指定该参数，则意味着nc被当作server，侦听并接受连接，而非向其它地址发起连接。</p>
<ol start="2">
<li>-p <port></li>
</ol>
<p>暂未用到（老版本的nc可能需要在端口号前加-p参数，下面测试环境是centos6.6，nc版本是nc-1.84，未用到-p参数）</p>
<ol start="3">
<li>-s </li>
</ol>
<p>指定发送数据的源IP地址，适用于多网卡机 </p>
<ol start="4">
<li><p>-u</p>
<p>指定nc使用UDP协议，默认为TCP</p>
</li>
<li><p>-v</p>
</li>
</ol>
<p>输出交互或出错信息，新手调试时尤为有用</p>
<p>6）-w</p>
<p>超时秒数，后面跟数字 </p>
<p>7）-z</p>
<p>表示zero，表示扫描时不发送任何数据</p>
<h1 id="前期准备"><a href="#前期准备" class="headerlink" title="前期准备"></a>前期准备</h1><p>准备两台机器，用于测试nc命令的用法</p>
<p>主机A：ip地址 10.0.1.161</p>
<p>主机B：ip地址 10.0.1.162</p>
<p>两台机器先安装nc和nmap的包</p>
<p>yum install nc -y</p>
<p>yum install nmap -y</p>
<h1 id="nc用法1，网络连通性测试和端口扫描"><a href="#nc用法1，网络连通性测试和端口扫描" class="headerlink" title="nc用法1，网络连通性测试和端口扫描"></a><strong>nc用法1，网络连通性测试和端口扫描</strong></h1><p><strong>nc可以作为server端启动一个tcp的监听（注意，此处重点是起tcp，下面还会讲udp）</strong></p>
<p>先关闭A的防火墙，或者放行下面端口，然后测试B机器是否可以访问A机器启动的端口</p>
<p>在A机器上启动一个端口监听，比如 9999端口（注意：下面的-l 是小写的L，不是数字1）</p>
<p>默认情况下下面监听的是一个tcp的端口</p>
<p>nc -l 9999</p>
<p><img src="https://images2015.cnblogs.com/blog/1076878/201612/1076878-20161209095543554-1037638344.png" alt="img"></p>
<p><strong>客户端测试，**</strong>测试方法1**</p>
<p>在B机器上telnet A机器此端口，如下显示表示B机器可以访问A机器此端口</p>
<p><img src="https://images2015.cnblogs.com/blog/1076878/201612/1076878-20161209095601413-784407778.png" alt="img"></p>
<p><strong>客户端测试，测试方法2</strong></p>
<p>B机器上也可以使用nmap扫描A机器的此端口</p>
<p>nmap 10.0.1.161 -p9999</p>
<p><img src="https://images2015.cnblogs.com/blog/1076878/201612/1076878-20161209095617601-914929817.png" alt="img"></p>
<p><strong>客户端测试，测试方法3</strong></p>
<p>使用nc命令作为客户端工具进行端口探测</p>
<p>nc -vz -w 2 10.0.1.161 9999</p>
<p>（-v可视化，-z扫描时不发送数据，-w超时几秒，后面跟数字）</p>
<p><img src="https://images2015.cnblogs.com/blog/1076878/201612/1076878-20161209095634851-958356921.png" alt="img"></p>
<p>上面命令也可以写成</p>
<p>nc -vzw 2 10.0.1.161 9999</p>
<p><img src="https://images2015.cnblogs.com/blog/1076878/201612/1076878-20161209095651569-1755893958.png" alt="img"></p>
<p><strong>客户端测试，测试方法4（和方法3相似，但用处更大）</strong></p>
<p>nc可以可以扫描连续端口，这个作用非常重要。常常可以用来扫描服务器端口，然后给服务器安全加固</p>
<p>在A机器上监听2个端口，一个9999，一个9998，使用&amp;符号丢入后台</p>
<p><img src="https://images2015.cnblogs.com/blog/1076878/201612/1076878-20161209095712866-936204965.png" alt="img"></p>
<p>在客户端B机器上扫描连续的两个端口，如下</p>
<p><img src="https://images2015.cnblogs.com/blog/1076878/201612/1076878-20161209095732429-1764157681.png" alt="img"></p>
<p><strong>nc作为server端启动一个udp的监听（注意，此处重点是起udp，上面主要讲了tcp）</strong></p>
<p>启动一个udp的端口监听</p>
<p>nc  -ul  9998</p>
<p><img src="https://images2015.cnblogs.com/blog/1076878/201612/1076878-20161209095753835-1671845784.png" alt="img"></p>
<p>复制当前窗口输入 netstat -antup |grep 9998 可以看到是启动了udp的监听</p>
<p><img src="https://images2015.cnblogs.com/blog/1076878/201612/1076878-20161209095812632-1749454663.png" alt="img"></p>
<p><strong>客户端测试，测试方法1</strong></p>
<p>nc -vuz 10.0.1.161 9998</p>
<p>由于udp的端口无法在客户端使用telnet去测试，我们可以使用nc命令去扫描（前面提到nc还可以用来扫描端口）</p>
<p>（telnet是运行于tcp协议的）</p>
<p>（u表示udp端口，v表示可视化输出，z表示扫描时不发送数据）</p>
<p><img src="https://images2015.cnblogs.com/blog/1076878/201612/1076878-20161209100707882-1433264712.png" alt="img"></p>
<p>上面在B机器扫描此端口的时候，看到A机器下面出现一串XXXXX字符串</p>
<p><img src="https://images2015.cnblogs.com/blog/1076878/201612/1076878-20161209100725866-2147390474.png" alt="img"></p>
<p><strong>客户端测试，测试方法2</strong></p>
<p>nmap -sU 10.0.1.161 -p 9998 -Pn</p>
<p>（它暂无法测试nc启动的udp端口，每次探测nc作为server端启动的udp端口时，会导致对方退出侦听，有这个bug，对于一些程序启动的udp端口在使用nc扫描时不会有此bug）</p>
<p>下面，A机器启动一个udp的端口监听，端口为9998</p>
<p>在复制的窗口上可以确认已经在监听了</p>
<p><img src="https://images2015.cnblogs.com/blog/1076878/201612/1076878-20161209100746272-590584994.png" alt="img"></p>
<p>B机器使用nmap命令去扫描此udp端口，在扫描过程中，导致A机器的nc退出监听。所以显示端口关闭了（我推测是扫描时发数据导致的）</p>
<p>nmap -sU 10.0.1.161 -p 9998 -Pn</p>
<p>-sU ：表示udp端口的扫描</p>
<p>-Pn ：如果服务器禁PING或者放在防火墙下面的，不加-Pn 参数的它就会认为这个扫描的主机不存活就不会进行扫描了，如果不加-Pn就会像下面的结果一样，它也会进行提示你添加上-Pn参数尝试的</p>
<p><img src="https://images2015.cnblogs.com/blog/1076878/201612/1076878-20161209100804726-1083735542.png" alt="img"></p>
<p>注意：如果A机器开启了防火墙，扫描结果可能会是下面状态。（不能确定对方是否有监听9998端口）</p>
<p><img src="https://images2015.cnblogs.com/blog/1076878/201612/1076878-20161209100817866-337685966.png" alt="img"></p>
<p>既然上面测试无法使用nmap扫描nc作为服务端启动的端口，我们可以使用nmap扫描其余的端口</p>
<p>（额，有点跑题了，讲nmap的用法了，没关系，主要为了说明nmap是也可以用来扫描udp端口的，只是扫描nc启动的端口会导致对方退出端口监听）</p>
<p>下面，A机器上rpcbind服务，监听在udp的111端口</p>
<p><img src="https://images2015.cnblogs.com/blog/1076878/201612/1076878-20161209100833757-599551176.png" alt="img"></p>
<p>在B机器上使用nmap扫描此端口，是正常的检测到处于open状态</p>
<p><img src="https://images2015.cnblogs.com/blog/1076878/201612/1076878-20161209100847319-1809046272.png" alt="img"></p>
<p><strong>客户端测试，测试方法3</strong></p>
<p><strong>nc扫描大量udp端口</strong></p>
<p>扫描过程比较慢，可能是1秒扫描一个端口，下面表示扫描A机器的1到1000端口（暂未发现可以在一行命令中扫描分散的几个端口的方法）</p>
<p>nc -vuz 10.0.1.161 1-1000</p>
<p><img src="https://images2015.cnblogs.com/blog/1076878/201612/1076878-20161209100901819-1505522198.png" alt="img"></p>
<h1 id="nc用法2，使用nc传输文件和目录"><a href="#nc用法2，使用nc传输文件和目录" class="headerlink" title="nc用法2，使用nc传输文件和目录"></a><strong>nc用法2，使用nc传输文件和目录</strong></h1><p><strong>方法1，传输文件演示（先启动接收命令）</strong></p>
<p>使用nc传输文件还是比较方便的，因为不用scp和rsync那种输入密码的操作了</p>
<p>把A机器上的一个rpm文件发送到B机器上</p>
<p>需注意操作次序，receiver先侦听端口，sender向receiver所在机器的该端口发送数据。  </p>
<p><strong>步骤1，先在B机器上启动一个接收文件的监听，格式如下</strong></p>
<p>意思是把赖在9995端口接收到的数据都写到file文件里（这里文件名随意取）</p>
<p>nc -l port &gt;file</p>
<p>nc -l 9995 &gt;zabbix.rpm</p>
<p><img src="https://images2015.cnblogs.com/blog/1076878/201612/1076878-20161209100917507-1008395936.png" alt="img"></p>
<p><strong>步骤2，在A机器上往B机器的9995端口发送数据，把下面rpm包发送过去</strong></p>
<p>nc 10.0.1.162 9995 &lt; zabbix-release-2.4-1.el6.noarch.rpm</p>
<p><img src="https://images2015.cnblogs.com/blog/1076878/201612/1076878-20161209100931116-1268991306.png" alt="img"></p>
<p>B机器接收完毕，它会自动退出监听，文件大小和A机器一样，md5值也一样</p>
<p><img src="https://images2015.cnblogs.com/blog/1076878/201612/1076878-20161209100944897-733297904.png" alt="img"></p>
<p><strong>方法2，传输文件演示（先启动发送命令）</strong></p>
<p><strong>步骤1，先在B机器上，启动发送文件命令</strong></p>
<p>下面命令表示通过本地的9992端口发送test.mv文件</p>
<p>nc -l 9992 &lt;test.mv</p>
<p><img src="https://images2015.cnblogs.com/blog/1076878/201612/1076878-20161209101002038-290824858.png" alt="img"></p>
<p><strong>步骤2，A机器上连接B机器，取接收文件</strong></p>
<p>下面命令表示通过连接B机器的9992端口接收文件，并把文件存到本目录下，文件名为test2.mv</p>
<p>nc 10.0.1.162 9992 &gt;test2.mv</p>
<p><img src="https://images2015.cnblogs.com/blog/1076878/201612/1076878-20161209101017632-493505389.png" alt="img"></p>
<p><strong>方法3，传输目录演示（方法发送文件类似）</strong></p>
<p><strong>步骤1，B机器先启动监听，如下</strong></p>
<p>A机器给B机器发送多个文件</p>
<p>传输目录需要结合其它的命令，比如tar</p>
<p>经过我的测试管道后面最后必须是 - ，不能是其余自定义的文件名</p>
<p>nc -l 9995 | tar xfvz -</p>
<p><img src="https://images2015.cnblogs.com/blog/1076878/201612/1076878-20161209101035476-313895763.png" alt="img"></p>
<p><strong>步骤2，A机器打包文件并连接B机器的端口</strong></p>
<p>管道前面表示把当前目录的所有文件打包为 - ，然后使用nc发送给B机器</p>
<p>tar cfz - * | nc 10.0.1.162 9995</p>
<p><img src="https://images2015.cnblogs.com/blog/1076878/201612/1076878-20161209101051101-1053431813.png" alt="img"></p>
<p>B机器这边已经自动接收和解压</p>
<p><img src="https://images2015.cnblogs.com/blog/1076878/201612/1076878-20161209101107241-716031832.png" alt="img"></p>
<h1 id="nc用法3，测试网速"><a href="#nc用法3，测试网速" class="headerlink" title="nc用法3，测试网速"></a><strong>nc用法3，测试网速</strong></h1><p>测试网速其实利用了传输文件的原理，就是把来自一台机器的/dev/zero 发送给另一台机器的/dev/null</p>
<p>就是把一台机器的无限个0，传输给另一个机器的空设备上，然后新开一个窗口使用dstat命令监测网速</p>
<p>在这之前需要保证机器先安装dstat工具</p>
<p>yum install -y dstat</p>
<p><strong>方法1，测试网速演示（先启动接收命令方式）</strong></p>
<p>步骤1，A机器先启动接收数据的命令，监听自己的9991端口，把来自这个端口的数据都输出给空设备（这样不写磁盘，测试网速更准确）</p>
<p>nc -l 9991 &gt;/dev/null</p>
<p><img src="https://images2015.cnblogs.com/blog/1076878/201612/1076878-20161209101124179-1971991069.png" alt="img"></p>
<p>步骤2，B机器发送数据，把无限个0发送给A机器的9991端口</p>
<p>nc 10.0.1.161 9991 &lt;/dev/zero</p>
<p><img src="https://images2015.cnblogs.com/blog/1076878/201612/1076878-20161209101150304-1813015616.png" alt="img"></p>
<p>在复制的窗口上使用dstat命令查看当前网速，dstat命令比较直观，它可以查看当前cpu，磁盘，网络，内存页和系统的一些当前状态指标。</p>
<p>我们只需要看下面我选中的这2列即可，recv是receive的缩写，表示接收的意思，send是发送数据，另外注意数字后面的单位B，KB，MB</p>
<p><img src="https://images2015.cnblogs.com/blog/1076878/201612/1076878-20161209101211132-150010168.png" alt="img"></p>
<p>可以看到A机器接收数据，平均每秒400MB左右</p>
<p><img src="https://images2015.cnblogs.com/blog/1076878/201612/1076878-20161209101227069-1285313680.png" alt="img"></p>
<p>B机器新打开的窗口上执行dstat，看到每秒发送400MB左右的数据</p>
<p><img src="https://images2015.cnblogs.com/blog/1076878/201612/1076878-20161209101252491-2064947286.png" alt="img"></p>
<p><strong>方法2，测试网速演示（先启动发送命令方式）</strong></p>
<p>步骤1，先启动发送的数据，谁连接这个端口时就会接收来自zero设备的数据（二进制的无限个0）</p>
<p>nc -l 9990 &lt;/dev/zero</p>
<p><img src="https://images2015.cnblogs.com/blog/1076878/201612/1076878-20161209101318991-1622147288.png" alt="img"></p>
<p>步骤2，下面B机器连接A机器的9990端口，把接收的数据输出到空设备上</p>
<p>nc 10.0.1.161 9990 &gt;/dev/null</p>
<p><img src="https://images2015.cnblogs.com/blog/1076878/201612/1076878-20161209101335976-869694121.png" alt="img"></p>
<p>同样可以使用dstat观察数据发送时的网速</p>
<p><img src="https://images2015.cnblogs.com/blog/1076878/201612/1076878-20161209101801304-671989613.png" alt="img"></p>
]]></content>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>揭密华为防火墙NAT地址复用专利技术</title>
    <url>/2019/04/24/18/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>提到多对多、多对一的NAT（多个私网地址转换为多个或一个公网地址），就不能回避公网地址利用率的问题。 “华为防火墙一个公网IP突破了65535端口限制，理论上能够无限制进行NAT转换”这个结论在江湖上已经广为流传，接触过华为防火墙的兄弟可能早有耳闻，几天前提起源NAT也有兄弟跳起来指出。这正是华为防火墙十年前申请的一项专利技术的应用。<br>至此处，原谅强叔回忆下此专利发明人的大牛风采。几前路遇隐居的大牛下山，强叔敬仰地双手抱拳：“哥你已不在江湖多年，江湖中仍然流传着哥的传说。”――强叔还被称为小强之时，大牛已经名满防火墙。此时大牛仍然腼腆一笑，道声旧日小事飘然去也，唯强叔口水流了一地。之后，强叔又马不停蹄至襄阳，请教如今的NAT传人后，才算对此专利解读稍有眉目。围观兄弟且看，强叔接下来揭密华为防火墙NAT地址复用技术。 </p>
<p><img src="http://support.huawei.com/ecommunity/showimage-10082245-10118533-2736ab01a18fa49475f497edb28833c8.jpg" alt="img"></p>
<p>在《源NAT》一节，强叔提到：“防火墙在应用源NAT功能时就是从地址池中挑选出一个公网IP，然后对私网IP进行转换。<strong>挑选哪个公网IP是随机的，**</strong>和配置时的顺序、IP大小等因素都没有关系。”**这其实就是我们看到的外部招式，所谓内功心法不外露的。</p>
<p>那么在进行源NAT时，究竟是怎样从地址池中挑选出公网IP地址资源进行分配的呢？<br>请允许强叔引入Hash算法的概念，这应该是大家常听说的一种广泛应用于程序编写的方法。一句话解释，就是把一种任意长度的信息进行压缩映射，成为某一固定长度的信息。例如，把3000个私网IP映射成100个公网IP，也就是从地址池挑选出公网IP地址资源进行分配的过程，资料中也偶尔会提到的“基于源地址Hash”。</p>
<p>Hash的具体规则或者说算法是什么呢？很灵活，自行设定，但是根据要达成的目标和计算结果，可以优选。在这里，我们使用的算法也比较简单取模运算。<br>估计很多不写代码兄弟的数学都已经还给老师了，但是提起求余运算应该都知道，思路如下：<br><img src="http://support.huawei.com/ecommunity/showimage-10082239-10118533-c608346f0b55016f5217be1e6c915fc2.jpg" alt="img"></p>
<p><strong>示例如下：</strong><br>内网用户10.1.1.1-10.10.10.1，NAT地址池202.169.1.1-202.169.1.5<br>X=5<br>Y=10.1.1.1<br>10.1.1.1—–&gt;00001010 00000001 00000001 00000001—–&gt;167837953<br>不用计算可目测余数为3，选择地址池的第四个资源即202.169.1.4。</p>
<p>至此，内网用户的源IP地址已经可以全部被分配了对应的地址池中的公网IP地址资源，并且保证了每个内网的IP地址每次访问外部网络时始终转换为同一个公网IP地址。<br>按照上述运算后，一部分内网用户就会被分配相同的公网IP地址资源。</p>
<p>下一步，我们来研究下如何分配端口资源。<br>其实强叔对于将复杂一点的数学运算表达清楚没有太多信心，决定到最后不得已的时候再引出来，下面端口分配先从防火墙的实现原理讲起，定性区分出端口分配带来的影响。<br>在《源NAT》一节中，我们已介绍了NAPT情况建立的会话表。<br>例如，内网10.1.1.1和10.1.1.2用户分别ping 220.180.20.50服务器，在USG上通过公网地址202.169.1.1进行NAT转换，查询会话表显示如下：<br><USG9000> display firewall session table<br> Current total sessions: 2<br> Slot: 5 CPU: 1<br> icmp VPN: public –&gt; public 10.1.1.1:1280[202.169.1.1:10298] –&gt; 220.180.20.50:2048<br> icmp VPN: public –&gt; public 10.1.1.2:1280[202.169.1.1:6103] –&gt; 220.180.20.50:2048<br>由于内网不同用户的IP地址和端口必不相同，仅使用“源地址+源端口”二元组信息在USG上即可标识一条数据流，来建立正向NAT地址转换。而进行反向地址还原时，使用“源地址+源端口+目的地址+目的端口+协议”五元组信息唯一标识一条数据流。<br>那么，根据会话表实现机制，只要内网不同用户访问“目的地址+目的端口+协议”三元组中的任一参数不同时，即使将地址池中同一公网地址的同一端口同时分配给内网多个用户时，也不会产生冲突。<br>示例如下：</p>
<table>
<thead>
<tr>
<th>编号</th>
<th>内网源地址</th>
<th>内网源端口</th>
<th>NAT地址</th>
<th>NAT端口</th>
<th>目的地址</th>
<th>目地端口</th>
<th>协议</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>10.1.1.1</td>
<td>80</td>
<td>202.169.1.1</td>
<td>8080</td>
<td><a href="http://www.baidu.com/">www.baidu.com</a></td>
<td>80</td>
<td>http</td>
</tr>
<tr>
<td>2</td>
<td>10.1.1.2</td>
<td>80</td>
<td>202.169.1.1</td>
<td>8080</td>
<td><a href="http://www.sohu.com/">www.sohu.com</a></td>
<td>80</td>
<td>http</td>
</tr>
</tbody></table>
<p>因此，只要内网不同用户访问“目的地址+目的端口+协议”三元组中的任一参数不同时，唯一的NAT地址和端口可以反复利用，不受65535端口的限制。此时无论端口如何分配，都不会产生问题。</p>
<p>围观兄弟接下来肯定就有问题等着强叔了：在地址池<strong>只有一个公网IP</strong>情况下，如果访问<strong>相同的</strong>“目的地址+目的端口+协议”三元组时怎么办？现实可能就是这么残酷……<br>在内网不同用户访问相同的“目的地址+目的端口+协议”三元组时，不能被分配给相同的NAT地址和端口资源，这是因为一旦完全相同，访问的目的主机会发现出现同样的“源地址+源端口”访问本主机的同一“目的地址+端口+协议”，目的主机无法正确回应甚至可能会判定为受到攻击。</p>
<p>关键点来了！因此，保证内网不同用户、访问相同的“目的地址+目的端口+协议”三元组时，不能被分配到相同地址的相同端口资源是关键。这就要引入冲突检测机制。<br>其实在分配端口的法则上，我们仍然使用Hash算法，使得在内存占用合理情况下、尽可能保证被分配到相同公网地址的用户、其被分配的端口尽量不一致，简化的基本思路如下：<img src="http://support.huawei.com/ecommunity/showimage-10082241-10118533-d4a7ce46af7a521c3521c79d21375cf5.jpg" alt="img"></p>
<p>这就保证了，不同内网户访问相同的 “目的地址+目的端口+协议”三元组，不会被分配到相同的NAT地址的端口资源。而且会话表是会实时老化的，被分配过的端口在会话表老化后会重新被利用，因此，概率上端口也不会受到限制。<br>除非最极端的情况发生：超过64k的内网用户，同一时刻、向外网同一目的主机的同一端口、采用同样协议发起链接。不过兄弟们觉不觉得很面熟，这看起来就是发起了传统而典型的DDoS攻击了吧-_-</p>
<p>好了，揭密到此，强叔已经全盘兜出了，大家是否已经了然于胸了？<br>其实原专利本身是晦涩难懂的，华为防火墙也在这么多年的发展中进行着不断演进，强叔只是对其基本实现原理进行了简单大意解读。若有对原专利感兴趣的小伙伴可自行谷歌：CN1567907A 一种网络地址资源的利用方法。</p>
]]></content>
      <tags>
        <tag>安全</tag>
      </tags>
  </entry>
  <entry>
    <title>交换机的带宽线速概念</title>
    <url>/2019/04/24/19/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>包转发率的计算－实例说明 100Mbit/s的以太网络，100M换算成byte则是100/8=12.5M byte/s，换算出来就是12500000bytes。</p>
<p> 因为在以太网的数据包中，最小的数据包的大小是64byte/s，加上8个byte的前导字节以及12个byte帧间间隙，合计就是84byte。 </p>
<p>那么用12500000/84=148809，所以就可以得到在100M吞吐量单向环境下的每秒最大的包转发个数148809，换算成k即为148.8k pps，也就是0.1488M pps。 0.1488M pps这个包转发率是100M的网络而言，那么1000M的网络，算出来的包转发率就应是1.488Mpps，对于10G网络对应的是14.88Mpps。 </p>
<p>下面，我按这个数值来验证一下H3C的交换机在其网站上公布的数据，是否满足全端口“线速转发”。</p>
<p> 1）设备：H3C S3600-28P-EI 公布包转发率：9.6Mpps 接口：24个10/100Base-TX以太网端口，4个1000Base-X SFP千兆以太网端口(就是24个100M＋4个1000M）计算：0.1488Mpps<em>24+1.488Mpps</em>4=3.5712Mpps+5.952Mpps=9.5232Mpps 结果9.5232Mpps &lt; 公布包转发率：9.6Mpps,满足全端口“线速转发”。</p>
<p> 2）设备：S5500-28C-EI 包转发率（整机）： 95.2Mpps 接口：24个10/100/1000Base-T以太网端口，4个复用的1000Base-X千兆SFP端口，2个扩展插槽（每个扩展插槽接口卡最大配置2×10G接口）；（也就是24<em>1000M＋2×2</em>10GE) 计算：1.488Mpps<em>24+14.88Mpps</em>2*2=35.712Mpps+59.52Mpps=95.232Mpps 结果95.232Mpps ＝包转发率（整机）： 95.2Mpps，满足全端口“线速转发”。 通过这样事例，可以清楚交换机厂商所公布的数据是“如何”的了吧！ 这是在二层交换上面所能达到的包转发率，但是如果一个路由器在三层路由上面，甚至在开启nat的情况下，其包转发率会有很大降低，而这个值才是值得关心的，所以我们在看到很多商家在一直强调包转发个数148810个包，其实这是二层交换的理论极限值，而不是真正的路由器在三层工作时候的值。 </p>
<p>交换机的背板带宽，是交换机接口处理器或接口卡和数据总线间所能吞吐的最大数据量。背板带宽标志了交换机总的数据交换能力，单位为Gbps，也叫交 换带宽，一般的交换机的背板带宽从几Gbps到上百Gbps不等。</p>
<p>一台交换机的背板带宽越高，所能处理数据的能力就越强，但同时设计成本也会越高。 一般来讲，计算方法如下: </p>
<p>1）线速的背板带宽 考察交换机上所有端口能提供的总带宽。计算公式为端口数<em>相应端口速率</em>2（全双工模式）如果总带宽≤标称背板带宽，那么在背板带宽上是线速的。</p>
<p> 2）第二层包转发线速 第二层包转发率=千兆端口数量×1.488Mpps+百兆端口数量<em>0.1488Mpps+其余类型端口数</em>相应计算方法，如果这个速率能≤标称二层包转发速率，那么交换机在做第二层交换的时候可以做到线速。 </p>
<p>3）第三层包转发线速 第三层包转发率=千兆端口数量×1.488Mpps+百兆端口数量<em>0.1488Mpps+其余类型端口数</em>相应计算方法，如果这个速率能≤标称三层包转发速率，那么交换机在做第三层交换的时候可以做到线速。 </p>
<p>那么，1.488Mpps是怎么得到的呢? 包 转发线速的衡量标准是以单位时间内发送64byte的数据包（最小包）的个数作为计算基准的。对于千兆以太网来说，计算方法如下：</p>
<p>1，000，000， 000bps/8bit/（64＋8＋12）byte=1,488,095pps </p>
<p>说明：当以太网帧为64byte时，需考虑8byte的帧头和12byte的帧间隙的固定开销。故一个线速的千兆以太网端口在转发64byte包时的包转 发率为1.488Mpps。快速以太网的统速端口包转发率正好为千兆以太网的十分之一，为148.8kpps。 *对于万兆以太网，一个线速端口的包转发率为14.88Mpps。 *对于千兆以太网，一个线速端口的包转发率为1.488Mpps。 *对于快速以太网，一个线速端口的包转发率为0.1488Mpps。 *对于OC－12的POS端口，一个线速端口的包转发率为1.17Mpps。 *对于OC－48的POS端口，一个线速端口的包转发率为468MppS。 </p>
<p>所以说，如果能满足上面三个条件，那么我们就说这款交换机真正做到了线性无阻塞 背 板带宽资源的利用率与交换机的内部结构息息相关。目前交换机的内部结构主要有以下几种：一是共享内存结构，这种结构依赖中心交换引擎来提供全端口的高性能 连接，由核心引擎检查每个输入包以决定路由。这种方法需要很大的内存带宽、很高的管理费用，尤其是随着交换机端口的增加，中央内存的价格会很高，因而交换 机内核成为性能实现的瓶颈；二是交叉总线结构，它可在端口间建立直接的点对点连接，这对于单点传输性能很好，但不适合多点传输；三是混合交叉总线结构，这 是一种混合交叉总线实现方式，它的设计思路是，将一体的交叉总线矩阵划分成小的交叉矩阵，中间通过一条高性能的总线连接。其优点是减少了交叉总线数，降低 了成本，减少了总线争用；但连接交叉矩阵的总线成为新的性能瓶颈。</p>
<p>背板带宽，是交换机接口处理器或接口卡和数据总线间所能吞吐的最大数据量。一台交换机的背板带宽越高，所能处理数据的能力就越强，但同时设计成本也会上去。<br>但是，我们如何去考察一个交换机的背板带宽是否够用呢？显然，通过估算的方法是没有用的，我认为应该从两个方面来考虑：<br>1、）所有端口容量X端口数量之和的2倍应该小于背板带宽，可实现全双工无阻塞交换，证明交换机具有发挥最大数据交换性能的条件。<br>2、）满配置吞吐量(Mpps)=满配置GE端口数×1.488Mpps其中1个千兆端口在包长为64字节时的理论吞吐量为1.488Mpps。例如，一台最多可以提供64个千兆端口的交换机，其满配置吞吐量应达到 64×1.488Mpps = 95.2Mpps，才能够确保在所有端口均线速工作时，提供无阻塞的包交换。如果一台交换机最多能够提供176个千兆端口，而宣称的吞吐量为不到261.8Mpps(176 x 1.488Mpps = 261.8)，那么用户有理由认为该交换机采用的是有阻塞的结构设计。一般是两者都满足的交换机才是合格的交换机。</p>
<p>比如：<br>2950G-48<br>背板＝2×1000×2＋48×100×2(Mbps)＝13.6(Gbps)<br>相当于13.6/2=6.8个千兆口<br>吞吐量=6.8×1.488=10.1184Mpps</p>
<p>4506<br>背板64G<br>满配置千兆口<br>4306×5＋2（引擎）＝32<br>吞吐量＝32×1.488=47.616 </p>
<p>一般是两者都满足的交换机才是合格的交换机。 </p>
<p>背板相对大，吞吐量相对小的交换机，除了保留了升级扩展的能力外就是软件效率或专用芯片电路设计有问题；背板相对小。吞吐量相对大的交换机，整体性能比较高。不过背板带宽是可以相信厂家的宣传的，可吞吐量是无法相信厂家的宣传的，因为后者是个设计值，测试 很困难的并且意义不是很大。 </p>
<p>交换机的背版速率一般是：Mbps,指的是第二层，<br>对于三层以上的交换才采用Mpps</p>
<p>背板带宽资源的利用率与交换机的内部结构息息相关。目前交换机的内部结构主要有以下几种：一是共享内存结构，这种结构依赖中心交换引擎来提供全端口的高性能连接，由核心引擎检查每个输入包以决定路由。这种方法需要很大的内存带宽、很高的管理费用，尤其是随着交换机端口的增加，中央内存的价格会很高，因而交换机内核成为性能实现的瓶颈；二是交叉总线结构，它可在端口间建立直接的点对点连接，这对于单点传输性能很好，但不适合多点传输；三是混合交叉总线结构，这是一种混合交叉总线实现方式，它的设计思路是，将一体的交叉总线矩阵划分成小的交叉矩阵，中间通过一条高性能的总线连接。其优点是减少了交叉总线数，降低了成本，减少了总线争用；但连接交叉矩阵的总线成为新的性能瓶颈。</p>
<h2 id="来自：http-blog-csdn-net-shanzhizi"><a href="#来自：http-blog-csdn-net-shanzhizi" class="headerlink" title="来自：http://blog.csdn.net/shanzhizi"></a>来自：<a href="http://blog.csdn.net/shanzhizi">http://blog.csdn.net/shanzhizi</a></h2>]]></content>
      <tags>
        <tag>有线</tag>
      </tags>
  </entry>
  <entry>
    <title>动态路由之OSPF和RIP协议实现全网互连互通</title>
    <url>/2019/04/24/20/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote>
<p>动态路由是指路由器能够自动地建立自己的路由表，并且能够根据实际情况的变化适时地进行调整。</p>
</blockquote>
<h2 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h2><p>动态路由是与静态路由相对的一个概念，指路由器能够根据路由器之间的交换的特定路由信息自动地建立自己的路由表，并且能够根据链路和节点的变化适时地进行自动调整。当网络中节点或节点间的链路发生故障，或存在其它可用路由时，动态路由可以自行选择最佳的可用路由并继续转发报文。</p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>动态路由机制的运作依赖路由器的两个基本功能:路由器之间适时的路由信息交换，对路由表的维护:</p>
<ol>
<li>路由器之间适时地交换路由信息。<br>动态路由之所以能根据网络的情况自动计算路由、选择转发路径，是由于当网络发生变化时，路由器之间彼此交换的路由信息会告知对方网络的这种变化，通过信息扩散使所有路由器都能得知网络变化。</li>
<li>路由器根据某种路由算法(不同的动态路由协议算法不同)把收集到的路由信息加工成路由表，供路由器在转发IP报文时查阅。<br>在网络发生变化时，收集到最新的路由信息后，路由算法重新计算，从而可以得到最新的路由表。</li>
</ol>
<h2 id="协议"><a href="#协议" class="headerlink" title="协议"></a>协议</h2><h3 id="RIP"><a href="#RIP" class="headerlink" title="RIP"></a>RIP</h3><blockquote>
<p>路由信息协议(RIP) 是内部网关协议IGP中最先得到广泛使用的协议。RIP是一种分布式的基于距离向量的路由选择协议，是因特网的标准协议，其最大优点就是实现简单，开销较小。</p>
<h3 id="OSPF"><a href="#OSPF" class="headerlink" title="OSPF"></a>OSPF</h3><p>OSPF(Open Shortest Path First开放式最短路径优先)是一个内部网关协议(Interior Gateway Protocol，简称IGP)，用于在单一自治系统(autonomous system,AS)内决策路由。</p>
<h3 id="IS-IS"><a href="#IS-IS" class="headerlink" title="IS-IS"></a>IS-IS</h3><p>IS-IS(Intermediate System-to-Intermediate System，中间系统到中间系统)路由协议最初是ISO(the International Organization for Standardization，国际标准化组织)为CLNP(Connection Less Network Protocol，无连接网络协议)设计的一种动态路由协议。</p>
<h3 id="BGP"><a href="#BGP" class="headerlink" title="BGP"></a>BGP</h3><p>边界网关协议(BGP)是运行于 TCP 上的一种自治系统的路由协议。 BGP 是唯一一个用来处理像因特网大小的网络的协议，也是唯一能够妥善处理好不相关路由域间的多路连接的协议。</p>
</blockquote>
<h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><p>1、无需管理员手工维护，减轻了管理员的工作负担。</p>
<p>2、占用了网络带宽。</p>
<p>3、在路由器上运行路由协议，使路由器可以自动根据网络拓朴结构的变化调整路由条目;</p>
<p>4、网络规模大、拓扑复杂的网络</p>
<h2 id="配置实验"><a href="#配置实验" class="headerlink" title="配置实验"></a>配置实验</h2><p><em>实验拓扑图</em></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/7EF32717E59A4AD48A630893FD8B3CA3?method=download&shareKey=f40b2ce6fd86733a0dcd2f46749cb56f" alt="image"></p>
<p><em>配置过程</em></p>
<p><strong>R1路由器的配置</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">R1#conf t</span><br><span class="line">R1(config)#int f0&#x2F;0</span><br><span class="line">R1(config-if)#ip add 192.168.20.2 255.255.255.0</span><br><span class="line">R1(config-if)#no shut    &#x2F;&#x2F;f0&#x2F;0接口配置IP地址并且开启</span><br><span class="line"></span><br><span class="line">R1(config-if)#int f0&#x2F;1</span><br><span class="line">R1(config-if)#ip add 192.168.30.1 255.255.255.0</span><br><span class="line">R1(config-if)#no shut    &#x2F;&#x2F;f0&#x2F;1接口配置IP地址并且开启</span><br><span class="line"></span><br><span class="line">R1(config)#ip route 192.168.10.0 255.255.255.0 192.168.20.1        &#x2F;&#x2F;配置到192.168.10.0网段的静态路由</span><br><span class="line"></span><br><span class="line">R1(config)#router ospf 1    &#x2F;&#x2F;开启ospf协议</span><br><span class="line">R1(config-router)#network 192.168.30.0 255.255.255.0 area 1      &#x2F;&#x2F;在area 1 宣告192.168.30.0网段</span><br><span class="line">R1(config-router)#redistribute static subnets     &#x2F;&#x2F;重分发静态路由</span><br><span class="line">R1(config-router)#redistribute connected subnets    &#x2F;&#x2F;重分发直连网段</span><br></pre></td></tr></table></figure>

<p><strong>R2路由器的配置</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">R2#conf t</span><br><span class="line">R2(config)#int f0&#x2F;0</span><br><span class="line">R2(config-if)#ip add 192.168.10.1 255.255.255.0</span><br><span class="line">R2(config-if)#no shut     &#x2F;&#x2F;f0&#x2F;0接口配置IP并且开启</span><br><span class="line"></span><br><span class="line">R2(config)#int f0&#x2F;1</span><br><span class="line">R2(config-if)#ip add 192.168.20.1 255.255.255.0</span><br><span class="line">R2(config-if)#no shut     &#x2F;&#x2F;f0&#x2F;1接口配置IP并且开启</span><br><span class="line"></span><br><span class="line">R2(config)#ip route 0.0.0.0 0.0.0.0 192.168.20.2     &#x2F;&#x2F;配置默认路由</span><br></pre></td></tr></table></figure>

<p><strong>R3路由器的配置</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">R3#conf t</span><br><span class="line">R3(config)#int f0&#x2F;0</span><br><span class="line">R3(config-if)#ip add 192.168.30.2 255.255.255.0</span><br><span class="line">R3(config-if)#no shut     &#x2F;&#x2F;f0&#x2F;0接口配置IP并且开启</span><br><span class="line"></span><br><span class="line">R3(config)#int f0&#x2F;1</span><br><span class="line">R3(config-if)#ip add 192.168.40.1 255.255.255.0</span><br><span class="line">R3(config-if)#no shut     &#x2F;&#x2F;f0&#x2F;1接口配置IP并且开启</span><br><span class="line"></span><br><span class="line">R3(config)#int f1&#x2F;1</span><br><span class="line">R3(config-if)#no switchport    &#x2F;&#x2F;开启路由功能</span><br><span class="line">R3(config-if)#ip add 12.0.0.1 255.255.255.0       </span><br><span class="line">R3(config-if)#no shut       &#x2F;&#x2F;f1&#x2F;1接口配置IP并且开启</span><br><span class="line"></span><br><span class="line">R3(config)#int f1&#x2F;0</span><br><span class="line">R3(config-if)#no switchport</span><br><span class="line">R3(config-if)#ip add 192.168.70.1 255.255.255.0      </span><br><span class="line">R3(config-if)#no shut     &#x2F;&#x2F;f1&#x2F;0接口配置IP并且开启</span><br><span class="line"></span><br><span class="line">R3(config)#router ospf 1       &#x2F;&#x2F;开启ospf协议</span><br><span class="line">R3(config-router)#network 192.168.30.0 255.255.255.0 area 1      &#x2F;&#x2F;在area 1 宣告192.168.30.0网络</span><br><span class="line">R3(config-router)#network 192.168.40.0 255.255.255.0 area 0      &#x2F;&#x2F;在area 0 宣告192.168.40.0网络</span><br><span class="line">R3(config-router)#network 192.168.70.0 255.255.255.0 area 0      &#x2F;&#x2F;在area 0 宣告192.168.70.0网络</span><br><span class="line">R3(config-router)#ex </span><br><span class="line"></span><br><span class="line">R3(config)#ip route 0.0.0.0 0.0.0.0 12.0.0.2     &#x2F;&#x2F;配置默认路由</span><br><span class="line"></span><br><span class="line">R3(config)#router ospf 1</span><br><span class="line">R3(config-router)#default-information originate    &#x2F;&#x2F;重分发默认路由</span><br></pre></td></tr></table></figure>

<p><strong>R4路由器的配置</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">R4#conf t</span><br><span class="line">R4(config)#int f0&#x2F;0</span><br><span class="line">R4(config-if)#ip add 192.168.40.2 255.255.255.0</span><br><span class="line">R4(config-if)#no shut     &#x2F;&#x2F;f0&#x2F;0接口配置IP并且开启</span><br><span class="line"></span><br><span class="line">R4(config)#int f0&#x2F;1</span><br><span class="line">R4(config-if)#ip add 192.168.50.1 255.255.255.0</span><br><span class="line">R4(config-if)#no shut     &#x2F;&#x2F;f0&#x2F;1接口配置IP并且开启</span><br><span class="line"></span><br><span class="line">R4(config)#router ospf 1     &#x2F;&#x2F;开启ospf协议</span><br><span class="line">R4(config-router)#network 192.168.40.0 255.255.255.0 area 0    &#x2F;&#x2F;在area 0 宣告192.168.40.0网段</span><br><span class="line"></span><br><span class="line">R4(config)#router rip    &#x2F;&#x2F;开启rip协议</span><br><span class="line">R4(config-router)#version 2    &#x2F;&#x2F;选择版本2</span><br><span class="line">R4(config-router)#network 192.168.50.0   &#x2F;&#x2F;宣告192.168.50.0网段</span><br><span class="line">R4(config-router)#no auto-summary    &#x2F;&#x2F;关闭路由汇总</span><br><span class="line">R4(config-router)#ex</span><br><span class="line"></span><br><span class="line">R4(config)#router ospf 1  </span><br><span class="line">R4(config-router)#redistribute rip subnets   &#x2F;&#x2F;在ospf协议中重分发RIP</span><br><span class="line"></span><br><span class="line">R4(config)#router rip</span><br><span class="line">R4(config-router)#redistribute ospf 1 metric 3     &#x2F;&#x2F;在RIP协议中重分发ospf，跳数为3 （这里3-5最合适）</span><br><span class="line">R4(config-router)#ex</span><br></pre></td></tr></table></figure>

<p><strong>R5（ISP运营商）的配置</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ISP#conf t</span><br><span class="line">ISP(config)#int f0&#x2F;0</span><br><span class="line">ISP(config-if)#ip add 12.0.0.2 255.255.255.0</span><br><span class="line">ISP(config-if)#no shut     &#x2F;&#x2F;f0&#x2F;0配置IP并且开启</span><br><span class="line">ISP(config-if)#ex</span><br><span class="line"></span><br><span class="line">ISP(config)#int f0&#x2F;1</span><br><span class="line">ISP(config-if)#ip add 13.0.0.1 255.255.255.0</span><br><span class="line">ISP(config-if)#no shut      &#x2F;&#x2F;f0&#x2F;1配置IP并且开启                 </span><br><span class="line">ISP(config-if)#ex</span><br><span class="line"></span><br><span class="line">ISP(config)#ip route 0.0.0.0 0.0.0.0 12.0.0.1     &#x2F;&#x2F;配置默认路由</span><br></pre></td></tr></table></figure>

<p><strong>R6路由器的配置</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">R6#conf t</span><br><span class="line">R6(config)#int f0&#x2F;0</span><br><span class="line">R6(config-if)#ip add 192.168.50.2 255.255.255.0</span><br><span class="line">R6(config-if)#no shut      &#x2F;&#x2F;f0&#x2F;0接口配置IP并且开启</span><br><span class="line">R6(config-if)#ex</span><br><span class="line"></span><br><span class="line">R6(config)#int f0&#x2F;1</span><br><span class="line">R6(config-if)#ip add 192.168.60.1 255.255.255.0</span><br><span class="line">R6(config-if)#no shut       &#x2F;&#x2F;f0&#x2F;1接口配置IP并且开启</span><br><span class="line">R6(config-if)#ex </span><br><span class="line"></span><br><span class="line">R6(config)#router rip       &#x2F;&#x2F;开启RIP协议</span><br><span class="line">R6(config-router)#version 2     &#x2F;&#x2F;选择版本2</span><br><span class="line">R6(config-router)#network 192.168.50.0   &#x2F;&#x2F;在RIP协议中宣告192.168.50.0网段</span><br><span class="line">R6(config-router)#network 192.168.60.0    &#x2F;&#x2F;宣告192.168.60.0网段</span><br><span class="line">R6(config-router)#no auto-summary    &#x2F;&#x2F;关闭路由汇总</span><br><span class="line">R6(config-router)#ex</span><br></pre></td></tr></table></figure>

<p>配置完毕后我们逐个查看路由器的路由表</p>
<p>R1路由器的路由表</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/456D5AF6176E4AC9876CEF7E0C4D9508?method=download&shareKey=2c99c93c548c7c67770aba3fadbe9008" alt="image"></p>
<p>R2路由器的路由表</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/F3613B0C847B4629B5A69BFC7853993A?method=download&shareKey=fca9ec9950ab27b620be183b84095403" alt="image"></p>
<p>R3路由器的路由表</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/8179F5E6FB7F4AD58DF46E06D6524DC6?method=download&shareKey=d3fff9a5c9c1d73da6edbf7deb470d37" alt="image"></p>
<p>R4路由器的路由表</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/BEAB55C59DFA40819F155D5C55BD6747?method=download&shareKey=adb22cd4592b75896c7580d2b81bf7f9" alt="image"></p>
<p>R5（ISP）路由器的路由表</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/072C0C52E3F94AE7BA701A74D0295D8F?method=download&shareKey=ff0d0f51b4f9f01f7bb5980f62a0eb10" alt="image"></p>
<p>R6路由器的路由表</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/A34AE9A2BF0046F199D7C8438DF29857?method=download&shareKey=5015a670f6901ac57e4b244a6819469a" alt="image"></p>
<p><strong>好，接下来我们使用vpcs配置四台pc机的IP进行全网互通的验证</strong></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/5A81CDE335244B7595E362A4E0292D14?method=download&shareKey=e6fde6d96c50c83b5cd916e89dab661f" alt="image"></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/1CEF65F33D3C4159AA35AD7E6CA0744A?method=download&shareKey=02bef39680d597fcb88cccdccdbfdf1b" alt="image"></p>
]]></content>
  </entry>
  <entry>
    <title>连风都知道我爱你</title>
    <url>/2019/04/24/22/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>我爱你，又很遗憾没人证明</p>
<p>我爱你，希望有一天可以和你一起保护水晶</p>
<p>我爱你，就算你满嘴谎言 仍有我痴情不改变</p>
<p>我爱你，就算你一身污秽如刺猬 也有我双手拥抱不忌讳</p>
<p>我爱你，原谅我只有遇见你的勇气 却没有得到你的本事</p>
<p>我爱你，你用半生温柔相濡以沫陪我赌 我又怎么可能让你输</p>
<p>我爱你，好想学一种可以伴你一生的咒语哪怕是做你的宠物狗也可以</p>
<p>我爱你，如果我此生只能给你拥抱和不放开你的手 你愿不愿意跟我走 </p>
<p>我爱你，也想把这世界上所有快乐都与你共享 哪怕被你折磨得 遍体鳞伤</p>
<p>我爱你，一直都很爱 只是你离开后我偶尔也会喜欢他人 在他人像你的时候</p>
<p>我爱你，愿你所有的温柔都能换来岁月的情深意浓 可以不必回首 相扶白头 </p>
<p>我爱你，他们说世界上海最深邃 干净又透明 我想那是他们没见过你的眼睛</p>
<p>我爱你，为了寻找你 我搬进鸟的眼睛 经常盯着路过的风 也忘了听猎人的枪声</p>
<p>我爱你，希望你可以把自己挂在淘宝上 因为你们淘宝承诺过 淘宝 要淘我喜欢</p>
<p>我爱你，等你时 我觉得一日不见 如隔三秋 你朝我笑 我又觉得 三秋未见 不过一日</p>
<p>我爱你，无论世界多污秽 有多少虚伪不纯粹 都有我在你身边 拼死给你一方碧海蓝天</p>
<p>我爱你，又很遗憾没人能证明 可这份爱已经如鲸向海 如鸟投林 无可避免 退无可退了</p>
<p>我爱你，如果有一天你觉的越相爱越是场意外 那就请你悄悄在月光下 找个男孩把我取代 </p>
<p>我爱你，请帮我叫一辆滴滴 目的地就定在你怀里 从此沿途的每一处风景 都是越来越近的你</p>
<p>我爱你，愿往后的时光都是崭新的 去记录 去寻找 去做梦 愿我们都能成为 自己想成为的人</p>
<p>我爱你，别为了不属于你的观众 演绎你不擅长的人生 反正谢幕后的每次相逢 都有我捧着鲜花 把你拥入怀中 </p>
<p>我爱你，我听过最动听的情歌 是你轻哼的摇篮曲 最可口的美食 是你做的烧带鱼 你用毕生温柔 却只盼我无忧一世 </p>
<p>我爱你，好希望当你离开的那天可以踩中我偷偷埋好的地雷 这样我们就能永远在一起了 反正你走一步就会死 我离开你也活不了</p>
<p>我爱你，可我们总是用最恶毒的话 去伤害最爱的人 然后再用最深的忏悔去挽回 感情就在这样的循环里撕扯和消磨 慢慢变得无迹可寻了 我们就这样在嘶吼里告别 就像那些美好从未发生过 一切都会消失的 感情也是 一切都是需要守护的 感情尤其是</p>
<p>#我爱你，找机会把这三个字还给我吧<br>#别忘了我爱你 如果有一天 你一无所有 我是你最后一件行李 我们永远不再见<br>#我爱你 是你给了故事开头 太过惊心动魄 也让我忘了看 我们结局是老死不相往来 没联络</p>
<p>via 酷酷的滕<br>整理 澈崽子<br>2017.5.20</p>
]]></content>
      <tags>
        <tag>自嘲</tag>
      </tags>
  </entry>
  <entry>
    <title>计算机网络面试题</title>
    <url>/2019/04/24/23/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><ul>
<li>面试题一：网络掩码<br>答：这个可以算~</li>
<li>面试题二：详细描述ping的工作过程<br>答：可以分为两种情况</li>
</ul>
<ol>
<li><p>同一网段</p>
<p>1 机器A的ping进程通知系统去建立一个icmp的请求数据包，目的地址是B</p>
<p>2 icmp协议打包这个数据包 同时将B的IP地址封装给IP协议层</p>
<p>3 IP协议层再将机器B的IP地址作为目的地址 本机的IP地址作为源地址 加上其他控制信息 构建IP数据包</p>
<p>4 那么如何获取机器B的MAC地址呢？</p>
<p>​    1 机器A的IP层协议通过机器B的IP地址和自己的子网掩码进行运算，发现机器B和自己同属同一网络就直接在本网络中查找这台机器的mac地址，这时又分为两台主机之间是否有过通讯 若之间有过通讯 则在机器A的ARP缓存表中查找B的MAC地址与B的IP地址的映射关系 若没有则发送全网段的ARP广播平得到机器B的MAC地址 提交给数据链路层</p>
<p>​    2 数据链路层构建数据帧 目的地址是IP层传过来的MAC地址 源地址是机器A的MAC地址 按照以太网的访问规则传送出去</p>
<p>​    3 机器B收到这个数据帧后 先检查目的地址 并与本机的mac地址做对比 若是符合 则接收 接收后检查该数据帧，将IP数据包从帧中提取出来，交给本机的IP协议层协议。IP层检查后，将有用的信息提取交给ICMP协议，后者处理后，马上构建一个ICMP应答包，发送给主机A，其过程和主机A发送ICMP请求包到主机B类似（这时候主机B已经知道了主机A的MAC地址，不需再发ARP请求） 不符合则丢弃</p>
</li>
<li><p>不同网段</p>
<p>1 涉及到路由和网关 ARP 主机AB运算后发现不同网段 则将数据包交个网关处理</p>
</li>
</ol>
<ul>
<li><p>面试题三：VLAN 802.1Q<br>答：VLAN可以为网络提供以下作用：</p>
<ul>
<li>广播控制</li>
<li>带宽利用</li>
<li>降低延迟</li>
<li>安全性（非设计作用，本身功能所附加出的）</li>
</ul>
</li>
<li><p>面试题四：OSPF协议邻接关系状态<br>答：邻居关系和邻接关系是两种不同的关系，邻接关系的建立是在邻居关系建立的基础之上。</p>
<p>邻居关系</p>
<p>OSPF邻居关系的建立，是通过协商Hello包中的参数来实现的。在Init状态，收到邻居的Hello包，并把其当做邻居，将其router-id添加在自己的Hello包中发送，邻居收到后，双方建立two-way状态，形成稳定的邻居关系。邻居关系建立之后，形成邻居表。</p>
<p>邻接关系</p>
<p>OSPF邻接关系的建立，始于Exstart状态，在Full状态，维持稳定的邻接关系。</p>
<p>邻接关系区别于邻居关系，邻居关系是只要Hello包中的参数协商成功，就建立。而邻接关系，是指两个启用了OSPF协议的路由器之间能够实现LSDB的同步。在Exstart状态，确定LSDB同步的主从关系，在Exchange状态，进行LSDB的交互。在Loading状态通过LSR、LSU、LSAck报文来进行LSDB的同步，同步完成，最终达到Full状态，形成完整的拓扑表(LSDB)。最终根据拓扑表，把最优条目放进转发表，形成最后的路由表。</p>
<p>路由汇聚</p>
<p>路由的汇聚，是根据路由表进行的。把多个带有相同类型子网的路由汇聚成一条路由，减小路由表，降低路由器开销。具体的路由条目必须要存在于路由表中，否则不能进行路由汇聚。</p>
<p>路由汇聚时使用LSU进行更新，使用LSAck报文进行确认。</p>
</li>
<li><p>面试题五：OSPF LSA<br>答：<a href="https://www.zhang-zhe.cn/2019/04/25/26/">https://www.zhang-zhe.cn/2019/04/25/26/</a> </p>
</li>
<li><p>面试题六：BGP状态周期Flapping<br>答：</p>
</li>
<li><p>面试题七：有状态防火墙<br>答：</p>
</li>
<li><p>面试题八：多个VLAN桥接<br>答：</p>
</li>
<li><p>面试题九：NAT设备后多个L2TP客户端只能与VPN Gateway建立一个连接<br>答：</p>
</li>
<li><p>面试题十：多级NAT通信故障<br>答：</p>
</li>
<li><p>面试题十一： TCP Keep-alive，NAT Timeout<br>答：</p>
</li>
<li><p>面试题十二：MTU Discovery<br>答：</p>
</li>
<li><p>面试题十三：ICMP出错消息如何寻找进程<br>答：</p>
</li>
<li><p>面试题十四：用户拨虚拟私有网络却失去了Internet连接<br>答：</p>
</li>
<li><p>面试题十五：用户抱怨网络慢<br>答：</p>
</li>
</ul>
<p>整理自知乎车小胖的live</p>
]]></content>
      <tags>
        <tag>面试</tag>
      </tags>
  </entry>
  <entry>
    <title>20岁无资本无未来</title>
    <url>/2019/04/24/24/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>​    你学习一般，考上了现在的这所学校，成绩不算好，拿不到奖学金，上课不听讲，上自习不规律，考试靠突击，同学帮一把的话也能每科考到七八十分，但是与优秀总有很大距离。<br>​    你家境一般，父母都是普通员工，你在这个城市的生活费是每月一千二，没事下下馆子，一个月添件衣服，想买台相机，咬咬牙才能买双自己喜欢的鞋。<br>​    你几乎没有特长，不会弹吉他，不会弹钢琴，不会跳舞，不会画画，想学摄影却不会使用图片处理软件，想上台演出却没信心，学校晚会比赛的时候，你经常是站在台下围观的人群里的一员，你与聚光灯环绕的舞台几乎绝缘。<br>​    你长相一般，不算英俊或者不算美丽，身材不算臃肿但也没什么肌肉或者没什么曲线，平时只是稍稍打扮一下，看上去并不出众，只能算整洁，与人擦肩而过是对方不会多留意你一眼。<br>​    你的感情也是一般，有时候会遇见自己心仪的那个人，但是总抓不住机会，眨眼间那个人就被其他人俘获，你就开始伤心、抱怨，但是几天之后又开始寻找新的心上人，就这样看着一个个心上人走过，直到你毕业，与其中任何一个都没有发展。 总之，你没有什么特别的地方 ，就和周围的千万个普通人一样。<br>​    你不甘心拿不到奖学金，看见别人得奖学金的时候你会说那完全是突击的结果，于是你开始上自习，不过你只坚持了一星期。<br>​    你不甘心自己的父辈平平，于是你批评讽刺自己周围的“官二代”、“富二代”，立志要努力学习争取成功，也好让自己的孩子成为“富二代”，你的热情持续了一个星期。<br>​    你不甘心自己什么特长都没有，于是你开始学弹吉他、买滑轮鞋、借来摄影方面的书籍，你对着镜子微笑着说：“你是最棒的。” 这份虚假的信心维持了一个星期。<br>​    你不甘心自己没有伴侣，你决心洗心革面重新做人，你删掉电脑里的偶像剧肥皂剧，你收拾起床上的懒人桌，把零食袋子统统扔掉，然后洗了个澡并且修饰了一下自己，你往发型上喷了啫喱水，好让自己看起来很精神，你怀揣着一本成功学的书决定出去走走，开始新的生活。这样的状态，你稀稀拉拉地坚持了一个星期。<br>​    一个星期之后，你还是和周围千万个人一样，你还是和一星期前的自己一样。<br>​    你逛网络论坛，看到了这样一句话：“二十岁是人生最美好的时光，不应该局限在学校里教室里，应该享受生活。” 于是你相信了，你觉得二十岁的你就应该“随心所欲”，享受“人生中最后的自由时光”；就应该“快乐地去恋爱”“风华正茂”“挥斥方遒”······<br>​    现在的你，用着父母的血汗钱，用着名牌包、穿着名牌跑鞋、骑着捷安特山地车、用着佳能牌的相机和苹果牌的手机，还经常去星巴克喝喝咖啡体验一下小资情调······<br>​    那么，请允许我猜测一下你的未来——<br>​    在大四将要结束时，你考研落榜。你风风火火的参加校园招聘会，很多公司你都看不上，嫌他们不是体制内单位、平台窄、规模小，直到毕业，你还没有找到心仪的工作。你收拾好行李回到老家，父母让你试着参加各种招聘考试或者参加当地的应聘会，你不去，因为你觉得那些工作太简单了，不适合你，你应该去寻找更好的就业机会。可是，当你去那些你看得上的公司应聘时，你的竞争对手太多了，而且都不差，你表现平平，理所当然地被拒之门外······<br>​    现在的你，也许还在上大学，也许和恋人恩恩爱爱，每天黏在一起，午饭晚饭一起去吃，晚自习后还会一起在操场散步。你们讨论起未来，最后的结论总是：不要想得太多，认真过好现在就好。 不幸运的话，几个月后，你们就分手了，你凄凄惨惨戚戚，反复问自己究竟哪里做错了；幸运的话，你们会一直恋爱到毕业，最终，你绝得自己不够优秀没能力去对方所在的城市读研或者工作，所以你们带着不舍和悔恨分手了。<br>​    现实很残酷，至此，你信了。<br>​    现在的你喜欢刷微博，你会全力支持那些你赞同的观点，你会激励否定那些你反对的观点。你爱憎分明，看起来很有正义感。你觉得血气方刚的年轻人就应该敢于说出自己的心声。你可能从来不会去想一个问题：你的观点，来自哪里？其实，它们绝大部分来自网络，它们已经蚕食了你的判断力。<br>现在，我只想问你一个问题：二十岁的你，有什么资本。<br>​    你只是千千万万人中微不足道的一个人，少了你，地球还是一样会转。<br>​    我敢打赌，一定很久没人和你说过“吃得苦中苦，方为人上人”这句话了吧？<br>​    你知道“责任”两个字是怎么写的吗?<br>​    当你谈论飞翔的时候，你是不是忘记了地心引力的存在？<br>​    现在的你，如果还是放纵着自己的懒惰与幼稚，虚度着光阴，那么，你就虚度去吧。反正我已经    过了二十岁的年纪，我还有未来，我得直奔向前了，不陪你了。<br>​    再见 </p>
<p>——华文《20岁无资本无未来》</p>
]]></content>
      <tags>
        <tag>自嘲</tag>
      </tags>
  </entry>
  <entry>
    <title>2018年总结</title>
    <url>/2018/12/31/25/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>2018年是充满收获的一年 也是充满坎坷的一年 自己从身份上完成了从学生到社会人的转变 心智也相对成熟 感谢在18年中给我帮助的同仁 同事和朋友 更感谢在生活工作中出现的贵人 但同时也鄙视一下出现在我生活中的傻逼们 但是正是由于有这些形形色色的人的出现 才让我更加快速的成长 感谢遇见 感恩<br>2019年新的一年 自己又长了一岁 希望自己各方面都能有所收获 本命年的一年 24岁的年龄 和前辈们相比是否能够沿着他们的足迹 亦或是能够更加出色 找准自己的定位 在职场 情场 各种场上不在那么衰 不在失意 最重要的是努力加油 ~<br>最近有说法 2018年是过去十年最差的一年 却将会是未来十年最好的一年 看到大街上熙熙攘攘的人群 每个人都在为自己奋斗 加油 ！<br>之前 总喜欢挂在嘴边的念念不忘 必有回响今天后面加一句 愿自己</p>
<p>日益努力 而后风生水起</p>
<p>再转个老工程师发朋友圈的感言：</p>
<blockquote>
<p>最近和一些朋友聊天，发现不少人对新技术革命推崇备至，对传统技术有错误的认知，借此机会我来纠正一些朋友对IT从业人员必备技能的错误认知[呲牙]  软件定义一切和虚拟化极大简化了业务系统部署和管理，自然包括极其重要的底层网络虚拟化，有些朋友认为学习传统网络协议如BGP, OSPF, MPLS，ECMP，LACP等等，通过CCIE，HCIE等认证不再有任何意义了，这是一个极其错误的认知，我觉得有义务做一个科普，避免误导想进入这一行的年轻人。网络虚拟化实现都是采用Overlay技术构建在Underlay IP网络之上，各种路由协议不但没有消亡，而是焕发了新的青春。为了满足快速增长的虚拟化的性能需求，下一代数据中心的高度可扩展的分布式核心架构，就是常说的Spine-and-leaf架构，可以支持成千上万物理服务器，在Leaf和Spine之间跑eBGP 是常见配置，通过EVPN address family 交换节点L2,L3可达信息，这也是BGP设计之初没想到的用法吧，为了适应SDN发展的Segment Routing也是在IS-IS和OSPF两个堂兄弟的基础上稍做扩展来实现，可轻松配合MPLS VPN网络无缝衔接，作为IT业者，掌握各种传统路由协议，例如MP-BGP自然是必备的技能，协议本身的高度可扩展性使它们永葆青春，与时俱进。还在学习网络技能的兄弟们，继续努力，你们学到知识大有可为，基础路由协议和SDN，虚拟化并不矛盾，相反，它是一切虚拟化方案依赖的基础，没有底层Underlay IP基础网络，一切虚拟化都是空中楼阁，镜花水月！希望本文对想入行的年轻人有参加价值，不要被各种宣传迷惑了双眼，迷失了方向！认同的点个赞[呲牙]</p>
</blockquote>
]]></content>
      <tags>
        <tag>自嘲</tag>
      </tags>
  </entry>
  <entry>
    <title>华为交换机端口无法UP故障排查思路 光衰查看</title>
    <url>/2019/04/28/28/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><strong>一、电口无法UP</strong></p>
<p>1、故障现象</p>
<p>​    网线相连的两个电口无法UP。</p>
<p>2、故障处理步骤</p>
<p>​    请保存以下步骤的执行结果，以便故障无法解决时快速收集和反馈信息。</p>
<p>​    2.1、检查端口是否被shutdown。首先检查故障端口有没有被shutdown或被拔掉网线，如果有shutdown的端口，则执行undo shutdown。</p>
<p>​    2.2、检查两端端口配置。检查两端电口的端口配置是否正确： 两边端口的速率、双工模式要一致；两边的自协商状态要一致，确保均工作在自协商模式下或者是非自协商模式下。</p>
<p>​    个别厂家设备跟华为交换机互连可能自协商不能link up，这时请将两端端口都尝试设置成强制方式。</p>
<p>​    2.3、检查MDI设置。MDI有三种模式，和网线是否是交叉网线有关，如果不确认网线类型，则将两端配置为auto模式。这三种模式对接的结果如下表1和下表2所示。</p>
<table>
<thead>
<tr>
<th>表1 平行网线对接表</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>平行网线</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>对接前电口MDI设置</td>
<td>对接后状态</td>
<td></td>
<td></td>
</tr>
<tr>
<td>端口A</td>
<td>端口B</td>
<td>端口A</td>
<td>端口B</td>
</tr>
<tr>
<td>GE电口AUTO</td>
<td>GE电口AUTO</td>
<td>UP</td>
<td>UP</td>
</tr>
<tr>
<td>FE电口AUTO</td>
<td>FE电口AUTO</td>
<td>UP</td>
<td>UP</td>
</tr>
<tr>
<td>FE电口AUTO</td>
<td>FE电口NORMAL</td>
<td>UP</td>
<td>UP</td>
</tr>
<tr>
<td>FE电口AUTO</td>
<td>FE电口ACROSS</td>
<td>UP</td>
<td>UP</td>
</tr>
<tr>
<td>FE电口ACROSS</td>
<td>FE电口NORMAL</td>
<td>UP</td>
<td>UP</td>
</tr>
<tr>
<td>FE电口ACROSS</td>
<td>FE电口ACROSS</td>
<td>DOWN</td>
<td>DOWN</td>
</tr>
<tr>
<td>FE电口NORMAL</td>
<td>FE电口NORMAL</td>
<td>DOWN</td>
<td>DOWN</td>
</tr>
<tr>
<td>表2 交叉网线对接表</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>交叉网线</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>对接前电口MDI设置</td>
<td>对接后状态</td>
<td></td>
<td></td>
</tr>
<tr>
<td>端口A</td>
<td>端口B</td>
<td>端口A</td>
<td>端口B</td>
</tr>
<tr>
<td>GE电口AUTO</td>
<td>GE电口AUTO</td>
<td>UP</td>
<td>UP</td>
</tr>
<tr>
<td>FE电口AUTO</td>
<td>FE电口AUTO</td>
<td>UP</td>
<td>UP</td>
</tr>
<tr>
<td>FE电口AUTO</td>
<td>FE电口NORMAL</td>
<td>UP</td>
<td>UP</td>
</tr>
<tr>
<td>FE电口AUTO</td>
<td>FE电口ACROSS</td>
<td>UP</td>
<td>UP</td>
</tr>
<tr>
<td>FE电口NORMAL</td>
<td>FE电口NORMAL</td>
<td>DOWN</td>
<td>DOWN</td>
</tr>
<tr>
<td>FE电口ACROSS</td>
<td>FE电口NORMAL</td>
<td>UP</td>
<td>UP</td>
</tr>
<tr>
<td>FE电口ACROSS</td>
<td>FE电口ACROSS</td>
<td>UP</td>
<td>UP</td>
</tr>
</tbody></table>
<p>3、检查链路。</p>
<p>​    3.1、排除网线问题：</p>
<p>​    看是否存在接触不好及网线外部损坏的情况；GE电口使用低于5类线的网线时接口不能UP；网线的4对线中有部分出现损坏，也不能够确保GE电口UP。</p>
<p>​    3.2、排除端口问题：</p>
<p>​    检查网口里面金属弹片是否凹陷或偏位；外环回和内环回测试。</p>
<p>​    3.3、测试链路的基本方法：</p>
<p>​    外环测试方法： 一般使用认为正常的端口来测试网线，端口能够UP即可，即交换机上的两个端口互连（注意现场的环路，可用临时建立其它vlan，两个端口配置不同的vlan）。</p>
<p>​    盒式交换机的设备可以执行virtual-cable-test命令, 用来查看链路是否存在有短路，交叉等的情况，再逐步来排除端口还是网线的问题。该命令行会导致该端口发生UP/DOWN。</p>
<p>​    对于端口是UP的，但是怀疑端口不能发包或收包，可以使用两个端口对接，分别在两个UP的端口执行test-packet start interface interface-type interface-number -c 来查看端口的统计计数是否正常，判断端口收发包是否正常。</p>
<p>​    [Quidway] test-packet start interface Ethernet 0/0/1 ?</p>
<p>​    -c    The number of packet</p>
<p>​    -s    The packet size</p>
<p>4、如果以上几步还是不能解决问题，请收集如下信息，并联系技术支持工程师。</p>
<p>​    上述步骤的执行结果；设备的配置文件、日志文件、告警信息；参考命令：display this interface、display logbuffer、display this。</p>
<p><strong>二、光口无法UP</strong></p>
<p>1、故障现象</p>
<p>​    两个光口互连时，端口无法UP。</p>
<p>2、故障处理步骤</p>
<p>​    请保存以下步骤的执行结果，以便故障无法解决时快速收集和反馈信息。</p>
<p>​    2.1、检查端口是否被shutdown。首先检查故障端口有没有被shutdown或被拔掉光纤，如果有shutdown的端口，则要执行命令undo shutdown。</p>
<p>​    2.2、检查两端端口配置。检查两端光口的端口配置是否按正确配置进行： 两边端口的速率要一致；两边端口的自协商模式要一致。</p>
<p>​    2.3、检查使用的光模块是否为华为认证的光模块。如果为非华为认证光模块，需替换为华为认证的光模块。</p>
<p>​    2.4、检查光纤、光模块是否配合使用正确：多模光纤需要与多模光模块配合使用；单模光纤只能用于单模光模块，不能够与多模光模块配合使用。 单模光纤一般为黄颜色，多模光纤一般为橘黄色。</p>
<p>​    2.5、在系统模式下输入display transceiver interface <em>interface-type interface-number</em>（故障点所在端口）verbose，查看对接光模块的波长是否一样。</p>
<p>​     <Quidway> display transceiver interface GigabitEthernet 0/1/1 verbose</p>
<p>​     GigabitEthernet0/1/1 transceiver information:</p>
<p>-————————————————————</p>
<p>Common information:</p>
<p>  Transceiver Type               :1000_BASE_SX_SFP</p>
<p>  Vendor PN                      :FTLF8519P3BTL-HW</p>
<p>  Connector Type                 :LC</p>
<p>  <strong>Wavelength(nm)                 :850</strong></p>
<p>  Transfer Distance(m)           :500(50um),300(62.5um)</p>
<p>  Digital Diagnostic Monitoring  :YES</p>
<p>  Vendor Name                    :FINISAR CORP.  </p>
<p>  Ordering Name                  :</p>
<p>-————————————————————</p>
<p>Diagnostic information:</p>
<p>  Temperature(℃ )              :27.00</p>
<p>  Temp High Threshold(℃ )      :90.00</p>
<p>  Temp Low  Threshold(℃ )      :-20.00</p>
<p>  Voltage(V)                    :3.27</p>
<p>  Volt High Threshold(V)        :3.70</p>
<p>  Volt Low  Threshold(V)        :2.90</p>
<p>  Bias Current(mA)              :6.94</p>
<p>  Bias High Threshold(mA)       :24.01</p>
<p>  Bias Low  Threshold(mA)       :1.75</p>
<p>  RX Power(dBM)                 :-28.54</p>
<p>  RX Power High Threshold(dBM)  :0.00</p>
<p>  RX Power Low  Threshold(dBM)  :-16.99</p>
<p>  TX Power(dBM)                 :-4.99</p>
<p>  TX Power High Threshold(dBM)  :0.00</p>
<p>  TX Power Low  Threshold(dBM)  :-9.50</p>
<p>-————————————————————</p>
<p>​    2.5、查看是否存在光口和光模块对应错误的情况：如100M光口使用了1000M光模块。</p>
<p>​    2.6、查看端口的收发光功率是否在正常范围内。光模块的收光光功率太低或太高都会导致端口不能UP，同时传输距离及光纤质量也是考虑因素。</p>
<p>​    2.7、自环测试。上述信息都正常的情况下，请做端口自环测试，将头纤及尾纤连接到同一个光模块上，确认端口是否能正常UP。</p>
<p>​    2.8、更换器件。仍不能确定问题的情况下，请优先考虑更换光模块及光纤。</p>
<p>​    2.9、如果以上几步还是不能解决问题，请收集如下信息，并联系技术支持工程师。 上述步骤的执行结果；设备的配置文件、日志文件、告警信息；参考命令：display this interface、display logbuffer、display this、display transceiver verbose。</p>
<p>如何查看华为交换机路由器光模块的收发光功率?</p>
<p>使用命令display transceiver verbose查看光模块的收发功率。版本不一样，显示信息有所差别，举例如下：</p>
<p>1、盒式交换机&amp;<strong>框式交换机 V100R006C03&amp;V100R006C05</strong>版本</p>
<p><strong>RX Power(dBM)**代表光模块接收功率，</strong>TX Power(dBM)**代表光模块发送功率。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;Quidway&gt; **display transceiver interface gigabitethernet 0&#x2F;0&#x2F;1 verbose**</span><br><span class="line"></span><br><span class="line">GigabitEthernet0&#x2F;0&#x2F;1 transceiver information:                                  </span><br><span class="line"></span><br><span class="line">\-------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">Common information:</span><br><span class="line"></span><br><span class="line">  Transceiver Type               :1000_BASE_SX_SFP</span><br><span class="line"></span><br><span class="line">  Connector Type                 :LC</span><br><span class="line"></span><br><span class="line">  Wavelength(nm)                 :850</span><br><span class="line"></span><br><span class="line">  Transfer Distance(m)           :300(50um),150(62.5um)</span><br><span class="line"></span><br><span class="line">  Digital Diagnostic Monitoring  :YES</span><br><span class="line"></span><br><span class="line">  Vendor Name                    :SumitomoElectric</span><br><span class="line"></span><br><span class="line">  Vendor Part Number             :HFBR-5710L</span><br><span class="line"></span><br><span class="line">  Ordering Name                  :</span><br><span class="line"></span><br><span class="line">\-------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">Manufacture information:</span><br><span class="line"></span><br><span class="line">  Manu. Serial Number            :88K056C10353</span><br><span class="line"></span><br><span class="line">  Manufacturing Date             :2008-08-08</span><br><span class="line"></span><br><span class="line">  Vendor Name                    :SumitomoElectric</span><br><span class="line"></span><br><span class="line">\-------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">**Diagnostic information:**&#x2F;&#x2F;Diagnostic information这一段落仅V100R006C03版本显示</span><br><span class="line"></span><br><span class="line">  **Temperature(****°C)              :26.00**</span><br><span class="line"></span><br><span class="line">  **Temp High Threshold(****°C)      :85.00**</span><br><span class="line"></span><br><span class="line">  **Temp Low  Threshold(****°C)      :-40.00**</span><br><span class="line"></span><br><span class="line">  **Voltage(V)                    :3.29**</span><br><span class="line"></span><br><span class="line">  **Volt High Threshold(V)        :3.64**</span><br><span class="line"></span><br><span class="line">  **Volt Low  Threshold(V)        :2.95**</span><br><span class="line"></span><br><span class="line">  **Bias Current(mA)              :4.57**</span><br><span class="line"></span><br><span class="line">  **Bias High Threshold(mA)       :9.00**</span><br><span class="line"></span><br><span class="line">  **Bias Low  Threshold(mA)       :2.00**</span><br><span class="line"></span><br><span class="line">  **RX Power(dBM)                 :-40.00**</span><br><span class="line"></span><br><span class="line">  **RX Power High Threshold(dBM)  :0.00**</span><br><span class="line"></span><br><span class="line">  **RX Power Low  Threshold(dBM)  :-16.99**</span><br><span class="line"></span><br><span class="line">  **TX Power(dBM)                 :-5.03**</span><br><span class="line"></span><br><span class="line">  **TX Power High Threshold(dBM)  :-2.22**</span><br><span class="line"></span><br><span class="line">  **TX Power Low  Threshold(dBM)  :-6.99**</span><br><span class="line"></span><br><span class="line">**-------------------------------------------------------------**</span><br><span class="line"></span><br><span class="line">User information:</span><br><span class="line"></span><br><span class="line">  THIS_IS_A_TEST</span><br><span class="line"></span><br><span class="line">\-------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">Diagnostic information:</span><br><span class="line"></span><br><span class="line">  Temperature(°C)                      :40.21</span><br><span class="line"></span><br><span class="line">  Temp High Warning Threshold(°C)      :93.00</span><br><span class="line"></span><br><span class="line">  Temp Low  Warning Threshold(°C)      :-30.00</span><br><span class="line"></span><br><span class="line">  Temp High Alarm   Threshold(°C)      :110.00</span><br><span class="line"></span><br><span class="line">  Temp Low  Alarm   Threshold(°C)      :-40.00</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">  Voltage(V)                            :3.26</span><br><span class="line"></span><br><span class="line">  Volt High Warning Threshold(V)        :3.70</span><br><span class="line"></span><br><span class="line">  Volt Low  Warning Threshold(V)        :2.90</span><br><span class="line"></span><br><span class="line">  Volt High Alarm   Threshold(V)        :3.90</span><br><span class="line"></span><br><span class="line">  Volt Low  Alarm   Threshold(V)        :2.70</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">  Bias Current(mA)                      :23.78</span><br><span class="line"></span><br><span class="line">  Bias High Warning Threshold(mA)       :70.00</span><br><span class="line"></span><br><span class="line">  Bias Low  Warning Threshold(mA)       :4.00</span><br><span class="line"></span><br><span class="line">  Bias High Alarm   Threshold(mA)       :80.00</span><br><span class="line"></span><br><span class="line">  Bias Low  Alarm   Threshold(mA)       :2.00</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">  **RX Power(dBM)**                         :-31.10</span><br><span class="line"></span><br><span class="line">  RX Power High Warning Threshold(dBM)  :-1.00</span><br><span class="line"></span><br><span class="line">  RX Power Low  Warning Threshold(dBM)  :-20.00</span><br><span class="line"></span><br><span class="line">  RX Power High Alarm   Threshold(dBM)  :0.75</span><br><span class="line"></span><br><span class="line">  RX Power Low  Alarm   Threshold(dBM)  :-23.97</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">  **TX Power(dBM)**                         :-5.78</span><br><span class="line"></span><br><span class="line">  TX Power High Warning Threshold(dBM)  :-1.00</span><br><span class="line"></span><br><span class="line">  TX Power Low  Warning Threshold(dBM)  :-11.50</span><br><span class="line"></span><br><span class="line">  TX Power High Alarm   Threshold(dBM)  :0.99</span><br><span class="line"></span><br><span class="line">  TX Power Low  Alarm   Threshold(dBM)  :-13.50</span><br><span class="line"></span><br><span class="line">\-------------------------------------------------------------</span><br></pre></td></tr></table></figure>



<p><strong>2**</strong>、框式交换机 V200R002&amp;V200R003**<strong>版本</strong></p>
<p><strong>Current Rx Power(dBM)**代表光模块当前接收功率， **Current Tx Power(dBM</strong>)代表光模块当前发送功率。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;Quidway&gt; **display transceiver interface gigabitethernet 3&#x2F;0&#x2F;0 verbose**</span><br><span class="line"></span><br><span class="line">GigabitEthernet3&#x2F;0&#x2F;0 transceiver information:                       </span><br><span class="line"></span><br><span class="line">\-------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">Common information:</span><br><span class="line"></span><br><span class="line">  Transceiver Type               :1000_BASE_SX_SFP</span><br><span class="line"></span><br><span class="line">  Connector Type                 :LC</span><br><span class="line"></span><br><span class="line">  Wavelength(nm)                 :850</span><br><span class="line"></span><br><span class="line">  Transfer Distance(m)           :500(50um),300(62.5um)</span><br><span class="line"></span><br><span class="line">  Digital Diagnostic Monitoring  :YES</span><br><span class="line"></span><br><span class="line">  Vendor Name                    :FINISAR CORP.</span><br><span class="line"></span><br><span class="line">  Vendor Part Number             :FTLF8519P2BNL-HW</span><br><span class="line"></span><br><span class="line">  Ordering Name                  :</span><br><span class="line"></span><br><span class="line">\-------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">Manufacture information:</span><br><span class="line"></span><br><span class="line">  Manu. Serial Number            :PEP3L5D</span><br><span class="line"></span><br><span class="line">  Manufacturing Date             :2008-12-05</span><br><span class="line"></span><br><span class="line">  Vendor Name                    :FINISAR CORP.</span><br><span class="line"></span><br><span class="line">\-------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">Alarm information:</span><br><span class="line"></span><br><span class="line">  TX power low</span><br><span class="line"></span><br><span class="line">\-------------------------------------------------------------                  </span><br><span class="line"></span><br><span class="line">Diagnostic information:</span><br><span class="line"></span><br><span class="line">  Temperature(°C)                       :39</span><br><span class="line"></span><br><span class="line">  Voltage(V)                            :3.31</span><br><span class="line"></span><br><span class="line">  Bias Current(mA)                      :6.59</span><br><span class="line"></span><br><span class="line">  Bias High Threshold(mA)               :10.50</span><br><span class="line"></span><br><span class="line">  Bias Low  Threshold(mA)               :2.50</span><br><span class="line"></span><br><span class="line">  **Current Rx Power(dBM)**                 :-2.23</span><br><span class="line"></span><br><span class="line">  Default Rx Power High Threshold(dBM)  :3.01</span><br><span class="line"></span><br><span class="line">  Default Rx Power Low  Threshold(dBM)  :-15.02</span><br><span class="line"></span><br><span class="line">  **Current Tx Power(dBM**)                 :-2.45</span><br><span class="line"></span><br><span class="line">  Default Tx Power High Threshold(dBM)  :3.01</span><br><span class="line"></span><br><span class="line">  Default Tx Power Low  Threshold(dBM)  :-9.00</span><br><span class="line"></span><br><span class="line">  User Set Rx Power High Threshold(dBM) :3.01</span><br><span class="line"></span><br><span class="line">  User Set Rx Power Low Threshold(dBM)  :-15.02</span><br><span class="line"></span><br><span class="line">  User Set Tx Power High Threshold(dBM) :3.01</span><br><span class="line"></span><br><span class="line">  User Set Tx Power Low Threshold(dBM)  :-9.00</span><br></pre></td></tr></table></figure>

<p>-————————————————————</p>
<p><strong>3、那么如何保证光模块的收发功率?</strong></p>
<p>​    光模块的诊断信息中，可以查看当前发送和接收的光功率值，以及默认的最高和最低功率值。</p>
<p>​    如果接收功率低（RxPower Low），说明本端接收到的信号过低，则可能出现端口不UP或者UP后报文收发有丢弃，此时请先排查传输距离是否过远，超出了该光模块的传输距离，再排查链路，如光模块、光纤是否有损坏，光纤单模多模是否用错，熔纤连接处质量是否可靠等，以及对端光模块发送功率是否过低。</p>
<p>​    如果接收功率高（RxPower High），说明本端接收到的信号过高，可能原因是该光模块为长距光模块，而实际传输距离太短，导致信号未衰减，此时应在光模块上增加光衰，以对光模块进行保护。</p>
<p>​    如果发送功率低（TxPower Low），说明该光模块发送信号不好，可能会导致对端接收功率低，而造成端口不UP或者UP后报文收发有丢弃，可能原因是光模块光口受污染，如灰尘积的太多等，此时请用棉签清洗光模块，然后再测试光口发光功率是否恢复正常。</p>
<p>​    如果发送功率高（TxPower High），说明该光模块发送信号太强，可能会导致对端接收功率高，而造成对端光模块因接收功率持续过高而烧坏，可能原因是本端光模块故障，建议更换光模块。</p>
<p>​    因此，在端口插入光模块并对接成功后，要对发送或接收光功率方面的告警信息进行排查，避免因功率过低或者过高造成流量或者光模块不正常。</p>
]]></content>
      <tags>
        <tag>华为</tag>
      </tags>
  </entry>
  <entry>
    <title>NGINX入门理解</title>
    <url>/2019/04/29/29/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>分享一篇来自简书的文章，对Nginx的讲解非常到位，文章链接：<a href="https://link.zhihu.com/?target=https://www.jianshu.com/p/5eab0f83e3b4">深入浅出Nginx</a>，作者主页：<a href="https://link.zhihu.com/?target=https://www.jianshu.com/u/cb569cce501b">张丰哲 - 简书</a>。</p>
<p>Nginx是一款轻量级的Web服务器、反向代理服务器，由于它的内存占用少，启动极快，高并发能力强，在互联网项目中广泛应用。</p>
<p><img src="https://image01.zhang-zhe.cn/20190429134037.png"></p>
<p>上图基本上说明了当下流行的技术架构，其中Nginx有点入口网关的味道。</p>
<h2 id="反向代理服务器？"><a href="#反向代理服务器？" class="headerlink" title="反向代理服务器？"></a>反向代理服务器？</h2><p>经常听人说到一些术语，如反向代理，那么什么是反向代理，什么又是正向代理呢？</p>
<p><strong>正向代理：</strong></p>
<p><img src="https://image01.zhang-zhe.cn/20190429134104.png"></p>
<p><strong>反向代理：</strong></p>
<p><img src="https://image01.zhang-zhe.cn/20190429134124.png"></p>
<p>由于防火墙的原因，我们并不能直接访问谷歌，那么我们可以借助VPN来实现，这就是一个简单的正向代理的例子。这里你能够发现，正向代理“代理”的是客户端，而且客户端是知道目标的，而目标是不知道客户端是通过VPN访问的。</p>
<p>当我们在外网访问百度的时候，其实会进行一个转发，代理到内网去，这就是所谓的反向代理，即反向代理“代理”的是服务器端，而且这一个过程对于客户端而言是透明的。</p>
<h2 id="Nginx的Master-Worker模式"><a href="#Nginx的Master-Worker模式" class="headerlink" title="Nginx的Master-Worker模式"></a>Nginx的Master-Worker模式</h2><p><img src="https://image01.zhang-zhe.cn/20190429134156.png"></p>
<p>启动Nginx后，其实就是在80端口启动了Socket服务进行监听，如图所示，Nginx涉及Master进程和Worker进程。</p>
<p><img src="https://image01.zhang-zhe.cn/20190429134220.png"></p>
<p>Master进程的作用是？</p>
<p><strong>读取并验证配置文件nginx.conf；管理worker进程；</strong></p>
<p>Worker进程的作用是？</p>
<p><strong>每一个Worker进程都维护一个线程（避免线程切换），处理连接和请求；注意Worker进程的个数由配置文件决定，一般和CPU个数相关（有利于进程切换），配置几个就有几个Worker进程。</strong></p>
<h2 id="思考：Nginx如何做到热部署？"><a href="#思考：Nginx如何做到热部署？" class="headerlink" title="思考：Nginx如何做到热部署？"></a>思考：Nginx如何做到热部署？</h2><p>所谓热部署，就是配置文件nginx.conf修改后，不需要stop Nginx，不需要中断请求，就能让配置文件生效！（nginx -s reload 重新加载/nginx -t检查配置/nginx -s stop）</p>
<p>通过上文我们已经知道worker进程负责处理具体的请求，那么如果想达到热部署的效果，可以想象：</p>
<p>方案一：</p>
<p>修改配置文件nginx.conf后，主进程master负责推送给woker进程更新配置信息，woker进程收到信息后，更新进程内部的线程信息。（有点valatile的味道）</p>
<p>方案二：</p>
<p>修改配置文件nginx.conf后，重新生成新的worker进程，当然会以新的配置进行处理请求，而且新的请求必须都交给新的worker进程，至于老的worker进程，等把那些以前的请求处理完毕后，kill掉即可。</p>
<p>Nginx采用的就是方案二来达到热部署的！</p>
<h2 id="思考：Nginx如何做到高并发下的高效处理？"><a href="#思考：Nginx如何做到高并发下的高效处理？" class="headerlink" title="思考：Nginx如何做到高并发下的高效处理？"></a>思考：Nginx如何做到高并发下的高效处理？</h2><p>上文已经提及Nginx的worker进程个数与CPU绑定、worker进程内部包含一个线程高效回环处理请求，这的确有助于效率，但这是不够的。</p>
<p><strong>作为专业的程序员，我们可以开一下脑洞：BIO/NIO/AIO、异步/同步、阻塞/非阻塞…</strong></p>
<p>要同时处理那么多的请求，要知道，有的请求需要发生IO，可能需要很长时间，如果等着它，就会拖慢worker的处理速度。</p>
<p><strong>Nginx采用了Linux的epoll模型，epoll模型基于事件驱动机制，它可以监控多个事件是否准备完毕，如果OK，那么放入epoll队列中，这个过程是异步的。worker只需要从epoll队列循环处理即可。</strong></p>
<h2 id="思考：Nginx挂了怎么办？"><a href="#思考：Nginx挂了怎么办？" class="headerlink" title="思考：Nginx挂了怎么办？"></a>思考：Nginx挂了怎么办？</h2><p>Nginx既然作为入口网关，很重要，如果出现单点问题，显然是不可接受的。</p>
<p>答案是：<strong>Keepalived+Nginx实现高可用</strong>。</p>
<p>Keepalived是一个高可用解决方案，主要是用来防止服务器单点发生故障，可以通过和Nginx配合来实现Web服务的高可用。（其实，Keepalived不仅仅可以和Nginx配合，还可以和很多其他服务配合）</p>
<p>Keepalived+Nginx实现高可用的思路：</p>
<p>第一：请求不要直接打到Nginx上，应该先通过Keepalived（这就是所谓虚拟IP，VIP）</p>
<p>第二：Keepalived应该能监控Nginx的生命状态（提供一个用户自定义的脚本，定期检查Nginx进程状态，进行权重变化,，从而实现Nginx故障切换）</p>
<p><img src="https://image01.zhang-zhe.cn/20190429134249.png"></p>
<h2 id="我们的主战场：nginx-conf"><a href="#我们的主战场：nginx-conf" class="headerlink" title="我们的主战场：nginx.conf"></a>我们的主战场：nginx.conf</h2><p>很多时候，在开发、测试环境下，我们都得自己去配置Nginx，就是去配置nginx.conf。</p>
<p>nginx.conf是典型的分段配置文件，下面我们来分析下。</p>
<h2 id="虚拟主机"><a href="#虚拟主机" class="headerlink" title="虚拟主机"></a>虚拟主机</h2><p><img src="https://image01.zhang-zhe.cn/20190429134316.png"></p>
<p>其实这是把Nginx作为web server来处理静态资源。</p>
<p>第一：location可以进行正则匹配，应该注意正则的几种形式以及优先级。（这里不展开）</p>
<p>第二：Nginx能够提高速度的其中一个特性就是：动静分离，就是把静态资源放到Nginx上，由Nginx管理，动态请求转发给后端。</p>
<p><strong>第三：我们可以在Nginx下把静态资源、日志文件归属到不同域名下（也即是目录），这样方便管理维护。</strong></p>
<p><strong>第四：Nginx可以进行IP访问控制，有些电商平台，就可以在Nginx这一层，做一下处理，内置一个黑名单模块，那么就不必等请求通过Nginx达到后端在进行拦截，而是直接在Nginx这一层就处理掉。</strong></p>
<h2 id="反向代理【proxy-pass】"><a href="#反向代理【proxy-pass】" class="headerlink" title="反向代理【proxy_pass】"></a>反向代理【proxy_pass】</h2><p>所谓反向代理，很简单，其实就是在location这一段配置中的root替换成<strong>proxy_pass</strong>即可。root说明是静态资源，可以由Nginx进行返回；而proxy_pass说明是动态请求，需要进行转发，比如代理到Tomcat上。</p>
<p>反向代理，上面已经说了，过程是透明的，比如说request -&gt; Nginx -&gt; Tomcat，那么对于Tomcat而言，请求的IP地址就是Nginx的地址，而非真实的request地址，这一点需要注意。不过好在Nginx不仅仅可以反向代理请求，还可以由用户<strong>自定义设置HTTP HEADER</strong>。</p>
<h2 id="负载均衡【upstream】"><a href="#负载均衡【upstream】" class="headerlink" title="负载均衡【upstream】"></a>负载均衡【upstream】</h2><p>上面的反向代理中，我们通过proxy_pass来指定Tomcat的地址，很显然我们只能指定一台Tomcat地址，那么我们如果想指定多台来达到负载均衡呢？</p>
<p>第一，通过<strong>upstream</strong>来定义一组Tomcat，并指定负载策略（IPHASH、加权论调、最少连接），健康检查策略（Nginx可以监控这一组Tomcat的状态）等。</p>
<p>第二，将proxy_pass替换成upstream指定的值即可。</p>
<p><strong>负载均衡可能带来的问题？</strong></p>
<p>负载均衡所带来的明显的问题是，一个请求，可以到A server，也可以到B server，这完全不受我们的控制，当然这也不是什么问题，只是我们得注意的是：<strong>用户状态的保存问题，如Session会话信息，不能在保存到服务器上。</strong></p>
<h2 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h2><p>缓存，是Nginx提供的，可以加快访问速度的机制，说白了，在配置上就是一个开启，同时指定目录，让缓存可以存储到磁盘上。具体配置，大家可以参考Nginx官方文档，这里就不在展开了。</p>
]]></content>
      <tags>
        <tag>LINUX</tag>
      </tags>
  </entry>
  <entry>
    <title>无线网络问题排查</title>
    <url>/2019/05/05/32/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>在无线网络部署中，很多情况下会出现无线的干扰，以下简单描述下在AC和AP上通过命令来查看个别AP的使用性能。以下以06-18为列子进行排查：</p>
<p>一、<strong>首先查看**</strong>AP**<strong>上用户是否太多：</strong></p>
<p>dis wlan client ap a06-18    可以查看所有的AP接入终端信息</p>
<p>​    dis wlan client ap a06-18 radio 1  可查看radio1接入的终端信息。</p>
<p>注意在只有两个信道的时候radio 1 是5G；radio 2 是2.4G。有三个信道的时候，radio1和radio2是5G信道，radio 3是2.4G信道。2665系列的AP理论值30-40就出现网络卡。4330理论60-70，实际值根据现网情况而定。</p>
<p><strong>二、接下来查看网络的带宽：</strong></p>
<p>dis wlan ap name  a06-18 verbose | in Band-width    一般带宽越大越容易受到干扰，具体分析在下面登录AP后可查询。</p>
<p><strong>三、登录**</strong>AP**<strong>进行具体分析：</strong></p>
<p>1．    在AC上登录AP方法：dis wlan ap name  a06-18 verbose | in Address 可以查看AP的管理IP地址。然后在AC上通过以下方法登录AP。如图所示：</p>
<p><img src="https://image01.zhang-zhe.cn/20190505153941.png"></p>
<p>​          从AC登录AP：<br>进入AC隐藏模式_h打开对应AP的远程权限：</p>
<p>sys</p>
<p>_h                                       进入隐藏模式<br>wlan ap a06-18 tel en        打开远程telnet<br>wlan ap a06-18 ex en        打开远程控制<br>登录AP：<br>telnet 10.13.11.25</p>
<p> <img src="https://image01.zhang-zhe.cn/20190505154143.png"></p>
<p>2．  当登录AP后，我们可通过命令dis ar5drv 1 channelbusy查看AP的干扰问题：</p>
<p>登录AP后</p>
<p>sys</p>
<p>-h</p>
<p>dis ar5drv 1 channelbusy</p>
<p><img src="https://image01.zhang-zhe.cn/20190505154238.png"></p>
<p>图示为正常的AP工作图：extbusy的数值一般为零为正常现象，当extbusy有数值的时候就认为此事的AP有来自外部（非<em>802.11ac**的干扰</em>），出现这种问题的原因大部分都是因为贷款大导致的，修改贷款即可解决。</p>
<p>​     RX和TX的比值不要超过太多，当TX少，而RX超多的时候，就是因为无线网络信道收到干扰导致的。此事修改信道，改未被利用的信道，使得RX降下来即可。</p>
<p> V7版本：AC配置portal页面推送配置。<br>AP登录方式<br>probe 进入隐藏模式<br>wlan ap-execute 6f-04 exec-console enable<br>重启AP：<br>ac上reset wlan ap name xx可以重启，或者在交换机上undo poe enable </p>
<p>dbm的相关参数：信号需大于等于-75dbm 低于这个值信号就很弱了 要考虑为何没有漫游到更近的AP上面</p>
<p>重启ap命令：reset wlan ap ap name xx</p>
<p><strong>1**</strong>、查看AP射频口上各信道的空口利用率是否过高** </p>
<p>登录到AP上进入隐藏模式查看2.4G射频各信道（1、6、11）的空口利用率信息是否过高，<strong>crtlbusy的值是否高于60%。</strong></p>
<p>如果更换多种信道（包括3、8、13类的非常规信道）后发现各信道状况类似即可初步判断是非WLAN的干扰。</p>
<p>如果更换多种信道（包括3、8、13类的非常规信道）后发现空口利用率过高只出现在指定信道，则判断为同频干扰。</p>
<p>V5命令： </p>
<p>Ø  登陆到AP上进入隐藏模式 </p>
<p>[H3C] <em>_hide</em></p>
<p>Ø  查看AP当前信道的空口利用率 </p>
<p>[H3C-hidecmd] <em>display ar5 2 channelbusy</em></p>
<p>Ø  在AP的radio口下更改当前使用的信道 </p>
<p>[H3C-wlan-ap-ap3-radio-2] <em>channel 6</em></p>
<p>[11f04-hidecmd]display ar5 2 channelbusy</p>
<p>ChannelBusy information</p>
<p> Ctl Channel:    06    Channel Band: 20M</p>
<p> Ext Channel:</p>
<p> Record Interval(s):  9</p>
<p> Date/Month/Year: 13/05/2015</p>
<p>​       Time(h/m/s):   CtlBusy(%) TxBusy(%)  RxBusy(%)  ExtBusy(%)</p>
<p> 01     07:20:59         80          6         26          0</p>
<p> 02     07:20:50         87          6         25          0</p>
<p> 03     07:20:41         84          6         22          0</p>
<p> 04     07:20:32         83          6         23          0</p>
<p>……</p>
<p>V7命令：</p>
<p>Ø  登陆到AP上进入probe模式 </p>
<p>[H3C] <em>probe</em></p>
<p>Ø  查看AP当前信道的空口利用率 </p>
<p>[H3C-probe] <em>display ar5 2 channelbusy</em>                       </p>
<p>Ø  在AP的radio口下更改当前使用的信道 </p>
<p>[H3C-wlan-ap-ap3-radio-2] <em>channel 6</em></p>
<p>Ø  对于终结者超瘦（wt version ver2,ver3）模式，登录到本体后 </p>
<p>[H3C-1010-probe]<em>display system internal wlan-drv channelbusy subslot 1 radio 1</em></p>
<p><strong>2、判断现场干扰为WLAN同频干扰。</strong> </p>
<p>查看AP当前信道空口利用率中RxBusy过高随之带来crtlbusy的数值也很高，这种情况在更换多种不同的信道后效果出现明显变化，即只有指定的某个或几个信道出现空口利用率过高就可以判断当前环境存在WLAN的同频干扰。 </p>
<p>WLAN同频干扰是同一个信道上其他WLAN设备产生的干扰，换个角度看也不算干扰，说是空口竞争更为公平。</p>
<p>WLAN同频干扰表现在空口利用率的RxBusy很高，但不会那么凑巧的所有信道都存在一样程度的干扰。</p>
<p>因此我们只需要更换信道，看看空口利用率是否有明显区别，尤其是一些偏门信道比如3、8、13这样的，如果空口利用率不高，则说明之前那个信道受到的就是WLAN同频干扰。</p>
<p>另外，我们也可以在AP模板下配置</p>
<p>【V5】device-detection enable【V7】client-proximity-sensor enable，几分钟后通过【V5】display wlan ids detected all；【V7】display client-proximity-sensor device ap/display client-proximity-sensor device ap verbose查看AP探测到的周围WLAN设备情况。</p>
<p>如果确实能发现不少其他WLAN设备，也可以说明确实存在WLAN同频干扰。</p>
<p>例如：通过命令查看指定AP附近的所有信号状况。</p>
<p> [<strong>V5 AC</strong>]display wlan ids detected all</p>
<p> Total Number of Entries : 19</p>
<p> Flags: r = rogue, p = permit, a = adhoc, w = ap, b = wireless-bridge,</p>
<p>​        c = client</p>
<p> #AP = number of active APs detecting, Ch = channel number</p>
<p>​                          Detected Device(s) List</p>
<p>-——————————————————————————-</p>
<p> MAC Address    Vendor        Type  #AP  Ch  Last Detected       SSID</p>
<p>-——————————————————————————-</p>
<p> 0000-1111-0000 NORMEREL S… -p-w- 1    6   2015-11-14/14:19:13 “Broadcom19”</p>
<p> 0000-1111-0002 NORMEREL S… -p-w- 1    11  2015-11-14/14:19:49 “Broadcom”</p>
<p>[<strong>V7 AC</strong>]display client-proximity-sensor device ap</p>
<p>Total 16 detected ap</p>
<p>MAC address    Type   Duration    Sensors Channel Status</p>
<p>0023-89c1-ec80 AP     00h 02m 28s 1       11      Active</p>
<p>0023-89c1-ec81 AP     00h 02m 33s 1       11      Active</p>
<p>08ed-b958-ed80 AP     00h 02m 23s 1       6       Active</p>
<p>282c-b2b5-3130 AP     00h 01m 25s 1       11      Active</p>
<p>3891-d562-dc5d AP     00h 02m 54s 1       5       Active</p>
<p>[H3C]display client-proximity-sensor device ap verbose</p>
<p>Total 48 detected ap</p>
<p> AP: 0023-89c1-ec80</p>
<p>   Status: Active</p>
<p><strong>3、查看空口利用率中数据是否具有典型非WLAN干扰特征。</strong> </p>
<p>除了WLAN的同频干扰外，无线局点中也常常遇到一些非wlan的干扰，对2.4G影响最大的非WLAN干扰常见于4G的干扰。比如2320-2370MHz（移动），2300-2320MHz（联通），2370-2390MHz（电信），这些4G频段都是紧挨着WLAN的2.4G，如果信号源接近AP，通常都会对WLAN的2.4G产生影响，并且影响是相当的大。还有一些非WLAN干扰是完全处于2.4G的，比如微波炉、无绳电话、蓝牙、无线摄像头等，但根据经验看，这些干扰总体上对WLAN的影响相对来说还是要小的多。而有些设备看似工作在与wlan完全不相干的频段但由于其功率过大并且距离我们wlan设备较近，从而对电磁波产生一定的干扰继而影响wlan的无线传输，但一般这种干扰的影响都是非常弱的，不会是首要干扰源。 </p>
<p>典型的非WLAN干扰体现：**AP当前信道空口利用率中crtlbusy的数值远大于TX与RX之和，一般差值大于30%**。</p>
<p>例如：通过命令查看，当前AP的空口利用率ctrlbusy已经大于60%属于信道繁忙，且ctrlbusy的数值远大于TX与RX之和，更换信道后情况类似。 </p>
<p>[11f04-hidecmd]display ar5 2 channelbusy</p>
<p>ChannelBusy information</p>
<p> Ctl Channel:    06    Channel Band: 20M</p>
<p> Ext Channel:</p>
<p> Record Interval(s):  9</p>
<p> Date/Month/Year: 13/05/2015</p>
<p>​       Time(h/m/s):   CtlBusy(%) TxBusy(%)  RxBusy(%)  ExtBusy(%)</p>
<p> 01     07:20:59         <strong>80</strong>          6         <strong>26</strong>          0</p>
<p> 02     07:20:50         87          6         25          0</p>
<p> 03     07:20:41         84          6         22          0</p>
<p> 04     07:20:32         83          6         23          0</p>
<p> 05     07:20:23         89          6         29          0</p>
<p> 06     07:20:14         80          6         29          0  </p>
]]></content>
      <tags>
        <tag>H3C</tag>
      </tags>
  </entry>
  <entry>
    <title>全站HTTPS+接入又拍云CDN</title>
    <url>/2019/05/05/33/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>​    本着不折腾就会挂星人的性格，小博客于今天全站HTTPS并且接入了又拍云CDN，虽然没有人看，这个博客更大程度上也是想作为自己的一个小笔记，那成就感也是相当的强。。</p>
<p>​    还记得之前申请HTTPS的时候还挺麻烦的，在又拍云还挺简单，直接把cname解析到这边，再配置一下回源，回源类型指向到github提供的gitpage域名就可以生效了。接入又拍云联盟之后每个月还有一些免费的流量，足够自己用了。</p>
<p>​    互联网真厉害，我要开始自己的学习之旅了。一起加油吧。</p>
<p>​    哦对了，之前在SSL这上面被坑过一次，回头有时间总结一下。</p>
]]></content>
      <tags>
        <tag>自嘲</tag>
      </tags>
  </entry>
  <entry>
    <title>HTTPS 与 SSL 证书概要</title>
    <url>/2019/05/06/34/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>​    HTTPS简介</p>
<p>超文本传输安全协议（英语：Hypertext Transfer Protocol Secure，缩写：HTTPS，常称为HTTP over TLS，HTTP over SSL或HTTP Secure）是一种网络安全传输协议。具体介绍以前先来介绍一下以前常见的HTTP，HTTP就是我们平时浏览网页时候使用的一种协议。HTTP协议传输的数据都是未加密的，也就是明文，因此使用HTTP协议传输隐私信息非常不安全。HTTP使用80端口通讯，而HTTPS占用443端口通讯。在计算机网络上，HTTPS经由超文本传输协议（HTTP）进行通信，但利用SSL/TLS来加密数据包。HTTPS开发的主要目的，是提供对网络服务器的身份认证，保护交换数据的隐私与完整性。这个协议由网景公司（Netscape）在1994年首次提出，随后扩展到互联网上。</p>
<h2 id="HTTPS-工作原理"><a href="#HTTPS-工作原理" class="headerlink" title="HTTPS 工作原理"></a>HTTPS 工作原理</h2><p>HTTPS在传输数据之前需要客户端（浏览器）与服务端（网站）之间进行一次握手，在握手过程中将确立双方加密传输数据的密码信息。TLS/SSL协议不仅仅是一套加密传输的协议，更是一件经过艺术家精心设计的艺术品，TLS/SSL中使用了非对称加密，对称加密以及HASH算法。握手过程的具体描述如下：</p>
<ul>
<li>1）浏览器将自己支持的一套加密规则发送给网站。 </li>
<li>2）网站从中选出一组加密算法与HASH算法，并将自己的身份信息以证书的形式发回给浏览器。证书里面包含了网站地址，加密公钥，以及证书的颁发机构等信息。  </li>
<li>3）浏览器获得网站证书之后浏览器要做以下工作：  a) 验证证书的合法性（颁发证书的机构是否合法，证书中包含的网站地址是否与正在访问的地址一致等），如果证书受信任，则浏览器栏里面会显示一个小锁头，否则会给出证书不受信的提示。  b) 如果证书受信任，或者是用户接受了不受信的证书，浏览器会生成一串随机数的密码，并用证书中提供的公钥加密。  c) 使用约定好的HASH算法计算握手消息，并使用生成的随机数对消息进行加密，最后将之前生成的所有信息发送给网站。 </li>
<li> 4）网站接收浏览器发来的数据之后要做以下的操作：  a) 使用自己的私钥将信息解密取出密码，使用密码解密浏览器发来的握手消息，并验证HASH是否与浏览器发来的一致。  b) 使用密码加密一段握手消息，发送给浏览器。 </li>
<li> 5）浏览器解密并计算握手消息的HASH，如果与服务端发来的HASH一致，此时握手过程结束，之后所有的通信数据将由之前浏览器生成的随机密码并利用对称加密算法进行加密。 </li>
</ul>
<p>这里浏览器与网站互相发送加密的握手消息并验证，目的是为了保证双方都获得了一致的密码，并且可以正常的加密解密数据，为后续真正数据的传输做一次测试。另外，HTTPS一般使用的加密与HASH算法如下：</p>
<ul>
<li>非对称加密算法：RSA，DSA/DSS</li>
<li>对称加密算法：AES，RC4，3DES</li>
<li>HASH算法：MD5，SHA1，SHA256</li>
</ul>
<h3 id="HTTPS对应的通信时序图如下："><a href="#HTTPS对应的通信时序图如下：" class="headerlink" title="HTTPS对应的通信时序图如下："></a>HTTPS对应的通信时序图如下：</h3><p><img src="https://www.runoob.com/wp-content/uploads/2017/05/201208201734403507.png" alt="img"></p>
<h2 id="HTTPS协议和HTTP协议的区别："><a href="#HTTPS协议和HTTP协议的区别：" class="headerlink" title="HTTPS协议和HTTP协议的区别："></a>HTTPS协议和HTTP协议的区别：</h2><ul>
<li>https协议需要到ca申请证书，一般免费证书很少，需要交费。</li>
<li>http是超文本传输协议，信息是明文传输，https 则是具有安全性的ssl加密传输协议。</li>
<li>http和https使用的是完全不同的连接方式用的端口也不一样,前者是80,后者是443。</li>
<li>http的连接很简单,是无状态的 。</li>
<li>HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议， 要比http协议安全。</li>
</ul>
<h2 id="SSL-证书"><a href="#SSL-证书" class="headerlink" title="SSL 证书"></a>SSL 证书</h2><p>从前面我们可以了解到HTTPS核心的一个部分是数据传输之前的握手，握手过程中确定了数据加密的密码。在握手过程中，网站会向浏览器发送SSL证书，SSL证书和我们日常用的身份证类似，是一个支持HTTPS网站的身份证明，SSL证书里面包含了网站的域名，证书有效期，证书的颁发机构以及用于加密传输密码的公钥等信息，由于公钥加密的密码只能被在申请证书时生成的私钥解密，因此浏览器在生成密码之前需要先核对当前访问的域名与证书上绑定的域名是否一致，同时还要对证书的颁发机构进行验证，如果验证失败浏览器会给出证书错误的提示。在这一部分我将对SSL证书的验证过程以及个人用户在访问HTTPS网站时，对SSL证书的使用需要注意哪些安全方面的问题进行描述。</p>
<h2 id="证书的类型"><a href="#证书的类型" class="headerlink" title="证书的类型"></a>证书的类型</h2><p>实际上，我们使用的证书分很多种类型，SSL证书只是其中的一种。证书的格式是由X.509标准定义。SSL证书负责传输公钥，是一种PKI（Public Key Infrastructure，公钥基础结构）证书。 我们常见的证书根据用途不同大致有以下几种：</p>
<ul>
<li> 1、SSL证书，用于加密HTTP协议，也就是HTTPS。</li>
<li> 2、代码签名证书，用于签名二进制文件，比如Windows内核驱动，Firefox插件，Java代码签名等等。</li>
<li> 3、客户端证书，用于加密邮件。</li>
<li> 4、双因素证书，网银专业版使用的USB Key里面用的就是这种类型的证书。</li>
</ul>
<p> 这些证书都是由受认证的证书颁发机构——我们称之为CA（Certificate Authority）机构来颁发，针对企业与个人的不同，可申请的证书的类型也不同，价格也不同。CA机构颁发的证书都是受信任的证书，对于SSL证书来说，如果访问的网站与证书绑定的网站一致就可以通过浏览器的验证而不会提示错误。</p>
<h2 id="SSL证书申请与规则"><a href="#SSL证书申请与规则" class="headerlink" title="SSL证书申请与规则"></a>SSL证书申请与规则</h2><p>SSL证书可以向CA机构通过付费的方式申请，也可以自己制作。 CA机构颁发的证书价格非常昂贵，而且有效期一般只有一年到三年不等（年数不同，价格也不同），过期之后还要再次交钱申请，因此一般只有企业才会申请证书。但是随着个人网站的增多，目前也有针对个人的SSL证书服务，价格相对便宜一些，国内的话400多块钱就能申请到一个，国外更是有免费的SSL证书可以申请。 在申请SSL证书时需要向CA机构提供网站域名，营业执照，以及申请人的身份信息等。网站的域名非常重要，申请人必须证明自己对域名有所有权，如果支持Hotmail.com，Gmail.com的SSL证书都可以随便申请，黑客们就不用做假证书欺骗了。</p>
<p>此外，一个证书一般只绑定一个域名，如果CA机构心情好的话，会免费再绑一个，比如你要申请域名时绑定的域名是 <a href="http://www.runoob.com,那么只有在浏览器地址是/">www.runoob.com，那么只有在浏览器地址是</a> <a href="https://www.runoob.com/">https://www.runoob.com</a> 的时候，这个证书才是受信任的，如果地址是<a href="https://tt.runoob.com或者https//login.runoob.com%EF%BC%8C%E9%82%A3%E4%B9%88%E8%BF%99%E4%B8%AA%E8%AF%81%E4%B9%A6%E7%94%B1%E4%BA%8E%E8%AE%BF%E9%97%AE%E7%9A%84%E5%9F%9F%E5%90%8D%E4%B8%8E%E8%AF%81%E4%B9%A6%E7%BB%91%E5%AE%9A%E7%9A%84%E5%9F%9F%E5%90%8D%E4%B8%8D%E5%90%8C%EF%BC%8C%E4%BB%8D%E7%84%B6%E4%BC%9A%E8%A2%AB%E6%B5%8F%E8%A7%88%E5%99%A8%E6%98%BE%E7%A4%BA%E4%B8%BA%E4%B8%8D%E5%8F%97%E4%BF%A1%E4%BB%BB%E7%9A%84%E3%80%82">https://tt.runoob.com或者https://login.runoob.com，那么这个证书由于访问的域名与证书绑定的域名不同，仍然会被浏览器显示为不受信任的。</a></p>
<p>CA机构也提供申请通配符域名（例如，*.runoob.com），通配符域名相当于绑定了主域名下的所有域名，因此使用起来非常方便，但是价格也超级昂贵，一个通配符域名一年大概得5000块钱，只有企业才可以申请。 </p>
<p>下面就来看看一个证书的信息：</p>
<p><img src="https://www.runoob.com/wp-content/uploads/2017/05/R-OslhS49QSoGyqVC8Wui3_mGh-wNb9y4DJ3zJj2IRajAQAACQIAAEpQ.jpg" alt="img"></p>
<p>在访问hotmail的时候会跳转到login.live.com，这时IE浏览器上会有一个小锁头，点一下那个小锁头再点击里面的”查看证书”就会出现上图的证书窗口，这里面我们可以看到这个证书只有一个用途——向远程计算机证明身份信息，证书的用途会有很多，SSL只是其中之一。在”颁发给”这一项就是这个证书在申请时绑定的域名；下面的”颁发者”是证书的颁发机构。最下面的两个日期是证书申请时间以及过期的时间。这里我们可以注意一下”颁发者”的信息，里面有”Extended Validation SSL”的字样，表明了这个证书是一个EV SSL证书（扩展验证SSL证书），EV SSL证书有个特点就是可以让浏览器的地址栏变绿，同时显示出来证书所属公司的名称，如下图所示：</p>
<p><img src="https://www.runoob.com/wp-content/uploads/2017/05/wqUuVQChlFGgN6TwqrFbVGAxcffFGFdChPF4vdOLRizaAQAAKwAAAEpQ.jpg" alt="img"></p>
<p>EV SSL证书与其他的证书相比，费用更高。</p>
<p>以上说的是向CA机构申请证书的情况，如果个人网站只为加密传输也可以自己制作SSL证书，自己制作的证书不会受到浏览器的信任，在访问的时候由于证书验证失败而给出警告。</p>
<h2 id="证书的验证过程"><a href="#证书的验证过程" class="headerlink" title="证书的验证过程"></a>证书的验证过程</h2><p>证书以证书链的形式组织，在颁发证书的时候首先要有根CA机构颁发的根证书，再由根CA机构颁发一个中级CA机构的证书，最后由中级CA机构颁发具体的SSL证书。我们可以这样理解，根CA机构就是一个公司，根证书就是他的身份凭证，每个公司由不同的部门来颁发不同用途的证书，这些不同的部门就是中级CA机构，这些中级CA机构使用中级证书作为自己的身份凭证，其中有一个部门是专门颁发SSL证书，当把根证书，中级证书，以及最后申请的SSL证书连在一起就形成了证书链，也称为证书路径。在验证证书的时候，浏览器会调用系统的证书管理器接口对证书路径中的所有证书一级一级的进行验证，只有路径中所有的证书都是受信的，整个验证的结果才是受信。我们还是以login.live.com这个证书举例，在查看证书的时候，点击”证书路径”标签就会有下图的显示：</p>
<p><img src="https://www.runoob.com/wp-content/uploads/2017/05/jOgm5Z07bBKA5FNVJFzuI99LxGzyg2U-8U_c7sYqn4GjAQAACQIAAEpQ.jpg" alt="img"></p>
<p>根证书是最关键的一个证书，如果根证书不受信任，它下面颁发的所有证书都不受信任。操作系统在安装过程中会默认安装一些受信任的CA机构的根证书，可以在”运行”里面运行”certmgr.msc”启动证书管理器，如下图所示：</p>
<p><img src="https://www.runoob.com/wp-content/uploads/2017/05/tQGTE_tnxxP0fsE4gtvnAXSl6E2MaSe_A9Qdockrn3ucAwAAGgIAAEpQ.jpg" alt="img"></p>
<p>根证书的有效期长，支持的用途多以方便颁发不同用途类型的中级证书；中级证书用途单一，有效期相对短一些，但是比具体的SSL证书要长很多。</p>
<p>如果SSL证书验证失败根据浏览器的不同会有以下的错误提示：</p>
<p><img src="https://www.runoob.com/wp-content/uploads/2017/05/EmdncPaZhVS65SfPqhIaabLfdQ5wMNsy-3Hu1hOG8m4gAwAAMAIAAEpQ.jpg" alt="img"></p>
<p><img src="https://www.runoob.com/wp-content/uploads/2017/05/GZLvVaGauRJDk79ESMv5P6G42ocWSjDTmIbsw2FRq30lAwAAGQIAAEpQ.jpg" alt="img"></p>
<p>SSL证书验证失败有以下三点原因：</p>
<ul>
<li>1、SSL证书不是由受信任的CA机构颁发的</li>
<li>2、证书过期</li>
<li>3、访问的网站域名与证书绑定的域名不一致</li>
</ul>
<p>这三点原因也是IE浏览器给出的提示。</p>
<blockquote>
<p>小提示：如果你对哪个根证书CA机构比较憎恨，可以将它的根证书删除，这样所有它颁发的证书都不会受信任。</p>
</blockquote>
<h2 id="SSL证书的安全问题"><a href="#SSL证书的安全问题" class="headerlink" title="SSL证书的安全问题"></a>SSL证书的安全问题</h2><p>对HTTPS最常见的攻击手段就是SSL证书欺骗或者叫SSL劫持，是一种典型的中间人攻击。不过SSL劫持并非只是用于攻击目的，在一些特殊情况下利用SSL劫持我们可以更顺畅的访问网络，我会在后文提到。</p>
<p>以攻击为目的的SSL劫持如果不注意浏览器安全提示的话，很容易就中招。当网络中有中间人发起SSL劫持攻击时，攻击者需要伪造一个SSL证书发给浏览器，这个时候由于伪造的SSL证书不受信任，浏览器会给出提示。</p>
<p>这里有一个误区，当SSL证书不受信任的时候，并不一定就是有SSL劫持发生，有种例外情况是：一些个人网站买不起合法的SSL证书，因此会自己制作一个SSL证书来加密传输的数据。如果你经常访问某个个人网站，而且你知道这个网站是干什么的，那么这种情况可以不用担心。但是如果你访问的是网银，在线支付，或者是hotmail.com，gmail.com等，这类公司性质的网站一定会申请合法的SSL证书（12306.cn除外），一旦SSL证书不受信任，应该果断的终止访问，这个时候网络中一定会存在异常行为，对于一些小区宽带的用户一定要注意这点。</p>
<p>所以作为个人用户，你一定要知道你访问的是什么网站，如果你只是一个没有多少计算机只是的普通网民，我相信你不会经常上那些自己制作SSL证书的个人网站（12306.cn除外），因此如果你没有办法判断网络是不是有异常，只要是证书有问题的，干脆就别再访问了。</p>
<blockquote>
<p>小提示：对于12306.cn，一定要按照网站说的那样，”为保障您顺畅购票，请下载安装根证书”。</p>
</blockquote>
<p>最后我们总结一下使用SSL证书要注意的问题：</p>
<ul>
<li>1、除非必要，不要随意安装根证书。安装根证书的时候一定要明确证书的来源。</li>
<li>2、对于网银，在线支付，重要邮箱等网站，一定要确保SSL证书是没有问题的，如果浏览器给出SSL证书错误的警告，一定要拒绝访问。一些小区宽带用户一定要注意这点。</li>
<li>3、由于现在个人申请SSL证书比较便宜，一定要注意挂着合法SSL证书的钓鱼网站（国外比较常见）。对于钓鱼网站，一定要看清域名，另外别相信什么中奖的消息，同时要安装带有钓鱼防护功能的安全软件。</li>
</ul>
<p>原文链接：<a href="https://www.runoob.com/w3cnote/https-ssl-intro.html">https://www.runoob.com/w3cnote/https-ssl-intro.html</a> </p>
]]></content>
      <tags>
        <tag>SSL</tag>
      </tags>
  </entry>
  <entry>
    <title>WireShark过滤语法与常用</title>
    <url>/2019/05/08/35/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>​    1、过滤协议，直接写协议名称</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">例子:</span><br><span class="line">tcp            #TCP(Transmission Control Protocol 传输控制协议)</span><br><span class="line">udp            #UDP(User Datagram Protocol 用户数据报协议)</span><br><span class="line">arp            #ARP(Address Resolution Protocol 地址解析协议)</span><br><span class="line">icmp           #ICMP(Internet Control Message Protocol Internet Internet 控制报文协议)</span><br><span class="line">http           #HTTP(HyperText Transfer Protocol 超文本传输协议)</span><br><span class="line">smtp           #SMTP(Simple Mail Transfer Protocol 简单邮件传输协议)</span><br><span class="line">ftp            #FTP(File Transfer Protocol 文件传输协议)</span><br><span class="line">dns            #DNS(Domain Name System 域名系统)</span><br><span class="line">ip             #IP(Internet Protocol IP协议)</span><br><span class="line">ssl            #SSL(Secure Sockets Layer 安全套阶层)</span><br><span class="line">oicq           #(openingIseekyou QQ协议)</span><br><span class="line">bootp          #BOOTP(Bootstrap Protocol，引导程序协议）)</span><br><span class="line">......</span><br><span class="line">排除arp包:   !arp   或者   not arp</span><br></pre></td></tr></table></figure>

<p>​    2、 过滤源和目的IP地址</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">过滤源地址</span><br><span class="line">ip.src_host eq 192.168.31.106          #相当于</span><br><span class="line">ip.src_host &#x3D;&#x3D; 192.168.31.106</span><br><span class="line">过滤目的地址</span><br><span class="line">ip.dst_host eq 192.168.31.106          #相当于</span><br><span class="line">ip.dst_host &#x3D;&#x3D; 192.168.31.106</span><br><span class="line">过滤源地址或者目的地址</span><br><span class="line">ip.addr eq 192.168.31.106                #相当于</span><br><span class="line">ip.addr &#x3D;&#x3D; 192.168.31.106</span><br></pre></td></tr></table></figure>

<p>​    3、针对端口进行过滤</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">例子:</span><br><span class="line">tcp.port eq 80                    #不管端口是来源的还是目标的都显示，相当于</span><br><span class="line">tcp.port &#x3D;&#x3D; 80</span><br><span class="line">tcp.port eq 80 or udp.port eq 80</span><br><span class="line">tcp.srcport &#x3D;&#x3D; 80                 #只显tcp协议的源端口80</span><br><span class="line">tcp.dstport &#x3D;&#x3D; 80                 #只显tcp协议的目标端口80</span><br><span class="line">udp.port eq 15000</span><br><span class="line">tcp.port &gt;&#x3D; 1 and tcp.port &lt;&#x3D; 80  #过滤端口范围</span><br></pre></td></tr></table></figure>

<p>​    4、过滤MAC地址</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">eth.addr eq B4-6D-83-2B-27-D5</span><br><span class="line">eth.src eq B4-6D-83-2B-27-D5 &#x2F;&#x2F; 过滤来源mac</span><br><span class="line">eth.dst &#x3D;&#x3D; B4-6D-83-2B-27-D5 &#x2F;&#x2F; 过滤目标mac</span><br></pre></td></tr></table></figure>

<p>​    5、针对http的请求类型进行过滤</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http.request.method &#x3D;&#x3D; &quot;GET&quot;</span><br><span class="line">http.request.method &#x3D;&#x3D; &quot;POST&quot;</span><br></pre></td></tr></table></figure>

<p>​    6、备注</p>
<blockquote>
<pre><code>     &lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;          lt          less than 小于 &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;&amp;#x3D;         le          小于等于&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#x3D;&amp;#x3D;         eq          等于&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt;            gt          大于&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt; &amp;#x3D;        ge          大于等于 &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt; !&amp;#x3D;       ne          不等于&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;</code></pre>
</blockquote>
]]></content>
      <tags>
        <tag>wireshark</tag>
      </tags>
  </entry>
  <entry>
    <title>ARP相关</title>
    <url>/2019/05/10/37/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>​    如果是二层的交换机就没有ARP表，因为在二层数据链路层只用到MAC地址也就是硬件地址，而IP地址是网络层使用的地址，以太网数据包已经将IP数据包 封装起来，所以与IP地址一点关系都没有。如果是三层交换机（具有路由功能的交换机），由于是网络层的设备，需要用到IP地址来传输IP包，所以三层交换 机内部会维护一张ARP表，以保存IP地址和MAC地址的对应关系！</p>
<p>问：一台H3C三层交换连一台H3C二层交换，二层交换有48个口，下面挂了很多PC和服务器，在三层上面dis arp可以见到很多ip和mac对应关系 可在二层上去找相应的mac可是找不到，这是为什么呢？</p>
<p>答：在<a href="http://zhidao.baidu.com/search?word=%E4%B8%89%E5%B1%82%E4%BA%A4%E6%8D%A2%E6%9C%BA&fr=qb_search_exp&ie=utf8">三层交换机</a>上可以使用dis arp 来查看ip和mac的对应关系，其实还有一项就是所学到的端口是那个端口也能看到。<br>在<a href="http://zhidao.baidu.com/search?word=%E4%BA%8C%E5%B1%82%E4%BA%A4%E6%8D%A2%E6%9C%BA&fr=qb_search_exp&ie=utf8">二层交换机</a>上无法使用dis arp来查看ip和mac的对应关系，只能使用dis  mac-address 来查看mac地址与端口的对应关系。<br>你看到的有可能是其他交换上学习过来的。总结来说在三层上用ip+mac+port的形式来断定这个mac地址从那个接入<a href="http://zhidao.baidu.com/search?word=%E4%BA%A4%E6%8D%A2%E6%9C%BA&fr=qb_search_exp&ie=utf8">交换机</a>学习上来的。之后在这个接入<a href="http://zhidao.baidu.com/search?word=%E4%BA%A4%E6%8D%A2%E6%9C%BA&fr=qb_search_exp&ie=utf8">交换机</a>上看mac地址在确定端口</p>
]]></content>
      <categories>
        <category>ARP</category>
      </categories>
      <tags>
        <tag>ARP</tag>
      </tags>
  </entry>
  <entry>
    <title>终端用户认证成功后频繁下线</title>
    <url>/2019/05/13/39/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h4><p>产品：S5700（V200R007C00SPC500）、Agile Controller-Campus (V100R002C00SPC300)</p>
<p>部分window7终端出现认证成功后，在5分钟左右出现掉线的现象，需要终端重新去认证，认证成功后，又会出现下线的现象。</p>
<p><img src="https://support.huawei.com/enterprise/product/images/f531c47a032f4555bab616a38d4c35cc" alt="img"></p>
<h4 id="处理过程"><a href="#处理过程" class="headerlink" title="处理过程"></a>处理过程</h4><p>在发生故障的终端上抓包，在controller服务器上查看用户相关日志，在用户所在交换机查看下线原因。</p>
<p><img src="https://support.huawei.com/enterprise/product/images/c0005f4c16094a4c860de852322d8228" alt="img"></p>
<h4 id="根因"><a href="#根因" class="headerlink" title="根因"></a>根因</h4><p>为确保用户在线状态正常，设备会向在线用户发送ARP下线探测报文，如果用户在下线探测周期内没有回应，则设备认为该用户已下线。用户加入的VLAN在设备上不存在对应的VLANIF接口或者VLANIF接口未配置IP地址，网络中存在部分终端不支持回应源IP地址为255.255.255.255的ARP探测报文。 </p>
<h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h4><p>通过access-user arp-detect default ip-address 0.0.0.0命令配置用户下线探测报文的默认源IP地址，解决故障。</p>
]]></content>
      <categories>
        <category>CASE记录</category>
      </categories>
      <tags>
        <tag>华为</tag>
      </tags>
  </entry>
  <entry>
    <title>细说VLAN与Trunk</title>
    <url>/2019/04/18/4/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>　　<a href="http://ad.doubleclick.net/ddm/trackclk/N7442.5006CHINABYTE/B10313247.138166524;dc_trk_aid=310538621;dc_trk_cid=74205219">网络</a>性能是影响业务效率的一个重要因素。将大型广播域分段是提高网络性能的方法之一。<a href="http://www.chinabyte.com/keyword/%E8%B7%AF%E7%94%B1%E5%99%A8/">路由器</a>能够将广播包阻隔在一个接口上，但是，路由器的LAN接口数量有限，它的主要功能是在网络间传输<a href="http://ad.doubleclick.net/ddm/trackclk/N7442.5006CHINABYTE/B10313247.138166523;dc_trk_aid=310538354;dc_trk_cid=74205219">数据</a>，而不是对终端设备提供网络接入。访问LAN的功能还是由接入层<a href="http://www.chinabyte.com/keyword/%E4%BA%A4%E6%8D%A2%E6%9C%BA/">交换机</a>来实现。与三层交换机相类似，通过在二层交换机上创建VLAN来减少广播域。现代交换机就是通过VLAN来构造的，因此在某种程度上，学习交换机就是学习VLAN。</p>
<p>　　问题的产生:</p>
<p>　　如下图所示，当网络上的所有设备在广播域产生大量的广播以及多播帧，就会与数据流竞争带宽。这是由网络管理数据流组成，如：<a href="http://www.chinabyte.com/keyword/ARP/">ARP</a>，DHCP，STP等。如下图所示，假设PC 1产生ARP，Windows登录，DHCP等请求：</p>
<p><img src="http://cimage.tianjimedia.com/uploadImages/2014/328/EA8967KB6JUD.jpg" alt="说明: DHCP等请求"></p>
<p>　　这些广播帧到达交换机1之后，遍历整个网络并到达所有节点直至路由器。随着网络节点增加，开销的总数也在增长，直至影响交换机性能。通过实施VLAN断开广播域将数据流隔离开来，能够解决这一问题。</p>
<p>　　什么是VLAN：</p>
<p>　　VLAN(virtual local area network)是一组与位置无关的逻辑端口。VLAN就相当于一个独立的三层网络。VLAN的成员无需局限于同一交换机的顺序或偶数端口。下图显示了一个常规的部署，左边这张图节点连接到交换机，交换机连接到路由器。所有的节点都位于同一IP网络，因为他们都连接到路由器同一接口。</p>
<p><img src="http://cimage.tianjimedia.com/uploadImages/2014/328/LGUI58IUK7G9.jpg" alt="说明: image003.jpg"></p>
<p>　　图中没有显示的是，缺省情况下，所有节点实际上都是同一VLAN。因此，这种拓扑接口可看作是基于同一VLAN的，如上面右图所示。例如，<a href="http://com.chinabyte.com/cisco/">Cisco</a>设备默认VLAN是VLAN 1，也称为管理VLAN。默认配置下包含所有的端口，体现在源地址表(source<a href="http://www.chinabyte.com/keyword/address/">address</a>table，SAT)中。该表用于交换机按照目的<a href="http://www.chinabyte.com/keyword/Mac/">MAC</a>地址将帧转发至合适的二层端口。引入VLAN之后，源地址表按照VLAN将端口与MAC地址相对应起来，从而使得交换机能够做出更多高级转发决策。下图显示了show mac address table和show vlan命令的显示输出。所有端口(FA0/1 – FA0/24)都在VLAN 1。</p>
<p><img src="http://cimage.tianjimedia.com/uploadImages/2014/328/V98H050K2054.jpg" alt="说明: image004.jpg"></p>
<p>　　另一种常用的拓扑结构是两个交换机被一个路由器分离开来，如下图所示。这种情况下，每台交换机各连接一组节点。每个交换机上的各节点共享一个IP地址域，这里有两个网段：192.168.1.0和192.168.2.0。</p>
<p><img src="http://cimage.tianjimedia.com/uploadImages/2014/328/DVO4SIQ4T3R7.jpg" alt="说明: image005.jpg"></p>
<p>　　注意到两台交换机的VLAN相同。非本地网络数据流必须经过路由器转发。路由器不会转发二层单播，多播以及广播帧。这种拓扑逻辑在两个地方类似于多VLAN：同一VLAN下的节点共享一个通用地址域，非本地数据流(对应多VLAN情况不同VLAN的节点)需通过路由器转发。在一台交换机上添加一个VLAN，去掉另一台交换机的话，结构如下所示：</p>
<p><img src="http://cimage.tianjimedia.com/uploadImages/2014/328/9608B782R99P.jpg" alt="说明: image006.jpg"></p>
<p>　　每一个VLAN相当于一个独立的三层IP网络，因此，192.168.1.0上的节点试图与192.168.2.0上的节点<a href="http://telecom.chinabyte.com/">通信</a>时，不同VLAN通信必须通过路由器，即使所有设备都连接到同一交换机。二层单播，多播和广播数据只会在同一VLAN内转发及泛洪，因此VLAN 1产生的数据不会为VLAN 2节点所见。只有交换机能看得到VLAN，节点和路由器都感觉不到VLAN的存在。添加了路由决策之后，可以利用3层的功能来实现更多的<a href="http://ad.doubleclick.net/ddm/trackclk/N7442.5006CHINABYTE/B10313247.138166523;dc_trk_aid=310538354;dc_trk_cid=74205219">安全</a>设定，更多流量以及负载均衡。</p>
<p>　　VLAN的作用：</p>
<p>　　安全性：每一个分组的敏感数据需要与网络其他部分隔离开，减少保密<a href="http://ad.doubleclick.net/ddm/trackclk/N7442.5006CHINABYTE/B10313247.138166523;dc_trk_aid=310538354;dc_trk_cid=74205219">信息</a>遭到破坏的可能性。如下图所示，VLAN 10上的教职工主机完全与学生和访客数据隔离。</p>
<p><img src="http://cimage.tianjimedia.com/uploadImages/2014/328/5815A3Z86575.jpg" alt="说明: image007.jpg"></p>
<p>　　节约成本：无需昂贵的网络升级，并且带宽及<a href="http://www.chinabyte.com/keyword/%E4%B8%8A%E8%A1%8C%E9%93%BE%E8%B7%AF/">上行链路</a>利用率更加有效。</p>
<p>　　性能提高：将二层网络划分成多个逻辑工作组(广播域)减少网络间不必要的数据流并提升性能。</p>
<p>　　缩小广播域：减少一个广播域上的设备数量。如上图所示：网络上有六台主机但有三个广播域：教职工，学生，访客。</p>
<p>　　提升<a href="http://www.chinabyte.com/keyword/IT%E7%AE%A1%E7%90%86/">IT管理</a>效率：网络需求相似的用户共享同一VLAN，从而网络管理更为简单。当添加一个新的交换机，在指定端口VLAN时，所有策略和步骤已配置好。</p>
<p>　　简化项目和应用管理：VLAN将用户和网络设备汇集起来，以支持不同的业务或地理位置需求。</p>
<p>　　每一个VLAN对应于一个IP网络，因此，部署VLAN的时候必须结合考虑网络地址层级的实现情况。</p>
<p>　　交换机间VLAN：</p>
<p>　　多交换机的情况下，VLAN是怎么工作的呢?下图所示的这种情况，两个交换机VLAN相同，都是默认VLAN 1，即两个交换机之间的联系同在VLAN 1之内。路由器是所有节点的出口。</p>
<p>　　这时单播，多播和广播数据自由传输，所有节点属于同一IP地址。这时节点之间的通信不会有问题，因为交换机的SAT显示它们在同一VLAN。</p>
<p><img src="http://cimage.tianjimedia.com/uploadImages/2014/328/6615I38Q79Z6.jpg" alt="说明: image008.jpg"></p>
<p>　　而下面这种连接方式就会有问题。由于VLAN在连接端口的主机之间创建了三层边界，它们将无法通信。</p>
<p><img src="http://cimage.tianjimedia.com/uploadImages/2014/328/I7SLV8FVS9XP.jpg" alt="说明: image009.png"></p>
<p>　　仔细看上图，这里有很多问题。第一，所有主机都在同一IP网，尽管连接到不同的VLAN。第二，路由器在VLAN 1,因此与所有节点隔离。最后，两台交换机通过不同的VLAN互连。每一点都会造成通信阻碍，合在一起，网络各元素之间会完全无法通信。</p>
<p>　　交换机用满或同一管理单元物理上彼此分离的情形是很常见的。这种情况下，VLAN需要通过trunk延伸至相邻交换机。trunk能够连接交换机，在网络间传载VLAN信息。如下图所示：</p>
<p><img src="http://cimage.tianjimedia.com/uploadImages/2014/328/7H9L468M7O82.jpg" alt="说明: image010.png"></p>
<p>　　对之前的拓扑的改进包括：</p>
<p>　　· PC 1和PC 2分配到192.168.1.0网段以及VLAN 2。</p>
<p>　　· PC 3和PC 4分配到192.168.2.0网段以及VLAN 3。</p>
<p>　　· 路由器接口连接到VLAN 2和VLAN 3。</p>
<p>　　· 交换机间通过trunk线互连。</p>
<p>　　注意到trunk端口出现在VLAN 1，他们没有用字母T来标识。trunk在任何VLAN都没有成员。现在VLAN跨越多交换机，同一VLAN下的节点可以物理上位于任何地方。</p>
<p>　　什么是Trunk：</p>
<p>　　Trunk是在两个网络设备之间承载多于一种VLAN的端到端的连接，将VLAN延伸至整个网络。没有VLAN Trunk，VLAN也不会非常有用。VLAN Trunk允许VLAN数据流在交换机间传输，所以设备在同一VLAN，但连接到不同交换机，能够不通过路由器来进行通信。</p>
<p>　　一个VLAN trunk不属于某一特定VLAN，而是交换机和路由器间多个VLAN的通道。如下图所示，交换机S1和S2，以及S1和S3之间的链路，配置为传输从VLAN10,20,30以及90的数据流。该网络没有VLAN trunk就无法工作。</p>
<p><img src="http://cimage.tianjimedia.com/uploadImages/2014/328/N7TZER8PCH59.jpg" alt="说明: image011.jpg"></p>
<p>　　当安装好trunk线之后，帧在trunk线传输是就可以使用trunk协议来修改以太网帧。这也意味着交换机端口有不止一种操作模式。缺省情况下，所有端口都称为接入端口。当一个端口用于交换机间互连传输VLAN信息时，这种端口模式改变为trunk，节点也路由器通常不知道VLAN的存在并使用标准以太网帧或“untagged”帧。trunk线能够使用“tagged”帧来标记VLAN或优先级。</p>
<p>　　因此，在trunk端口，运行trunk协议来允许帧中包含trunk信息。如下图所示：</p>
<p><img src="http://cimage.tianjimedia.com/uploadImages/2014/328/GK1P3M6U0IBP.jpg" alt="说明: image012.jpg"></p>
<p>　　PC 1在经过路由表处理后向PC 2发送数据流。这两个节点在同一VLAN但不同交换机。步骤如下：</p>
<p>　　· 以太网帧离开PC 1到达Switch 1。</p>
<p>　　· Switch 1的SAT表明目的地是trunk线的另一端。</p>
<p>　　· Switch 1使用trunk协议在以太网帧中添加VLAN id。</p>
<p>　　· 新帧离开Switch 1的trunk端口被Switch 2接收。</p>
<p>　　· Switch 2读取trunk id并解析trunk协议。</p>
<p>　　· 源帧按照Switch 2的SAT转发至目的地(端口4)。</p>
<p>　　VLAN tag如下图所示，包含类型域，优先级域，CFI(Canonical Format Indicator)指示MAC数据域，VLAN ID。</p>
<p><img src="http://cimage.tianjimedia.com/uploadImages/2014/328/G1128I6E05A8.jpg" alt="说明: image013.jpg"></p>
]]></content>
      <tags>
        <tag>VLAN</tag>
      </tags>
  </entry>
  <entry>
    <title>跟着动画来学习TCP三次握手和四次挥手</title>
    <url>/2019/05/13/40/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>TCP三次握手和四次挥手的问题在面试中是最为常见的考点之一。很多读者都知道三次和四次，但是如果问深入一点，他们往往都无法作出准确回答。</p>
<p>本篇尝试使用动画来对这个知识点进行讲解，期望读者们可以更加简单地地理解TCP交互的本质。</p>
<h2 id="TCP-三次握手"><a href="#TCP-三次握手" class="headerlink" title="TCP 三次握手"></a>TCP 三次握手</h2><p>TCP 三次握手就好比两个人在街上隔着50米看见了对方，但是因为雾霾等原因不能100%确认，所以要通过招手的方式相互确定对方是否认识自己。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/6/26/1643a1dd6df4813b?imageslim" alt="img"></p>
<p>张三首先向李四招手(<strong>syn</strong>)，李四看到张三向自己招手后，向对方点了点头挤出了一个微笑(<strong>ack</strong>)。张三看到李四微笑后确认了李四成功辨认出了自己(进入<strong>estalished</strong>状态)。</p>
<p>但是李四还有点狐疑，向四周看了一看，有没有可能张三是在看别人呢，他也需要确认一下。所以李四也向张三招了招手(<strong>syn</strong>)，张三看到李四向自己招手后知道对方是在寻求自己的确认，于是也点了点头挤出了微笑(<strong>ack</strong>)，李四看到对方的微笑后确认了张三就是在向自己打招呼(进入<strong>established</strong>状态)。</p>
<p>于是两人加快步伐，走到了一起，相互拥抱。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/6/26/1643a1f3fa6c21b0?imageslim" alt="img"></p>
<p>我们看到这个过程中一共是四个动作，张三招手–李四点头微笑–李四招手–张三点头微笑。其中李四连续进行了2个动作，先是点头微笑(回复对方)，然后再次招手(寻求确认)，实际上可以将这两个动作合一，招手的同时点头和微笑(<strong>syn+ack</strong>)。于是四个动作就简化成了三个动作，张三招手–李四点头微笑并招手–张三点头微笑。这就是三次握手的本质，中间的一次动作是两个动作的合并。</p>
<p>我们看到有两个中间状态，<strong>syn_sent</strong>和<strong>syn_rcvd</strong>，这两个状态叫着「半打开」状态，就是向对方招手了，但是还没来得及看到对方的点头微笑。<strong>syn_sent</strong>是主动打开方的「半打开」状态，<strong>syn_rcvd</strong>是被动打开方的「半打开」状态。客户端是主动打开方，服务器是被动打开方。</p>
<ul>
<li>syn_sent: syn package has been sent</li>
<li>syn_rcvd: syn package has been received</li>
</ul>
<h2 id="TCP-数据传输"><a href="#TCP-数据传输" class="headerlink" title="TCP 数据传输"></a>TCP 数据传输</h2><p>TCP 数据传输就是两个人隔空对话，差了一点距离，所以需要对方反复确认听见了自己的话。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/6/26/1643a1f92f5af34a?imageslim" alt="img"></p>
<p>张三喊了一句话(data)，李四听见了之后要向张三回复自己听见了(ack)。</p>
<p>如果张三喊了一句，半天没听到李四回复，张三就认为自己的话被大风吹走了，李四没听见，所以需要重新喊话，这就是tcp重传。</p>
<p>也有可能是李四听到了张三的话，但是李四向张三的回复被大风吹走了，以至于张三没听见李四的回复。张三并不能判断究竟是自己的话被大风吹走了还是李四的回复被大风吹走了，张三也不用管，重传一下就是。</p>
<p>既然会重传，李四就有可能同一句话听见了两次，这就是「去重」。「重传」和「去重」工作操作系统的网络内核模块都已经帮我们处理好了，用户层是不用关心的。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/6/26/1643a1fc9435605c?imageslim" alt="img"></p>
<p>张三可以向李四喊话，同样李四也可以向张三喊话，因为tcp链接是「双工的」，双方都可以主动发起数据传输。不过无论是哪方喊话，都需要收到对方的确认才能认为对方收到了自己的喊话。</p>
<p>张三可能是个高射炮，一说连说了八句话，这时候李四可以不用一句一句回复，而是连续听了这八句话之后，一起向对方回复说前面你说的八句话我都听见了，这就是批量ack。但是张三也不能一次性说了太多话，李四的脑子短时间可能无法消化太多，两人之间需要有协商好的合适的发送和接受速率，这个就是「TCP窗口大小」。</p>
<p>网络环境的数据交互同人类之间的对话还要复杂一些，它存在数据包乱序的现象。同一个来源发出来的不同数据包在「网际路由」上可能会走过不同的路径，最终达到同一个地方时，顺序就不一样了。操作系统的网络内核模块会负责对数据包进行排序，到用户层时顺序就已经完全一致了。</p>
<h2 id="TCP-四次挥手"><a href="#TCP-四次挥手" class="headerlink" title="TCP 四次挥手"></a>TCP 四次挥手</h2><p>TCP断开链接的过程和建立链接的过程比较类似，只不过中间的两部并不总是会合成一步走，所以它分成了4个动作，张三挥手(fin)——李四伤感地微笑(ack)——李四挥手(fin)——张三伤感地微笑(ack)。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/6/26/1643a20296de1ff0?imageslim" alt="img"></p>
<p>之所以中间的两个动作没有合并，是因为tcp存在「半关闭」状态，也就是单向关闭。张三已经挥了手，可是人还没有走，只是不再说话，但是耳朵还是可以继续听，李四呢继续喊话。等待李四累了，也不再说话了，朝张三挥了挥手，张三伤感地微笑了一下，才彻底结束了。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/6/26/1643b1147fbbc5e7?imageslim" alt="img"></p>
<p>上面有一个非常特殊的状态<code>time_wait</code>，它是主动关闭的一方在回复完对方的挥手后进入的一个长期状态，这个状态标准的持续时间是4分钟，4分钟后才会进入到closed状态，释放套接字资源。不过在具体实现上这个时间是可以调整的。</p>
<p>它就好比主动分手方要承担的责任，是你提出的要分手，你得付出代价。这个后果就是持续4分钟的<code>time_wait</code>状态，不能释放套接字资源(端口)，就好比守寡期，这段时间内套接字资源(端口)不得回收利用。</p>
<p>它的作用是重传最后一个ack报文，确保对方可以收到。因为如果对方没有收到ack的话，会重传fin报文，处于time_wait状态的套接字会立即向对方重发ack报文。</p>
<p>同时在这段时间内，该链接在对话期间于网际路由上产生的残留报文(因为路径过于崎岖，数据报文走的时间太长，重传的报文都收到了，原始报文还在路上)传过来时，都会被立即丢弃掉。4分钟的时间足以使得这些残留报文彻底消逝。不然当新的端口被重复利用时，这些残留报文可能会干扰新的链接。</p>
<p>4分钟就是2个MSL，每个MSL是2分钟。MSL就是<code>maximium segment lifetime</code>——最长报文寿命。这个时间是由官方RFC协议规定的。至于为什么是2个MSL而不是1个MSL，我还没有看到一个非常满意的解释。</p>
<p>四次挥手也并不总是四次挥手，中间的两个动作有时候是可以合并一起进行的，这个时候就成了三次挥手，主动关闭方就会从<code>fin_wait_1</code>状态直接进入到<code>time_wait</code>状态，跳过了<code>fin_wait_2</code>状态。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>TCP状态转换是一个非常复杂的过程，本文仅对一些简单的基础知识点进行了类比讲解。关于TCP的更多知识还需要读者去搜寻相关技术文章进入深入学习。如果读者对TCP的基础知识掌握得比较牢固，高级的知识理解起来就不会太过于吃力。</p>
<p>作者：老錢</p>
<p>链接：<a href="https://juejin.im/post/5b29d2c4e51d4558b80b1d8c">https://juejin.im/post/5b29d2c4e51d4558b80b1d8c</a></p>
<p>来源：掘金</p>
<p>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>
]]></content>
      <categories>
        <category>TCP/IP</category>
      </categories>
      <tags>
        <tag>TCP</tag>
      </tags>
  </entry>
  <entry>
    <title>运营商级NAT（Carrier-grade NAT）</title>
    <url>/2019/05/14/42/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="运营商级NAT（Carrier-grade-NAT）"><a href="#运营商级NAT（Carrier-grade-NAT）" class="headerlink" title="运营商级NAT（Carrier-grade NAT）"></a>运营商级NAT（Carrier-grade NAT）</h3><p>  运营商级（Carrier-grade）NAT，是用于缓解是IPV4地址枯竭的一种方法，通过这种方法，原来被分配公网ip的端点、家庭网络等可以被分配一个私有的ip地址，共享一个地址池。<br>  以家庭网络为例，最初IPV4地址充足的时候，运营商可以分配给每个家庭一个公网ip，每个家庭使用NAT共享此ip（也可以不使用）；而随着接入的家庭增多，为了防止运营商手中的地址消耗过快，不再分给每个家庭一个公网ip，因此就采用在家庭网络之上再架设一层NAT，让这些家庭共享一个地址池的方法来缓解压力。而这个运营商级别的NAT使用的预留地址空间，显然不能跟用户使用的预留地址空间冲突，所以只能再选取另一段地址作为运营商级NAT的地址空间，也就是[<a href="https://tools.ietf.org/html/rfc6598">RFC6598</a>]中记录分配的地址空间，这段地址叫Shared Address Space。ARIN根据此分配的需要将空间返还给IANA。分配的地址块为<strong>100.64.0.0/10</strong>。<br>  这是近些年的改动，因此很多教科书中的预留地址中并没有介绍这个地址，事实上预留的地址还有很多，可以自己查阅文档：|</p>
<h3 id="为什么要用新的地址空间："><a href="#为什么要用新的地址空间：" class="headerlink" title="为什么要用新的地址空间："></a>为什么要用新的地址空间：</h3><p>  最初[<a href="https://tools.ietf.org/html/rfc1918">RFC1918</a>]分配了三个地址空间作为预留ip地址，供私有网络作为内网ip使用，其分布如下：</p>
<blockquote>
<p>10.0.0.0 - 10.255.255.255 (10/8 prefix)<br>172.16.0.0 - 172.31.255.255 (172.16/12 prefix)<br>192.168.0.0 - 192.168.255.255 (192.168/16 prefix)</p>
</blockquote>
<p>  因为ISP用户的私有网络（例如家庭网络）常用的地址空间就是RFC1918分配的地址空间，因此ISP如果想在用户的NAT之上再架设NAT，就只能用另一块地址空间来作为私有地址，不能与用户使用的地址空间冲突。<br>  如果一个ISP部署一个大范围的NAT，并且使用[<a href="https://tools.ietf.org/html/rfc1918">RFC1918</a>]分配的地址空间（即我们最为熟知的那三个预留地址空间），会发生什么？试想一下一个路由器/NAT内外侧存在相同的ip地址 :P</p>
<h3 id="CGN的害处"><a href="#CGN的害处" class="headerlink" title="CGN的害处"></a>CGN的害处</h3><p>  其害处与一般NAT都是类似的，比如损害端到端原则，无法架设服务器等等，见一般教科书即可。另外，这样一个NAT显然会使得追踪ip地址变得困难，因为个人的私有ip地址对应公用地址池中的一个地址的一个端口，显然，如果不记录地址翻译，将很难追踪一个ip地址的行为。<br>  显然这种方法也只是缓解IPV4地址不够用的情况，并不能从根本上解决地址枯竭的问题。</p>
<p>参考资料：<br><a href="https://en.wikipedia.org/wiki/Carrier-grade_NAT">https://en.wikipedia.org/wiki/Carrier-grade_NAT</a><br><a href="https://tools.ietf.org/html/rfc1918">https://tools.ietf.org/html/rfc1918</a><br><a href="https://tools.ietf.org/html/rfc6598">https://tools.ietf.org/html/rfc6598</a></p>
]]></content>
      <categories>
        <category>NAT</category>
      </categories>
      <tags>
        <tag>小知识</tag>
      </tags>
  </entry>
  <entry>
    <title>接入交换机下挂hub后1x认证不下线的解决</title>
    <url>/2019/05/16/44/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>最近发现个别的用户在办公区下挂hub使用有线网络时，1x认证在华为campus上会体现出一直在线的问题，（由于没有使用1x客户端，所以1x的上下线机制可能不会生效，同时启用了1x认证又使用dot1x port-method mac-based 的端口下的主机 mac地址不会老化）</p>
<p>又由于某种原因（防火墙流量探测机制，15分钟没有流量在防火墙上下线客户端），会导致用户在华为campus上一直在线，而防火墙有几率不在线，导致用户无法使用外网。</p>
<p>经查看文档同时与H3C工程师交流，可使用dot1x handshake来保证用户上下线信息的传递，但是咱们使用的1x方式是EAP-TLS的 没有使用类似H3C iNODE的客户端，可能兼容性上会有问题，</p>
<p>故建议使用1x重认证的功能，配置命令以及方法如下：</p>
<p>PS：因为只是个别的用户会出现此类问题 故可以在出现此类情况的端口启用1x重认证 防止产生过多的1x日志</p>
<p>总部办公区使用的H3C S5120 V5版本的接入交换机命令</p>
<p>V5版本需要全局开始dot1x timer reauth-period 时间（缺省为3600 建议配置最大值7200）</p>
<p>然后在下挂了hub的端口下面开启 dot1x re-authenticate 会生效1x重认证功能，用户侧两小时1x重认证一次，冲抵华为campus上的认证日志。</p>
<p>cur信息：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;YZO-S5120-PC-F8-S&gt;dis cur int g1&#x2F;0&#x2F;38</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet1&#x2F;0&#x2F;38</span><br><span class="line">description To-Server</span><br><span class="line">port access vlan 100</span><br><span class="line">loopback-detection enable</span><br><span class="line">broadcast-suppression 5</span><br><span class="line">multicast-suppression 5</span><br><span class="line">storm-constrain control block</span><br><span class="line">packet-filter 3000 outbound</span><br><span class="line">mac-address max-mac-count 3</span><br><span class="line">dot1x guest-vlan 110</span><br><span class="line">dot1x auth-fail vlan 110</span><br><span class="line">**dot1x re-authenticate**</span><br><span class="line">undo dot1x handshake</span><br><span class="line">dot1x</span><br><span class="line">port-isolate enable</span><br><span class="line">ip verify source ip-address mac-address</span><br><span class="line">#</span><br></pre></td></tr></table></figure>



<p>数字工厂办公区使用的H3C S5720 V7版本的接入交换机命令</p>
<p>V7版本的交换机可以直接在端口下启用命令，原理如上，不再赘述。</p>
<p>cur信息：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;SZGC-S5130-PC-F5&gt;dis cur int g6&#x2F;0&#x2F;42</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet6&#x2F;0&#x2F;42</span><br><span class="line">port link-mode bridge</span><br><span class="line">description To-Server</span><br><span class="line">port access vlan 100</span><br><span class="line">storm-constrain control block</span><br><span class="line">broadcast-suppression 5</span><br><span class="line">multicast-suppression 5</span><br><span class="line">stp edged-port</span><br><span class="line">mac-address max-mac-count 8</span><br><span class="line">dot1x</span><br><span class="line">undo dot1x handshake</span><br><span class="line">**dot1x re-authenticate**</span><br><span class="line">dot1x guest-vlan 110</span><br><span class="line">dot1x auth-fail vlan 110</span><br><span class="line">**dot1x timer reauth-period 7200**</span><br><span class="line">loopback-detection enable vlan 100 110 999 </span><br><span class="line">dhcp snooping binding record</span><br><span class="line">#</span><br><span class="line">return</span><br></pre></td></tr></table></figure>



<p>参考链接：<a href="http://www.h3c.com/cn/d_201506/872056_30005_0.htm#_Toc377974511">http://www.h3c.com/cn/d_201506/872056_30005_0.htm#_Toc377974511</a> </p>
]]></content>
      <categories>
        <category>CASE记录</category>
      </categories>
      <tags>
        <tag>H3C</tag>
      </tags>
  </entry>
  <entry>
    <title>新版网工技能图</title>
    <url>/2019/05/22/47/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://image01.zhang-zhe.cn/20190522141137.png"></p>
]]></content>
      <categories>
        <category>技能</category>
      </categories>
      <tags>
        <tag>技能</tag>
      </tags>
  </entry>
  <entry>
    <title>为什么在12306买火车票要装根证书？</title>
    <url>/2019/04/18/5/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>　　12306主页上有一段很显眼的文字—–“为保障您顺畅购票，请下载安装根证书。”这段文字和12306很多的其他问题一起成为网友诟病12306的话题，但是这个看似安全的根证书确可能会成为让12306用户们的安全受到严重威胁的东西。</p>
<p>　　为什么在12306上买火车票要装根证书？想要回答这个问题，那么我们就必须先要提前回答说几个定义：</p>
<p>　　电脑在与服务器交换敏感信息时会使用一种叫做SSL的加密方式。在很多情况下，交换敏感信息必须要通过这个方式来进行。包括12306在内，淘宝、京东等在交换敏感信息的时候都使用了SSL进行加密。</p>
<p>　　那么，我们怎么知道网站是否使用了SSL加密呢？最简单的办法就是看看地址栏——如果网址前面写的是“https://”，那么这个页面就是使用SSL加密的。这意味着你访问的页面是安全的并且可以用来交换敏感信息。如果你使用的是Internet Explorer 7或者以上版本浏览器，你应该能在浏览器地址栏的最右边看到一把小锁头。就像下图所示的那样。点开这把小锁头，就能看到关于https的信息。</p>
<p><img src="https://www.williamlong.info/upload/3461_1.jpg" alt="为什么在12306上买火车票要装根证书"></p>
<p>　　用其他浏览器呢？现在流行的浏览器中，全部都会标示出来该网页是使用了https以防止窃听和用户的个人信息安全的。比如下边的图就是在Firefox中使用https浏览维基百科的画面。</p>
<p><img src="https://www.williamlong.info/upload/3461_2.jpg" alt="为什么在12306上买火车票要装根证书"></p>
<p>　　但是，谁又能保证https的安全呢？这里就又是一个概念：数字证书认证机构。它的译名很多，不过大致意思对就可以了。英文Certificate Authority，经常被缩写为CA。下文中也使用“CA”来称呼数字证书认证机构。</p>
<p>　　CA是一个机构——打个比方，这就像是信用卡一样。一个人向银行申请信用卡，就像网站向CA申请证书。CA觉得网站的信用合格，就签发SSL证书；银行觉得申请者的信用合格，就签发信用卡。等等，什么又是“SSL证书”呢？这就是CA签发给网站用以证明网站身份的“信用卡”。有了SSL证书，加密网页才能被信任。当你在访问一个被https加密的网页时，网页会出示一份证书，这份证书有助于用户信任这个网站。没有正规CA签发的证书的网站是不会受到浏览器的信任的——就算你用了SSL来加密也没用。</p>
<p>　　再看看前面的两张图片。第一章支付宝的截图中，CA就是：<em>VeriSign Class 3 Public Primary Certification Authority - G5</em></p>
<p>　　第二章维基百科的截图中，CA是：<em>DigiCert Inc</em></p>
<p>　　浏览器又上哪知道CA是正规的呢？那就是根证书库，这是一个操作系统认为可以被信任的CA的名单。几乎每个能上网操作系统（甚至包括诺基亚最弱智的S40系统）都有一个。在这里用Mac做示例。Mac的根证书库在：</p>
<p>　　<em>Finder-应用程序-其他（提示：OS X Lion或者以下操作系统叫“实用工具”）-钥匙串访问</em></p>
<p>　　然后在最左边找“系统根证书”，点进去便是。看到的应该如下图所示。</p>
<p><img src="https://www.williamlong.info/upload/3461_3.jpg" alt="为什么在12306上买火车票要装根证书"></p>
<p>　　可以试着找一下*VeriSign Class 3 Public Primary Certification Authority - G5—–*肯定能找到！每次浏览器浏览https网页时，都会把网站出示的证书在这个库里面找一圈，能找到就OK，找不到的话，就证明你这个CA是不可靠的！</p>
<p>　　SSL加密的目的除了保证用户信息在传输过程中的安全外，还保障了服务器的身份。有些简单的SSL证书仅仅需要用该网站域名的邮箱向CA发封邮件就能签发了——不过如果是一个组织、团体、基金会或者盈利性机构（尤其是类似于支付宝或者PayPal的网络支付服务），那么SSL证书的签发就会变得十分繁琐。网站需要提供大量的文件以证明该网站是可靠的。如果能够证明该网站是可靠的，CA才会给签发证书。</p>
<p>　　还有一种证书被称作EV SSL证书（Extended Validation SSL），这种证书遵循全球统一的严格身份验证标准颁发的SSL证书，是目前业界最高安全级别的SSL证书。这种证书显示起来，就是俗称的绿色地址栏证书。在IE 7和以上IE浏览器便会出现绿色地址栏，并且滚动展示该网站的信息和CA信息。如下图所示。</p>
<p><img src="https://www.williamlong.info/upload/3461_4.jpg" alt="为什么在12306上买火车票要装根证书"></p>
<p>　　EV SSL的申请手续更复杂，申请费用也更多，但是可以换来更多用户的信任。左图是Firefox下显示EV SSL证书的样子。这个证书证明了这个网站的经营者为<em>Wikimedia Foundation, Inc.<em>，并且位置位于</em>San Francisco</em> <em>California, US</em></p>
<p>　　据一个叫做VeriSign的CA的统计，使用EV SSL能大幅提升用户对于网站的信任。</p>
<p><img src="https://www.williamlong.info/upload/3461_5.jpg" alt="为什么在12306上买火车票要装根证书"></p>
<p>　　总而言之，SSL证书的目的有两个：</p>
<ul>
<li>确保网站和用户之间的数据是加密并且可靠的</li>
<li>确保网站所宣称身份的真实可靠</li>
</ul>
<p>　　如果访问12306.cn会出现什么情况呢？12306的确使用了SSL来加密以保障网页的安全，而访问直接访问12306就算不安装根证书也不会出现任何问题。以Chrome为例，访问主页不会出现任何问题，但是若要访问购票页面就会无法访问，如下图所示。</p>
<p><img src="https://www.williamlong.info/upload/3461_6.jpg" alt="为什么在12306上买火车票要装根证书"></p>
<p>　　12306会让我们访问一个叫<em><a href="https://dynamic.12306.cn/otsweb">https://dynamic.12306.cn/otsweb</a></em>的网址。如果我们直接用Chrome访问这个网址呢？华丽丽的一幕出现了：</p>
<p><img src="https://www.williamlong.info/upload/3461_7.jpg" alt="为什么在12306上买火车票要装根证书"></p>
<p>　　使用IE8浏览这个页面会出现这样：</p>
<p><img src="https://www.williamlong.info/upload/3461_8.jpg" alt="为什么在12306上买火车票要装根证书"></p>
<p>　　回到Chrome，如果我们点击“仍然继续”，就会正常的看到购票页面没有任何阻力。IE8也是一样，不过IE8的地址栏整个都会变成红色的。</p>
<p>　　如果我们点击旁边的小锁头来查看关于这个证书的信息呢？会出现下图。</p>
<p><img src="https://www.williamlong.info/upload/3461_9.jpg" alt="为什么在12306上买火车票要装根证书"></p>
<p>　　再点击“证书信息”，会看到这个12306的证书是一个叫做SRCA的CA签发的。</p>
<p><img src="https://www.williamlong.info/upload/3461_10.jpg" alt="为什么在12306上买火车票要装根证书"></p>
<p>　　但是在“钥匙串访问”里面根本没有一个叫做SRCA的CA。</p>
<p>　　如果安装上了首页给出的“根证书”，（依然以Mac为例）钥匙串访问里面就会有一个叫做“SRCA”的CA！并且本来这个证书是不受信任的，安装之后就会被设置为“<em>此证书已被标记为受此账户信任</em>”。</p>
<p><img src="https://www.williamlong.info/upload/3461_11.jpg" alt="为什么在12306上买火车票要装根证书"></p>
<p>　　这样的话，浏览器和操作系统就会信任这个证书，便不会给予CA信息不对的提示了。</p>
<p>　　“SRCA”又是何许人也？在上图中，可以看到SRCA的细节部分，“组织”填写的是<em>Sinorail Certification Authority</em></p>
<p>　　这也就不难分析了，“Sinorial”中的“S”和“R”，“Certification Authority”的“S”和“A”，就拼出来了“SRCA”。</p>
<p>　　在搜索引擎中搜索<em>Sinorail Certification Authority</em>中的<em>Sinorail</em>，就会找到这样一个网站。叫做“中铁信息工程集团”。网址就是<a href="http://www.sinorail.com/%E3%80%82">http://www.sinorail.com/。</a></p>
<p>　　听名字就知道这网站跟12306肯定是亲戚关系。换种话说，就是自己给自己发证书。你说这证书能可信吗？</p>
<p>　　正规CA的证书可不是白给的。要不然CA靠什么吃饭？一个SSL证书从每年三百块RMB到一万五不等。据我所知，最贵的证书是VeriSign签发的，一万五的那个就是他。而便宜的三百块证书——只要不是VeriSign，其他CA签出来的最便宜的证书差不多都这个价。比较便宜的代表是Go Daddy、Comodo等。为什么12306要使用自己给自己的证书呢？貌似唯一的合理解释就是省钱。能省大概三百到一万五不等。</p>
<p>　　铁道部有时候买一张火车票就差不多够一年的证书钱了。</p>
<p>　　那么又为什么说铁道部用自己的证书不安全呢？有些人在12306上买票时会看到“<em>该站点安全证书的吊销信息不可用，是否继续</em>”的提示语，这又是什么意思呢？</p>
<p>　　从前有个倒霉的的荷兰CA，叫DigiNotar。这CA被黑客攻破，导致这家CA办法给一些用户的证书的私钥失效（私钥是在SSL加密环节中非常重要的东西），这就使得以这家CA的名义伪造证书成了可能。黑客可以通过这家公司的名义伪造证书给一些非法网站，客户一看这是加密过的还是大型CA签出来的证书便很容易信任。因为DigiNotar名气很大，并且很多大公司都使用它的证书，微软等操作系统厂商在这事情发生之后开始忙不迭的发布更新补丁来宣布DigiNotar的证书失效。</p>
<p>　　微软在 <a href="http://technet.microsoft.com/zh-cn/security/advisory/2607712">KB2607712</a> 补丁中宣布了DigiNotar的根证书无效。原文如下：</p>
<blockquote>
<p>Microsoft 已获悉 DigiNotar 颁发了至少一个虚假数字证书，DigiNotar 是受信任的根证书颁发机构存储区中出现的一个证书颁发机构。虚假证书可能用于哄骗内容、执行网页仿冒攻击或者针对所有 Web 浏览器用户（包括 Internet Explorer 用户）执行中间人攻击。虽然这不是 Microsoft 产品中的一个漏洞，但是此问题会影响 Microsoft Windows 的所有受支持版本。</p>
</blockquote>
<p>　　这家倒霉公司最后因为这件事华丽丽的破产了。</p>
<p>　　正如这件事一样，有些知名CA出了事，微软这些系统厂商会忙不迭的发布补丁来宣布该CA的根证书失效——有些小CA，尤其是“SRCA”这样貌似只给12306.cn一个网站签证书的CA，人还懒得管你呢！那么小CA的私钥失窃之后会有什么不就措施呢？那就是证书吊销列表，英文全称Certificate revocation list，简称CRL。下文也称呼它为CRL。更详细的内容可以参考<a href="https://zh.wikipedia.org/wiki/%E8%AF%81%E4%B9%A6%E5%90%8A%E9%94%80%E5%88%97%E8%A1%A8">这里</a>和<a href="https://en.wikipedia.org/wiki/Certificate_revocation_list">这里（英文）</a>。</p>
<p>　　CRL是干什么的呢？比如你买的证书被盗了，只要将信息报告给CA，那么CA就会把你这个证书的信息添加到这个CA的CRL中，每次浏览器浏览加密网页时，都会检索CRL信息——如果没有的话，就会提示<em>该站点安全证书的吊销信息不可用，是否继续</em>。想必读到这里大家也都知道了，12306的证书没有CRL信息。这也就意味着，12306所使用的证书一旦失窃，系统厂商不会管这个，甚至连最后一根救命稻草CRL都没有。</p>
<p>　　简而言之，如果证书出了事，两种解决办法：</p>
<ul>
<li>系统厂商发补丁宣布该证书失效</li>
<li>通过CRL宣布证书失效</li>
</ul>
<p>　　不过可惜的是12306出了事，这两招哪一个都不顶用。</p>
<p>　　如果证书失窃，会有什么后果？最可能的后果就是像前面的倒霉蛋一样倒闭。不过我大天朝铁道部（尽管已经倒闭）欠了两千多亿还巍然不动，这个可能便没有了。前面提到的两种解决方案一个也用不了，这就意味着遭殃的一定是用户。证书失窃，任何人都能用此来伪造虚假证书。尽管SRCA颁发的证书默认是不受到系统信任的，但是中国这么多去过12306网站买过火车票的人——假设所有人都安装了这个根证书使的系统对此证书信任——一个绿色地址栏都能提升用户这么大的信任，违法网站只要获得了SRCA颁发的证书，岂不就能轻易骗得用户的信任？</p>
<p>　　如果你是Mac用户，并且访问<a href="https://www.12306.cn/">https://www.12306.cn</a>没有任何障碍，那么可以参考<a href="https://player.vimeo.com/video/65127548">这个视频</a>中的步骤来将SRCA的证书设为不信任。如果要购票，反其道而行之即可。</p>
<p>　　从证书的角度看，中国很多大佬都做的非常不到位。比如我手里的建行网银，在安装U盾的时候必须安装一个网银根证书。SSL证书方面中国也做的很不到位。比如京东只有在用户登陆的时候才用了SSL来加密，而京东甚至在下订单的时候依然是明文传输。新浪微博在更改个人敏感信息时仍然使用明文传输，而twitter在早期甚至连微博内容都用https。如果使用不加密的公共Wi-Fi的话，那么在同一个Wi-Fi热点下有一个黑客，黑客便可以非常轻松的窃取到你的个人信息。</p>
<p>　　P.S.：现在12306在付款的过程中使用了VeriSign签发的合格的证书，但是这样并不代表着上面所说的可能造成的严重影响不会发生。</p>
<p>　　EV SSL介绍：<a href="http://www.wosign.com/EVSSL/index.htm">http://www.wosign.com/EVSSL/index.htm</a></p>
<p>　　这个地址打开后便可以看到EV SSL的效果：<a href="https://www.evssl.cn/en/">https://www.evssl.cn/en/</a></p>
<p>　　HTTPS - 维基百科：<a href="https://zh.wikipedia.org/wiki/Https">https://zh.wikipedia.org/wiki/Https</a></p>
<p>　　来源：techyan投稿，<a href="http://techyan.weebly.com/2/post/2013/05/12306.html">原文链接</a>。</p>
<p>　　更新：2017年12月12日更新，12306网站终于支持SSL证书了，之前多年该网站都使用自己签发的证书。新证书于2017年11月29日生效，由DigiCert签发。 </p>
]]></content>
      <categories>
        <category>SSL</category>
      </categories>
      <tags>
        <tag>安全</tag>
      </tags>
  </entry>
  <entry>
    <title>数据平面与控制平面&amp;南北流量与东西流量</title>
    <url>/2019/05/24/51/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="1-管理平面-控制平面"><a href="#1-管理平面-控制平面" class="headerlink" title="1. 管理平面/控制平面"></a>1. 管理平面/控制平面</h2><p>管理平面和控制平面统称为控制平面。</p>
<h3 id="1-1-管理平面"><a href="#1-1-管理平面" class="headerlink" title="1.1 管理平面"></a>1.1 管理平面</h3><p>管理平面是提供给网络管理人员使用TELNET、WEB、SSH、SNMP、RMON 等方式来管理设备，并支持、理解和执行管理人员对于网络设备各种网络协议的设置命令。管理平面提供了控制平面正常运行的前提，管理平面必须预先设置好控制平面中各种协议的相关参数，并支持在必要时刻对控制平面的运行进行干预。</p>
<h3 id="1-2-控制平面"><a href="#1-2-控制平面" class="headerlink" title="1.2 控制平面"></a>1.2 控制平面</h3><p>控制平面用于控制和管理所有网络协议的运行，例如生成树协议、VLAN 协议、ARP协议、各种路由协议和组播协议等等的管理和控制。控制平面通过网络协议提供给路由器/交换机对整个网络环境中网络设备、连接链路和交互协议的准确了解，并在网络状况发生改变时做出及时的调整以维护网络的正常运行。控制平面提供了数据平面数据处理转发前所必须的各种网络信息和转发查询表项。控制平面并不占用过多的硬件资源，但在正常状况下依然是网络设备CPU资源的主要占用平面，因此除了优化网络设备对于控制平面的调度流程和效率，一般还可以通过提供多CPU或提高CPU的处理性能来提高网络设备的控制平面性能。</p>
<p>控制平面主要靠CPU资源来处理信息。</p>
<p>show ip route 查看IP路由表，属控制平面范畴（路由信息数据库，RIB）</p>
<h2 id="2-数据转发平面"><a href="#2-数据转发平面" class="headerlink" title="2.数据转发平面"></a>2.数据转发平面</h2><p>网络设备的基本任务是处理和转发不同端口上各种类型的数据，对于数据处理过程中各种具体的处理转发过程，例如L2/L3/ACL/QOS/组播/安全防护等各功能的具体执行过程，都属于数据转发平面的任务范畴。数据转发平面在网络设备的各种平面任务当中需要占用决大部分的硬件资源，也直接地对其性能表现起决定作用，各个厂家都通过各种技术手段和芯片技术努力地提高网络设备数据平面的处理性能。</p>
<p>数据转发平面主要靠硬件资源来处理信息。</p>
<p>show ip cef 查看最终迭代的出接口，属数据平面范畴（转发信息数据库，FIB）</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><em>关于路由器常说的数据层面和控制层面</em></li>
</ul>
<h3 id="南北流量"><a href="#南北流量" class="headerlink" title="南北流量"></a>南北流量</h3><p>数据中心纵向的流量，即server-client的流量</p>
<h3 id="东西流量"><a href="#东西流量" class="headerlink" title="东西流量"></a>东西流量</h3><p>数据中心横向的流量，即server-server的流量</p>
]]></content>
      <categories>
        <category>知识</category>
      </categories>
      <tags>
        <tag>知识</tag>
      </tags>
  </entry>
  <entry>
    <title>SDN漫谈</title>
    <url>/2019/05/24/50/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://image01.zhang-zhe.cn/20190524170803.png"></p>
<p>SD-WAN是Software-Defined Wide Area Network的简称。这是最近3-4年才提出的名词。从名字上可以看出，它与SDN有着相同的理念。<strong>两者都是将转发与控制分离，以简化网络的管理和操作。区别是，SDN是针对数据中心的网络，SD-WAN是针对WAN。</strong></p>
<p>虽然SD-WAN是个新的网络技术的趋势，但是针对它的调研报告却不少。Gartner在2015年的一份报告<a href="https://link.zhihu.com/?target=http://blogs.gartner.com/andrew-lerner/2015/12/15/predicting-sd-wan-adoption/">Predicting SD-WAN Adoption</a>指出：虽然在2015年，只有不到1%的企业使用SD-WAN，但是到2019年，将会有30%的企业使用SD-WAN技术。Dell’Oro Group在<a href="https://link.zhihu.com/?target=https://www.sdxcentral.com/articles/news/delloro-group-sd-wan-market-grow-33-next-five-years/2017/06/">2016年</a>和<a href="https://link.zhihu.com/?target=http://www.delloro.com/news/sd-wan-market-grow-33-compound-annual-growth-rate-next-five-years-according-delloro-group">2017年</a>的报告都指出：SD-WAN市场将以33%的年符合率增长。在2016年这个市场是3亿美金，到了2021年，这个市场将达到13亿美金。<a href="https://link.zhihu.com/?target=https://www.citrix.com.cn/glossary/sd-wan.html">Citrix公司更为乐观</a>，认为在2020年，SD-WAN市场将达到60亿美金。在SD-WAN领域，对于相应创业公司的风投也是巨大的，根据Rayno Report research的一份报告，已经有超过3.6亿美金的风投给到了SD-WAN的创业公司。就在不久前，Cisco以6.1亿美金收购SD-WAN公司Viptela。</p>
<p>看起来这是一个很有钱景的方向，本文将从技术和产品的角度，介绍什么是SD-WAN。</p>
<h2 id="WAN"><a href="#WAN" class="headerlink" title="WAN"></a><strong>WAN</strong></h2><p>在了解SD-WAN之前，先来回顾一下什么是WAN？从字面上看就能理解，Wide Area Network，也就是平常说的广域网。这是一个电信网络或者计算机网络，它覆盖了较远的距离，早期通常通过租用电信线路来搭建。这里的较远距离可以是跨区域，跨国家，甚至是全世界的范围。如果从计算机网络协议和概念来看，WAN关注的是远距离数据传输的计算机网络技术。这种技术应用在LAN（局域网，Local Area Network），MAN（城域网，Metropolitan Area Network）和其他本地计算机网络之间，使得这些本地网络能够连接成为一个连通的广域网络。下图就是由多个MAN组成的WAN示意图。</p>
<p><img src="https://image01.zhang-zhe.cn/20190529200134.png"></p>
<p>我们日常生活息息相关的Internet就是一个WAN，一个在全世界范围覆盖的WAN。Internet由ISP（Internet Service Provider）构建，向各个LAN提供Internet服务。但是不能说WAN就是Internet，在企业和组织的应用中，更多出现的是私有WAN。</p>
<p>WAN的物理连接技术包括电话线，无线电波和光纤等。在逻辑层方面，常见的WAN协议有早期的X.25，Frame Relay，目前主流的是MPLS，Leased Line（T1，T3）等等。尤其是MPLS，已经在WAN构建中占据了主导地位。</p>
<p>我们知道了，WAN就是远距离组网。先不说逻辑层需要什么，看看物理连接。以光纤为例，不同的陆地之间需要通过海底光缆连接，不同国家之间的连接可能会引起法律纷争，管制纷争。就是同一个国家，通过埋设地下光缆构建WAN，也涉及租地，保护，施工等等问题。解决这些问题归根到底就是钱。这直接导致了WAN成本非常高，从而引出了<strong>WAN的最大问题：贵</strong>！在实际中，除了自己构建，更多是租用SP（Service Provider）提供的WAN连接服务。但就是这样，费用也不菲，例如：20M的Leased line，一个月就要大于10万的租金。相比之下，MPLS要稍微便宜，20M带宽的国内MPLS一个月要3万左右的租金。</p>
<p>随着基于网络的应用的发展，许多现代的应用，例如VoIP，视频会议，流媒体，虚拟应用和虚拟桌面等，都要求低延时，高带宽。尤其是HD视频对带宽的要求更高。在面对这些应用的时候，为了保证应用的可用性，有时必须要扩展WAN的带宽，直接带来的结果是成本的明显提升。</p>
<h2 id="Virtual-WAN"><a href="#Virtual-WAN" class="headerlink" title="Virtual WAN"></a><strong>Virtual WAN</strong></h2><p>同样是WAN，相比之下，Internet或者LTE网络，使用成本就低很多，而且从用户的角度来说，管理和维护也容易。Virtual WAN提出基于现有的公共WAN网络，来实现用户的私有WAN，从而达到节约资金和运维成本的目的。Virtual WAN的提出是为了补充甚至替代传统的WAN连接（MPLS）。Virtual WAN提供物理或者虚拟的设备，用户通过这些设备，在公共的WAN网络上，构建私有的WAN。公共的WAN网络指的是Internet，LTE，或者是Public WLAN，例如Motorola Canopy，等等。Virtual WAN的优势不言而喻，成本，一个20M的Internet连接，一年可能只要几百的租金。但是可能带来的问题，也是Virtual WAN需要关注的地方，有以下几点：</p>
<ul>
<li>安全。私有WAN作为连接企业或者组织内部的网络，最关心的可能就是安全了。对于Virtual WAN来说，流量走在公共网络上，必然会带来安全隐患。因此Virtual WAN利用SSL等技术，通过加密传输来保证数据的安全。</li>
<li>性能，同样的带宽，Internet的性能必然不如专用的MPLS连接。同时，MPLS的QoS能保证线路的带宽，而Internet不能。因此Virtual WAN通常会将多条Internet线路聚合在一起，成为一条逻辑上的线路，以减轻性能上的影响。另一方面，当网带宽需求降低时，又可以适当释放一些带宽，以节约成本。</li>
<li>稳定：公共网络的稳定性通常也不如专用线路，因此Virtual WAN在多条线路聚合的逻辑线路上，再加上负载均衡。根据当前几条线路的负载情况，动态的分配流量，聚合线路的稳定性。另外一方面，Virtual WAN可以聚合来自不同SP的Internet连接，以提高稳定性。</li>
</ul>
<h2 id="SD-WAN"><a href="#SD-WAN" class="headerlink" title="SD-WAN"></a><strong>SD-WAN</strong></h2><p>终于到正题了。前面说的Virtual WAN，其实已经属于SD-WAN的一部分了。现在普遍认为，SD-WAN应该具有以下4个功能：</p>
<ul>
<li><p><strong>支持多种连接方式，MPLS，frame relay，LTE，Public Internet等等。</strong></p>
</li>
<li><ul>
<li>SD-WAN将Virtual WAN与传统WAN结合，在这之上做overlay。对于应用程序来说，不需要清楚底层的WAN连接究竟是什么。在不需要传统WAN的场景下，SD-WAN就是Virtual WAN。</li>
</ul>
</li>
<li><p><strong>能够在多种连接之间动态选择链路，以达到负载均衡或者资源弹性。</strong></p>
</li>
<li><ul>
<li>与Virtual WAN类似，动态选择多条路径。SD-WAN如果同时连接了MPLS和Internet，那么可以将一些重要的应用流量，例如VoIP，分流到MPLS，以保证应用的可用性。对于一些对带宽或者稳定性不太敏感的应用流量，例如文件传输，可以分流到Internet上。这样减轻了企业对MPLS的依赖。或者，Internet可以作为MPLS的备份连接，当MPLS出故障了，至少企业的WAN网络不至于也断连。</li>
</ul>
</li>
<li><p><strong>简单的WAN管理接口。</strong></p>
</li>
<li><ul>
<li>凡是涉及网络的事物，似乎都存在管理和故障排查较为复杂的问题，WAN也不例外。SD-WAN通常也会提供一个集中的控制器，来管理WAN连接，设置应用流量policy和优先级，监测WAN连接可用性等等。基于集中控制器，可以再提供CLI或者GUI。以达到简化WAN管理和故障排查的目的。</li>
</ul>
</li>
<li><p><strong>支持VPN，防火墙，网关，WAN优化器等服务。</strong></p>
</li>
<li><ul>
<li>SD-WAN在WAN连接的基础上，将提供尽可能多的，开放的和基于软件的技术。</li>
</ul>
</li>
</ul>
<p>基本的SD-WAN的操作就是多条WAN路径的选择规划，如下图所示。</p>
<p><img src="https://image01.zhang-zhe.cn/20190529200155.png"></p>
<h2 id="SD-WAN产品"><a href="#SD-WAN产品" class="headerlink" title="SD-WAN产品"></a><strong>SD-WAN产品</strong></h2><p><strong>当我们说SDN时，更多是一种针对DC的网络架构。而SD-WAN却是一种可以购买技术产品</strong>。与Virtual WAN类似，SD-WAN产品可以是物理的，也可以是虚拟的<strong>。</strong>在WAN架构中，SD-WAN与WAN edge router放置在一起，用来增强WAN edge router甚至替代WAN edge router。从其放置的位置可以看出，客户所有的WAN流量都会流经SD-WAN。对于纯Virtual WAN而言，其产品越来越多的部署在云上。SD-WAN产品的位置如下图所示：</p>
<p><img src="https://image01.zhang-zhe.cn/20190529200212.png"></p>
<p>现实中，各个宣称提供SD-WAN的公司，其产品也不尽相同。主要可以分为两大类，一类是提供SD-WAN设备，可以是专用设备，也可以是现有设备集成了SD-WAN功能，另一类是提供WAN as a Service，自己提供WAN网络的同时，搭配售卖SD-WAN设备。</p>
<p>第一类就是前面介绍的SD-WAN。这里再说一说第二类，以Aryaka为例，Aryaka通过与各个SP合作，自己构建了一个全球范围的WAN。Aryaka的WAN在全球有26个接入点。据称，对于世界上95%的企业来说，都可以找到小于30毫秒的延时的接入点。企业用户需要通过Internet接入到Aryaka的接入点，之后数据就跑在Aryaka的骨干网上。Aryaka相当于对WAN做了虚拟化，在这之上虚拟出了多个私有WAN，供用户使用。Aryaka的SD-WAN设备用来连接用户网络和其接入点。这种方式，部署简单，传统的MPLS部署可能需要几个月，而现在几个小时就可以了。成本上也能大大降低，Aryaka的产品比较同等的MPLS，节约了超过50%的成本。下图是Aryaka的组网示意图。</p>
<p><img src="https://image01.zhang-zhe.cn/20190529200230.png"></p>
<p>Packetpusher列举除了当下知名的SD-WAN相应公司：<a href="https://link.zhihu.com/?target=http://packetpushers.net/virtual-toolbox/list-sd-wan-vendors/">List of SD-WAN Vendors</a>. 有兴趣可以看一下。虽然厂商众多，但是根据2017年一季度的数据，Viptela占据21%的SD-WAN市场，VeloCloud占据14%的市场。</p>
<h2 id="SD-WAN相关的技术"><a href="#SD-WAN相关的技术" class="headerlink" title="SD-WAN相关的技术"></a><strong>SD-WAN相关的技术</strong></h2><p>我们讲了SD-WAN的特点，介绍了SD-WAN产品，最后来看一下与SD-WAN类似或者相关的技术，通过与这些技术的对比，进一步来说明SD-WAN。</p>
<h2 id="Hybrid-WAN"><a href="#Hybrid-WAN" class="headerlink" title="Hybrid WAN"></a>Hybrid WAN</h2><p>Hybrid WAN是指采用同时采用多种WAN连接，通常就是私有MPLS连接和Internet连接。企业通过Hybrid WAN技术，可以将一些应用流量分流到Internet连接上来。毕竟，私有MPLS连接成本不低。从这点看，Hybrid WAN与前面描述的SD-WAN非常接近。实际<a href="https://link.zhihu.com/?target=http://www.infovista.com/blog/index.php/2015/08/27/sd-wan-hybrid-wan-architectures-the-roles-of-each-in-the-enterprise/">InfoVista</a>将hybrid WAN看作是SD-WAN的前身。不过Hybrid WAN只是强调同时使用多条WAN连接，SD-WAN在这之上加上了software-defined的概念，这包括了集中控制，智能分析和动态创建网络服务等。Hybrid WAN仍然占据了WAN市场较大一部分，当用户需要升级或者需要更灵活的WAN连接管理时，SD-WAN会是一个不错的替代。</p>
<h2 id="WAN-Optimization"><a href="#WAN-Optimization" class="headerlink" title="WAN Optimization"></a>WAN Optimization</h2><p>WAN Optimization是指提高数据在WAN上传输效率的技术的集合。SD-WAN关注的是使用低成本线路，以达到高性能线路传输效果。而WAN Optimization关注的是网络数据包如何更有效的在已有线路上传输。在实际中，SD-WAN可以配合WAN Optimization使用。在SD-WAN场景下，WAN Optimization通常是以虚拟的形式存在。</p>
<h2 id="WAN-edge-router"><a href="#WAN-edge-router" class="headerlink" title="WAN edge router"></a>WAN edge router</h2><p>前面说过，SD-WAN实际上能增强WAN edge router甚至取而代之。传统的网络厂商一般是在自己的WAN edge device（路由器，NGFW）里集成SD-WAN功能，而新兴的SD-WAN创业公司，更倾向于专有的SD-WAN设备，或者虚拟的SD-WAN产品，来配合WAN edge router。</p>
<h2 id="MPLS"><a href="#MPLS" class="headerlink" title="MPLS"></a>MPLS</h2><p>SD-WAN的倡导者通常会宣称SD-WAN是用来替代MPLS的。不过，只要对网络流量可靠的QoS还有需要，那么MPLS或者其他的传统WAN连接技术仍然是不能替代。现实中，SD-WAN厂商通常会建议MPLS和Virtual WAN一起部署。对于高优先级流量，仍然走MPLS。从技术的角度来看，MPLS，可以通过Traffic Engineering完全控制骨干网网络流量。而SD-WAN，其所有的控制都是在网络边缘。网络对于SD-WAN来说就是个黑盒子。所以总的来说，SD-WAN可以减轻企业对MPLS的依赖，但是不能完全消除MPLS。</p>
<h2 id="NFV"><a href="#NFV" class="headerlink" title="NFV"></a>NFV</h2><p>SD-WAN产品需要支持基于软件的VPN，防火墙，WAN Optimization等。这可以在SD-WAN上实现，也可以通过NFV技术向SD-WAN添加相应的VNF来实现。NFV和SD-WAN都是虚拟网络服务，两者并不互斥，可以配合工作。</p>
<h2 id="SDN"><a href="#SDN" class="headerlink" title="SDN"></a>SDN</h2><p>与SDN的联系更多是概念上。前面已经提过了SD-WAN与SDN的区别。这里再引用一个报告，Riverbed 2015年通过对260个样本调查发现，29%的用户正在研究SD-WAN，而已经有5%的用户在使用SD-WAN。相比之下，77%的用户在研究SDN，只有13%在使用。SD-WAN的先驱使用者是零售商和金融机构，他们都有大量的分支机构。SDN是对现有网络架构的更新，虽然说SDN架构优势明显，但是应用到实际中，因为企业现有网络架构在还能用之前，没人会提出更换成SDN架构，企业不会承担相应的成本和风险。而SD-WAN，最直接的效应就是减少企业在WAN上的投入，特别是分支机构较多的企业。设计到钱的问题的时候，总是比涉及技术更容易在企业推广。并且SD-WAN是增量变化，企业有时可以在原有WAN架构的基础上新增SD-WAN功能。因此，普遍认为SD-WAN的发展速度会更快。</p>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a><strong>最后</strong></h2><p>很多组成SD-WAN的技术并不新颖。SD-WAN更像是一些现有技术的打包和增强。<a href="https://link.zhihu.com/?target=http://www.aryaka.com/press/aryakas-2017-state-wan-report-reveals-almost-50-enterprise-traffic-composed-cloud-saas-traffic/?utm_adgroup=ticker">Aryaka 2017年的一份报告</a>指出，有将近50%的企业网络流量是云和SaaS流量。应用流量的攀升，促进了WAN连接的变革，进而促进了SD-WAN的发展。通过SD-WAN，识别应用流量，分配至不同的WAN连接，多条WAN连接，增强网络稳定性。通过软件定义的方式，简单，灵活的管理WAN连接，使得以较低成本，能够实现高效的WAN数据传输。</p>
<p>这似乎跟云计算的发迹很像啊。</p>
<p>转载自知乎 肖宏辉 链接：<a href="https://zhuanlan.zhihu.com/p/27775512">https://zhuanlan.zhihu.com/p/27775512</a></p>
]]></content>
      <categories>
        <category>SDN</category>
      </categories>
      <tags>
        <tag>SDN</tag>
      </tags>
  </entry>
  <entry>
    <title>SD-WAN技术分析</title>
    <url>/2019/05/24/52/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><strong>摘要：</strong>本文介绍了企业WAN技术的演进、SD-WAN应用场景以及解决方案、SD-WAN现状及挑战等。</p>
<p><strong>关键词：</strong>WAN、SD-WAN、宽带接入、Internet</p>
<p><strong>1.概述</strong></p>
<p>宽带接入以及Internet骨干网容量的持续提升，促使企业WAN技术变革。在已有专线的基础上，SD-WAN提供了一种低成本的快捷方案，正受到业界的追捧。本文介绍企业WAN技术演进、SD-WAN应用场景及解决方案、SD-WAN现状及挑战等。</p>
<p><strong>2.企业WAN技术演进</strong></p>
<p>传统企业应用，包括E-mail、文件共享、Web应用等，采用集中部署的方式，通常企业会在总部部署数据中心，并通过租用运营商专线（包括SDH、OTN、Ethernet、MPLS等），将分支机构连接到数据中心（如图1所示）。运营商承诺专线业务的SLA，包括带宽、时延、抖动、丢包率等，满足企业在各分支机构部署各种应用的需求（比如，存储服务、统一通信系统等）。传统专线网络可获取性比较差，光纤/电路需要单独部署，耗费的周期长；专线跨越多个网络/运营商时，业务开通周期更长；并且，专线价格昂贵，业务不能够灵活订购，通常需要比较长的合同周期（也是因为业务的开通成本比较高）。为尽可能提升专线的利用率，各种WAN优化及应用加速技术应运而生，包括QoS流控、TCP协议优化、协议代理、数据缓存技术、数据压缩技术等。</p>
<p><img src="https://ask.qcloudimg.com/http-save/yehe-1419448/zte4yd1z3u.jpeg?imageView2/2/w/1620" alt="img"></p>
<p>图1传统企业WAN网络</p>
<p>随着以太网技术的普及，运营商提供以太网服务，可以提供E-Line、E-Tree以及E-LAN服务，带宽的订购相对灵活。运营商目前引入SDN技术，在WAN网络中部署SDN控制器以及协同器,专线业务发放的效率也将显著提升(如图2所示)。专线的高可靠性，依托于运营商专网，或者，运营商为专线分配独占的网络资源，专线的成本依然很高。</p>
<p><img src="https://ask.qcloudimg.com/http-save/yehe-1419448/6pxo65ixzz.jpeg?imageView2/2/w/1620" alt="img"></p>
<p>图2 运营商SDN-WAN网络</p>
<p>互联网容量持续增长，企业分支机构和总部通过互联网连接，逐渐可行，并且互联网租赁费用适宜。企业租用互联网链路（xPON、xDSL、以太网等）的成本，通常是MPLS连接成本的1/3到1/2，并且，业务发放的周期短，租用灵活。企业在传统专线的基础上，通过Internet连接企业总部及分支机构（如图3所示）。这种场景通常称为Hybrid-WAN，要求能够基于网络的实时状态，将业务动态分发到总部和分支机构之间的多条路径上。最初的Hybrid-WAN解决方案，在分支机构部署复杂的CPE设备，通常是在路由器上集成各种网络增值服务，包括WAN优化、安全（防火墙、VPN）、x86硬件平台（可扩展新的网络增值服务）等。这种传统路由器的配置管理复杂，需要专业人员维护。</p>
<p><img src="https://ask.qcloudimg.com/http-save/yehe-1419448/1bumktpbw8.jpeg?imageView2/2/w/1620" alt="img"></p>
<p>图3混合WAN网络(Hybrid-WAN)</p>
<p>随着移动办公以及云计算的引入，企业应用的部署发生了巨大的变化。特别是，各种公有云服务，包括Office 365、Salesforce、Skype(for Business)、Box、Off Premise Storage等，使得企业网的流量发生巨大变化——企业分支对公有云的访问量越来越高（如图4所示）。公有云通常部署在少数几个数据中心，通过Internet访问，网络质量无法保障，一些业务的体验可能会受限。</p>
<p><img src="https://ask.qcloudimg.com/http-save/yehe-1419448/2up9z8qqiu.jpeg?imageView2/2/w/1620" alt="img"></p>
<p>图4基于公有云（/私有云）的企业应用</p>
<p>SDN理念逐渐在ICT领域发酵，并被引入到企业WAN市场，促使SD-WAN衍生。</p>
<p><strong>3.SD-WAN应用场景及解决方案分析</strong></p>
<p>SD-WAN继承SDN控制与转发分离、集中控制等理念，在企业WAN中部署软件控制系统，提供业务快速部署、业务智能管理等功能，帮助企业应对云服务及办公移动化所带来的挑战。典型的SD-WAN应用场景可以分为三类：Hybrid-WAN场景、公有云访问场景以及BYOD场景。</p>
<p><strong>3.1.Hybrid-WAN场景</strong></p>
<p>在传统的Hybrid-WAN解决方案中，引入集中控制器。如图5所示：</p>
<p><img src="https://ask.qcloudimg.com/http-save/yehe-1419448/xlmlh8vbtu.jpeg?imageView2/2/w/1620" alt="img"></p>
<p>图5 Hybrid-WAN场景</p>
<p>这种SD-WAN基础场景应用，提供基础的控制与转发分离功能。通过引入SD-WAN控制器，完成分支机构CPE设备的集中管理以及自动化配置，包括各种Internet接入及专线接入的配置管理等。SD-WAN可以提供企业WAN网络及应用的可视化，提供智能路由功能，能够基于WAN网络的实时状态，将各种应用的数据流智能调度到各种WAN链路上，保障时延抖动敏感应用（语音等）的服务质量。SD-WAN控制器可灵活部署在企业侧、或者云端。</p>
<p>初期Hybrid-WAN场景部署，可以不改动已有的CPE设备。但企业部署多厂商CPE设备时，要求SD-WAN控制器提供比较灵活的南向接口。</p>
<p>新部署的CPE设备，功能相对简单，复杂的功能可部署在云端。CPE设备具备即插即用特性——可以上电后自动连接SD-WAN控制器，并完成基础配置。CPE可以提供各种WAN链路网络状态的实时监测功能，或者，通过单独部署探测器(Probe)实现。</p>
<p>网络增值服务部署在云端，可以根据企业用户的需求，灵活提供。如图6所示，运营商(/第三方服务商)通常将分支机构的业务连接到其（边缘）云节点，在云节点内部提供各种增值服务。</p>
<p><img src="https://ask.qcloudimg.com/http-save/yehe-1419448/by7dznd9il.jpeg?imageView2/2/w/1620" alt="img"></p>
<p>图 6 网络增值服务云端部署</p>
<p><strong>3.2.公有云接入场景</strong></p>
<p>运营商针对公有云服务进行优化，在企业分支(或总部)，识别出公有云数据，通过运营商的专网进行承载，并接入到公有云最近的数据中心。如图7所示：</p>
<p><img src="https://ask.qcloudimg.com/http-save/yehe-1419448/oku44ekiar.jpeg?imageView2/2/w/1620" alt="img"></p>
<p>图7公有云接入场景</p>
<p>这种场景下，运营商可以建立一张专网，接入各种公有云资源。在企业分支(/总部)的CPE设备(或者运营商的边缘云节点)，能够识别出公有云业务，并且将业务流发送到运营商最近的公有云接入(/交换)节点。</p>
<p><strong>3.3.移动办公场景</strong></p>
<p>企业员工从任意地点接入企业应用，包括企业部署的私有云以及公有云。运营商可提供安全接入服务，将员工接入到最近的服务点。如图8所示：</p>
<p><img src="https://ask.qcloudimg.com/http-save/yehe-1419448/rio59vcmya.jpeg?imageView2/2/w/1620" alt="img"></p>
<p>图8移动办公场景</p>
<p>移动办公，特别是BYOD的广泛部署，使得企业网面临更严重的安全威胁。SD-WAN集中控制系统，可以将安全策略推送到各分支机构，同时，可部署多种安全防护功能，并能够同SDP(Software Defined Perimeter软件定义边界)技术结合。针对用户互联网接入场景，运营商/第三方服务商可以提供IP Sec以及SSL等安全接入服务。</p>
<p><strong>4.SD-WAN现状及挑战</strong></p>
<p>据IDC预测，相对传统企业WAN方案，SD-WAN可以节省至少20%的费用，2020年SD-WAN市场规模将超过60亿美元。Gartner在2016年7月底发布的技术曲线中，将SD-WAN服务以及SD-WAN产品作为热点技术，预测未来2~5年将大规模商用。</p>
<p>SD-WAN服务领域，DT、Verizon、SingTel、NTT等运营商积极应对挑战，进行SD-WAN服务试点，希望在网络基础连接服务的基础上，充分利用运营商自有的数据中心(包括最接近用户的边缘数据中心)，提供网络增值服务，包括防火墙、WAN加速、<a href="https://cloud.tencent.com/product/ns?from=10680">网络安全</a>等。也出现了一些第三方服务商，通过购买运营商专线，搭建自己的广域网以及核心交换节点，并向其他企业提供SD-WAN服务。</p>
<p>SD-WAN产品领域则是一片红海，各厂商解决方案暂无统一的标准，使得企业部署SD-WAN时，难以抉择。</p>
<p>SD-WAN本身也存在一定的局限性，当前主流方案是针对Hybrid-WAN方案的优化。SD-WAN是企业IT网络的一部分，企业IT包括总部和分支机构的各种LAN网络、企业数据中心、企业私有云等，企业IT网络部署各种应用，这些网络及应用是一个整体，网络的运维和监控，需要统一协调。运营商/第三方服务商提供SD-WAN服务，应当需要利用已有的运营及运维系统，而不是单独部署一套新的运营及运维系统。</p>
<p><strong>5.总结</strong></p>
<p>Internet接入及骨干容量的提升，带来了传统WAN市场的变革，SD-WAN提供了一种快速、低成本的部署方式，受到企业以及运营商的追捧。SD-WAN领域在不断创新，是初创公司的沃土。SD-WAN整体解决方案涉及企业、运营商、第三方，解决方案的开放性是各方所关注以及努力的方向。</p>
<p><strong>参考文献</strong></p>
<p>[1]Marcia Savage. SD-WAN Ramping Up In The Enterprise. 2016-07</p>
<p>[2]Jessica Scarpati. SD-What? Understanding SD-WAN. 2015-09</p>
<p>[3]Johna Till Johnson. What’s the difference between hybrid, virtual and SD-WAN?, 2016-06</p>
<p>[4]Andrew Lerner, Mark Fabbi, Neil Rickard, et al. Cool Vendors in Enterprise Networking, 2016. Gartner. 2016-04</p>
<p>[5]Mike Fratto, SD-WAN 2015 Market Update:Vendor Snapshots Show a Crowded, Competitive Field Attempting to Diversify, Current Analysis. 2015-12</p>
]]></content>
      <categories>
        <category>SDN</category>
      </categories>
      <tags>
        <tag>SDN</tag>
      </tags>
  </entry>
  <entry>
    <title>DCI平面</title>
    <url>/2019/05/24/53/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>现在的<a href="http://dc.idcquan.com/">数据中心</a>早已不是一座孤立的机房，而是一个建筑群。一个数据中心可以包含很多个分支数据中心，可以说是一个数据中心群，这些分支数据中心所处的位置不同，却可以通过网络互联起来，共同完成相应的业务部署。像阿里、腾讯、百度等这些大型互联网公司，为了提升客户访问体验，会在不同省会都会建立自己的数据中心分支机构，以便满足不同地区的客户访问需求，数据中心早已不再局限于一座或几座机房。这些数据中心要协同运转，就需要相互之间交互信息，这就有了互连需求，产生了DCI网络，即Data Center Inter-connect，这里囊括了物理网络层面和逻辑网络层面的技术。要实现不同地区的数据中心互联，有多种方式：可以直接Internet互联，可以使