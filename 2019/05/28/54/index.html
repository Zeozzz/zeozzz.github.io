<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="澈崽子"><meta name="copyright" content="澈崽子"><meta name="generator" content="Hexo 5.0.0"><meta name="theme" content="hexo-theme-yun"><title>OSPF配置---华为 | 澈崽子 | 家有网工初长成</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="none" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.19/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_stqaphw3j4.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>document.addEventListener("DOMContentLoaded", () => {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
});
</script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script defer src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.min.css"><script defer src="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/auto-render.min.js"></script><script>document.addEventListener("DOMContentLoaded", function() {
  renderMathInElement(document.body, {
    delimiters: [
      {left: "$$", right: "$$", display: true},
      {left: "$", right: "$", display: false},
      {left: "\\(", right: "\\)", display: false},
      {left: "\\[", right: "\\]", display: true}
    ]
  });
});</script><link class="aplayer-style-marker" rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/aplayer@latest/dist/APlayer.min.css"><script class="aplayer-script-marker" src="https://cdn.jsdelivr.net/npm/aplayer@latest/dist/APlayer.min.js" defer></script><script class="meting-script-marker" src="https://cdn.jsdelivr.net/npm/meting@1/dist/Meting.min.js" defer></script><link rel="shortcut icon" type="image/svg+xml" href="/yun.svg"><link rel="mask-icon" href="/yun.svg" color="#0078E7"><link rel="alternate icon" href="/yun.ico"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="stylesheet" href="/css/hexo-theme-yun.css"><link rel="alternate" href="/atom.xml" title="澈崽子 | 家有网工初长成" type="application/atom+xml"><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"root":"/","title":"澈崽子的小窝","version":"0.9.5","anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"local_search":{"path":"/search.xml"},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};
  </script><meta name="description" content="6.1  OSPF简介介绍OSPF的定义和目的。 定义开放式最短路径优先OSPF（Open Shortest Path First）是IETF组织开发的一个基于链路状态的内部网关协议（Interior Gateway Protocol）。 目前针对IPv4协议使用的是OSPF Version 2（RFC2328）；针对IPv6协议使用OSPF Version 3（RFC2740）。如无特殊说明，本">
<meta property="og:type" content="article">
<meta property="og:title" content="OSPF配置---华为">
<meta property="og:url" content="https://zeozzz.github.com/2019/05/28/54/index.html">
<meta property="og:site_name" content="澈崽子 | 家有网工初长成">
<meta property="og:description" content="6.1  OSPF简介介绍OSPF的定义和目的。 定义开放式最短路径优先OSPF（Open Shortest Path First）是IETF组织开发的一个基于链路状态的内部网关协议（Interior Gateway Protocol）。 目前针对IPv4协议使用的是OSPF Version 2（RFC2328）；针对IPv6协议使用OSPF Version 3（RFC2740）。如无特殊说明，本">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/76d5fe7788bc45ac8b07e7f99d5cb807">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/ef85c3eb05ed403d8ba6d19f54bfc020">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/3ecba075c8024ae49a9917fcad8de3cd">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/6e0284db542442a6b644e637b9ddf01c">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/40ece72d5e9e466c8dafc300cc776a35">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/c55e9f3ac146428e8bf29fcd5fa6d77d">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/fa920abb92e24c549d48c0150883adaa">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/28927eee31074cf6ba4a37fcaefeb0fd">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/8fcc2f94eabb4a55bbb80bd1b5604012">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/47c62a5ef1284953a52fdc0dc8e6a83e">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/125603863bea4fe2900e3d04fcad0ae5">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/64593677b4554ae1a5fe7a9391a41dbc">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/1fb59f67d2734943a4390a9ced1952b7">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/7293ad5cb7864b03a572b9b15d3e58fc">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/0e94dca1f06240eaaf96255e18339f75">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/ce0e92c456ba4000aeab242dbd11e5e5">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/87391de24c5549fbabc05a32fe55cafd">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/c7efd0b2fb4b4a3198e9435cf660b031">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/897242c5165642e8acbc439cda8a5eae">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/8ff7e47c94524cae807edf1a7d0a0312">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/861cfafbcc224151bc56e0a3adba4cae">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/784f45b916ce446fb56ce65526d53920">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/df9cd1e3eebd4cf3bab313edfe215e0a">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/28e5b3f3f7cf42f08a7251f502003464">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/1d061332638f42679570e7bc3760cf21">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/59d41ae5dd93492dbfe55f6279495191">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/99d4c40766404752b80be71a36bb3686">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/74d4be3a0b9d4391b9909c9fd35d5bac">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/5f0c3d095de84160bce2f64f02f2efdd">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/246e618ffa424079b829d9f6ffc358d8">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/389bb0861b87491399c42e865cd34c10">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/9f0165e80290478fad395c1940ed17dc">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/53e023b149c247c3bfb752f15bf49922">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/b4f3577fa46a48e68fc3d29b4c0907d7">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/b8056316558143ac8d378739dfd3fcaf">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/bbff4c7b79b5472ab3ac45ac1a8afa35">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/f6c057db138649938b3eccabf52f50e1">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/18e63c141f204672ac34b1ddbab2387b">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/227a2a099c884a5a8ae5810fdb2601ab">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/5bf7fc7c2b06498782a61a01fdd10e10">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/e465d3869b7a48b59059d7236a1b5917">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/d08ba32e6dd440c1a29985222cf8cdbb">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/a9ecd4b1af4b43f7ad078a5d3d58184a">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/f54579d8161e40febf1619520cf29708">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/50c4863a207b415ca7a19cb852646619">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/9d04f2a7f407457cab4fee4b4b962fef">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/14f206dabba3413f831e92a666aa27ef">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/26ed5d6cc3ca49e7b7f41ff8a216fbc0">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/1717dffcdd0d4af69959cefeda101cf3">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/85a9e2ea85a444c69528313584ba50af">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/affeb831396b4afcb3c99e7f929bbae2">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/4783d38322d5480ba88f1376e22d5d29">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/c29e59e493ca402dbe3638b906176d00">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/148aa1440b9f4feeb23e04e38ac34a7d">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/d3f18cc658c9446988f147136a6363bf">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/1be62ec2e84748168adcf46cc4827a6c">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/d3e5c409c021434ca486645a7623bc6f">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/42db71da25894242b3c5af3371386223">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/ab53c9a2427640e8bafd9f4d93ab2c8d">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/0d78a236994a4260864b8dd26df155a7">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/159689dba7de441db3f92d31373fd7a3">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/e78eca4d41394439886ab90a62ad9a12">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/4c4b01155c2c4fbf9c732349e2a61ba0">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/fb1e65e32c534fff8faea1de9ef9ad00">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/3ef4f0987d274d6c9acced469f57e57c">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/4e58271662bb4091ab3657d6bef4b9b8">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/5bf7fc7c2b06498782a61a01fdd10e10">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/5bf7fc7c2b06498782a61a01fdd10e10">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/02e1c47ef46e4fd080b6ebdb038d065d">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/8b1576ffe3c94d419fc4efb4900385cb">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/905536776fa642cd98f85bf457c55d31">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/5bf7fc7c2b06498782a61a01fdd10e10">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/5bf7fc7c2b06498782a61a01fdd10e10">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/5bf7fc7c2b06498782a61a01fdd10e10">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/5bf7fc7c2b06498782a61a01fdd10e10">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/4d913fc7efbe48c0a33c55ea292d0624">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/eab0e78c08eb4ed89b94426591d2773a">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/0c89df9499ee4183ac48875c3fc52780">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/384fb40cc92046608ad92fe15f6d7b03">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/92162df4db1843f7831569f36e16d00b">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/94d35e91310e44d5af19e6d0ccad3845">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/b6708e9072ab4319ac3ad1663d47682f">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/266dca518f594cb6a368cbc16c8a385b">
<meta property="og:image" content="http://support.huawei.com/enterprise/product/images/547bad259f194675918a5fb8fe5b24a0">
<meta property="article:published_time" content="2019-05-28T05:36:06.000Z">
<meta property="article:modified_time" content="2019-05-28T07:20:11.498Z">
<meta property="article:author" content="澈崽子">
<meta property="article:tag" content="OSPF">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://support.huawei.com/enterprise/product/images/76d5fe7788bc45ac8b07e7f99d5cb807"><script src="/js/ui/mode.js"></script></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script defer src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="澈崽子"><img width="96" loading="lazy" src="/avatar.jfif" alt="澈崽子"></a><div class="site-author-name"><a href="/about/">澈崽子</a></div><a class="site-name" href="/about/site.html">澈崽子 | 家有网工初长成</a><sub class="site-subtitle"></sub><div class="site-desciption">念念不忘 必有回响</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">75</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">29</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">36</span></a></div><a class="site-state-item hty-icon-button" href="/links/" title="常用链接"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-settings-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" title="RSS" target="_blank" style="color:orange"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-rss-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="QQ 群" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/Zeozzz" title="GitHub" target="_blank" style="color:#6e5494"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://weibo.com/linche521chn" title="微博" target="_blank" style="color:#E6162D"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-weibo-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://www.douban.com/people/zeozzz/" title="豆瓣" target="_blank" style="color:#007722"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-douban-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/user/home?id=46666755" title="网易云音乐" target="_blank" style="color:#C20C0C"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-netease-cloud-music-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://www.zhihu.com/people/janz1995chn/activities" title="知乎" target="_blank" style="color:#0084FF"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-zhihu-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://space.bilibili.com/15054940" title="哔哩哔哩" target="_blank" style="color:#FF8EB3"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-bilibili-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://twitter.com/zeozzz" title="Twitter" target="_blank" style="color:#1da1f2"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-twitter-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://t.me/zeozzz" title="Telegram Channel" target="_blank" style="color:#0088CC"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-telegram-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:zhangzhe@live.in" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://travellings.now.sh/" title="Travelling" target="_blank" style="color:var(--hty-text-color)"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-send-plane-2-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" target="_blank" rel="noopener" href="https://ispip.clang.cn/" title="IP归属查询" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-information-line"></use></svg></a><a class="links-item hty-icon-button" target="_blank" rel="noopener" href="http://ping.pe" title="ping工具" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-questionnaire-line"></use></svg></a><a class="links-item hty-icon-button" target="_blank" rel="noopener" href="https://photos.oneplus.com/cn" title="每日一图" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-gallery-line"></use></svg></a><a class="links-item hty-icon-button" target="_blank" rel="noopener" href="https://smallpdf.com/cn" title="PDF工具" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></a><a class="links-item hty-icon-button" target="_blank" rel="noopener" href="https://www.runoob.com/" title="菜鸟教程" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-pushpin-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-OSPF%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">6.1  OSPF简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89"><span class="toc-number">1.1.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E7%9A%84"><span class="toc-number">1.2.</span> <span class="toc-text">目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF"><span class="toc-number">1.3.</span> <span class="toc-text">相关信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-%E5%8E%9F%E7%90%86%E6%8F%8F%E8%BF%B0"><span class="toc-number">2.</span> <span class="toc-text">6.2  原理描述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-1-OSPF%E5%9F%BA%E7%A1%80"><span class="toc-number">2.1.</span> <span class="toc-text">6.2.1  OSPF基础</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-1-1-OSPF%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-number">2.1.1.</span> <span class="toc-text">6.2.1.1  OSPF的特点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-1-2-OSPF%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6"><span class="toc-number">2.1.2.</span> <span class="toc-text">6.2.1.2  OSPF运行机制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-1-3-OSPF%E6%8A%A5%E6%96%87%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.1.3.</span> <span class="toc-text">6.2.1.3  OSPF报文类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-1-4-OSPF%E6%94%AF%E6%8C%81%E7%9A%84%E7%BD%91%E7%BB%9C%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.1.4.</span> <span class="toc-text">6.2.1.4  OSPF支持的网络类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-1-5-DR%E5%92%8CBDR%E9%80%89%E4%B8%BE"><span class="toc-number">2.1.5.</span> <span class="toc-text">6.2.1.5  DR和BDR选举</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Router-ID"><span class="toc-number">2.1.5.1.</span> <span class="toc-text">Router ID</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#DR%E5%92%8CBDR%E9%80%89%E4%B8%BE%E7%9A%84%E5%8E%9F%E5%9B%A0"><span class="toc-number">2.1.5.2.</span> <span class="toc-text">DR和BDR选举的原因</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#DR%E5%92%8CBDR%E9%80%89%E4%B8%BE%E7%9A%84%E5%8E%9F%E5%88%99"><span class="toc-number">2.1.5.3.</span> <span class="toc-text">DR和BDR选举的原则</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#DR%E5%92%8CBDR%E9%80%89%E4%B8%BE%E8%BF%87%E7%A8%8B"><span class="toc-number">2.1.5.4.</span> <span class="toc-text">DR和BDR选举过程</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#DR%E5%92%8CBDR%E9%80%89%E4%B8%BE%E8%BF%87%E7%A8%8B%E9%AA%8C%E8%AF%81"><span class="toc-number">2.1.5.5.</span> <span class="toc-text">DR和BDR选举过程验证</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-1-6-OSPF%E7%8A%B6%E6%80%81%E6%9C%BA"><span class="toc-number">2.1.6.</span> <span class="toc-text">6.2.1.6  OSPF状态机</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#OSPF%E6%8E%A5%E5%8F%A3%E7%8A%B6%E6%80%81%E6%9C%BA"><span class="toc-number">2.1.6.1.</span> <span class="toc-text">OSPF接口状态机</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OSPF%E9%82%BB%E5%B1%85%E7%8A%B6%E6%80%81%E6%9C%BA"><span class="toc-number">2.1.6.2.</span> <span class="toc-text">OSPF邻居状态机</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-1-7-OSPF%E9%82%BB%E6%8E%A5%E5%85%B3%E7%B3%BB%E7%9A%84%E5%BB%BA%E7%AB%8B"><span class="toc-number">2.1.7.</span> <span class="toc-text">6.2.1.7  OSPF邻接关系的建立</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#OSPF%E9%82%BB%E5%B1%85%E5%85%B3%E7%B3%BB%E5%92%8C%E9%82%BB%E6%8E%A5%E5%85%B3%E7%B3%BB"><span class="toc-number">2.1.7.1.</span> <span class="toc-text">OSPF邻居关系和邻接关系</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OSPF%E9%82%BB%E6%8E%A5%E5%85%B3%E7%B3%BB%E5%BB%BA%E7%AB%8B%E8%BF%87%E7%A8%8B"><span class="toc-number">2.1.7.2.</span> <span class="toc-text">OSPF邻接关系建立过程</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-1-8-OSPF%E5%8C%BA%E5%9F%9F"><span class="toc-number">2.1.8.</span> <span class="toc-text">6.2.1.8  OSPF区域</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%99%A8%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.1.8.1.</span> <span class="toc-text">路由器类型</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.1.8.2.</span> <span class="toc-text">路由类型</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8C%BA%E5%9F%9F%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.1.8.3.</span> <span class="toc-text">区域类型</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OSPF%E5%8C%BA%E5%9F%9F%E9%97%B4%E7%8E%AF%E8%B7%AF%E5%8F%8A%E9%98%B2%E7%8E%AF%E6%96%B9%E6%B3%95"><span class="toc-number">2.1.8.4.</span> <span class="toc-text">OSPF区域间环路及防环方法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OSPF%E7%BC%BA%E7%9C%81%E8%B7%AF%E7%94%B1"><span class="toc-number">2.1.8.5.</span> <span class="toc-text">OSPF缺省路由</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-1-9-OSPF-LSA%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.1.9.</span> <span class="toc-text">6.2.1.9  OSPF LSA类型</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Router-LSA"><span class="toc-number">2.1.9.1.</span> <span class="toc-text">Router-LSA</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Network-LSA"><span class="toc-number">2.1.9.2.</span> <span class="toc-text">Network-LSA</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Network-summary-LSA"><span class="toc-number">2.1.9.3.</span> <span class="toc-text">Network-summary-LSA</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ASBR-Summary-LSA"><span class="toc-number">2.1.9.4.</span> <span class="toc-text">ASBR-Summary-LSA</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#AS-external-LSA"><span class="toc-number">2.1.9.5.</span> <span class="toc-text">AS-external-LSA</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#NSSA-LSA"><span class="toc-number">2.1.9.6.</span> <span class="toc-text">NSSA LSA</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Opaque-LSA"><span class="toc-number">2.1.9.7.</span> <span class="toc-text">Opaque LSA</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-1-10-OSPF%E5%BF%AB%E9%80%9F%E6%94%B6%E6%95%9B"><span class="toc-number">2.1.10.</span> <span class="toc-text">6.2.1.10  OSPF快速收敛</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-1-11-OSPF%E8%99%9A%E8%BF%9E%E6%8E%A5"><span class="toc-number">2.1.11.</span> <span class="toc-text">6.2.1.11  OSPF虚连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-1-12-OSPF%E8%B7%AF%E7%94%B1%E8%81%9A%E5%90%88%E5%92%8C%E8%B7%AF%E7%94%B1%E8%BF%87%E6%BB%A4"><span class="toc-number">2.1.12.</span> <span class="toc-text">6.2.1.12  OSPF路由聚合和路由过滤</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#OSPF%E8%B7%AF%E7%94%B1%E8%81%9A%E5%90%88"><span class="toc-number">2.1.12.1.</span> <span class="toc-text">OSPF路由聚合</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OSPF%E8%B7%AF%E7%94%B1%E8%BF%87%E6%BB%A4"><span class="toc-number">2.1.12.2.</span> <span class="toc-text">OSPF路由过滤</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-1-13-OSPF%E5%A4%9A%E8%BF%9B%E7%A8%8B"><span class="toc-number">2.1.13.</span> <span class="toc-text">6.2.1.13  OSPF多进程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-1-14-OSPF-RFC1583%E5%85%BC%E5%AE%B9"><span class="toc-number">2.1.14.</span> <span class="toc-text">6.2.1.14  OSPF RFC1583兼容</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-2-OSPF%E5%A2%9E%E5%BC%BA%E5%8A%9F%E8%83%BD"><span class="toc-number">2.2.</span> <span class="toc-text">6.2.2  OSPF增强功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-2-1-OSPF-VPN"><span class="toc-number">2.2.1.</span> <span class="toc-text">6.2.2.1  OSPF VPN</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-1"><span class="toc-number">2.2.1.1.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%AE%E7%9A%84-1"><span class="toc-number">2.2.1.2.</span> <span class="toc-text">目的</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#PE-CE%E9%97%B4%E8%BF%90%E8%A1%8COSPF"><span class="toc-number">2.2.1.3.</span> <span class="toc-text">PE-CE间运行OSPF</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#PE-CE%E9%97%B4OSPF%E5%8C%BA%E5%9F%9F%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.1.4.</span> <span class="toc-text">PE-CE间OSPF区域配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OSPF-Domain-ID"><span class="toc-number">2.2.1.5.</span> <span class="toc-text">OSPF Domain ID</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E7%8E%AF%E8%B7%AF%E9%A2%84%E9%98%B2"><span class="toc-number">2.2.1.6.</span> <span class="toc-text">路由环路预防</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A7%A3%E9%99%A4%E8%B7%AF%E7%94%B1%E7%8E%AF%E8%B7%AF%E9%A2%84%E9%98%B2"><span class="toc-number">2.2.1.7.</span> <span class="toc-text">解除路由环路预防</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Multi-VPN-Instance-CE"><span class="toc-number">2.2.1.8.</span> <span class="toc-text">Multi-VPN-Instance CE</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-2-2-OSPF-TE"><span class="toc-number">2.2.2.</span> <span class="toc-text">6.2.2.2  OSPF TE</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#OSPF%E5%9C%A8MPLS-TE%E4%B8%AD%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">OSPF在MPLS-TE中的作用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#TE-LSA"><span class="toc-number">2.2.2.2.</span> <span class="toc-text">TE-LSA</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OSPF-TE%E4%B8%8ECSPF%E4%BA%A4%E4%BA%92"><span class="toc-number">2.2.2.3.</span> <span class="toc-text">OSPF TE与CSPF交互</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#IGP-Shortcut%E5%92%8C%E8%BD%AC%E5%8F%91%E9%82%BB%E6%8E%A5"><span class="toc-number">2.2.2.4.</span> <span class="toc-text">IGP Shortcut和转发邻接</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OSPF-DS-TE"><span class="toc-number">2.2.2.5.</span> <span class="toc-text">OSPF DS-TE</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OSPF-SRLG"><span class="toc-number">2.2.2.6.</span> <span class="toc-text">OSPF SRLG</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-2-3-OSPF%E5%AE%89%E5%85%A8"><span class="toc-number">2.2.3.</span> <span class="toc-text">6.2.2.3  OSPF安全</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#OSPF-GTSM"><span class="toc-number">2.2.3.1.</span> <span class="toc-text">OSPF GTSM</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OSPF%E6%8A%A5%E6%96%87%E8%AE%A4%E8%AF%81"><span class="toc-number">2.2.3.2.</span> <span class="toc-text">OSPF报文认证</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-2-4-OSPF-GR"><span class="toc-number">2.2.4.</span> <span class="toc-text">6.2.2.4  OSPF GR</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">2.2.4.1.</span> <span class="toc-text">基本概念</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#GR%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">2.2.4.2.</span> <span class="toc-text">GR的分类</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#GR%E7%9A%84%E8%BF%87%E7%A8%8B"><span class="toc-number">2.2.4.3.</span> <span class="toc-text">GR的过程</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9C%89%E6%97%A0GR%E6%8A%80%E6%9C%AF%E7%9A%84%E6%AF%94%E8%BE%83"><span class="toc-number">2.2.4.4.</span> <span class="toc-text">有无GR技术的比较</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-2-5-OSPF%E9%82%BB%E5%B1%85%E9%9C%87%E8%8D%A1%E6%8A%91%E5%88%B6"><span class="toc-number">2.2.5.</span> <span class="toc-text">6.2.2.5  OSPF邻居震荡抑制</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BA%A7%E7%94%9F%E5%8E%9F%E5%9B%A0"><span class="toc-number">2.2.5.1.</span> <span class="toc-text">产生原因</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5"><span class="toc-number">2.2.5.2.</span> <span class="toc-text">相关概念</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-number">2.2.5.3.</span> <span class="toc-text">实现原理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B8%E5%9E%8B%E5%9C%BA%E6%99%AF"><span class="toc-number">2.2.5.4.</span> <span class="toc-text">典型场景</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-2-6-OSPF-Smart-discover"><span class="toc-number">2.2.6.</span> <span class="toc-text">6.2.2.6  OSPF Smart-discover</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-2"><span class="toc-number">2.2.6.1.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-number">2.2.6.2.</span> <span class="toc-text">原理</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-2-7-OSPF-Database-Overflow"><span class="toc-number">2.2.7.</span> <span class="toc-text">6.2.2.7  OSPF Database Overflow</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-3"><span class="toc-number">2.2.7.1.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%AE%E7%9A%84-2"><span class="toc-number">2.2.7.2.</span> <span class="toc-text">目的</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8E%9F%E7%90%86-1"><span class="toc-number">2.2.7.3.</span> <span class="toc-text">原理</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-2-8-OSPF-Mesh-Group"><span class="toc-number">2.2.8.</span> <span class="toc-text">6.2.2.8  OSPF Mesh-Group</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-4"><span class="toc-number">2.2.8.1.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%AE%E7%9A%84-3"><span class="toc-number">2.2.8.2.</span> <span class="toc-text">目的</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8E%9F%E7%90%86-2"><span class="toc-number">2.2.8.3.</span> <span class="toc-text">原理</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-3-OSPF%E4%B8%8E%E5%85%B6%E5%AE%83%E5%8D%8F%E8%AE%AE%E8%81%94%E5%8A%A8"><span class="toc-number">2.3.</span> <span class="toc-text">6.2.3  OSPF与其它协议联动</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#OSPF%E4%B8%8EBFD%E8%81%94%E5%8A%A8"><span class="toc-number">2.3.1.</span> <span class="toc-text">OSPF与BFD联动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#OSPF%E4%B8%8EBGP%E8%81%94%E5%8A%A8"><span class="toc-number">2.3.2.</span> <span class="toc-text">OSPF与BGP联动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#OSPF-LDP%E8%81%94%E5%8A%A8"><span class="toc-number">2.3.3.</span> <span class="toc-text">OSPF-LDP联动</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-3-%E5%BA%94%E7%94%A8"><span class="toc-number">3.</span> <span class="toc-text">6.3  应用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-1-OSPF-GR"><span class="toc-number">3.1.</span> <span class="toc-text">6.3.1  OSPF GR</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-2-OSPF-GTSM"><span class="toc-number">3.2.</span> <span class="toc-text">6.3.2  OSPF GTSM</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-4-OSPF%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97"><span class="toc-number">4.</span> <span class="toc-text">6.4  OSPF部署指南</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-1-OSPF%E7%BD%91%E7%BB%9C%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99"><span class="toc-number">4.1.</span> <span class="toc-text">6.4.1  OSPF网络规划设计原则</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%9D%E6%8C%81OSPF%E7%BD%91%E7%BB%9C%E7%9A%84%E7%A8%B3%E5%AE%9A%E6%80%A7%EF%BC%9ARouter-ID%E7%9A%84%E8%A7%84%E5%88%92"><span class="toc-number">4.1.1.</span> <span class="toc-text">保持OSPF网络的稳定性：Router ID的规划</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B1%82%E6%AC%A1%E5%8C%96%E7%9A%84%E7%BD%91%E7%BB%9C%E8%AE%BE%E8%AE%A1%EF%BC%9AOSPF%E5%8C%BA%E5%9F%9F%E7%9A%84%E8%A7%84%E5%88%92"><span class="toc-number">4.1.2.</span> <span class="toc-text">层次化的网络设计：OSPF区域的规划</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%9E%E9%AA%A8%E5%B9%B2%E5%8C%BA%E5%9F%9F%E7%9A%84%E8%B7%AF%E7%94%B1%E8%A1%A8%E9%A1%B9%E4%BC%98%E5%8C%96%EF%BC%9A%E7%89%B9%E6%AE%8A%E5%8C%BA%E5%9F%9F%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">4.1.3.</span> <span class="toc-text">非骨干区域的路由表项优化：特殊区域的使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AA%A8%E5%B9%B2%E5%8C%BA%E5%9F%9F%E7%9A%84%E8%B7%AF%E7%94%B1%E8%A1%A8%E9%A1%B9%E4%BC%98%E5%8C%96%EF%BC%9A%E9%9D%9E%E9%AA%A8%E5%B9%B2%E5%8C%BA%E5%9F%9FIP%E5%AD%90%E7%BD%91%E8%A7%84%E5%88%92%E5%92%8C%E8%B7%AF%E7%94%B1%E6%B1%87%E8%81%9A"><span class="toc-number">4.1.4.</span> <span class="toc-text">骨干区域的路由表项优化：非骨干区域IP子网规划和路由汇聚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8A%E8%A1%8C%E6%B5%81%E9%87%8F%E7%9A%84%E5%BC%95%E5%AF%BC%EF%BC%9AOSPF%E7%BC%BA%E7%9C%81%E8%B7%AF%E7%94%B1%E7%9A%84%E5%BC%95%E5%85%A5%E5%92%8C%E9%80%89%E8%B7%AF%E4%BC%98%E5%8C%96"><span class="toc-number">4.1.5.</span> <span class="toc-text">上行流量的引导：OSPF缺省路由的引入和选路优化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E6%B1%87%E6%80%BB%E5%9C%BA%E6%99%AF%E4%B8%8B%E7%9A%84%E9%98%B2%E7%8E%AF%E8%AE%BE%E8%AE%A1%EF%BC%9A%E9%BB%91%E6%B4%9E%E8%B7%AF%E7%94%B1%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">4.1.6.</span> <span class="toc-text">路由汇总场景下的防环设计：黑洞路由的使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#OSPF%E7%BD%91%E7%BB%9C%E5%9F%BA%E6%9C%AC%E5%AE%89%E5%85%A8%EF%BC%9AOSPF%E9%9D%99%E9%BB%98%E6%8E%A5%E5%8F%A3%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">4.1.7.</span> <span class="toc-text">OSPF网络基本安全：OSPF静默接口的使用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-2-OSPF%E7%BD%91%E7%BB%9C%E8%AE%BE%E8%AE%A1%E9%83%A8%E7%BD%B2%E6%A1%88%E4%BE%8B"><span class="toc-number">4.2.</span> <span class="toc-text">6.4.2  OSPF网络设计部署案例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%9D%E6%8C%81OSPF%E7%BD%91%E7%BB%9C%E7%9A%84%E7%A8%B3%E5%AE%9A%E6%80%A7%EF%BC%9ARouter-ID%E7%9A%84%E8%A7%84%E5%88%92-1"><span class="toc-number">4.2.1.</span> <span class="toc-text">保持OSPF网络的稳定性：Router ID的规划</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B1%82%E6%AC%A1%E5%8C%96%E7%9A%84%E7%BD%91%E7%BB%9C%E8%AE%BE%E8%AE%A1%EF%BC%9AOSPF%E5%8C%BA%E5%9F%9F%E7%9A%84%E8%A7%84%E5%88%92-1"><span class="toc-number">4.2.2.</span> <span class="toc-text">层次化的网络设计：OSPF区域的规划</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%9E%E9%AA%A8%E5%B9%B2%E5%8C%BA%E5%9F%9F%E7%9A%84%E8%B7%AF%E7%94%B1%E8%A1%A8%E9%A1%B9%E4%BC%98%E5%8C%96%EF%BC%9A%E7%89%B9%E6%AE%8A%E5%8C%BA%E5%9F%9F%E7%9A%84%E4%BD%BF%E7%94%A8-1"><span class="toc-number">4.2.3.</span> <span class="toc-text">非骨干区域的路由表项优化：特殊区域的使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AA%A8%E5%B9%B2%E5%8C%BA%E5%9F%9F%E7%9A%84%E8%B7%AF%E7%94%B1%E8%A1%A8%E9%A1%B9%E4%BC%98%E5%8C%96%EF%BC%9A%E9%9D%9E%E9%AA%A8%E5%B9%B2%E5%8C%BA%E5%9F%9FIP%E5%AD%90%E7%BD%91%E8%A7%84%E5%88%92%E5%92%8C%E8%B7%AF%E7%94%B1%E6%B1%87%E8%81%9A-1"><span class="toc-number">4.2.4.</span> <span class="toc-text">骨干区域的路由表项优化：非骨干区域IP子网规划和路由汇聚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8A%E8%A1%8C%E6%B5%81%E9%87%8F%E7%9A%84%E5%BC%95%E5%AF%BC%EF%BC%9AOSPF%E7%BC%BA%E7%9C%81%E8%B7%AF%E7%94%B1%E7%9A%84%E5%BC%95%E5%85%A5%E5%92%8C%E9%80%89%E8%B7%AF%E4%BC%98%E5%8C%96-1"><span class="toc-number">4.2.5.</span> <span class="toc-text">上行流量的引导：OSPF缺省路由的引入和选路优化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E6%B1%87%E6%80%BB%E5%9C%BA%E6%99%AF%E4%B8%8B%E7%9A%84%E9%98%B2%E7%8E%AF%E8%AE%BE%E8%AE%A1%EF%BC%9A%E9%BB%91%E6%B4%9E%E8%B7%AF%E7%94%B1%E7%9A%84%E4%BD%BF%E7%94%A8-1"><span class="toc-number">4.2.6.</span> <span class="toc-text">路由汇总场景下的防环设计：黑洞路由的使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#OSPF%E7%BD%91%E7%BB%9C%E5%9F%BA%E6%9C%AC%E5%AE%89%E5%85%A8%EF%BC%9AOSPF%E9%9D%99%E9%BB%98%E6%8E%A5%E5%8F%A3%E7%9A%84%E4%BD%BF%E7%94%A8-1"><span class="toc-number">4.2.7.</span> <span class="toc-text">OSPF网络基本安全：OSPF静默接口的使用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-5-%E9%85%8D%E7%BD%AE%E4%BB%BB%E5%8A%A1%E6%A6%82%E8%A7%88"><span class="toc-number">5.</span> <span class="toc-text">6.5  配置任务概览</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-6-%E9%85%8D%E7%BD%AE%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">6.</span> <span class="toc-text">6.6  配置注意事项</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B6%89%E5%8F%8A%E7%BD%91%E5%85%83"><span class="toc-number">6.1.</span> <span class="toc-text">涉及网元</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#License%E6%94%AF%E6%8C%81"><span class="toc-number">6.2.</span> <span class="toc-text">License支持</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%88%E6%9C%AC%E6%94%AF%E6%8C%81"><span class="toc-number">6.3.</span> <span class="toc-text">版本支持</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E6%80%A7%E4%BE%9D%E8%B5%96%E5%92%8C%E9%99%90%E5%88%B6"><span class="toc-number">6.4.</span> <span class="toc-text">特性依赖和限制</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-7-%E7%BC%BA%E7%9C%81%E9%85%8D%E7%BD%AE"><span class="toc-number">7.</span> <span class="toc-text">6.7  缺省配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-8-%E9%85%8D%E7%BD%AEOSPF%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8A%9F%E8%83%BD"><span class="toc-number">8.</span> <span class="toc-text">6.8  配置OSPF的基本功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E7%8E%AF%E5%A2%83"><span class="toc-number">8.1.</span> <span class="toc-text">应用环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E4%BB%BB%E5%8A%A1"><span class="toc-number">8.2.</span> <span class="toc-text">前置任务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-8-1-%E5%88%9B%E5%BB%BAOSPF%E8%BF%9B%E7%A8%8B"><span class="toc-number">8.3.</span> <span class="toc-text">6.8.1  创建OSPF进程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF"><span class="toc-number">8.3.1.</span> <span class="toc-text">背景信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4"><span class="toc-number">8.3.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-8-2-%E5%88%9B%E5%BB%BAOSPF%E5%8C%BA%E5%9F%9F"><span class="toc-number">8.4.</span> <span class="toc-text">6.8.2  创建OSPF区域</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF-1"><span class="toc-number">8.4.1.</span> <span class="toc-text">背景信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-1"><span class="toc-number">8.4.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-8-3-%E4%BD%BF%E8%83%BDOSPF"><span class="toc-number">8.5.</span> <span class="toc-text">6.8.3  使能OSPF</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF-2"><span class="toc-number">8.5.1.</span> <span class="toc-text">背景信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-2"><span class="toc-number">8.5.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-8-4-%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89%E5%88%9B%E5%BB%BA%E8%99%9A%E8%BF%9E%E6%8E%A5"><span class="toc-number">8.6.</span> <span class="toc-text">6.8.4  （可选）创建虚连接</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF-3"><span class="toc-number">8.6.1.</span> <span class="toc-text">背景信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-3"><span class="toc-number">8.6.2.</span> <span class="toc-text">操作步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%BB%AD%E5%A4%84%E7%90%86"><span class="toc-number">8.6.3.</span> <span class="toc-text">后续处理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-8-5-%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89%E9%85%8D%E7%BD%AE%E5%AF%B9OSPF%E6%9B%B4%E6%96%B0LSA%E7%9A%84%E6%B3%9B%E6%B4%AA%E9%99%90%E5%88%B6"><span class="toc-number">8.7.</span> <span class="toc-text">6.8.5  （可选）配置对OSPF更新LSA的泛洪限制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF-4"><span class="toc-number">8.7.1.</span> <span class="toc-text">背景信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-4"><span class="toc-number">8.7.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-8-6-%E6%A3%80%E6%9F%A5%E9%85%8D%E7%BD%AE%E7%BB%93%E6%9E%9C"><span class="toc-number">8.8.</span> <span class="toc-text">6.8.6  检查配置结果</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6"><span class="toc-number">8.8.1.</span> <span class="toc-text">前提条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-5"><span class="toc-number">8.8.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-9-%E9%85%8D%E7%BD%AEOSPF%E9%82%BB%E5%B1%85%E6%88%96%E9%82%BB%E6%8E%A5%E7%9A%84%E4%BC%9A%E8%AF%9D%E5%8F%82%E6%95%B0"><span class="toc-number">9.</span> <span class="toc-text">6.9  配置OSPF邻居或邻接的会话参数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E4%BB%BB%E5%8A%A1-1"><span class="toc-number">9.1.</span> <span class="toc-text">前置任务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%B5%81%E7%A8%8B"><span class="toc-number">9.2.</span> <span class="toc-text">配置流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-9-1-%E9%85%8D%E7%BD%AEOSPF%E6%8A%A5%E6%96%87%E9%87%8D%E4%BC%A0%E9%99%90%E5%88%B6"><span class="toc-number">9.3.</span> <span class="toc-text">6.9.1  配置OSPF报文重传限制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF-5"><span class="toc-number">9.3.1.</span> <span class="toc-text">背景信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-6"><span class="toc-number">9.3.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-9-2-%E4%BD%BF%E8%83%BD%E5%9C%A8DD%E6%8A%A5%E6%96%87%E4%B8%AD%E5%A1%AB%E5%85%85%E6%8E%A5%E5%8F%A3%E7%9A%84%E5%AE%9E%E9%99%85MTU"><span class="toc-number">9.4.</span> <span class="toc-text">6.9.2  使能在DD报文中填充接口的实际MTU</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF-6"><span class="toc-number">9.4.1.</span> <span class="toc-text">背景信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-7"><span class="toc-number">9.4.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-9-3-%E6%A3%80%E6%9F%A5%E9%85%8D%E7%BD%AE%E7%BB%93%E6%9E%9C"><span class="toc-number">9.5.</span> <span class="toc-text">6.9.3  检查配置结果</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6-1"><span class="toc-number">9.5.1.</span> <span class="toc-text">前提条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-8"><span class="toc-number">9.5.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-10-%E9%85%8D%E7%BD%AEOSPF%E5%9C%A8%E4%B8%8D%E5%90%8C%E7%BD%91%E7%BB%9C%E7%B1%BB%E5%9E%8B%E4%B8%AD%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-number">10.</span> <span class="toc-text">6.10  配置OSPF在不同网络类型中的属性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E7%8E%AF%E5%A2%83-1"><span class="toc-number">10.1.</span> <span class="toc-text">应用环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E4%BB%BB%E5%8A%A1-2"><span class="toc-number">10.2.</span> <span class="toc-text">前置任务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%B5%81%E7%A8%8B-1"><span class="toc-number">10.3.</span> <span class="toc-text">配置流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-10-1-%E9%85%8D%E7%BD%AE%E6%8E%A5%E5%8F%A3%E7%9A%84%E7%BD%91%E7%BB%9C%E7%B1%BB%E5%9E%8B"><span class="toc-number">10.4.</span> <span class="toc-text">6.10.1  配置接口的网络类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF-7"><span class="toc-number">10.4.1.</span> <span class="toc-text">背景信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-9"><span class="toc-number">10.4.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-10-2-%E9%85%8D%E7%BD%AEP2MP%E7%BD%91%E7%BB%9C%E5%B1%9E%E6%80%A7"><span class="toc-number">10.5.</span> <span class="toc-text">6.10.2  配置P2MP网络属性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-10"><span class="toc-number">10.5.1.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-10-3-%E9%85%8D%E7%BD%AENBMA%E7%BD%91%E7%BB%9C%E5%B1%9E%E6%80%A7"><span class="toc-number">10.6.</span> <span class="toc-text">6.10.3  配置NBMA网络属性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-11"><span class="toc-number">10.6.1.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-10-4-%E6%A3%80%E6%9F%A5%E9%85%8D%E7%BD%AE%E7%BB%93%E6%9E%9C"><span class="toc-number">10.7.</span> <span class="toc-text">6.10.4  检查配置结果</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6-2"><span class="toc-number">10.7.1.</span> <span class="toc-text">前提条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-12"><span class="toc-number">10.7.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-11-%E9%85%8D%E7%BD%AEOSPF%E7%9A%84Stub%E5%8C%BA%E5%9F%9F"><span class="toc-number">11.</span> <span class="toc-text">6.11  配置OSPF的Stub区域</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E7%8E%AF%E5%A2%83-2"><span class="toc-number">11.1.</span> <span class="toc-text">应用环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E4%BB%BB%E5%8A%A1-3"><span class="toc-number">11.2.</span> <span class="toc-text">前置任务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%B5%81%E7%A8%8B-2"><span class="toc-number">11.3.</span> <span class="toc-text">配置流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-11-1-%E9%85%8D%E7%BD%AE%E5%BD%93%E5%89%8D%E5%8C%BA%E5%9F%9F%E4%B8%BAStub%E5%8C%BA%E5%9F%9F"><span class="toc-number">11.4.</span> <span class="toc-text">6.11.1  配置当前区域为Stub区域</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-13"><span class="toc-number">11.4.1.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-11-2-%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89%E9%85%8D%E7%BD%AE%E5%8F%91%E9%80%81%E5%88%B0Stub%E5%8C%BA%E5%9F%9F%E7%BC%BA%E7%9C%81%E8%B7%AF%E7%94%B1%E7%9A%84%E5%BC%80%E9%94%80"><span class="toc-number">11.5.</span> <span class="toc-text">6.11.2  （可选）配置发送到Stub区域缺省路由的开销</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-14"><span class="toc-number">11.5.1.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-11-3-%E6%A3%80%E6%9F%A5%E9%85%8D%E7%BD%AE%E7%BB%93%E6%9E%9C"><span class="toc-number">11.6.</span> <span class="toc-text">6.11.3  检查配置结果</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-15"><span class="toc-number">11.6.1.</span> <span class="toc-text">操作步骤</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-12-%E9%85%8D%E7%BD%AEOSPF%E7%9A%84NSSA%E5%8C%BA%E5%9F%9F"><span class="toc-number">12.</span> <span class="toc-text">6.12  配置OSPF的NSSA区域</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E7%8E%AF%E5%A2%83-3"><span class="toc-number">12.1.</span> <span class="toc-text">应用环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E4%BB%BB%E5%8A%A1-4"><span class="toc-number">12.2.</span> <span class="toc-text">前置任务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-16"><span class="toc-number">12.2.1.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E9%85%8D%E7%BD%AE%E7%BB%93%E6%9E%9C"><span class="toc-number">12.3.</span> <span class="toc-text">检查配置结果</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-13-%E8%B0%83%E6%95%B4OSPF%E7%9A%84%E9%80%89%E8%B7%AF"><span class="toc-number">13.</span> <span class="toc-text">6.13  调整OSPF的选路</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E7%8E%AF%E5%A2%83-4"><span class="toc-number">13.1.</span> <span class="toc-text">应用环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E4%BB%BB%E5%8A%A1-5"><span class="toc-number">13.2.</span> <span class="toc-text">前置任务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%B5%81%E7%A8%8B-3"><span class="toc-number">13.3.</span> <span class="toc-text">配置流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-13-1-%E9%85%8D%E7%BD%AEOSPF%E7%9A%84%E6%8E%A5%E5%8F%A3%E5%BC%80%E9%94%80"><span class="toc-number">13.4.</span> <span class="toc-text">6.13.1  配置OSPF的接口开销</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF-8"><span class="toc-number">13.4.1.</span> <span class="toc-text">背景信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-17"><span class="toc-number">13.4.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-13-2-%E9%85%8D%E7%BD%AE%E7%AD%89%E4%BB%B7%E8%B7%AF%E7%94%B1"><span class="toc-number">13.5.</span> <span class="toc-text">6.13.2  配置等价路由</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF-9"><span class="toc-number">13.5.1.</span> <span class="toc-text">背景信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-18"><span class="toc-number">13.5.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-13-3-%E9%85%8D%E7%BD%AE%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9%E8%A7%84%E5%88%99"><span class="toc-number">13.6.</span> <span class="toc-text">6.13.3  配置路由选择规则</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF-10"><span class="toc-number">13.6.1.</span> <span class="toc-text">背景信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-19"><span class="toc-number">13.6.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-13-4-%E6%A3%80%E6%9F%A5%E9%85%8D%E7%BD%AE%E7%BB%93%E6%9E%9C"><span class="toc-number">13.7.</span> <span class="toc-text">6.13.4  检查配置结果</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6-3"><span class="toc-number">13.7.1.</span> <span class="toc-text">前提条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-20"><span class="toc-number">13.7.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-14-%E6%8E%A7%E5%88%B6OSPF%E7%9A%84%E8%B7%AF%E7%94%B1%E4%BF%A1%E6%81%AF"><span class="toc-number">14.</span> <span class="toc-text">6.14  控制OSPF的路由信息</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E4%BB%BB%E5%8A%A1-6"><span class="toc-number">14.1.</span> <span class="toc-text">前置任务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%B5%81%E7%A8%8B-4"><span class="toc-number">14.2.</span> <span class="toc-text">配置流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-14-1-%E9%85%8D%E7%BD%AEOSPF%E5%BC%95%E5%85%A5%E5%A4%96%E9%83%A8%E8%B7%AF%E7%94%B1"><span class="toc-number">14.3.</span> <span class="toc-text">6.14.1  配置OSPF引入外部路由</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF-11"><span class="toc-number">14.3.1.</span> <span class="toc-text">背景信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-21"><span class="toc-number">14.3.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-14-2-%E9%85%8D%E7%BD%AEOSPF%E5%B0%86%E7%BC%BA%E7%9C%81%E8%B7%AF%E7%94%B1%E9%80%9A%E5%91%8A%E5%88%B0OSPF%E8%B7%AF%E7%94%B1%E5%8C%BA%E5%9F%9F"><span class="toc-number">14.4.</span> <span class="toc-text">6.14.2  配置OSPF将缺省路由通告到OSPF路由区域</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF-12"><span class="toc-number">14.4.1.</span> <span class="toc-text">背景信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-22"><span class="toc-number">14.4.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-14-3-%E9%85%8D%E7%BD%AEOSPF%E8%B7%AF%E7%94%B1%E8%81%9A%E5%90%88"><span class="toc-number">14.5.</span> <span class="toc-text">6.14.3  配置OSPF路由聚合</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF-13"><span class="toc-number">14.5.1.</span> <span class="toc-text">背景信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-23"><span class="toc-number">14.5.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-14-4-%E9%85%8D%E7%BD%AEOSPF%E5%AF%B9%E6%8E%A5%E6%94%B6%E7%9A%84%E8%B7%AF%E7%94%B1%E8%BF%9B%E8%A1%8C%E8%BF%87%E6%BB%A4"><span class="toc-number">14.6.</span> <span class="toc-text">6.14.4  配置OSPF对接收的路由进行过滤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-24"><span class="toc-number">14.6.1.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-14-5-%E9%85%8D%E7%BD%AEOSPF%E5%AF%B9%E5%8F%91%E5%B8%83%E7%9A%84%E8%B7%AF%E7%94%B1%E8%BF%9B%E8%A1%8C%E8%BF%87%E6%BB%A4"><span class="toc-number">14.7.</span> <span class="toc-text">6.14.5  配置OSPF对发布的路由进行过滤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-25"><span class="toc-number">14.7.1.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-14-6-%E9%85%8D%E7%BD%AE%E5%AF%B9%E5%8F%91%E9%80%81%E7%9A%84LSA%E8%BF%9B%E8%A1%8C%E8%BF%87%E6%BB%A4"><span class="toc-number">14.8.</span> <span class="toc-text">6.14.6  配置对发送的LSA进行过滤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF-14"><span class="toc-number">14.8.1.</span> <span class="toc-text">背景信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-26"><span class="toc-number">14.8.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-14-7-%E9%85%8D%E7%BD%AE%E5%AF%B9ABR-Type3-LSA%E8%BF%9B%E8%A1%8C%E8%BF%87%E6%BB%A4"><span class="toc-number">14.9.</span> <span class="toc-text">6.14.7  配置对ABR Type3 LSA进行过滤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF-15"><span class="toc-number">14.9.1.</span> <span class="toc-text">背景信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-27"><span class="toc-number">14.9.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-14-8-%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89%E4%BD%BF%E8%83%BDMesh-Group%E7%89%B9%E6%80%A7"><span class="toc-number">14.10.</span> <span class="toc-text">6.14.8  （可选）使能Mesh-Group特性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF-16"><span class="toc-number">14.10.1.</span> <span class="toc-text">背景信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-28"><span class="toc-number">14.10.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-14-9-%E9%85%8D%E7%BD%AELSDB%E4%B8%ADExternal-LSA%E7%9A%84%E6%9C%80%E5%A4%A7%E6%95%B0%E9%87%8F"><span class="toc-number">14.11.</span> <span class="toc-text">6.14.9  配置LSDB中External LSA的最大数量</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-29"><span class="toc-number">14.11.1.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-14-10-%E6%A3%80%E6%9F%A5%E9%85%8D%E7%BD%AE%E7%BB%93%E6%9E%9C"><span class="toc-number">14.12.</span> <span class="toc-text">6.14.10  检查配置结果</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6-4"><span class="toc-number">14.12.1.</span> <span class="toc-text">前提条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-30"><span class="toc-number">14.12.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-15-%E9%85%8D%E7%BD%AEOSPF%E4%B8%8EBFD%E8%81%94%E5%8A%A8"><span class="toc-number">15.</span> <span class="toc-text">6.15  配置OSPF与BFD联动</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E7%8E%AF%E5%A2%83-5"><span class="toc-number">15.1.</span> <span class="toc-text">应用环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E4%BB%BB%E5%8A%A1-7"><span class="toc-number">15.2.</span> <span class="toc-text">前置任务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%B5%81%E7%A8%8B-5"><span class="toc-number">15.3.</span> <span class="toc-text">配置流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-15-1-%E9%85%8D%E7%BD%AE%E5%85%A8%E5%B1%80BFD%E5%8A%9F%E8%83%BD"><span class="toc-number">15.4.</span> <span class="toc-text">6.15.1  配置全局BFD功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-31"><span class="toc-number">15.4.1.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-15-2-%E9%85%8D%E7%BD%AEOSPF%E7%9A%84BFD%E7%89%B9%E6%80%A7"><span class="toc-number">15.5.</span> <span class="toc-text">6.15.2  配置OSPF的BFD特性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-32"><span class="toc-number">15.5.1.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-15-3-%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89%E9%98%BB%E6%AD%A2%E6%8E%A5%E5%8F%A3%E5%8A%A8%E6%80%81%E5%88%9B%E5%BB%BABFD%E4%BC%9A%E8%AF%9D"><span class="toc-number">15.6.</span> <span class="toc-text">6.15.3  （可选）阻止接口动态创建BFD会话</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF-17"><span class="toc-number">15.6.1.</span> <span class="toc-text">背景信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-33"><span class="toc-number">15.6.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-15-4-%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89%E9%85%8D%E7%BD%AE%E6%8C%87%E5%AE%9A%E6%8E%A5%E5%8F%A3%E7%9A%84BFD%E7%89%B9%E6%80%A7"><span class="toc-number">15.7.</span> <span class="toc-text">6.15.4  （可选）配置指定接口的BFD特性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF-18"><span class="toc-number">15.7.1.</span> <span class="toc-text">背景信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-34"><span class="toc-number">15.7.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-15-5-%E6%A3%80%E6%9F%A5%E9%85%8D%E7%BD%AE%E7%BB%93%E6%9E%9C"><span class="toc-number">15.8.</span> <span class="toc-text">6.15.5  检查配置结果</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6-5"><span class="toc-number">15.8.1.</span> <span class="toc-text">前提条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-35"><span class="toc-number">15.8.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-16-%E9%85%8D%E7%BD%AEOSPF-IP-FRR"><span class="toc-number">16.</span> <span class="toc-text">6.16  配置OSPF IP FRR</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-16-1-%E4%BD%BF%E8%83%BDOSPF-IP-FRR"><span class="toc-number">16.1.</span> <span class="toc-text">6.16.1  使能OSPF IP FRR</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-36"><span class="toc-number">16.1.1.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-16-2-%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89%E9%85%8D%E7%BD%AEOSPF-IP-FRR%E4%B8%8EBFD%E7%BB%91%E5%AE%9A"><span class="toc-number">16.2.</span> <span class="toc-text">6.16.2  （可选）配置OSPF IP FRR与BFD绑定</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF-19"><span class="toc-number">16.2.1.</span> <span class="toc-text">背景信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-37"><span class="toc-number">16.2.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-16-3-%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89%E7%A6%81%E6%AD%A2%E6%8C%87%E5%AE%9A%E6%8E%A5%E5%8F%A3%E7%9A%84OSPF-IP-FRR%E8%83%BD%E5%8A%9B"><span class="toc-number">16.3.</span> <span class="toc-text">6.16.3  （可选）禁止指定接口的OSPF IP FRR能力</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-38"><span class="toc-number">16.3.1.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-16-4-%E6%A3%80%E6%9F%A5%E9%85%8D%E7%BD%AE%E7%BB%93%E6%9E%9C"><span class="toc-number">16.4.</span> <span class="toc-text">6.16.4  检查配置结果</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6-6"><span class="toc-number">16.4.1.</span> <span class="toc-text">前提条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-39"><span class="toc-number">16.4.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-17-%E9%85%8D%E7%BD%AEOSPF%E7%BD%91%E7%BB%9C%E7%9A%84%E5%BF%AB%E9%80%9F%E6%94%B6%E6%95%9B"><span class="toc-number">17.</span> <span class="toc-text">6.17  配置OSPF网络的快速收敛</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E4%BB%BB%E5%8A%A1-8"><span class="toc-number">17.1.</span> <span class="toc-text">前置任务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%B5%81%E7%A8%8B-6"><span class="toc-number">17.2.</span> <span class="toc-text">配置流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-17-1-%E9%85%8D%E7%BD%AEOSPF%E8%B7%AF%E7%94%B1%E7%9A%84%E6%94%B6%E6%95%9B%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-number">17.3.</span> <span class="toc-text">6.17.1  配置OSPF路由的收敛优先级</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF-20"><span class="toc-number">17.3.1.</span> <span class="toc-text">背景信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-40"><span class="toc-number">17.3.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-17-2-%E9%85%8D%E7%BD%AE%E6%8E%A5%E5%8F%A3%E5%8F%91%E9%80%81Hello%E6%8A%A5%E6%96%87%E7%9A%84%E6%97%B6%E9%97%B4%E9%97%B4%E9%9A%94"><span class="toc-number">17.4.</span> <span class="toc-text">6.17.2  配置接口发送Hello报文的时间间隔</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF-21"><span class="toc-number">17.4.1.</span> <span class="toc-text">背景信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-41"><span class="toc-number">17.4.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-17-3-%E9%85%8D%E7%BD%AE%E7%9B%B8%E9%82%BB%E9%82%BB%E5%B1%85%E5%A4%B1%E6%95%88%E7%9A%84%E6%97%B6%E9%97%B4"><span class="toc-number">17.5.</span> <span class="toc-text">6.17.3  配置相邻邻居失效的时间</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-42"><span class="toc-number">17.5.1.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-17-4-%E9%85%8D%E7%BD%AESmart-discover"><span class="toc-number">17.6.</span> <span class="toc-text">6.17.4  配置Smart-discover</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF-22"><span class="toc-number">17.6.1.</span> <span class="toc-text">背景信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-43"><span class="toc-number">17.6.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-17-5-%E9%85%8D%E7%BD%AE%E6%9B%B4%E6%96%B0LSA%E7%9A%84%E6%97%B6%E9%97%B4%E9%97%B4%E9%9A%94"><span class="toc-number">17.7.</span> <span class="toc-text">6.17.5  配置更新LSA的时间间隔</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF-23"><span class="toc-number">17.7.1.</span> <span class="toc-text">背景信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-44"><span class="toc-number">17.7.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-17-6-%E9%85%8D%E7%BD%AE%E6%8E%A5%E6%94%B6LSA%E7%9A%84%E6%97%B6%E9%97%B4%E9%97%B4%E9%9A%94"><span class="toc-number">17.8.</span> <span class="toc-text">6.17.6  配置接收LSA的时间间隔</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF-24"><span class="toc-number">17.8.1.</span> <span class="toc-text">背景信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-45"><span class="toc-number">17.8.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-17-7-%E9%85%8D%E7%BD%AESPF%E8%AE%A1%E7%AE%97%E7%9A%84%E6%97%B6%E9%97%B4%E9%97%B4%E9%9A%94"><span class="toc-number">17.9.</span> <span class="toc-text">6.17.7  配置SPF计算的时间间隔</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF-25"><span class="toc-number">17.9.1.</span> <span class="toc-text">背景信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-46"><span class="toc-number">17.9.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-17-8-%E6%A3%80%E6%9F%A5%E9%85%8D%E7%BD%AE%E7%BB%93%E6%9E%9C"><span class="toc-number">17.10.</span> <span class="toc-text">6.17.8  检查配置结果</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6-7"><span class="toc-number">17.10.1.</span> <span class="toc-text">前提条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-47"><span class="toc-number">17.10.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-18-%E9%85%8D%E7%BD%AEOSPF-GR"><span class="toc-number">18.</span> <span class="toc-text">6.18  配置OSPF GR</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">18.1.</span> <span class="toc-text">应用场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E4%BB%BB%E5%8A%A1-9"><span class="toc-number">18.2.</span> <span class="toc-text">前置任务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-18-1-%E4%BD%BF%E8%83%BDOSPF%E7%9A%84opauqe-LSA%E7%89%B9%E6%80%A7"><span class="toc-number">18.3.</span> <span class="toc-text">6.18.1  使能OSPF的opauqe-LSA特性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-48"><span class="toc-number">18.3.1.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-18-2-%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89%E9%85%8D%E7%BD%AERestarter%E7%AB%AFGR%E7%9A%84%E4%BC%9A%E8%AF%9D%E5%8F%82%E6%95%B0"><span class="toc-number">18.4.</span> <span class="toc-text">6.18.2  （可选）配置Restarter端GR的会话参数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-49"><span class="toc-number">18.4.1.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-18-3-%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89%E9%85%8D%E7%BD%AEHelper%E7%AB%AFGR%E7%9A%84%E4%BC%9A%E8%AF%9D%E5%8F%82%E6%95%B0"><span class="toc-number">18.5.</span> <span class="toc-text">6.18.3  （可选）配置Helper端GR的会话参数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-50"><span class="toc-number">18.5.1.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-18-4-%E6%A3%80%E6%9F%A5%E9%85%8D%E7%BD%AE%E7%BB%93%E6%9E%9C"><span class="toc-number">18.6.</span> <span class="toc-text">6.18.4  检查配置结果</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6-8"><span class="toc-number">18.6.1.</span> <span class="toc-text">前提条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-51"><span class="toc-number">18.6.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-19-%E6%8F%90%E9%AB%98OSPF%E7%BD%91%E7%BB%9C%E7%9A%84%E7%A8%B3%E5%AE%9A%E6%80%A7"><span class="toc-number">19.</span> <span class="toc-text">6.19  提高OSPF网络的稳定性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E7%8E%AF%E5%A2%83-6"><span class="toc-number">19.1.</span> <span class="toc-text">应用环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E4%BB%BB%E5%8A%A1-10"><span class="toc-number">19.2.</span> <span class="toc-text">前置任务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%B5%81%E7%A8%8B-7"><span class="toc-number">19.3.</span> <span class="toc-text">配置流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-19-1-%E9%85%8D%E7%BD%AEOSPF%E7%9A%84%E5%8D%8F%E8%AE%AE%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-number">19.4.</span> <span class="toc-text">6.19.1  配置OSPF的协议优先级</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF-26"><span class="toc-number">19.4.1.</span> <span class="toc-text">背景信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-52"><span class="toc-number">19.4.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-19-2-%E9%85%8D%E7%BD%AE%E6%8E%A5%E5%8F%A3%E4%BC%A0%E9%80%81LSA%E7%9A%84%E5%BB%B6%E8%BF%9F%E6%97%B6%E9%97%B4"><span class="toc-number">19.5.</span> <span class="toc-text">6.19.2  配置接口传送LSA的延迟时间</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-53"><span class="toc-number">19.5.1.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-19-3-%E9%85%8D%E7%BD%AE%E9%82%BB%E6%8E%A5%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%87%8D%E4%BC%A0LSA%E7%9A%84%E9%97%B4%E9%9A%94"><span class="toc-number">19.6.</span> <span class="toc-text">6.19.3  配置邻接交换机重传LSA的间隔</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF-27"><span class="toc-number">19.6.1.</span> <span class="toc-text">背景信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-54"><span class="toc-number">19.6.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-19-4-%E9%85%8D%E7%BD%AEStub%E8%B7%AF%E7%94%B1%E5%99%A8"><span class="toc-number">19.7.</span> <span class="toc-text">6.19.4  配置Stub路由器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF-28"><span class="toc-number">19.7.1.</span> <span class="toc-text">背景信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-55"><span class="toc-number">19.7.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-19-5-%E7%A6%81%E6%AD%A2OSPF%E6%8E%A5%E5%8F%A3%E5%8F%91%E9%80%81%E5%92%8C%E6%8E%A5%E6%94%B6%E5%8D%8F%E8%AE%AE%E6%8A%A5%E6%96%87"><span class="toc-number">19.8.</span> <span class="toc-text">6.19.5  禁止OSPF接口发送和接收协议报文</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF-29"><span class="toc-number">19.8.1.</span> <span class="toc-text">背景信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-56"><span class="toc-number">19.8.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-19-6-%E5%85%B3%E9%97%ADOSPF%E5%BC%82%E5%B8%B8%E8%80%81%E5%8C%96%E8%A7%A6%E5%8F%91%E7%9A%84%E4%B8%BB%E5%A4%87%E5%80%92%E6%8D%A2%E5%8A%9F%E8%83%BD"><span class="toc-number">19.9.</span> <span class="toc-text">6.19.6  关闭OSPF异常老化触发的主备倒换功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF-30"><span class="toc-number">19.9.1.</span> <span class="toc-text">背景信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-57"><span class="toc-number">19.9.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-19-7-%E6%A3%80%E6%9F%A5%E9%85%8D%E7%BD%AE%E7%BB%93%E6%9E%9C"><span class="toc-number">19.10.</span> <span class="toc-text">6.19.7  检查配置结果</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6-9"><span class="toc-number">19.10.1.</span> <span class="toc-text">前提条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-58"><span class="toc-number">19.10.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-20-%E6%8F%90%E9%AB%98OSPF%E7%BD%91%E7%BB%9C%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7"><span class="toc-number">20.</span> <span class="toc-text">6.20  提高OSPF网络的安全性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E7%8E%AF%E5%A2%83-7"><span class="toc-number">20.1.</span> <span class="toc-text">应用环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E4%BB%BB%E5%8A%A1-11"><span class="toc-number">20.2.</span> <span class="toc-text">前置任务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%B5%81%E7%A8%8B-8"><span class="toc-number">20.3.</span> <span class="toc-text">配置流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-20-1-%E9%85%8D%E7%BD%AEOSPF-GTSM%E5%8A%9F%E8%83%BD"><span class="toc-number">20.4.</span> <span class="toc-text">6.20.1  配置OSPF GTSM功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF-31"><span class="toc-number">20.4.1.</span> <span class="toc-text">背景信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-59"><span class="toc-number">20.4.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-20-2-%E5%8C%BA%E5%9F%9F%E9%AA%8C%E8%AF%81%E6%96%B9%E5%BC%8F"><span class="toc-number">20.5.</span> <span class="toc-text">6.20.2  区域验证方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF-32"><span class="toc-number">20.5.1.</span> <span class="toc-text">背景信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-60"><span class="toc-number">20.5.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-20-3-%E6%8E%A5%E5%8F%A3%E9%AA%8C%E8%AF%81%E6%96%B9%E5%BC%8F"><span class="toc-number">20.6.</span> <span class="toc-text">6.20.3  接口验证方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF-33"><span class="toc-number">20.6.1.</span> <span class="toc-text">背景信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-61"><span class="toc-number">20.6.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-20-4-%E6%A3%80%E6%9F%A5%E9%85%8D%E7%BD%AE%E7%BB%93%E6%9E%9C"><span class="toc-number">20.7.</span> <span class="toc-text">6.20.4  检查配置结果</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6-10"><span class="toc-number">20.7.1.</span> <span class="toc-text">前提条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-62"><span class="toc-number">20.7.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-21-%E9%85%8D%E7%BD%AEOSPF%E9%82%BB%E5%B1%85%E9%9C%87%E8%8D%A1%E6%8A%91%E5%88%B6"><span class="toc-number">21.</span> <span class="toc-text">6.21  配置OSPF邻居震荡抑制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E7%8E%AF%E5%A2%83-8"><span class="toc-number">21.1.</span> <span class="toc-text">应用环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E4%BB%BB%E5%8A%A1-12"><span class="toc-number">21.2.</span> <span class="toc-text">前置任务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-63"><span class="toc-number">21.2.1.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E9%85%8D%E7%BD%AE%E7%BB%93%E6%9E%9C-1"><span class="toc-number">21.3.</span> <span class="toc-text">检查配置结果</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-22-%E9%85%8D%E7%BD%AEOSPF%E7%BD%91%E7%AE%A1%E5%8A%9F%E8%83%BD"><span class="toc-number">22.</span> <span class="toc-text">6.22  配置OSPF网管功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E4%BB%BB%E5%8A%A1-13"><span class="toc-number">22.1.</span> <span class="toc-text">前置任务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%B5%81%E7%A8%8B-9"><span class="toc-number">22.2.</span> <span class="toc-text">配置流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-22-1-%E9%85%8D%E7%BD%AEOSPF-MIB%E7%BB%91%E5%AE%9A"><span class="toc-number">22.3.</span> <span class="toc-text">6.22.1  配置OSPF MIB绑定</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF-34"><span class="toc-number">22.3.1.</span> <span class="toc-text">背景信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-64"><span class="toc-number">22.3.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-22-2-%E9%85%8D%E7%BD%AEOSPF-TRAP%E5%8A%9F%E8%83%BD"><span class="toc-number">22.4.</span> <span class="toc-text">6.22.2  配置OSPF TRAP功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-65"><span class="toc-number">22.4.1.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-22-3-%E9%85%8D%E7%BD%AEOSPF%E6%97%A5%E5%BF%97%E4%BF%A1%E6%81%AF%E5%8A%9F%E8%83%BD"><span class="toc-number">22.5.</span> <span class="toc-text">6.22.3  配置OSPF日志信息功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-66"><span class="toc-number">22.5.1.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-22-4-%E6%A3%80%E6%9F%A5%E9%85%8D%E7%BD%AE%E7%BB%93%E6%9E%9C"><span class="toc-number">22.6.</span> <span class="toc-text">6.22.4  检查配置结果</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6-11"><span class="toc-number">22.6.1.</span> <span class="toc-text">前提条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-67"><span class="toc-number">22.6.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-23-%E7%BB%B4%E6%8A%A4OSPF"><span class="toc-number">23.</span> <span class="toc-text">6.23  维护OSPF</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-23-1-%E6%B8%85%E9%99%A4OSPF"><span class="toc-number">23.1.</span> <span class="toc-text">6.23.1  清除OSPF</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF-35"><span class="toc-number">23.1.1.</span> <span class="toc-text">背景信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-68"><span class="toc-number">23.1.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-23-2-%E5%A4%8D%E4%BD%8DOSPF"><span class="toc-number">23.2.</span> <span class="toc-text">6.23.2  复位OSPF</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF-36"><span class="toc-number">23.2.1.</span> <span class="toc-text">背景信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-69"><span class="toc-number">23.2.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-24-%E9%85%8D%E7%BD%AE%E4%B8%BE%E4%BE%8B"><span class="toc-number">24.</span> <span class="toc-text">6.24  配置举例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-24-1-%E9%85%8D%E7%BD%AEOSPF%E5%9F%BA%E6%9C%AC%E5%8A%9F%E8%83%BD%E7%A4%BA%E4%BE%8B"><span class="toc-number">24.1.</span> <span class="toc-text">6.24.1  配置OSPF基本功能示例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%84%E7%BD%91%E9%9C%80%E6%B1%82"><span class="toc-number">24.1.1.</span> <span class="toc-text">组网需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%80%9D%E8%B7%AF"><span class="toc-number">24.1.2.</span> <span class="toc-text">配置思路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-70"><span class="toc-number">24.1.3.</span> <span class="toc-text">操作步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">24.1.4.</span> <span class="toc-text">配置文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-24-2-%E9%85%8D%E7%BD%AEOSPF%E7%9A%84DR%E9%80%89%E6%8B%A9%E7%A4%BA%E4%BE%8B"><span class="toc-number">24.2.</span> <span class="toc-text">6.24.2  配置OSPF的DR选择示例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%84%E7%BD%91%E9%9C%80%E6%B1%82-1"><span class="toc-number">24.2.1.</span> <span class="toc-text">组网需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%80%9D%E8%B7%AF-1"><span class="toc-number">24.2.2.</span> <span class="toc-text">配置思路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-71"><span class="toc-number">24.2.3.</span> <span class="toc-text">操作步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-1"><span class="toc-number">24.2.4.</span> <span class="toc-text">配置文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-24-3-%E9%85%8D%E7%BD%AEOSPF%E7%9A%84Stub%E5%8C%BA%E5%9F%9F%E7%A4%BA%E4%BE%8B"><span class="toc-number">24.3.</span> <span class="toc-text">6.24.3  配置OSPF的Stub区域示例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%84%E7%BD%91%E9%9C%80%E6%B1%82-2"><span class="toc-number">24.3.1.</span> <span class="toc-text">组网需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%80%9D%E8%B7%AF-2"><span class="toc-number">24.3.2.</span> <span class="toc-text">配置思路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-72"><span class="toc-number">24.3.3.</span> <span class="toc-text">操作步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-2"><span class="toc-number">24.3.4.</span> <span class="toc-text">配置文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-24-4-%E9%85%8D%E7%BD%AEOSPF%E7%9A%84NSSA%E5%8C%BA%E5%9F%9F%E7%A4%BA%E4%BE%8B"><span class="toc-number">24.4.</span> <span class="toc-text">6.24.4  配置OSPF的NSSA区域示例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%84%E7%BD%91%E9%9C%80%E6%B1%82-3"><span class="toc-number">24.4.1.</span> <span class="toc-text">组网需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%80%9D%E8%B7%AF-3"><span class="toc-number">24.4.2.</span> <span class="toc-text">配置思路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-73"><span class="toc-number">24.4.3.</span> <span class="toc-text">操作步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-3"><span class="toc-number">24.4.4.</span> <span class="toc-text">配置文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-24-5-%E9%85%8D%E7%BD%AEOSPF%E8%B4%9F%E8%BD%BD%E5%88%86%E6%8B%85%E7%A4%BA%E4%BE%8B"><span class="toc-number">24.5.</span> <span class="toc-text">6.24.5  配置OSPF负载分担示例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%84%E7%BD%91%E9%9C%80%E6%B1%82-4"><span class="toc-number">24.5.1.</span> <span class="toc-text">组网需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%80%9D%E8%B7%AF-4"><span class="toc-number">24.5.2.</span> <span class="toc-text">配置思路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-74"><span class="toc-number">24.5.3.</span> <span class="toc-text">操作步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-4"><span class="toc-number">24.5.4.</span> <span class="toc-text">配置文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-24-6-%E9%85%8D%E7%BD%AEOSPF-BGP%E8%81%94%E5%8A%A8%E7%89%B9%E6%80%A7%E7%A4%BA%E4%BE%8B"><span class="toc-number">24.6.</span> <span class="toc-text">6.24.6  配置OSPF-BGP联动特性示例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%84%E7%BD%91%E9%9C%80%E6%B1%82-5"><span class="toc-number">24.6.1.</span> <span class="toc-text">组网需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%80%9D%E8%B7%AF-5"><span class="toc-number">24.6.2.</span> <span class="toc-text">配置思路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-75"><span class="toc-number">24.6.3.</span> <span class="toc-text">操作步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-5"><span class="toc-number">24.6.4.</span> <span class="toc-text">配置文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-24-7-%E9%85%8D%E7%BD%AEOSPF-GR%E7%89%B9%E6%80%A7%E7%A4%BA%E4%BE%8B"><span class="toc-number">24.7.</span> <span class="toc-text">6.24.7  配置OSPF GR特性示例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%84%E7%BD%91%E9%9C%80%E6%B1%82-6"><span class="toc-number">24.7.1.</span> <span class="toc-text">组网需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%80%9D%E8%B7%AF-6"><span class="toc-number">24.7.2.</span> <span class="toc-text">配置思路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-76"><span class="toc-number">24.7.3.</span> <span class="toc-text">操作步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-6"><span class="toc-number">24.7.4.</span> <span class="toc-text">配置文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-24-8-%E9%85%8D%E7%BD%AEOSPF%E4%B8%8EBFD%E8%81%94%E5%8A%A8%E7%A4%BA%E4%BE%8B"><span class="toc-number">24.8.</span> <span class="toc-text">6.24.8  配置OSPF与BFD联动示例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%84%E7%BD%91%E9%9C%80%E6%B1%82-7"><span class="toc-number">24.8.1.</span> <span class="toc-text">组网需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%80%9D%E8%B7%AF-7"><span class="toc-number">24.8.2.</span> <span class="toc-text">配置思路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-77"><span class="toc-number">24.8.3.</span> <span class="toc-text">操作步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-7"><span class="toc-number">24.8.4.</span> <span class="toc-text">配置文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-24-9-%E9%85%8D%E7%BD%AEOSPF-IP-FRR%E7%A4%BA%E4%BE%8B"><span class="toc-number">24.9.</span> <span class="toc-text">6.24.9  配置OSPF IP FRR示例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%84%E7%BD%91%E9%9C%80%E6%B1%82-8"><span class="toc-number">24.9.1.</span> <span class="toc-text">组网需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%80%9D%E8%B7%AF-8"><span class="toc-number">24.9.2.</span> <span class="toc-text">配置思路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-78"><span class="toc-number">24.9.3.</span> <span class="toc-text">操作步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-8"><span class="toc-number">24.9.4.</span> <span class="toc-text">配置文件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-25-%E5%B8%B8%E8%A7%81%E9%85%8D%E7%BD%AE%E9%94%99%E8%AF%AF"><span class="toc-number">25.</span> <span class="toc-text">6.25  常见配置错误</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-25-1-OSPF%E9%82%BB%E5%B1%85%E5%BB%BA%E7%AB%8B%E4%B8%8D%E6%88%90%E5%8A%9F"><span class="toc-number">25.1.</span> <span class="toc-text">6.25.1  OSPF邻居建立不成功</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%85%E9%9A%9C%E7%8E%B0%E8%B1%A1"><span class="toc-number">25.1.1.</span> <span class="toc-text">故障现象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-79"><span class="toc-number">25.1.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-25-2-OSPF%E4%B8%8D%E8%83%BD%E5%8F%91%E7%8E%B0%E5%85%B6%E4%BB%96%E5%8C%BA%E5%9F%9F%E7%9A%84%E8%B7%AF%E7%94%B1"><span class="toc-number">25.2.</span> <span class="toc-text">6.25.2  OSPF不能发现其他区域的路由</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%85%E9%9A%9C%E7%8E%B0%E8%B1%A1-1"><span class="toc-number">25.2.1.</span> <span class="toc-text">故障现象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-80"><span class="toc-number">25.2.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-26-%E5%8F%82%E8%80%83%E4%BF%A1%E6%81%AF"><span class="toc-number">26.</span> <span class="toc-text">6.26  参考信息</span></a></li></ol></div></div></div><div class="tag-cloud"><div class="tag-cloud-tags"><a href="/tags/802-1x/" style="font-size: 12px; color: #999">802.1x</a> <a href="/tags/ARP/" style="font-size: 12px; color: #999">ARP</a> <a href="/tags/CASE/" style="font-size: 12px; color: #999">CASE</a> <a href="/tags/Cisco/" style="font-size: 12px; color: #999">Cisco</a> <a href="/tags/H3C/" style="font-size: 30px; color: #0078e7">H3C</a> <a href="/tags/IDC/" style="font-size: 12px; color: #999">IDC</a> <a href="/tags/IPv6/" style="font-size: 24px; color: #3383cd">IPv6</a> <a href="/tags/LINUX/" style="font-size: 18px; color: #668eb3">LINUX</a> <a href="/tags/Linux/" style="font-size: 12px; color: #999">Linux</a> <a href="/tags/NAT/" style="font-size: 24px; color: #3383cd">NAT</a> <a href="/tags/OSPF/" style="font-size: 12px; color: #999">OSPF</a> <a href="/tags/RAID/" style="font-size: 12px; color: #999">RAID</a> <a href="/tags/SDN/" style="font-size: 24px; color: #3383cd">SDN</a> <a href="/tags/SSL/" style="font-size: 12px; color: #999">SSL</a> <a href="/tags/TCP/" style="font-size: 18px; color: #668eb3">TCP</a> <a href="/tags/TCP-IP/" style="font-size: 12px; color: #999">TCP/IP</a> <a href="/tags/VLAN/" style="font-size: 18px; color: #668eb3">VLAN</a> <a href="/tags/VPN/" style="font-size: 12px; color: #999">VPN</a> <a href="/tags/VXLAN/" style="font-size: 12px; color: #999">VXLAN</a> <a href="/tags/git/" style="font-size: 12px; color: #999">git</a></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="https://zeozzz.github.com/2019/05/28/54/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="澈崽子"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="澈崽子 | 家有网工初长成"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">OSPF配置---华为</h1><div class="post-meta"><div class="post-time" style="display:block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="创建时间：2019-05-28 13:36:06" itemprop="dateCreated datePublished" datetime="2019-05-28T13:36:06+08:00">2019-05-28</time></div><span class="post-count"><span class="post-symbolcount"><span class="post-meta-item-icon" title="本文字数"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-file-word-line"></use></svg></span> <span title="本文字数">82.4k</span><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读时长"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-timer-line"></use></svg></span> <span title="阅读时长">342m</span></span></span><span class="post-busuanzi"><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读次数"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-eye-line"></use></svg> <span id="busuanzi_value_page_pv"></span></span></span><div class="post-classify"><span class="post-category"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span> <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category" href="/categories/OSPF/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">OSPF</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag" href="/tags/OSPF/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">OSPF</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#0078E7;"><h2 id="6-1-OSPF简介"><a href="#6-1-OSPF简介" class="headerlink" title="6.1  OSPF简介"></a>6.1  OSPF简介</h2><p>介绍OSPF的定义和目的。</p>
<h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>开放式最短路径优先OSPF（Open Shortest Path First）是IETF组织开发的一个基于链路状态的内部网关协议（Interior Gateway Protocol）。</p>
<p>目前针对IPv4协议使用的是OSPF Version 2（RFC2328）；针对IPv6协议使用OSPF Version 3（RFC2740）。如无特殊说明，本文中所指的OSPF均为OSPF Version 2。</p>
<ul>
<li>OSPF把自治系统AS（Autonomous System）划分成逻辑意义上的一个或多个区域；</li>
<li>OSPF通过LSA（Link State Advertisement）的形式发布路由；</li>
<li>OSPF依靠在OSPF区域内各设备间交互OSPF报文来达到路由信息的统一；</li>
<li>OSPF报文封装在IP报文内，可以采用单播或组播的形式发送。</li>
</ul>
<h3 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h3><p>在OSPF出现前，RIP是网络上使用最广泛的IGP协议。</p>
<p>由于RIP是基于距离矢量算法的路由协议，存在着收敛慢、路由环路、可扩展性差等问题，OSPF成为了网络上使用最广泛的IGP协议。</p>
<p>OSPF作为基于链路状态的协议，能够解决RIP所面临的诸多问题。此外，OSPF还有以下优点：</p>
<ul>
<li>OSPF采用组播形式收发报文，这样可以减少对其它不运行OSPF路由器的影响。</li>
<li>OSPF支持无类型域间选路（CIDR）。</li>
<li>OSPF支持对等价路由进行负载分担。</li>
<li>OSPF支持报文加密。</li>
</ul>
<h3 id="相关信息"><a href="#相关信息" class="headerlink" title="相关信息"></a>相关信息</h3><p><strong>技术论坛</strong></p>
<p><a target="_blank" rel="noopener" href="http://support.huawei.com/ecommunity/bbs/10259484.html">问鼎OSPF系列技术贴</a></p>
<h2 id="6-2-原理描述"><a href="#6-2-原理描述" class="headerlink" title="6.2  原理描述"></a>6.2  原理描述</h2><h3 id="6-2-1-OSPF基础"><a href="#6-2-1-OSPF基础" class="headerlink" title="6.2.1  OSPF基础"></a>6.2.1  OSPF基础</h3><h4 id="6-2-1-1-OSPF的特点"><a href="#6-2-1-1-OSPF的特点" class="headerlink" title="6.2.1.1  OSPF的特点"></a>6.2.1.1  OSPF的特点</h4><p>在OSPF网络中，每台路由器根据自己周围的网络拓扑结构生成链路状态通告LSA（Link State Advertisement），并通过更新报文将LSA发送给网络中的其它路由器。</p>
<p>RIP交互的是路由。与RIP不同，OSPF交互的是链路状态信息。也就是说，RIP中，路由器的选路依赖于邻居路由器的路由信息，但不管邻居路由器传达的信息是否正确；而OSPF中，路由器的选路是一种“自主行为”，LSA只是一种选路的参考信息。</p>
<p>每台路由器都通过链路状态数据库LSDB(Link State DataBase)掌握全网的拓扑结构。如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_111501">图6-1</a>所示，每台路由器都会收集其它路由器发来的LSA，所有的LSA放在一起便组成了链路状态数据库LSDB。LSA是对路由器周围网络拓扑结构的描述，LSDB则是对整个自治系统的网络拓扑结构的描述。路由器将LSDB转换成一张带权的有向图，这张图便是对整个网络拓扑结构的真实反映。在网络拓扑稳定的情况下，各个路由器得到的有向图是完全相同的。</p>
<p><strong>图6-1</strong>  通过LSDB掌握全网的拓扑结构<br><img src="http://support.huawei.com/enterprise/product/images/76d5fe7788bc45ac8b07e7f99d5cb807" alt="img" loading="lazy"></p>
<p>路由器根据最短路径优先(Shortest Path First)算法计算到达目的网络的路径，而不是根据路由通告来获取路由信息。如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_111502">图6-2</a>所示，每台路由器根据有向图，使用SPF算法计算出一棵以自己为根的最短路径树，这棵树给出了到自治系统中各节点的路由。相对于RIP，这种机制极大地提升了路由器的自主选路能力，使得路由器不再依靠路由通告进行选路。</p>
<p><strong>图6-2</strong>  根据SPF计算到达目的网络的路径<br><img src="http://support.huawei.com/enterprise/product/images/ef85c3eb05ed403d8ba6d19f54bfc020" alt="img" loading="lazy"></p>
<p>总之，LSDB保证路由器能够时刻掌握全网的拓扑机构，SPF算法保证路由器能够迅速计算出到达目的网络的最短路径。</p>
<h4 id="6-2-1-2-OSPF运行机制"><a href="#6-2-1-2-OSPF运行机制" class="headerlink" title="6.2.1.2  OSPF运行机制"></a>6.2.1.2  OSPF运行机制</h4><p>OSPF的运行机制包括以下5个步骤：</p>
<ol>
<li><p>通过交互Hello报文形成邻居关系</p>
<p>如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_111601">图6-3</a>所示，路由器运行OSPF协议后，会从所有启动OSPF协议的接口上发送Hello报文。如果两台路由器共享一条公共数据链路，并且能够成功协商各自Hello报文中所指定的某些参数，就能形成邻居关系。</p>
<p><strong>图6-3</strong>  通过交互Hello报文形成邻居关系<br><img src="http://support.huawei.com/enterprise/product/images/3ecba075c8024ae49a9917fcad8de3cd" alt="img" loading="lazy"></p>
</li>
<li><p>通过泛洪LSA通告链路状态信息</p>
<p>形成邻接关系的路由器之间可以交互LSA，如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_111602">图6-4</a>所示。LSA描述了路由器所有的链路、接口、邻居及链路状态等信息。路由器通过交互这些链路信息来了解整个网络的拓扑信息。由于链路的多样性，OSPF协议定义了多种LSA类型。详见<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_feature_ospf_1123">6.2.1.9 OSPF LSA类型</a>。</p>
<p><strong>图6-4</strong>  通过泛洪LSA通告链路状态信息<br><img src="http://support.huawei.com/enterprise/product/images/6e0284db542442a6b644e637b9ddf01c" alt="img" loading="lazy"></p>
</li>
<li><p>通过组建LSDB形成带权有向图</p>
<p>通过LSA的泛洪，路由器会把收到的LSA汇总记录在LSDB中。最终，所有路由器都会形成同样的LSDB，如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_111603">图6-5</a>所示。LSA是对路由器周围网络拓扑结构的描述，而LSDB则是对整个自治系统的网络拓扑结构的描述，LSDB是LSA的汇总。</p>
<p><strong>图6-5</strong>  通过组建LSDB形成带权有向图<br><img src="http://support.huawei.com/enterprise/product/images/40ece72d5e9e466c8dafc300cc776a35" alt="img" loading="lazy"></p>
</li>
<li><p>通过SPF算法计算并形成路由</p>
<p>如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_111604">图6-6</a>所示，当LSDB同步完成之后，每一台路由器都将以其自身为根，使用SPF算法来计算一个无环路的拓扑图来描述它所知道的到达每一个目的地的最短路径（最小的路径代价）。这个拓扑图就是最短路径树，有了这棵树，路由器就能知道到达自治系统中各个节点的最优路径。</p>
<p><strong>图6-6</strong>  通过SPF算法计算并形成路由<br><img src="http://support.huawei.com/enterprise/product/images/c55e9f3ac146428e8bf29fcd5fa6d77d" alt="img" loading="lazy"></p>
</li>
<li><p>维护和更新路由表</p>
<p>根据SPF算法得出最短路径树后，每台路由器将计算得出的最短路径加载到OSPF路由表形成指导数据转发的路由表项，并且实时更新，如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_111605">图6-7</a>所示。同时，邻居之间交互Hello报文进行保活，维持邻居关系或邻接关系，并且周期性地重传LSA。</p>
<p><strong>图6-7</strong>  维护和更新路由表<br><img src="http://support.huawei.com/enterprise/product/images/fa920abb92e24c549d48c0150883adaa" alt="img" loading="lazy"></p>
</li>
</ol>
<h4 id="6-2-1-3-OSPF报文类型"><a href="#6-2-1-3-OSPF报文类型" class="headerlink" title="6.2.1.3  OSPF报文类型"></a>6.2.1.3  OSPF报文类型</h4><p>OSPF提供五种类型的报文。</p>
<ul>
<li><p>Hello报文</p>
<p>Hello报文是最常用的报文，用于建立和维护邻接关系。使能了OSPF功能的接口周期性地发送Hello报文。Hello报文中包括一些定时器的数值、本网络中的DR（Designated Router）、BDR（Backup Designated Router）以及已知的邻居。</p>
</li>
<li><p>DD报文</p>
<p>两台路由器在邻接关系初始化时，DD报文（Database Description packet）用来协商主从关系，此时报文中不包含LSA的Header。在两台路由器交换DD报文的过程中，一台为Master，另一台为Slave。由Master规定起始序列号，每发送一个DD报文序列号加1，Slave方使用Master的序列号作为确认。</p>
<p>邻接关系建立之后，路由器使用DD报文描述本端路由器的LSDB，进行数据库同步。DD报文里包括LSDB中每一条LSA的Header（LSA的Header可以唯一标识一条LSA），即所有LSA的摘要信息。LSA Header只占一条LSA的整个数据量的一小部分，这样可以减少路由器之间的协议报文流量。对端路由器根据LSA Header就可以判断出是否已有这条LSA。</p>
</li>
<li><p>LSR报文</p>
<p>两台路由器互相交换过DD报文之后，需要发送LSR报文（Link State Request packet）向对方请求更新LSA。LSR报文里包括所需要的LSA的摘要信息。</p>
</li>
<li><p>LSU报文</p>
<p>LSU报文（Link State Update packet）用来向对端路由器发送其所需要的LSA或者泛洪本端更新的LSA，其报文内容是多条完整的LSA的集合。为了实现泛洪的可靠性传输，需要LSAck报文对其进行确认，对没有收到确认报文的LSA进行重传，重传的LSA是直接发送到邻居的。</p>
</li>
<li><p>LSAck报文</p>
<p>LSAck报文（Link State Acknowledgment packet）用来对接收到的LSU报文进行确认，内容是需要确认的LSA的Header。一个LSAck报文可对多个LSA进行确认。</p>
</li>
</ul>
<h4 id="6-2-1-4-OSPF支持的网络类型"><a href="#6-2-1-4-OSPF支持的网络类型" class="headerlink" title="6.2.1.4  OSPF支持的网络类型"></a>6.2.1.4  OSPF支持的网络类型</h4><p>OSPF根据链路层协议类型，将网络分为如下四种类型：</p>
<ul>
<li><p>广播类型（Broadcast）</p>
<p>当链路层协议是Ethernet或FDDI（Fiber Distributed Digital Interface）时，缺省情况下，OSPF认为网络类型是Broadcast。</p>
<p>在该类型的网络中：</p>
<ul>
<li>通常以组播形式发送Hello报文、LSU报文和LSAck报文。其中，224.0.0.5的组播地址为OSPF设备的预留IP组播地址；224.0.0.6的组播地址为OSPF DR/BDR的预留IP组播地址。</li>
<li>以单播形式发送DD报文和LSR报文。</li>
</ul>
</li>
<li><p>NBMA类型（Non-Broadcast Multi-Access）</p>
<p>当链路层协议是帧中继或X.25时，缺省情况下，OSPF认为网络类型是NBMA。</p>
<p>在该类型的网络中，以单播形式发送协议报文（Hello报文、DD报文、LSR报文、LSU报文、LSAck报文）。</p>
</li>
<li><p>点到多点P2MP类型（Point-to-Multipoint）</p>
<p>没有一种链路层协议会被缺省的认为是P2MP类型。点到多点必须是由其他的网络类型强制更改的。常用做法是将非全连通的NBMA改为点到多点的网络。</p>
<p>在该类型的网络中：</p>
<ul>
<li>以组播形式（224.0.0.5）发送Hello报文。</li>
<li>以单播形式发送其他协议报文（DD报文、LSR报文、LSU报文、LSAck报文）。</li>
</ul>
</li>
<li><p>点到点P2P类型（Point-to-Point）</p>
<p>当链路层协议是PPP、HDLC或LAPB时，缺省情况下，OSPF认为网络类型是P2P。</p>
<p>在该类型的网络中，以组播形式（224.0.0.5）发送协议报文（Hello报文、DD报文、LSR报文、LSU报文、LSAck报文）。</p>
</li>
</ul>
<h4 id="6-2-1-5-DR和BDR选举"><a href="#6-2-1-5-DR和BDR选举" class="headerlink" title="6.2.1.5  DR和BDR选举"></a>6.2.1.5  DR和BDR选举</h4><h5 id="Router-ID"><a href="#Router-ID" class="headerlink" title="Router ID"></a>Router ID</h5><p>在了解DR/BDR的选举过程之前，需要先了解Router ID。Router ID是用于在自治系统中唯一标识一台运行OSPF的路由器的32位整数。每个运行OSPF的路由器都有一个Router ID。Router ID的格式和IP地址的格式是一样的。在实际网络部署中，考虑到协议的稳定，推荐使用路由器上Loopback接口的IP地址做为路由器的Router ID。</p>
<p>Router ID的选取有两种方式：通过命令行手动配置和设备自动设定。</p>
<p>如果没有手动配置Router ID，设备会从当前接口的IP地址中自动选取一个作为Router ID。其选择顺序是：</p>
<ol>
<li>优先从Loopback地址中选择最大的IP地址作为Router ID。</li>
<li>如果没有配置Loopback接口，则在接口地址中选取最大的IP地址作为Router ID。</li>
</ol>
<p>只有重新配置系统的Router ID或OSPF的Router ID，并且重新启动OSPF进程后，才会进行Router ID的重新选取。</p>
<h5 id="DR和BDR选举的原因"><a href="#DR和BDR选举的原因" class="headerlink" title="DR和BDR选举的原因"></a>DR和BDR选举的原因</h5><p>在广播网络和NBMA网络中，任意两台路由器之间都要传递路由信息。如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_111901">图6-8</a>所示，网络中有n台路由器，则需要建立n*(n-1)/2个邻接关系。这使得任何一台路由器的路由变化都会导致多次传递，浪费了带宽资源。</p>
<p>为解决这一问题，OSPF定义了DR。通过选举产生DR后，所有其他设备都只将信息发送给DR，由DR将网络链路状态LSA广播出去。</p>
<p>为了防止DR发生故障，重新选举DR时会产成业务中断，除了DR之外，还会选举一个备份指定路由器BDR。这样除DR和BDR之外的路由器（称为DR Other）之间将不再建立邻接关系，也不再交换任何路由信息，这样就减少了广播网和NBMA网络上各路由器之间邻接关系的数量。</p>
<p><strong>图6-8</strong>  DR和BDR选举<br><img src="http://support.huawei.com/enterprise/product/images/28927eee31074cf6ba4a37fcaefeb0fd" alt="img" loading="lazy"></p>
<h5 id="DR和BDR选举的原则"><a href="#DR和BDR选举的原则" class="headerlink" title="DR和BDR选举的原则"></a>DR和BDR选举的原则</h5><p>在广播网络和NBMA网络中，为了稳定地进行DR和BDR选举，OSPF规定了一系列的选举规则：选举制、终身制、继承制。</p>
<p><strong>选举制</strong></p>
<p>选举制是指DR和BDR不是人为指定的，而是由本网段中所有的路由器共同选举出来的。如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_111902">图6-9</a>所示，路由器接口的DR优先级决定了该接口在选举DR、BDR时所具有的资格，本网段内DR优先级大于0的路由器都可作为“候选人”。选举中使用的“选票”就是Hello报文，每台路由器将自己选出的DR写入Hello报文中，发给网段上的其他路由器。当处于同一网段的两台路由器同时宣布自己是DR时，DR优先级高者胜出。如果优先级相等，则Router ID大者胜出。如果一台路由器的优先级为0，则它不会被选举为DR或BDR。</p>
<p><strong>图6-9</strong>  DR和BDR选举的原则—选举制<br><img src="http://support.huawei.com/enterprise/product/images/8fcc2f94eabb4a55bbb80bd1b5604012" alt="img" loading="lazy"></p>
<p><strong>终身制</strong></p>
<p>终身制也叫非抢占制。每一台新加入的路由器并不急于参加选举，而是先考察一下本网段中是否已存在DR。如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_111903">图6-10</a>所示，如果目前网段中已经存在DR，即使本路由器的DR优先级比现有的DR还高，也不会再声称自己是DR，而是承认现有的DR。因为网段中的每台路由器都只和DR、BDR建立邻接关系，如果DR频繁更换，则会引起本网段内的所有路由器重新与新的DR、BDR建立邻接关系。这样会导致短时间内网段中有大量的OSPF协议报文在传输，降低网络的可用带宽。终身制有利于增加网络的稳定性、提高网络的可用带宽。实际上，在一个广播网络或NBMA网络上，最先启动的两台具有DR选举资格的路由器将成为DR和BDR。</p>
<p><strong>图6-10</strong>  DR和BDR选举的原则—终身制<br><img src="http://support.huawei.com/enterprise/product/images/47c62a5ef1284953a52fdc0dc8e6a83e" alt="img" loading="lazy"></p>
<p><strong>继承制</strong></p>
<p>如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_111904">图6-11</a>所示，继承制是指如果DR发生故障了，那么下一个当选为DR的一定是BDR，其他的路由器只能去竞选BDR的位置。这个原则可以保证DR的稳定，避免频繁地进行选举，并且DR是有备份的（BDR），一旦DR失效，可以立刻由BDR来承担DR的角色。由于DR和BDR的数据库是完全同步的，这样当DR故障后，BDR立即成为DR，履行DR的职责，而且邻接关系已经建立，所以从角色切换到承载业务的时间会很短。同时，在BDR成为新的DR之后，还会选举出一个新的BDR，虽然这个过程所需的时间比较长，但已经不会影响路由的计算了。</p>
<p><strong>图6-11</strong>  DR和BDR选举的原则—继承制<br><img src="http://support.huawei.com/enterprise/product/images/125603863bea4fe2900e3d04fcad0ae5" alt="img" loading="lazy"></p>
<h5 id="DR和BDR选举过程"><a href="#DR和BDR选举过程" class="headerlink" title="DR和BDR选举过程"></a>DR和BDR选举过程</h5><p>广播链路或者NMBA链路上DR和BDR的选举过程如下：</p>
<ol>
<li>接口UP后，发送Hello报文，同时进入到Waiting状态。在Waiting状态下会有一个WaitingTimer，该计时器的长度与DeadTimer是一样的。默认值为40秒，用户不可自行调整。OSPF接口状态的详细描述，请参见<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_feature_ospf_1120">OSPF接口状态机</a>。</li>
<li>在WaitingTimer触发前，发送的hello报文是没有DR和BDR字段的。在Waiting阶段，如果收到Hello报文中有DR和BDR，那么直接承认网络中的DR和BDR，而不会触发选举。直接离开Waiting状态，开始邻居同步。</li>
<li>假设网络中已经存在一个DR和一个BDR，这时新加入网络中的路由器，不论它的Router ID或者DR优先级有多大，都会承认现网中已有的DR和BDR。</li>
<li>当DR因为故障Down掉之后，BDR会继承DR的位置，剩下的优先级大于0的路由器会竞争成为新的BDR。</li>
<li>只有当不同Router ID，或者配置不同DR优先级的路由器同时起来，在同一时刻进行DR选举才会应用DR选举规则产生DR。该规则是：优先选择DR优先级最高的作为DR，次高的作为BDR。DR优先级为0的路由器只能成为DR Other；如果优先级相同，则优先选择Router ID较大的路由器成为DR，次大的成为BDR，其余路由器成为DR Other。</li>
</ol>
<h5 id="DR和BDR选举过程验证"><a href="#DR和BDR选举过程验证" class="headerlink" title="DR和BDR选举过程验证"></a>DR和BDR选举过程验证</h5><p>五台路由器组成一个广播网络，R5作为纯二层设备，R1～R4作为路由设备。R1～R4都规划在OSPF的Area0区域内，各路由器的IP地址及Router ID如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_111905">图6-12</a>所示。</p>
<p><strong>图6-12</strong>  DR和BDR选举组网图<br><img src="http://support.huawei.com/enterprise/product/images/64593677b4554ae1a5fe7a9391a41dbc" alt="img" loading="lazy"></p>
<p><strong>网络中可以正常选举出DR和BDR时</strong></p>
<p>假设R1～R4各接口的配置已经完成，这里仅给出OSPF相关的配置。</p>
<ul>
<li><p>R1的配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">ospf 1 Router ID 10.1.1.1 </span><br><span class="line"> area 0.0.0.0 </span><br><span class="line">  network 192.168.1.0 0.0.0.255 </span><br><span class="line">#</span><br></pre></td></tr></table></figure>
</li>
<li><p>R2的配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">ospf 1 Router ID 10.2.2.2</span><br><span class="line"> area 0.0.0.0 </span><br><span class="line">  network 192.168.1.0 0.0.0.255 </span><br><span class="line">#</span><br></pre></td></tr></table></figure>
</li>
<li><p>R3的配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">ospf 1 Router ID 10.3.3.3 </span><br><span class="line"> area 0.0.0.0 </span><br><span class="line">  network 192.168.1.0 0.0.0.255 </span><br><span class="line">#</span><br></pre></td></tr></table></figure>
</li>
<li><p>R4的配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">ospf 1 Router ID 10.4.4.4</span><br><span class="line"> area 0.0.0.0 </span><br><span class="line">  network 192.168.1.0 0.0.0.255 </span><br><span class="line">#</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>配置完成后，待网络稳定后查看当前网络中DR和BDR的选举情况。</p>
<p># 在R1上查看OSPF的邻居信息。可以看出，该网络已经完成了DR和BDR的选举，R1是DR，R2是BDR，R3和R4是DR Other。这里R1是DR，R2是BDR跟系统的启动顺序是直接相关的。本例中按照R1、R2、R3、R4的顺序依次启动设备，所以R1和R2首先完成了初始化，自然成为了DR和BDR。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;R1&gt; display ospf peer</span><br><span class="line"></span><br><span class="line">         OSPF Process 1 with Router ID 10.1.1.1</span><br><span class="line">                 Neighbors</span><br><span class="line"></span><br><span class="line"> Area 0.0.0.0 interface 192.168.1.1(GigabitEthernet0&#x2F;0&#x2F;1)&#39;s neighbors</span><br><span class="line"> Router ID: 10.2.2.2         Address: 192.168.1.2</span><br><span class="line">   State: Full  Mode:Nbr is Master  Priority: 1</span><br><span class="line">   DR: 192.168.1.1  BDR: 192.168.1.2   MTU: 0</span><br><span class="line">   Dead timer due in 38  sec</span><br><span class="line">   Retrans timer interval: 5</span><br><span class="line">   Neighbor is up for 00:22:16</span><br><span class="line">   Authentication Sequence: [ 0 ]</span><br><span class="line"></span><br><span class="line"> Router ID: 10.3.3.3         Address: 192.168.1.3</span><br><span class="line">   State: Full  Mode:Nbr is Master   Priority: 1</span><br><span class="line">   DR: 192.168.1.1  BDR: 192.168.1.2   MTU: 0</span><br><span class="line">   Dead timer due in 35  sec</span><br><span class="line">   Retrans timer interval: 5</span><br><span class="line">   Neighbor is up for 00:21:30</span><br><span class="line">   Authentication Sequence: [ 0 ]</span><br><span class="line"></span><br><span class="line"> Router ID: 10.4.4.4         Address: 192.168.1.4</span><br><span class="line">   State: Full  Mode:Nbr is Master   Priority: 1</span><br><span class="line">   DR: 192.168.1.1  BDR: 192.168.1.2   MTU: 0</span><br><span class="line">   Dead timer due in 33  sec</span><br><span class="line">   Retrans timer interval: 5</span><br><span class="line">   Neighbor is up for 00:20:24</span><br><span class="line">   Authentication Sequence: [ 0 ]</span><br></pre></td></tr></table></figure>

<p># 在R1、R2、R3和R4上查看OSPF邻居的概要信息。可以看出，R1、R2和其他三台路由器的邻居关系都是Full，而R3和R4之间的邻居关系是2-Way状态。这表示DR、BDR与邻居间建立的是邻接关系，而DR Other之间建立的只是邻居关系。OSPF邻居状态的详细描述，请参见<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_feature_ospf_1120">OSPF邻居状态机</a>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;R1&gt; display ospf 1 peer brief</span><br><span class="line"></span><br><span class="line">         OSPF Process 1 with Router ID 10.1.1.1</span><br><span class="line">                   Peer Statistic Information</span><br><span class="line"> ----------------------------------------------------------------------------</span><br><span class="line"> Area Id         Interface                  Neighbor id      State</span><br><span class="line"> 0.0.0.0         GigabitEthernet0&#x2F;0&#x2F;1       10.2.2.2         Full</span><br><span class="line"> 0.0.0.0         GigabitEthernet0&#x2F;0&#x2F;1       10.3.3.3         Full</span><br><span class="line"> 0.0.0.0         GigabitEthernet0&#x2F;0&#x2F;1       10.4.4.4         Full</span><br><span class="line"> ----------------------------------------------------------------------------</span><br><span class="line"> Total Peer(s):     3</span><br><span class="line">&lt;R2&gt; display ospf 1 peer brief</span><br><span class="line"></span><br><span class="line">         OSPF Process 1 with Router ID 10.2.2.2</span><br><span class="line">                   Peer Statistic Information</span><br><span class="line"> ----------------------------------------------------------------------------</span><br><span class="line"> Area Id         Interface                  Neighbor id      State</span><br><span class="line"> 0.0.0.0         GigabitEthernet0&#x2F;0&#x2F;1       10.1.1.1         Full</span><br><span class="line"> 0.0.0.0         GigabitEthernet0&#x2F;0&#x2F;1       10.3.3.3         Full</span><br><span class="line"> 0.0.0.0         GigabitEthernet0&#x2F;0&#x2F;1       10.4.4.4         Full</span><br><span class="line"> ----------------------------------------------------------------------------</span><br><span class="line"> Total Peer(s):     3</span><br><span class="line">&lt;R3&gt; display ospf 1 peer brief</span><br><span class="line"></span><br><span class="line">         OSPF Process 1 with Router ID 10.3.3.3</span><br><span class="line">                   Peer Statistic Information</span><br><span class="line"> ----------------------------------------------------------------------------</span><br><span class="line"> Area Id         Interface                  Neighbor id      State</span><br><span class="line"> 0.0.0.0         GigabitEthernet0&#x2F;0&#x2F;1       10.1.1.1         Full</span><br><span class="line"> 0.0.0.0         GigabitEthernet0&#x2F;0&#x2F;1       10.2.2.2         Full</span><br><span class="line"> 0.0.0.0         GigabitEthernet0&#x2F;0&#x2F;1       10.4.4.4         2-Way</span><br><span class="line"> ----------------------------------------------------------------------------</span><br><span class="line"> Total Peer(s):     3</span><br><span class="line">&lt;R4&gt; display ospf 1 peer brief</span><br><span class="line"></span><br><span class="line">         OSPF Process 1 with Router ID 10.4.4.4</span><br><span class="line">                   Peer Statistic Information</span><br><span class="line"> ----------------------------------------------------------------------------</span><br><span class="line"> Area Id         Interface                  Neighbor id      State</span><br><span class="line"> 0.0.0.0         GigabitEthernet0&#x2F;0&#x2F;1        10.1.1.1         Full</span><br><span class="line"> 0.0.0.0         GigabitEthernet0&#x2F;0&#x2F;1        10.2.2.2         Full</span><br><span class="line"> 0.0.0.0         GigabitEthernet0&#x2F;0&#x2F;1        10.3.3.3         2-Way</span><br><span class="line"> ----------------------------------------------------------------------------</span><br><span class="line"> Total Peer(s):     3</span><br></pre></td></tr></table></figure>

<p><strong>网络中无法选举出BDR时</strong></p>
<p>如果在R2、R3、R4的接口GE0/0/1上执行<strong>ospf dr-priority</strong>命令将接口的DR优先级配置为0，那么这个时候这三台路由器将失去DR和BDR的选举资格，只能作为DR Other，网络中仅存在一台具备DR和BDR选举资格的路由器，就是R1。</p>
<p># 在R1上查看OSPF邻居信息。可以看到，此时DR是R1，BDR显示为None，即网络中不存在BDR。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;R1&gt; display ospf peer</span><br><span class="line"></span><br><span class="line">         OSPF Process 1 with Router ID 10.1.1.1</span><br><span class="line">                 Neighbors</span><br><span class="line"></span><br><span class="line"> Area 0.0.0.0 interface 192.168.1.1(GigabitEthernet0&#x2F;0&#x2F;1)&#39;s neighbors</span><br><span class="line"> Router ID: 10.2.2.2         Address: 192.168.1.2</span><br><span class="line">   State: Full  Mode:Nbr is Master  Priority: 0</span><br><span class="line">   DR: 192.168.1.1  BDR: None   MTU: 0</span><br><span class="line">   Dead timer due in 38  sec</span><br><span class="line">   Retrans timer interval: 5</span><br><span class="line">   Neighbor is up for 00:04:31</span><br><span class="line">   Authentication Sequence: [ 0 ]</span><br><span class="line"></span><br><span class="line"> Router ID: 10.3.3.3         Address: 192.168.1.3</span><br><span class="line">   State: Full  Mode:Nbr is Master   Priority: 0</span><br><span class="line">   DR: 192.168.1.1  BDR: None   MTU: 0</span><br><span class="line">   Dead timer due in 35  sec</span><br><span class="line">   Retrans timer interval: 5</span><br><span class="line">   Neighbor is up for 00:03:45</span><br><span class="line">   Authentication Sequence: [ 0 ]</span><br><span class="line"></span><br><span class="line"> Router ID: 10.4.4.4         Address: 192.168.1.4</span><br><span class="line">   State: Full  Mode:Nbr is Master   Priority: 0</span><br><span class="line">   DR: 192.168.1.1  BDR: None   MTU: 0</span><br><span class="line">   Dead timer due in 33  sec</span><br><span class="line">   Retrans timer interval: 5</span><br><span class="line">   Neighbor is up for 00:03:36</span><br><span class="line">   Authentication Sequence: [ 0 ]</span><br></pre></td></tr></table></figure>

<p># 在R1、R2、R3和R4上查看OSPF邻居的概要信息。可以看出，R2、R3、R4分别和R1建立了邻接关系（状态为FULL），而R2、R3、R4之间的邻居状态只停留在2-Way的状态。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;R1&gt; display ospf 1 peer brief</span><br><span class="line"></span><br><span class="line">         OSPF Process 1 with Router ID 10.1.1.1</span><br><span class="line">                   Peer Statistic Information</span><br><span class="line"> ----------------------------------------------------------------------------</span><br><span class="line"> Area Id         Interface                  Neighbor id      State</span><br><span class="line"> 0.0.0.0         GigabitEthernet0&#x2F;0&#x2F;1       10.2.2.2         Full</span><br><span class="line"> 0.0.0.0         GigabitEthernet0&#x2F;0&#x2F;1       10.3.3.3         Full</span><br><span class="line"> 0.0.0.0         GigabitEthernet0&#x2F;0&#x2F;1       10.4.4.4         Full</span><br><span class="line"> ----------------------------------------------------------------------------</span><br><span class="line"> Total Peer(s):     3</span><br><span class="line">&lt;R2&gt; display ospf 1 peer brief</span><br><span class="line"></span><br><span class="line">         OSPF Process 1 with Router ID 10.2.2.2</span><br><span class="line">                   Peer Statistic Information</span><br><span class="line"> ----------------------------------------------------------------------------</span><br><span class="line"> Area Id         Interface                  Neighbor id      State</span><br><span class="line"> 0.0.0.0         GigabitEthernet0&#x2F;0&#x2F;1       10.1.1.1         Full</span><br><span class="line"> 0.0.0.0         GigabitEthernet0&#x2F;0&#x2F;1       10.3.3.3         2-Way</span><br><span class="line"> 0.0.0.0         GigabitEthernet0&#x2F;0&#x2F;1       10.4.4.4         2-Way</span><br><span class="line"> ----------------------------------------------------------------------------</span><br><span class="line"> Total Peer(s):     3</span><br><span class="line">&lt;R3&gt; display ospf 1 peer brief</span><br><span class="line"></span><br><span class="line">         OSPF Process 1 with Router ID 10.3.3.3</span><br><span class="line">                   Peer Statistic Information</span><br><span class="line"> ----------------------------------------------------------------------------</span><br><span class="line"> Area Id         Interface                  Neighbor id      State</span><br><span class="line"> 0.0.0.0         GigabitEthernet0&#x2F;0&#x2F;1       10.1.1.1         Full</span><br><span class="line"> 0.0.0.0         GigabitEthernet0&#x2F;0&#x2F;1       10.2.2.2         2-Way</span><br><span class="line"> 0.0.0.0         GigabitEthernet0&#x2F;0&#x2F;1       10.4.4.4         2-Way</span><br><span class="line"> ----------------------------------------------------------------------------</span><br><span class="line"> Total Peer(s):     3</span><br><span class="line">&lt;R4&gt; display ospf 1 peer brief</span><br><span class="line"></span><br><span class="line">         OSPF Process 1 with Router ID 10.4.4.4</span><br><span class="line">                   Peer Statistic Information</span><br><span class="line"> ----------------------------------------------------------------------------</span><br><span class="line"> Area Id         Interface                  Neighbor id      State</span><br><span class="line"> 0.0.0.0         GigabitEthernet0&#x2F;0&#x2F;1       10.1.1.1         Full</span><br><span class="line"> 0.0.0.0         GigabitEthernet0&#x2F;0&#x2F;1       10.2.2.2         2-Way</span><br><span class="line"> 0.0.0.0         GigabitEthernet0&#x2F;0&#x2F;1       10.3.3.3         2-Way</span><br><span class="line"> ----------------------------------------------------------------------------</span><br><span class="line"> Total Peer(s):     3</span><br></pre></td></tr></table></figure>

<p>由此可知，如果在一个广播网络或NBMA网络上只有一台路由器具有选举资格，那么这台路由器将成为DR，并且在这个网络上没有BDR，其他所有的路由器都将只和DR建立邻接关系。</p>
<p><strong>网络中无法选举出DR和BDR时</strong></p>
<p>在以上配置的基础上，如果在R1的接口GE0/0/1上执行<strong>ospf dr-priority</strong>命令将接口的DR优先级配置为0，则R1也失去DR、BDR的选举资格。此时该网络中将没有任何路由器具备DR和BDR的选举资格。</p>
<p># 在R1上查看OSPF邻居信息。可以看到，DR和BDR字段都显示None，表示这个网络中不存在DR和BDR。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;R1&gt; display ospf peer</span><br><span class="line"></span><br><span class="line">         OSPF Process 1 with Router ID 10.1.1.1</span><br><span class="line">                 Neighbors</span><br><span class="line"></span><br><span class="line"> Area 0.0.0.0 interface 192.168.1.1(GigabitEthernet0&#x2F;0&#x2F;1)&#39;s neighbors</span><br><span class="line"> Router ID: 10.2.2.2         Address: 192.168.1.2</span><br><span class="line">   State: Full  Mode:Nbr is Master  Priority: 0</span><br><span class="line">   DR: None  BDR: None   MTU: 0</span><br><span class="line">   Dead timer due in 38  sec</span><br><span class="line">   Retrans timer interval: 5</span><br><span class="line">   Neighbor is up for 00:00:00</span><br><span class="line">   Authentication Sequence: [ 0 ]</span><br><span class="line"></span><br><span class="line"> Router ID: 10.3.3.3         Address: 192.168.1.3</span><br><span class="line">   State: Full  Mode:Nbr is Master   Priority: 0</span><br><span class="line">   DR: None  BDR: None   MTU: 0</span><br><span class="line">   Dead timer due in 35  sec</span><br><span class="line">   Retrans timer interval: 5</span><br><span class="line">   Neighbor is up for 00:00:00</span><br><span class="line">   Authentication Sequence: [ 0 ]</span><br><span class="line"></span><br><span class="line"> Router ID: 10.4.4.4         Address: 192.168.1.4</span><br><span class="line">   State: Full  Mode:Nbr is Master   Priority: 0</span><br><span class="line">   DR: None  BDR: None   MTU: 0</span><br><span class="line">   Dead timer due in 33  sec</span><br><span class="line">   Retrans timer interval: 5</span><br><span class="line">   Neighbor is up for 00:00:00</span><br><span class="line">   Authentication Sequence: [ 0 ]</span><br></pre></td></tr></table></figure>

<p># 在R1、R2、R3和R4上查看OSPF邻居的概要信息。可以看出，此时所有的邻居状态都只停留在2-Way的状态，网络不能建立邻接关系，各个路由器之间不能完成路由信息的交互。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;R1&gt; display ospf 1 peer brief</span><br><span class="line"></span><br><span class="line">         OSPF Process 1 with Router ID 10.1.1.1</span><br><span class="line">                   Peer Statistic Information</span><br><span class="line"> ----------------------------------------------------------------------------</span><br><span class="line"> Area Id         Interface                  Neighbor id      State</span><br><span class="line"> 0.0.0.0         GigabitEthernet0&#x2F;0&#x2F;1       10.2.2.2         2-Way</span><br><span class="line"> 0.0.0.0         GigabitEthernet0&#x2F;0&#x2F;1       10.3.3.3         2-Way</span><br><span class="line"> 0.0.0.0         GigabitEthernet0&#x2F;0&#x2F;1       10.4.4.4         2-Way</span><br><span class="line"> ----------------------------------------------------------------------------</span><br><span class="line"> Total Peer(s):     3</span><br><span class="line">&lt;R2&gt; display ospf 1 peer brief</span><br><span class="line"></span><br><span class="line">         OSPF Process 1 with Router ID 10.2.2.2</span><br><span class="line">                   Peer Statistic Information</span><br><span class="line"> ----------------------------------------------------------------------------</span><br><span class="line"> Area Id         Interface                  Neighbor id      State</span><br><span class="line"> 0.0.0.0         GigabitEthernet0&#x2F;0&#x2F;1       10.1.1.1         2-Way</span><br><span class="line"> 0.0.0.0         GigabitEthernet0&#x2F;0&#x2F;1       10.3.3.3         2-Way</span><br><span class="line"> 0.0.0.0         GigabitEthernet0&#x2F;0&#x2F;1       10.4.4.4         2-Way</span><br><span class="line"> ----------------------------------------------------------------------------</span><br><span class="line"> Total Peer(s):     3</span><br><span class="line">&lt;R3&gt; display ospf 1 peer brief</span><br><span class="line"></span><br><span class="line">         OSPF Process 1 with Router ID 10.3.3.3</span><br><span class="line">                   Peer Statistic Information</span><br><span class="line"> ----------------------------------------------------------------------------</span><br><span class="line"> Area Id         Interface                  Neighbor id      State</span><br><span class="line"> 0.0.0.0         GigabitEthernet0&#x2F;0&#x2F;1       10.1.1.1         2-Way</span><br><span class="line"> 0.0.0.0         GigabitEthernet0&#x2F;0&#x2F;1       10.2.2.2         2-Way</span><br><span class="line"> 0.0.0.0         GigabitEthernet0&#x2F;0&#x2F;1       10.4.4.4         2-Way</span><br><span class="line"> ----------------------------------------------------------------------------</span><br><span class="line"> Total Peer(s):     3</span><br><span class="line">&lt;R4&gt; display ospf 1 peer brief</span><br><span class="line"></span><br><span class="line">         OSPF Process 1 with Router ID 10.4.4.4</span><br><span class="line">                   Peer Statistic Information</span><br><span class="line"> ----------------------------------------------------------------------------</span><br><span class="line"> Area Id         Interface                  Neighbor id      State</span><br><span class="line"> 0.0.0.0         GigabitEthernet0&#x2F;0&#x2F;1       10.1.1.1         2-Way</span><br><span class="line"> 0.0.0.0         GigabitEthernet0&#x2F;0&#x2F;1       10.2.2.2         2-Way</span><br><span class="line"> 0.0.0.0         GigabitEthernet0&#x2F;0&#x2F;1       10.3.3.3         2-Way</span><br><span class="line"> ----------------------------------------------------------------------------</span><br><span class="line"> Total Peer(s):     3</span><br></pre></td></tr></table></figure>

<p>由此可知，如果在一个广播网络或NBMA网络上不存在具备DR和BDR选举资格的路由器，那么这个网络上将没有DR或者BDR，而且也不会建立任何邻接关系。这种情况下，网络上所有路由器的邻居状态都将停留在2-Way状态。</p>
<h4 id="6-2-1-6-OSPF状态机"><a href="#6-2-1-6-OSPF状态机" class="headerlink" title="6.2.1.6  OSPF状态机"></a>6.2.1.6  OSPF状态机</h4><h5 id="OSPF接口状态机"><a href="#OSPF接口状态机" class="headerlink" title="OSPF接口状态机"></a>OSPF接口状态机</h5><p>OSPF设备从接口获取链路信息后，与相邻设备建立邻接关系，交互这些信息。在建立邻接关系之前，邻居设备间需要明确角色分工才能正常建立连接。OSPF接口信息的State字段（可通过<strong>display ospf interface</strong>命令查看）表明了OSPF设备在对应链路中的作用。</p>
<p>OSPF接口共有以下七种状态：</p>
<ul>
<li><strong>Down</strong>：接口的初始状态。表明此时接口不可用，不能用于收发流量。</li>
<li><strong>Loopback</strong>：设备到网络的接口处于环回状态。环回接口不能用于正常的数据传输，但可以通过Router-LSA进行通告。因此，进行连通性测试时能够发现到达这个接口的路径。</li>
<li><strong>Waiting</strong>：设备正在判定网络上的DR和BDR。在设备参与DR和BDR选举前，接口上会启动Waiting定时器。在这个定时器超时前，设备发送的Hello报文不包含DR和BDR信息，设备不能被选举为DR或BDR。这样可以避免不必要地改变链路中已存在的DR和BDR。仅NMBA网络、广播网络有此状态。</li>
<li><strong>P-2-P</strong>：接口连接到物理点对点网络或者是虚拟链路，这个时候设备会与链路连接的另一端设备建立邻接关系。仅P2P、P2MP网络有此状态。</li>
<li><strong>DROther</strong>：设备没有被选为DR或BDR，但连接到广播网络或NBMA网络上的其他设备被选举为DR。它会与DR和BDR建立邻接关系。</li>
<li><strong>BDR</strong>：设备是相连的网络中的BDR，并将在当前的DR失效时成为DR。该设备与接入该网络的所有其他设备建立邻接关系。</li>
<li><strong>DR</strong>：设备是相连的网络中的DR。该设备与接入该网络的所有其他设备建立邻接关系。</li>
</ul>
<p>OSPF接口根据不同的情况（即输入事件）在各状态中进行灵活转换，这样就形成了一个高效运作的接口状态机，如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_112001">图6-13</a>所示。</p>
<p><strong>图6-13</strong>  OSPF接口状态机<br><img src="http://support.huawei.com/enterprise/product/images/1fb59f67d2734943a4390a9ced1952b7" alt="img" loading="lazy"></p>
<p><a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_feature_ospf_1120_mMcCpPsS_table_01">表6-1</a>列出了不同状态切换时的输入事件InputEvent（<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_112001">图6-13</a>中简称IE）。</p>
<p><strong>表6-1</strong>  OSPF接口状态切换的输入事件</p>
<table>
<thead>
<tr>
<th>输入事件</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>IE1</td>
<td>InterfaceUP：底层协议表明接口是可操作的。</td>
</tr>
<tr>
<td>IE2</td>
<td>WaitTimer：等待定时器超时，表明DR和BDR选举等待时间结束。</td>
</tr>
<tr>
<td>IE3</td>
<td>BackupSeen：设备已检测过网络中是否存在BDR。发生这个事件主要有下面两种方式：接口收到邻居设备的Hello报文，宣称自己是BDR。接口收到邻居设备的Hello的报文，宣称自己是DR，而没有指明有BDR。这都说明邻居间已进行了相互通信，可以结束Waiting状态了。</td>
</tr>
<tr>
<td>IE4</td>
<td>接口所在的设备在网络中被选举为DR。</td>
</tr>
<tr>
<td>IE5</td>
<td>接口所在的设备在网络中被选举为BDR。</td>
</tr>
<tr>
<td>IE6</td>
<td>接口所在的设备在网络中没有被选举为DR或BDR。</td>
</tr>
<tr>
<td>IE7</td>
<td>NeighborChange：与该接口相关的邻居关系变化的事件发生，这表明DR和BDR需要重新选举。下面的这些邻居关系变化可能会导致DR和BDR重新选举：接口所在的设备和一个邻居设备建立了双向通信关系。接口所在的设备和一个邻居设备之间丢失了双向通信关系。通过邻居设备发送的Hello报文检测到邻居设备重新宣称自己是DR或BDR。通过邻居设备发送的Hello报文再一次检测到邻居设备宣称自己不再是DR或BDR。通过邻居设备发送的Hello报文再一次检测到相邻设备的DR优先级都已经改变。</td>
</tr>
<tr>
<td>IE8</td>
<td>UnLoopInd：网管系统或者底层协议表明接口不再处于环回状态。</td>
</tr>
<tr>
<td>IE9</td>
<td>InterfaceDown：底层协议表明接口不可操作。任何一种状态都可能触发此事件切换到Down状态。</td>
</tr>
<tr>
<td>IE10</td>
<td>LoopInd：网管系统或者底层协议表明接口处于环回状态。任何一种状态都可能触发此事件切换到Loopback状态。</td>
</tr>
</tbody></table>
<h5 id="OSPF邻居状态机"><a href="#OSPF邻居状态机" class="headerlink" title="OSPF邻居状态机"></a>OSPF邻居状态机</h5><p>在OSPF网络中，相邻设备间通过不同的邻居状态切换，最终可以形成完全的邻接关系，完成LSA信息的交互。</p>
<p>OSPF邻居信息的State字段（可通过<strong>display ospf peer</strong>命令查看）表明了OSPF设备的邻居状态。</p>
<p>OSPF邻居共有以下八种状态：</p>
<ul>
<li><strong>Down</strong>：邻居会话的初始阶段。表明没有在邻居失效时间间隔内收到来自邻居设备的Hello报文。除了NBMA网络OSPF路由器会每隔PollInterval时间对外轮询发送Hello报文，包括向处于Down状态的邻居路由器（即失效的邻居路由器）发送之外，其他网络是不会向失效的邻居路由器发送Hello报文的。</li>
<li><strong>Attempt</strong>：这种状态适用于NBMA网络，邻居路由器是手工配置的。邻居关系处于本状态时，路由器会每隔HelloInterval时间向自己手工配置的邻居发送Hello报文，尝试建立邻居关系。</li>
<li><strong>Init</strong>：本状态表示已经收到了邻居的Hello报文，但是对端并没有收到本端发送的Hello报文，收到的Hello报文的邻居列表并没有包含本端的Router ID，双向通信仍然没有建立。</li>
<li><strong>2-Way</strong>：互为邻居。本状态表示双方互相收到了对端发送的Hello报文，报文中的邻居列表也包含本端的Router ID，邻居关系建立。如果不形成邻接关系则邻居状态机就停留在此状态，否则进入ExStart状态。DR和BDR只有在邻居状态处于这个状态或者更高的状态才会被选举出来。</li>
<li><strong>ExStart</strong>：协商主从关系。建立主从关系主要是为了保证在后续的DD报文交换中能够有序的发送。邻居间从此时才开始正式建立邻接关系。</li>
<li><strong>Exchange</strong>：交换DD报文。本端设备将本地的LSDB用DD报文来描述，并发给邻居设备。</li>
<li><strong>Loading</strong>：正在同步LSDB。两端设备发送LSR报文向邻居请求对方的LSA，同步LSDB。</li>
<li><strong>Full</strong>：建立邻接。两端设备的LSDB已同步，本端设备和邻居设备建立了完全的邻接关系。</li>
</ul>
<p>OSPF邻居状态的切换如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_112002">图6-14</a>所示。</p>
<p><strong>图6-14</strong>  OSPF邻居状态机<br><img src="http://support.huawei.com/enterprise/product/images/7293ad5cb7864b03a572b9b15d3e58fc" alt="img" loading="lazy"></p>
<p><a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_feature_ospf_1120_mMcCpPsS_table_02">表6-2</a>列出了不同状态切换时的输入事件InputEvent（<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_112001">图6-13</a>中简称IE）。</p>
<p><strong>表6-2</strong>  OSPF邻居状态切换的输入事件</p>
<table>
<thead>
<tr>
<th>输入事件</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>IE1</td>
<td>Start：以HelloInterval间隔向邻居设备发送Hello报文，尝试建立邻居关系。仅NMBA网络适用。</td>
</tr>
<tr>
<td>IE2</td>
<td>HelloReceived：从邻居设备收到一个Hello报文。</td>
</tr>
<tr>
<td>IE3</td>
<td>2-WayReceived：从邻居设备收到的Hello报文中包含了自己的RouterID，邻居间建立了双向通信关系。接下来会进行判断：IE3(Y)：如果相邻设备间应当建立邻接关系，会将邻居状态切换为ExStart。IE3(N)：如果相邻设备间不应当建立邻接关系，只建立邻居关系，会将邻居状态切换为2-Way。</td>
</tr>
<tr>
<td>IE4</td>
<td>NegotiationDone：邻居间主从关系已经协商完成，DD序列号已经交换。</td>
</tr>
<tr>
<td>IE5</td>
<td>ExchangeDone：邻居间成功交换了数据库描述报文。接下来会进行判断：IE5(Y)：如果链路状态请求列表为空，会将邻居状态切换为Full状态，表示链路状态数据已全部交换完成，邻居间建立了完全的邻接关系。IE5(N)：如果链路状态请求列表不为空，会将邻居状态切换为Loading状态，开始或继续向邻居发送LSR报文，请求还没有接收到的链路状态数据。</td>
</tr>
<tr>
<td>IE6</td>
<td>LoadingDone：链路请求状态列表为空。</td>
</tr>
</tbody></table>
<h4 id="6-2-1-7-OSPF邻接关系的建立"><a href="#6-2-1-7-OSPF邻接关系的建立" class="headerlink" title="6.2.1.7  OSPF邻接关系的建立"></a>6.2.1.7  OSPF邻接关系的建立</h4><h5 id="OSPF邻居关系和邻接关系"><a href="#OSPF邻居关系和邻接关系" class="headerlink" title="OSPF邻居关系和邻接关系"></a>OSPF邻居关系和邻接关系</h5><p>OSPF设备启动后，会通过OSPF接口向外发送Hello报文。网络中其它收到Hello报文的OSPF设备会检查该报文中所定义的参数，比如Hello报文发送间隔、网络类型、IP地址掩码等。如果双方Hello报文中的参数一致就会形成邻居关系，两端设备互为邻居。</p>
<p>OSPF邻接关系位于邻居关系之上。两端需要进一步交换DD报文、交互LSA信息时才建立邻接关系。</p>
<p>在广播链路和NBMA链路上，因为DR Other之间不需要交换LSA信息，所以建立的是邻居关系。而DR与BDR之间，DR、BDR与DR Other之间需要交互LSA信息，所以建立的是邻接关系。如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_112101">图6-15</a>所示，两台DR Other各有三个邻居，但是分别只有两个邻接。</p>
<p><strong>图6-15</strong>  OSPF邻居关系和邻接关系<br><img src="http://support.huawei.com/enterprise/product/images/0e94dca1f06240eaaf96255e18339f75" alt="img" loading="lazy"></p>
<p>P2P链路和P2MP链路上只有OSPF邻接关系。</p>
<p>简单来说，邻居关系是指邻居状态达到了2-Way状态，而邻接关系则需要达到ExStart或以上状态。</p>
<h5 id="OSPF邻接关系建立过程"><a href="#OSPF邻接关系建立过程" class="headerlink" title="OSPF邻接关系建立过程"></a>OSPF邻接关系建立过程</h5><p>不同类型的网络，OSPF邻接关系建立过程略有不同。</p>
<p><strong>广播网络</strong></p>
<p>在广播网络中，DR、BDR和网段内的每一台路由器都形成邻接关系，但DR other之间只形成邻居关系。邻接关系建立的过程如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_112102">图6-16</a>所示。</p>
<p><strong>图6-16</strong>  广播网络中邻接关系的建立过程<br><img src="http://support.huawei.com/enterprise/product/images/ce0e92c456ba4000aeab242dbd11e5e5" alt="img" loading="lazy"></p>
<ol>
<li><p>建立邻居关系</p>
<ol>
<li>RouterA连接到广播类型网络的接口上使能了OSPF协议，并发送了一个Hello报文（使用组播地址224.0.0.5）。此时，RouterA认为自己是DR设备（DR=1.1.1.1），但不确定邻居是哪台设备（Neighbors Seen=0）。</li>
<li>RouterB收到RouterA发送的Hello报文后，发送一个Hello报文回应给RouterA，并且在报文中的Neighbors Seen字段中填入RouterA的Router ID（Neighbors Seen=1.1.1.1），表示已收到RouterA的Hello报文，并且宣告DR设备是RouterB（DR=2.2.2.2），然后RouterB的邻居状态机置为Init。</li>
<li>RouterA收到RouterB回应的Hello报文后，将邻居状态机置为2-Way状态，下一步双方开始发送各自的链路状态数据库。在广播网络中，两个接口状态是DR Other的设备之间将停留在此步骤。</li>
</ol>
</li>
<li><p>主从关系协商、DD报文交换</p>
<ol>
<li><p>RouterA首先发送一个DD报文，宣称自己是Master（即将DD报文中的MS字段置为1），并规定序列号Seq=X。I=1表示这是第一个DD报文，报文中并不包含LSA的摘要，只是为了协商主从关系。M=1说明这不是最后一个报文。</p>
<p>为了提高发送的效率，RouterA和RouterB首先了解对端数据库中哪些LSA是需要更新的。如果某一条LSA在LSDB中已经存在，就不再需要请求更新了。为了达到这个目的，RouterA和RouterB先发送DD报文，DD报文中包含了对LSDB中LSA的摘要描述（每一条摘要可以唯一标识一条LSA）。为了保证报文在传输过程中的可靠性，在DD报文的发送过程中需要确定双方的主从关系，作为Master的一方定义一个序列号Seq，每发送一个新的DD报文将Seq加1，作为Slave的一方，每次发送DD报文时使用接收到的上一个Master的DD报文中的Seq。</p>
</li>
<li><p>RouterB在收到RouterA的DD报文后，将RouterA的邻居状态机改为ExStart，并且回应一个DD报文（该报文中同样不包含LSA的摘要信息）。由于RouterB的Router ID较大，所以在报文中RouterB认为自己是Master，并且重新规定了序列号Seq=Y。</p>
</li>
<li><p>RouterA收到报文后，同意了RouterB为Master，并将RouterB的邻居状态机改为Exchange。RouterA使用RouterB的序列号Seq=Y来发送新的DD报文，该报文开始正式传送LSA的摘要。在报文中RouterA将MS字段置为0，说明自己是Slave。</p>
</li>
<li><p>RouterB收到报文后，将RouterA的邻居状态机改为Exchange，并发送新的DD报文来描述自己的LSA摘要，此时RouterB将报文的序列号改为Seq=Y+1。上述过程持续进行，RouterA通过重复RouterB的序列号来确认已收到RouterB的报文。RouterB通过将序列号Seq加1来确认已收到RouterA的报文。当RouterB发送最后一个DD报文时，在报文中写上M=0。</p>
</li>
</ol>
</li>
<li><p>LSDB同步（LSA请求、LSA传输、LSA应答）</p>
<ol>
<li>RouterA收到最后一个DD报文后，发现RouterB的数据库中有许多LSA是自己没有的，将邻居状态机改为Loading状态。此时RouterB也收到了RouterA的最后一个DD报文，但RouterA的LSA，RouterB都已经有了，不需要再请求，所以直接将RouterA的邻居状态机改为Full状态。</li>
<li>RouterA发送LSR报文向RouterB请求更新LSA。RouterB用LSU报文来回应RouterA的请求。RouterA收到后，发送LSAck报文确认。</li>
</ol>
<p>上述过程持续到RouterA中的LSA与RouterB的LSA完全同步为止，此时RouterA将RouterB的邻居状态机改为Full状态。当路由器交换完DD报文并更新所有的LSA后，此时邻接关系建立完成。</p>
</li>
</ol>
<p><strong>NBMA网络</strong></p>
<p>在NBMA网络中，所有路由器只与DR和BDR之间形成邻接关系。邻接关系建立的过程如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_112103">图6-17</a>所示。</p>
<p><strong>图6-17</strong>  NBMA网络中邻接关系的建立过程<br><img src="http://support.huawei.com/enterprise/product/images/87391de24c5549fbabc05a32fe55cafd" alt="img" loading="lazy"></p>
<ol>
<li>建立邻居关系<ol>
<li>RouterB向RouterA的一个状态为Down的接口发送Hello报文后，RouterB的邻居状态机置为Attempt。此时，RouterB认为自己是DR设备（DR=2.2.2.2），但不确定邻居是哪台设备（Neighbors Seen=0）。</li>
<li>RouterA收到Hello报文后将邻居状态机置为Init，然后再回复一个Hello报文。此时，RouterA同意RouterB是DR设备（DR=2.2.2.2），并且在Neighbors Seen字段中填入邻居设备的Router ID（Neighbors Seen=2.2.2.2）。在NBMA网络中，两个接口状态是DR Other的设备之间将停留在此步骤。</li>
</ol>
</li>
<li>主从关系协商、DD报文交换过程与广播网络中邻接关系建立过程相同。</li>
<li>LSDB同步（LSA请求、LSA传输、LSA应答）过程与广播网络中邻接关系建立过程相同。</li>
</ol>
<p><strong>点到点网络和点到多点网络</strong></p>
<p>点到点网络、点到多点网络中OSPF邻接关系建立的过程与广播网络相似。不同的是，在点到点、点到多点网络中不需要选举DR和BDR，且点到点网络中的DD报文是单播发送的。</p>
<h4 id="6-2-1-8-OSPF区域"><a href="#6-2-1-8-OSPF区域" class="headerlink" title="6.2.1.8  OSPF区域"></a>6.2.1.8  OSPF区域</h4><p>随着网络规模日益扩大，当一个大型网络中的路由器都运行OSPF路由协议时，路由器数量的增多会导致链路状态数据库LSDB（Link-State Database）非常庞大，占用大量的存储空间，并使得运行SPF算法的复杂度增加，导致路由器负担很重。在网络规模增大之后，拓扑结构发生变化的概率也增大，网络会经常处于“动荡”之中，造成网络中会有大量的OSPF协议报文在传递，降低了网络的带宽利用率。更为严重的是，每一次变化都会导致网络中所有的路由器重新进行路由计算。</p>
<p>OSPF协议通过将自治系统划分成不同的区域解决LSDB频繁更新的问题，提高网络的利用率。区域是从逻辑上将路由器划分为不同的组，每个组用区域号（Area ID）来标识。区域的边界是路由器，而不是链路。一个网段（链路）只能属于一个区域，或者说每个运行OSPF的接口必须指明属于哪一个区域。</p>
<p>在了解OSPF区域之前，需要先了解与区域相关的两个概念：路由器类型和路由类型。</p>
<h5 id="路由器类型"><a href="#路由器类型" class="headerlink" title="路由器类型"></a>路由器类型</h5><p>OSPF协议中常用到的路由器类型如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_112201">图6-18</a>所示。</p>
<p><strong>图6-18</strong>  路由器类型<br><img src="http://support.huawei.com/enterprise/product/images/c7efd0b2fb4b4a3198e9435cf660b031" alt="img" loading="lazy"></p>
<p><strong>表6-3</strong>  路由器类型</p>
<table>
<thead>
<tr>
<th>路由器类型</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>区域内路由器（Internal Router）</td>
<td>该类设备的所有接口都属于同一个OSPF区域。</td>
</tr>
<tr>
<td>区域边界路由器ABR（Area Border Router）</td>
<td>该类设备可以同时属于两个以上的区域，但其中一个必须是骨干区域。ABR用来连接骨干区域和非骨干区域，它与骨干区域之间既可以是物理连接，也可以是逻辑上的连接。</td>
</tr>
<tr>
<td>骨干路由器（Backbone Router）</td>
<td>该类设备至少有一个接口属于骨干区域。所有的ABR和位于Area0的内部设备都是骨干路由器。</td>
</tr>
<tr>
<td>自治系统边界路由器ASBR（AS Boundary Router）</td>
<td>与其他AS交换路由信息的设备称为ASBR。ASBR并不一定位于AS的边界，它可能是区域内设备，也可能是ABR。只要一台OSPF设备引入了外部路由的信息，它就成为ASBR。</td>
</tr>
</tbody></table>
<h5 id="路由类型"><a href="#路由类型" class="headerlink" title="路由类型"></a>路由类型</h5><p>AS区域内和区域间路由描述的是AS内部的网络结构，AS外部路由则描述了应该如何选择到AS以外目的地址的路由。OSPF将引入的AS外部路由分为Type1和Type2两类。</p>
<p><a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_feature_ospf_1122_mMcCpPsS_table_02">表6-4</a>中按优先级从高到低顺序列出了路由类型。</p>
<p><strong>表6-4</strong>  路由类型</p>
<table>
<thead>
<tr>
<th>路由类型</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>Intra Area</td>
<td>区域内路由。</td>
</tr>
<tr>
<td>Inter Area</td>
<td>区域间路由。</td>
</tr>
<tr>
<td>第一类外部路由（Type1 External）</td>
<td>这类路由的可信程度高一些，所以计算出的外部路由的开销与自治系统内部的路由开销是相当的，并且和OSPF自身路由的开销具有可比性。到第一类外部路由的开销=本设备到相应的ASBR的开销+ASBR到该路由目的地址的开销。</td>
</tr>
<tr>
<td>第二类外部路由（Type2 External）</td>
<td>这类路由的可信度比较低，所以OSPF协议认为从ASBR到自治系统之外的开销远大于在自治系统之内到达ASBR的开销。所以，OSPF计算路由开销时只考虑ASBR到自治系统之外的开销，即到第二类外部路由的开销=ASBR到该路由目的地址的开销。</td>
</tr>
</tbody></table>
<h5 id="区域类型"><a href="#区域类型" class="headerlink" title="区域类型"></a>区域类型</h5><p>OSPF的区域类型包括普通区域、Stub区域、NSSA区域。</p>
<p><strong>表6-5</strong>  区域类型</p>
<table>
<thead>
<tr>
<th>区域类型</th>
<th>作用</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>普通区域</td>
<td>缺省情况下，OSPF区域被定义为普通区域。普通区域包括：标准区域：最通用的区域，它传输区域内路由，区域间路由和外部路由。骨干区域：连接所有其他OSPF区域的中央区域，用<strong>Area 0</strong>表示。骨干区域负责区域之间的路由，非骨干区域之间的路由信息必须通过骨干区域来转发。</td>
<td>骨干区域自身必须保持连通。所有非骨干区域必须与骨干区域保持连通。</td>
</tr>
<tr>
<td>Stub区域</td>
<td>Stub区域是一些特定的区域，Stub区域的ABR不传播它们接收到的自治系统外部路由，因此这些区域中路由器的路由表规模以及路由信息传递的数量都会大大减少。一般情况下，Stub区域位于自治系统的边界，是只有一个ABR的非骨干区域，为保证到自治系统外的路由依旧可达，Stub区域的ABR将生成一条缺省路由，并发布给Stub区域中的其他非ABR路由器。Totally Stub区域允许ABR发布Type3缺省路由，不允许发布自治系统外部路由和区域间的路由，只允许发布区域内路由。</td>
<td>骨干区域不能配置成Stub区域。Stub区域内不能存在ASBR，因此自治系统外部的路由不能在本区域内传播。虚连接不能穿过Stub区域。</td>
</tr>
<tr>
<td>NSSA（Not-So-Stubby Area）区域</td>
<td>NSSA是Stub区域的一个变形，它和Stub区域有许多相似的地方。NSSA区域不允许存在Type5 LSA。NSSA区域允许引入自治系统外部路由，携带这些外部路由信息的Type7 LSA由NSSA的ASBR产生，仅在本NSSA内传播。当Type7 LSA到达NSSA的ABR时，由ABR将Type7 LSA转换成Type5 LSA，泛洪到整个OSPF域中。Totally NSSA区域不允许发布自治系统外部路由和区域间的路由，只允许发布区域内路由。</td>
<td>该区域的ABR发布Type7 LSA缺省路由传播到区域内，所有域间路由都必须通过ABR才能发布。虚连接不能穿过NSSA区域。</td>
</tr>
</tbody></table>
<p>OSPF网络划分区域以后，一个区域内参与SPF算法的只有区域内的LSA，其他的区域的LSA不参与本区域的SPF算法。如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_112204">图6-19</a>所示，Area 1中的链路质量不好一直处于闪断中，所以Area 1的SPF算法会频繁运算。但是这种影响仅局限在Area 1内，其他区域不会因此而重新进行SPF运算，网络的震荡被限制在一个更小的范围内，提高了网络的稳定性。</p>
<p><strong>图6-19</strong>  划分区域后链路震荡的影响范围减小<br><img src="http://support.huawei.com/enterprise/product/images/897242c5165642e8acbc439cda8a5eae" alt="img" loading="lazy"></p>
<p><strong>Stub区域和Totally Stub区域</strong></p>
<p>如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_112202">图6-20</a>所示，OSPF划分了Area 0和Area 2，并且Area 0内的ASBR引入了外部路由。通常情况下，为了保证网络的路由可达性，可能把网络的各个角落的路由全都发布进了OSPF。此时，虽然各路由设备都能够到达网络的各个角落了，但如果网络越来越大，设备越来越多，那么每台设备的路由表项就会越来越大，而维护一个大规模的路由表项是需要消耗很多CPU及内存资源的。特别是对于一些边缘区域，设备性能可能比较低，维护大规模的路由表项会对设备性能带来巨大压力。</p>
<p><strong>图6-20</strong>  Stub区域和Totally Stub区域<br><img src="http://support.huawei.com/enterprise/product/images/8ff7e47c94524cae807edf1a7d0a0312" alt="img" loading="lazy"></p>
<p>从网络优化的角度考虑，通常在保证网络可达性的同时应尽量减小路由表项的规模，减少网络中LSA报文的泛洪。Area 2如果作为一个常规区域，那么可能存在Type1、Type2、Type3、Type4、Type5共计5中类型的LSA。对于Area 2中的路由器，无论想到达区域外的哪个网络，都必须首先到达到ABR路由器，也就是说这个时候Area 2中的其他路由器并不需要了解外部网络的细节。这种情况下，就产生了OSPF的Stub区域。</p>
<p>Stub区域是一种特殊的区域。Stub区域的ABR不传播它们接收到的自治系统外部路由，在这些区域中路由器的路由表规模以及路由信息传递的数量都会大大减少。</p>
<p>Stub区域是一种可选的配置属性，但并不是每个区域都符合配置的条件。通常来说，Stub区域位于自治系统的边界，是那些只有一个ABR的非骨干区域。</p>
<p>为保证到自治系统外的路由依旧可达，Stub区域的ABR将生成一条缺省路由，并发布给Stub区域中的其他非ABR路由器。</p>
<p>配置Stub区域时需要注意下列几点：</p>
<ul>
<li>骨干区域不能配置成Stub区域。</li>
<li>如果要将一个区域配置成Stub区域，则该区域中的所有路由器都要配置Stub区域属性。</li>
<li>Stub区域内不能存在ASBR，即自治系统外部的路由不能在本区域内传播。</li>
<li>虚连接不能穿过Stub区域。</li>
</ul>
<p>对于Area 2中的路由器来说，其实区域间的明细路由也没必要都了解，仅保留一个出口让Area 2中的路由器的数据包能够出去就足够了，这就产生了OSPF的Totally Stub区域。Totally Stub区域中，既不允许自治系统外部的路由在区域内传播，也不允许区域间路由在区域内传播，这样就进一步减少了区域内LSA的数量。</p>
<p><strong>NSSA区域和Totally NSSA区域</strong></p>
<p>如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_112203">图6-21</a>所示，假设Area 2原来作为一个Stub区域运行，但是有个外部网络需要通过Area 2接入到这个OSPF网络，也就是需要将自治系统外部路由引入并传播到整个OSPF自治系统中。此时可以在RouterA上将外部路由注入到OSPF自治系统，但是这样RouterA将成为ASBR，因此，Area 2也就不是Stub区域了。针对这种场景，OSPF定义了NSSA区域。</p>
<p><strong>图6-21</strong>  NSSA区域和Totally NSSA区域<br><img src="http://support.huawei.com/enterprise/product/images/861cfafbcc224151bc56e0a3adba4cae" alt="img" loading="lazy"></p>
<p>相比于Stub区域，NSSA区域能够将自治系统外部路由引入并传播到整个OSPF自治系统中，同时又不会学习来自OSPF网络其它区域的路由。</p>
<p>在NSSA区域中，为保证到自治系统外的路由可达，NSSA区域的ABR将生成一条缺省路由，并发布给NSSA区域中的其他路由器。</p>
<p>配置NSSA区域时需要注意下列几点：</p>
<ul>
<li>骨干区域不能配置成NSSA区域。</li>
<li>如果要将一个区域配置成NSSA区域，则该区域中的所有路由器都要配置NSSA区域属性。</li>
<li>虚连接不能穿过NSSA区域。</li>
</ul>
<p>在NSSA区域中，可能同时存在多个ABR，为了防止路由环路产生，边界路由器之间不计算对方发布的缺省路由。</p>
<p>一个区域内所有路由器上配置的区域类型必须保持一致。OSPF在Hello报文中使用N-bit来标识路由器支持的区域类型，区域类型选择不一致的路由器不能建立OSPF邻居关系。虽然协议有要求，但有些厂商实现时违背了这一原则，在OSPF DD报文中也置位了N-bit。为了和这些厂商互通，交换机的实现方式是可以通过命令设置N-bit来兼容。</p>
<p>与Totally Stub区域类似，为了进一步减少NSSA区域中LSA的数量，OSPF还定义了Totally NSSA区域。</p>
<h5 id="OSPF区域间环路及防环方法"><a href="#OSPF区域间环路及防环方法" class="headerlink" title="OSPF区域间环路及防环方法"></a>OSPF区域间环路及防环方法</h5><p>OSPF在区域内部运行的是SPF算法，这个算法能够保证区域内部的路由不会成环。然而划分区域后，区域之间的路由传递实际上是一种类似距离矢量算法的方式，这种方式容易产生环路。</p>
<p>为了避免区域间的环路，OSPF规定直接在两个非骨干区域之间发布路由信息是不允许的，只允许在一个区域内部或者在骨干区域和非骨干区域之间发布路由信息。因此，每个ABR都必须连接到骨干区域。</p>
<p>假设OSPF允许非骨干区域之间直接传递路由，则可能会导致区域间环路。如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_112205">图6-22</a>所示，骨干区连接到其他网络的路由信息会传递至Area 1。假设非骨干区之间允许直接传递路由信息，那么这条路由信息最终又被传递回去，形成区域间的路由环路。为了防止这种区域间环路，OSPF禁止Area 1和Area 3，以及Area 2和Area 3之间直接进行路由交互，而必须通过骨干区域进行路由交互。这样就能防止区域间环路的产生。</p>
<p><strong>图6-22</strong>  OSPF区域间环路<br><img src="http://support.huawei.com/enterprise/product/images/784f45b916ce446fb56ce65526d53920" alt="img" loading="lazy"></p>
<h5 id="OSPF缺省路由"><a href="#OSPF缺省路由" class="headerlink" title="OSPF缺省路由"></a>OSPF缺省路由</h5><p>缺省路由是指目的地址和掩码都是0的路由。当设备无精确匹配的路由时，就可以通过缺省路由进行报文转发。由于OSPF路由的分级管理，Type3缺省路由的优先级高于Type5或Type7路由。</p>
<p>OSPF缺省路由通常应用于下面两种情况：</p>
<ul>
<li>由区域边界路由器（ABR）发布Type3缺省Summary LSA，用来指导区域内设备进行区域之间报文的转发。</li>
<li>由自治系统边界路由器（ASBR）发布Type5外部缺省ASE LSA，或者Type7外部缺省NSSA LSA，用来指导自治系统（AS）内设备进行自治系统外报文的转发。</li>
</ul>
<p>OSPF缺省路由的发布原则如下：</p>
<ul>
<li>OSPF路由器只有具有对区域外的出口时，才能够发布缺省路由LSA。</li>
<li>如果OSPF路由器已经发布了缺省路由LSA，那么不再学习其它路由器发布的相同类型缺省路由。即路由计算时不再计算其它路由器发布的相同类型的缺省路由LSA，但数据库中存有对应LSA。</li>
<li>外部缺省路由的发布如果要依赖于其它路由，那么被依赖的路由不能是本OSPF路由域内的路由，即不是本进程OSPF学习到的路由。因为外部缺省路由的作用是用于指导报文的域外转发，而本OSPF路由域的路由的下一跳都指向了域内，不能满足指导报文域外转发的要求。</li>
</ul>
<p>不同区域缺省路由发布原则如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#table_04">表6-6</a>所示。</p>
<p><strong>表6-6</strong>  OSPF缺省路由发布原则</p>
<table>
<thead>
<tr>
<th>区域类型</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>普通区域</td>
<td>缺省情况下，普通OSPF区域内的OSPF路由器是不会产生缺省路由的，即使它有缺省路由。当网络中缺省路由通过其他路由进程产生时，路由器必须将缺省路由通告到整个OSPF自治系统中。实现方法是在ASBR上手动通过命令进行配置，产生缺省路由。配置完成后，路由器会产生一个缺省ASE LSA（Type5 LSA），并且通告到整个OSPF自治系统中。</td>
</tr>
<tr>
<td>Stub区域</td>
<td>Stub区域不允许自治系统外部的路由（Type5 LSA）在区域内传播。区域内的路由器必须通过ABR学到自治系统外部的路由。实现方法是ABR会自动产生一条缺省的Summary LSA（Type3 LSA）通告到整个Stub区域内。这样，到达自治系统的外部路由就可以通过ABR到达。</td>
</tr>
<tr>
<td>Totally Stub区域</td>
<td>Totally Stub区域既不允许自治系统外部的路由（Type5 LSA）在区域内传播，也不允许区域间路由（Type3 LSA）在区域内传播。区域内的路由器必须通过ABR学到自治系统外部和其他区域的路由。实现方法是配置Totally Stub区域后，ABR会自动产生一条缺省的Summary LSA（Type3 LSA）通告到整个Stub区域内。这样，到达自治系统外部的路由和其他区域间的路由都可以通过ABR到达。</td>
</tr>
<tr>
<td>NSSA区域</td>
<td>NSSA区域允许引入通过本区域的ASBR到达的少量外部路由，但不允许其他区域的外部路由ASE LSA（Type5 LSA）在区域内传播。即到达自治系统外部的路由只能通过本区域的ASBR到达。只配置了NSSA区域是不会自动产生缺省路由的。此时，有两种选择：如果希望到达自治系统外部的路由通过该区域的ASBR到达，而其它外部路由通过其它区域出去。此时，ABR会产生一条Type7 LSA的缺省路由，通告到整个NSSA区域内。这样，除了某少部分路由通过NSSA的ASBR到达，其它路由都可以通过NSSA的ABR到达其它区域的ASBR出去。如果希望所有的外部路由只通过本区域NSSA的ASBR到达。则必须在ASBR上手动通过命令进行配置，使ASBR产生一条缺省的NSSA LSA（Type7 LSA），通告到整个NSSA区域内。这样，所有的外部路由就只能通过本区域NSSA的ASBR到达。上面两种情况的区别是：在ABR上无论路由表中是否存在缺省路由0.0.0.0，都会产生Type7 LSA的缺省路由。在ASBR上只有当路由表中存在缺省路由0.0.0.0时，才会产生Type7 LSA的缺省路由。因为缺省路由只是在本NSSA区域内泛洪，并没有泛洪到整个OSPF域中，所以本NSSA区域内的路由器在找不到路由之后可以从该NSSA的ASBR出去，但不能实现其他OSPF域的路由从这个出口出去。Type7 LSA缺省路由不会在ABR上转换成Type5 LSA缺省路由泛洪到整个OSPF域。</td>
</tr>
<tr>
<td>Totally NSSA区域</td>
<td>Totally NSSA区域既不允许其他区域的外部路由ASE LSA（Type5 LSA）在区域内传播，也不允许区域间路由（Type3 LSA）在区域内传播。区域内的路由器必须通过ABR学到其他区域的路由。实现方法是配置Totally NSSA区域后，ABR会自动产生一条缺省的Type3 LSA通告到整个NSSA区域内。这样，其他区域的外部路由和区域间路由都可以通过ABR在区域内传播。</td>
</tr>
</tbody></table>
<h4 id="6-2-1-9-OSPF-LSA类型"><a href="#6-2-1-9-OSPF-LSA类型" class="headerlink" title="6.2.1.9  OSPF LSA类型"></a>6.2.1.9  OSPF LSA类型</h4><p>OSPF网络中划分了不同的区域，每个区域都维护自己独立的LSDB，同时路由器也被定义成不同的类型。封装了路由描述信息的LSA根据路由器的类型也可以分门别类。</p>
<p><a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_112301">图6-23</a>是一个被划分区域的OSPF网络。R4上配置了静态路由，在R4上将静态路由引入到OSPF进程中。</p>
<p><strong>图6-23</strong>  划分区域的OSPF网络<br><img src="http://support.huawei.com/enterprise/product/images/df9cd1e3eebd4cf3bab313edfe215e0a" alt="img" loading="lazy"></p>
<p>R1、R2、R3、R4的Router ID及各接口的IP地址如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_feature_ospf_1123_mMcCpPsS_table_01">表6-7</a>所示。</p>
<p><strong>表6-7</strong>  数据规划</p>
<table>
<thead>
<tr>
<th>设备</th>
<th>Router ID</th>
<th>接口IP地址</th>
</tr>
</thead>
<tbody><tr>
<td>R1</td>
<td>10.1.1.1/32</td>
<td>GE0/0/1：192.168.12.1/24</td>
</tr>
<tr>
<td>R2</td>
<td>10.2.2.2/32</td>
<td>GE0/0/2：192.168.12.2/24GE0/0/1：192.168.23.1/24</td>
</tr>
<tr>
<td>R3</td>
<td>10.3.3.3/32</td>
<td>GE0/0/2：192.168.23.2/24GE0/0/1：192.168.34.1/24</td>
</tr>
<tr>
<td>R4</td>
<td>10.4.4.4/32</td>
<td>GE0/0/2：192.168.34.2/24</td>
</tr>
</tbody></table>
<p>下面结合<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_112301">图6-23</a>所示的网络介绍各类LSA。</p>
<h5 id="Router-LSA"><a href="#Router-LSA" class="headerlink" title="Router-LSA"></a>Router-LSA</h5><p>Router-LSA是一种最基本的LSA，即Type1 LSA。</p>
<p>OSPF网络里的每一台路由设备都会发布Type1 LSA。这种类型的LSA用于描述设备的链路状态和开销，在路由器所属的区域内传播。以R2为例，如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_112302">图6-24</a>所示，R2在Area 0、Area 1会分别发布Router-LSA。</p>
<p><strong>图6-24</strong>  Type1 Router-LSA<br><img src="http://support.huawei.com/enterprise/product/images/28e5b3f3f7cf42f08a7251f502003464" alt="img" loading="lazy"></p>
<p>以R2在接口GE0/0/1上泛洪的一条Router-LSA为例，该LSA中包含的信息如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_112303">图6-25</a>所示。</p>
<p><strong>图6-25</strong>  Router-LSA信息<br><img src="http://support.huawei.com/enterprise/product/images/1d061332638f42679570e7bc3760cf21" alt="img" loading="lazy"></p>
<p>LSA报文包括LSA头部和LSA信息字段。所有类型的LSA报文，其LSA头部包含的字段都是一样的，唯一不同的是Link State ID字段含义。在LSA头部中，主要关注以下三个字段：</p>
<ul>
<li>Link-State Advertisement Type：LSA类型。</li>
<li>Link State ID：链路状态ID。在Router-LSA中代表始发该LSA的设备的Router ID，这里即是R2自己的Router ID。</li>
<li>Advertising Router：通告路由器。</li>
</ul>
<p>Router-LSA的信息字段有三个，用于将自己连接的所有链路的状况以及开销告诉该LSA泛洪区域的其他路由器。</p>
<p><a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_112303">图6-25</a>所示的LSA描述的信息为：链路类型（Type）为一个传送网络（Transit），DR接口的IP地址（ID）为192.168.23.2，和网络相连的通告路由器接口的IP地址是192.138.23.1（Data），到达该网络的开销（Metric）是1。收到该LSA报文的路由器根据这些链路状态的描生成拓扑。</p>
<p>其中，Link Type有四种类型，并且ID和Data的值会根据Link Type而有不同：</p>
<ul>
<li>1-P2P（点对点）：此时ID表示邻居路由设备的Router ID，Data表示和网络相连的通告路由器接口的IP地址。</li>
<li>2-Transit（传送网络）：此时ID表示DR接口的IP地址，Data表示和网络相连的通告路由器接口的IP地址。</li>
<li>3-Stub（末梢网络）：此时ID表示IP网络或子网地址，Data表示网络的IP地址或子网掩码。</li>
<li>4-Virtual Link（虚链路）：此时ID表示邻居路由设备的Router ID，Data表示通告路由器接口的MIB-II ifIndex值。</li>
</ul>
<h5 id="Network-LSA"><a href="#Network-LSA" class="headerlink" title="Network-LSA"></a>Network-LSA</h5><p>Network-LSA，也就是Type2 LSA，由DR（Designated Router）产生，描述本网段的链路状态，在所属的区域内传播。如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_112304">图6-26</a>所示，R3向R2发送一条Network-LSA，列出了所有与DR形成完全邻接关系的路由器的Router ID。</p>
<p><strong>图6-26</strong>  Type2 Network-LSA<br><img src="http://support.huawei.com/enterprise/product/images/59d41ae5dd93492dbfe55f6279495191" alt="img" loading="lazy"></p>
<p>该Network-LSA中包含的信息如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_112305">图6-27</a>所示。</p>
<p><strong>图6-27</strong>  Network-LSA信息<br><img src="http://support.huawei.com/enterprise/product/images/99d4c40766404752b80be71a36bb3686" alt="img" loading="lazy"></p>
<p>在Network-LSA中，Link State ID字段的含义是DR接口上的IP地址。</p>
<p>通过Router-LSA和Network-LSA在区域内洪泛，区域内每个路由器可以完成LSDB同步，这就解决了区域内部的通信问题。</p>
<h5 id="Network-summary-LSA"><a href="#Network-summary-LSA" class="headerlink" title="Network-summary-LSA"></a>Network-summary-LSA</h5><p>Network-summary-LSA，也叫Type3 LSA，由ABR发布，用来描述区域间的路由信息。ABR将Network-summary-LSA发布到一个区域，通告该区域到其他区域的目的地址。实际上，ABR是将区域内部的Type1和Type2的信息收集起来并汇总之后扩散出去，这就是Summay的含义。如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_112306">图6-28</a>所示，R2作为ABR，将Area 0和Area 1中的路由信息分别发布对方区域。</p>
<p><strong>图6-28</strong>  Type3 Network-summary-LSA<br><img src="http://support.huawei.com/enterprise/product/images/74d4be3a0b9d4391b9909c9fd35d5bac" alt="img" loading="lazy"></p>
<p>如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_112307">图6-29</a>所示，是R2在接口GE0/0/1上发布的一条Network-summary-LSA。</p>
<p><strong>图6-29</strong>  Network-summary-LSA信息<br><img src="http://support.huawei.com/enterprise/product/images/5f0c3d095de84160bce2f64f02f2efdd" alt="img" loading="lazy"></p>
<p>在Network-summary-LSA中，Link State ID字段代表该LSA所描述网络的网络地址。从LSA的信息中可以看出，该LSA由R2发布（10.2.2.2），可以到达192.168.12.0，掩码为255.255.255.0的网络，代价为1。R2将Area 1中的网络地址在Area 0中发布，从而让Area 0中的路由器知道去该网络的路径，实现区域间的通信。</p>
<p>如果—台ABR在与它本身相连的区域内有多条路由可以到达目的地，那么它将只会始发单一的一条网络汇总LSA到骨干区域，而且这条网络汇总LSA是上述多条路由中代价最低的。</p>
<p>Network-summary-LSA不会通告给Totally Stub和Totally NSSA区域。</p>
<h5 id="ASBR-Summary-LSA"><a href="#ASBR-Summary-LSA" class="headerlink" title="ASBR-Summary-LSA"></a>ASBR-Summary-LSA</h5><p>ASBR-summary-LSA，也叫Type4 LSA，由ABR发布，描述到ASBR的路由信息，并通告给除ASBR所在区域的其他相关区域。如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_112308">图6-30</a>所示，R3作为ABR通告ASBR-summary-LSA到Area 0中。</p>
<p><strong>图6-30</strong>  Type4 ASBR-summary-LSA<br><img src="http://support.huawei.com/enterprise/product/images/246e618ffa424079b829d9f6ffc358d8" alt="img" loading="lazy"></p>
<p>ASBR-summary-LSA信息如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_112309">图6-31</a>所示。其中，Link State ID表示该LSA所描述的ASBR的Router ID（10.4.4.4），即R4，发布该LSA的路由设备是R3（10.3.3.3），R3到达R4的代价是1。</p>
<p><strong>图6-31</strong>  ASBR-summary-LSA信息<br><img src="http://support.huawei.com/enterprise/product/images/389bb0861b87491399c42e865cd34c10" alt="img" loading="lazy"></p>
<h5 id="AS-external-LSA"><a href="#AS-external-LSA" class="headerlink" title="AS-external-LSA"></a>AS-external-LSA</h5><p>AS-external-LSA，也叫Type5 LSA，由ASBR产生，描述到AS外部的路由，通告到除Stub区域和NSSA区域以外所有的区域。如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_112310">图6-32</a>所示，R4作为ASBR发布了一条OSPF AS到外部目的网络的路由信息。</p>
<p><strong>图6-32</strong>  Type5 AS-external-LSA<br><img src="http://support.huawei.com/enterprise/product/images/9f0165e80290478fad395c1940ed17dc" alt="img" loading="lazy"></p>
<p>AS-external-LSA中包含的信息如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_112311">图6-33</a>所示。其中，Link State ID代表外部网络目的IP地址，转发地址是指到达该外部网络的数据包应该被转发到的地址。此处的转发地址为0.0.0.0表示数据包将被转发到始发ASBR上。</p>
<p><strong>图6-33</strong>  AS-external-LSA信息<br><img src="http://support.huawei.com/enterprise/product/images/53e023b149c247c3bfb752f15bf49922" alt="img" loading="lazy"></p>
<h5 id="NSSA-LSA"><a href="#NSSA-LSA" class="headerlink" title="NSSA LSA"></a>NSSA LSA</h5><p>除了上述几种LSA之外，还有一种比较特殊的LSA，NSSA LSA，也叫Type7 LSA。NSSA LSA由ASBR产生，描述到AS外部的路由，仅在NSSA区域内传播。NSSA区域的ABR收到NSSA LSA时，会有选择地将其转化为Type5 LSA，以便将外部路由信息通告到OSPF网络的其它区域。</p>
<p>如果<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_112301">图6-23</a>中的Area 2为NSSA区域，R4的接口GE0/0/2会始发一条NSSA LSA，如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_112312">图6-34</a>所示。</p>
<p><strong>图6-34</strong>  NSSA LSA<br><img src="http://support.huawei.com/enterprise/product/images/b4f3577fa46a48e68fc3d29b4c0907d7" alt="img" loading="lazy"></p>
<p>NSSA LSA所有的字段与AS-external-LSA字段均相同，但这两种LSA泛洪的区域不同。AS-external-LSA是在整个AS泛洪，而NSSA LSA仅在NSSA区域中泛洪。</p>
<p>NSSA区域允许引入外部路由，但描述外部路由信息的NSSA LSA只能在本区域泛洪。为了使外部路由能被引入到除NSSA区域以外的其他区域，NSSA LSA在ABR（R3）上会转换成AS-external-LSA，并且泛洪到骨干区直至整个自治系统中。</p>
<ul>
<li>P-bit（Propagate bit）用于告知转化路由器该条Type7 LSA是否需要转化。</li>
<li>缺省情况下，转化路由器是NSSA区域中Router ID最大的ABR。</li>
<li>只有P-bit置位并且FA（Forwarding Address）不为0的NSSA LSA才能转化为AS-external-LSA。FA用来表示发送的某个目的地址的报文将被转发到FA所指定的地址。</li>
<li>区域边界路由器产生的NSSA LSA不会置位P-bit。</li>
</ul>
<h5 id="Opaque-LSA"><a href="#Opaque-LSA" class="headerlink" title="Opaque LSA"></a>Opaque LSA</h5><p>Opaque LSA包括Type9 LSA，Type10 LSA和Type11 LSA，用于OSPF的扩展通用机制。</p>
<ul>
<li>Type9 LSA仅在接口所在网段范围内传播。用于支持GR的Grace LSA就是Type9 LSA的一种。</li>
<li>Type10 LSA在区域内传播。用于支持TE的LSA就是Type10 LSA的一种。</li>
<li>Type11 LSA在自治系统内传播，目前还没有实际应用的例子。</li>
</ul>
<h4 id="6-2-1-10-OSPF快速收敛"><a href="#6-2-1-10-OSPF快速收敛" class="headerlink" title="6.2.1.10  OSPF快速收敛"></a>6.2.1.10  OSPF快速收敛</h4><p>OSPF快速收敛是为了提高路由的收敛速度而做的扩展特性。包括：</p>
<ul>
<li><p>OSPF按优先级收敛</p>
<p>OSPF按优先级收敛是指在大量路由情况下，能够让某些特定的路由优先收敛的一种技术。通过对不同的路由配置不同的收敛优先级，达到重要的路由先收敛的目的，提高网络的可靠性。因此，用户可以把和关键业务相关的路由配置成相对较高的优先级，使这些路由更快的收敛，从而使关键的业务受到的影响减小。</p>
</li>
<li><p>PRC（Partial Route Calculation）部分路由计算</p>
<p>当网络上路由发生变化的时候，只对发生变化的路由进行重新计算。</p>
</li>
<li><p>通过智能定时器控制LSA的生成与接收，达到对低频变化快速响应，又能对高频变化起到有效抑制的目的。</p>
<p>RFC2328通过如下两个规定来避免网络连接或者路由频繁动荡引起的过多占用设备资源：</p>
<ul>
<li>同一条LSA在1秒内不能再次生成，即LSA的更新时间间隔5秒。</li>
<li>LSA被接收的时间间隔为1秒。</li>
</ul>
<p>在网络相对稳定、对路由收敛时间要求较高的组网环境中，可以通过智能定时器指定LSA的更新、被接收的时间间隔为0，使得拓扑或者路由的变化可以通过LSA发布到网络中，或者立即被感知到，从而加快路由的收敛。</p>
</li>
<li><p>通过智能定时器控制路由计算</p>
<p>当网络发生变化时，OSPF需要重新进行路由计算，为避免频繁的网络变化对设备造成的冲击，标准RFC2328规定路由计算时要使用延迟定时器，定时器超时后才进行路由计算。但标准协议中，该定时器定时间隔固定，无法做到既能快速响应又能抑制震荡。</p>
<p>通过智能定时器来控制路由计算的延迟时间，达到对低频率变化快速响应，又能对高频率变化起到有效抑制的目的。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_feature_ospf_0007">6.2.2.6 OSPF Smart-discover</a></p>
</li>
</ul>
<h4 id="6-2-1-11-OSPF虚连接"><a href="#6-2-1-11-OSPF虚连接" class="headerlink" title="6.2.1.11  OSPF虚连接"></a>6.2.1.11  OSPF虚连接</h4><p>虚连接（Virtual link）是指在两台ABR之间通过一个非骨干区域建立的一条逻辑上的连接通道。</p>
<p>根据RFC 2328，在部署OSPF时，要求所有的非骨干区域与骨干区域相连，否则会出现有的区域不可达的问题。但是在实际应用中，可能会因为各方面条件的限制，无法满足所有非骨干区域与骨干区域保持连通的要求，此时可以通过配置OSPF虚连接来解决这个问题。</p>
<p>如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_112401">图6-35</a>所示，Area 2没有连接到骨干区Area 0，所以RouterA不能作为ABR向Area 2生成Area 0中Network1的路由信息，所以RouterB上没有到达Network1的路由。此时可以考虑部署虚连接来解决这个问题。</p>
<p><strong>图6-35</strong>  OSPF非骨干区没有连接骨干区<br><img src="http://support.huawei.com/enterprise/product/images/b8056316558143ac8d378739dfd3fcaf" alt="img" loading="lazy"></p>
<p>如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_112402">图6-36</a>所示，通过虚连接，两台ABR之间直接传递OSPF报文信息，两者之间的OSPF设备只是起到一个转发报文的作用。由于OSPF协议报文的目的地址不是这些设备，所以这些报文对于两者而言是透明的，只是当作普通的IP报文来转发。</p>
<p><strong>图6-36</strong>  OSPF虚连接实现原理<br><img src="http://support.huawei.com/enterprise/product/images/bbff4c7b79b5472ab3ac45ac1a8afa35" alt="img" loading="lazy"></p>
<p>虚连接相当于在两个ABR之间形成了一个点到点的连接，因此，虚连接的两端和物理接口一样可以配置接口的各参数，如发送Hello报文间隔等。为虚连接两端提供一条非骨干区域内部路由的区域称为传输区域（Transit Area）。配置虚连接时，必须在两端同时配置方可生效。</p>
<p>然而，虚连接的存在增加了网络的复杂程度，而且使故障的排除更加困难。因此，在网络规划中应该尽量避免使用虚连接。虚连接仅是作为修复无法避免的网络拓扑问题的一种临时手段。虚链路可以看作是一个标明网络的某个部分是否需要重新规划设计的标志。</p>
<h4 id="6-2-1-12-OSPF路由聚合和路由过滤"><a href="#6-2-1-12-OSPF路由聚合和路由过滤" class="headerlink" title="6.2.1.12  OSPF路由聚合和路由过滤"></a>6.2.1.12  OSPF路由聚合和路由过滤</h4><h5 id="OSPF路由聚合"><a href="#OSPF路由聚合" class="headerlink" title="OSPF路由聚合"></a>OSPF路由聚合</h5><p>路由聚合是指ABR可以将具有相同前缀的路由信息聚合到一起，只发布一条路由到其它区域。</p>
<p>区域间通过路由聚合，可以减少路由信息，从而减小路由表的规模，提高设备的性能。</p>
<p>OSPF有两种路由聚合方式：</p>
<ul>
<li><p>ABR聚合</p>
<p>ABR向其它区域发送路由信息时，以网段为单位生成Type3 LSA。如果该区域中存在一些连续的网段，则可以通过命令将这些连续的网段聚合成一个网段。这样ABR只发送一条聚合后的LSA，所有属于命令指定的聚合网段范围的LSA将不会再被单独发送出去。</p>
</li>
<li><p>ASBR聚合</p>
<p>配置路由聚合后，如果本地设备是自治系统边界路由器ASBR，将对引入的聚合地址范围内的Type5 LSA进行聚合。当配置了NSSA区域时，还要对引入的聚合地址范围内的Type7 LSA进行聚合。</p>
<p>如果本地设备既是ASBR又是ABR，则对由Type7 LSA转化成的Type5 LSA进行聚合处理。</p>
</li>
</ul>
<h5 id="OSPF路由过滤"><a href="#OSPF路由过滤" class="headerlink" title="OSPF路由过滤"></a>OSPF路由过滤</h5><p>OSPF支持使用路由策略对路由信息进行过滤。缺省情况下，OSPF不进行路由过滤。</p>
<p>OSPF可以使用的路由策略包括route-policy、访问控制列表（access-list）和地址前缀列表（prefix-list）。</p>
<p>OSPF路由过滤可以应用于以下几个方面：</p>
<ul>
<li><p>路由引入</p>
<p>OSPF可以引入其它路由协议学习到的路由。在引入时可以通过配置路由策略来过滤路由，只引入满足条件的路由。</p>
</li>
<li><p>引入路由发布</p>
<p>OSPF引入了路由后会向其它邻居发布引入的路由信息。</p>
<p>可以通过配置过滤规则来过滤向邻居发布的路由信息。该过滤规则只在ASBR上配置才有效。</p>
</li>
<li><p>路由学习</p>
<p>通过配置过滤规则，可以设置OSPF对接收到的区域内、区域间和自治系统外部的路由进行过滤。</p>
<p>该过滤只作用于路由表项的添加与否，即只有通过过滤的路由才被添加到本地路由表中，但所有的路由仍可以在OSPF路由表中被发布出去。</p>
</li>
<li><p>区域间LSA学习</p>
<p>通过命令可以在ABR上配置对进入本区域的Summary LSA进行过滤。该配置只在ABR上有效（只有ABR才能发布Summary LSA）。</p>
<p>区域间LSA学习和路由学习之间的差异在于：区域间LSA学习直接对进入区域的LSA进行过滤；路由学习不是对LSA进行过滤而是对LSA计算出来的路由是否添加本地路由表进行过滤，学习到的LSA是完整的。</p>
</li>
<li><p>区域间LSA发布</p>
<p>通过命令可以在ABR上配置对本区域出方向的Summary LSA进行过滤。该配置只在ABR上配置有效。</p>
</li>
</ul>
<h4 id="6-2-1-13-OSPF多进程"><a href="#6-2-1-13-OSPF多进程" class="headerlink" title="6.2.1.13  OSPF多进程"></a>6.2.1.13  OSPF多进程</h4><p>OSPF支持多进程，在同一台路由器上可以运行多个不同的OSPF进程，它们之间互不影响，彼此独立。不同OSPF进程之间的路由交互相当于不同路由协议之间的路由交互。</p>
<p>路由器的一个接口只能属于某一个OSPF进程。</p>
<p>OSPF多进程的一个典型应用就是在VPN场景中PE和CE之间运行OSPF协议，同时VPN骨干网上的IGP也采用OSPF。在PE上，这两个OSPF进程互不影响。</p>
<h4 id="6-2-1-14-OSPF-RFC1583兼容"><a href="#6-2-1-14-OSPF-RFC1583兼容" class="headerlink" title="6.2.1.14  OSPF RFC1583兼容"></a>6.2.1.14  OSPF RFC1583兼容</h4><p>RFC1583是OSPFv2协议比较早的版本。</p>
<p>OSPF在计算外部路由时，由于RFC2328和RFC1583的路由计算规则不一致，可能会导致路由环路。为了避免路由环路的发生，RFC2328中提出了RFC1583兼容特性。</p>
<ul>
<li>使能RFC1583兼容后，OSPF采用RFC1583的路由计算规则。</li>
<li>不使能RFC1583兼容时，OSPF采用RFC2328的路由计算规则。</li>
</ul>
<p>OSPF是根据5类LSA来计算外部路由的。RFC1583兼容特性主要用于路由器收到5类LSA后：</p>
<ul>
<li>选择到达产生该LSA的ASBR或该LSA所描述的转发地址（Forwarding Address）的路径；</li>
<li>选择到达相同目的地的外部路径。</li>
</ul>
<p>缺省情况下，OSPF兼容RFC1583。</p>
<h3 id="6-2-2-OSPF增强功能"><a href="#6-2-2-OSPF增强功能" class="headerlink" title="6.2.2  OSPF增强功能"></a>6.2.2  OSPF增强功能</h3><h4 id="6-2-2-1-OSPF-VPN"><a href="#6-2-2-1-OSPF-VPN" class="headerlink" title="6.2.2.1  OSPF VPN"></a>6.2.2.1  OSPF VPN</h4><h5 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h5><p>OSPF VPN多实例特性是为了支持在VPN场景中PE（Provider Edge）和CE（Customer Edge）之间能够运行OSPF协议、使用OSPF进行路由的学习和发布而在OSPF基础协议上进行的扩展。</p>
<h5 id="目的-1"><a href="#目的-1" class="headerlink" title="目的"></a>目的</h5><p>OSPF是一种应用广泛的IGP协议，很多情况下，VPN用户内部网络运行OSPF。如果能够在PE-CE之间使用OSPF，PE通过OSPF向CE发布VPN路由，则在CE上就不需要配置PE-CE之间的其它路由协议，从而简化CE的管理和配置。</p>
<h5 id="PE-CE间运行OSPF"><a href="#PE-CE间运行OSPF" class="headerlink" title="PE-CE间运行OSPF"></a>PE-CE间运行OSPF</h5><p>BGP/MPLS VPN中，PE之间使用MP-BGP传递路由信息，而PE-CE间则广泛使用OSPF进行路由学习和传递。</p>
<p>PE-CE间使用OSPF有如下优势：</p>
<ul>
<li>通常在一个Site内部使用OSPF学习路由。如果PE-CE间也使用OSPF则可以减少CE设备所支持的协议种类，降低对CE设备的要求。</li>
<li>同样，Site内部和PE-CE间都使用OSPF可以降低网络管理人员的工作复杂度，不必要求管理人员对多种协议熟练掌握。</li>
<li>PE-CE间使用OSPF可以方便从一个非VPN的骨干网转化为一个BGP/MPLS VPN网络。</li>
</ul>
<p>如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_000801">图6-37</a>所示，CE1、CE3和CE4都属于VPN1，图中OSPF之后的数字表示PE设备上运行的OSPF多实例进程号。</p>
<p><strong>图6-37</strong>  PE-CE间运行OSPF<br><img src="http://support.huawei.com/enterprise/product/images/f6c057db138649938b3eccabf52f50e1" alt="img" loading="lazy"></p>
<p>CE1上的路由发布给CE3和CE4过程可以描述为：</p>
<ol>
<li>PE1将CE1上的OSPF路由引入到BGP中，形成BGP VPNv4路由。</li>
<li>PE1通过MP-BGP将这些BGP VPNv4路由发布给PE2。</li>
<li>PE2将BGP VPNv4路由引入到OSPF，再发布给CE3和CE4。</li>
</ol>
<p>同理，CE4和CE3上的路由发布给CE1的过程类似。</p>
<h5 id="PE-CE间OSPF区域配置"><a href="#PE-CE间OSPF区域配置" class="headerlink" title="PE-CE间OSPF区域配置"></a>PE-CE间OSPF区域配置</h5><p>PE与CE之间的OSPF区域可以是非骨干区域，也可以是骨干区域（区域0），并且PE永远是ABR（Area Border Router）。</p>
<p>在OSPF VPN扩展应用中，MPLS VPN骨干网被看作是Area0。由于OSPF要求Area 0连续，因此，所有VPN Site的Area0必须与MPLS VPN骨干网相连。如果VPN Site中存在OSPF Area0，则CE接入的PE必须通过Area0与这个VPN Site的骨干区域相连（可以通过Virtual-link实现逻辑连通），如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_000802">图6-38</a>所示。</p>
<p><strong>图6-38</strong>  PE-CE间OSPF区域配置<br><img src="http://support.huawei.com/enterprise/product/images/18e63c141f204672ac34b1ddbab2387b" alt="img" loading="lazy"></p>
<p>PE-CE间配置为非骨干区域1，而Site1内配置了骨干区域0，此时Site1的骨干区域就与VPN骨干区域分离了，所以在CE1与PE1间配置虚连接（Virtual link）来保持骨干区域连续。</p>
<h5 id="OSPF-Domain-ID"><a href="#OSPF-Domain-ID" class="headerlink" title="OSPF Domain ID"></a>OSPF Domain ID</h5><p>本地OSPF区域和VPN远端的OSPF区域间如果相互发布区域间路由（Inter-area routes），则认为这些区域属于同一个OSPF域（OSPF Domain）。</p>
<ul>
<li>域标识符（Domain ID）用来标识和区分不同的域。</li>
<li>每一个OSPF域都有一个或多个域标识符，其中有一个是主标识符，其它为从标识符。</li>
<li>如果OSPF实例没有明确域标识符，则认为它的标识符为NULL。</li>
</ul>
<p>PE把从远端PE学来的BGP路由向CE发布时，需要根据域标识符的情况选择向CE发布Type3、Type5或Type7的OSPF路由。</p>
<ul>
<li>如果本地的域标识符与BGP路由信息中携带的远端域标识符相等或相互兼容，则发布3类路由；</li>
<li>否则，发布Type5或Type7路由。</li>
</ul>
<p><strong>表6-8</strong>  Domain ID</p>
<table>
<thead>
<tr>
<th>本地和远端域标识符</th>
<th>本地和远端域标识符是否相等</th>
<th>发布的路由类型</th>
</tr>
</thead>
<tbody><tr>
<td>本地和远端域标识符都为NULL</td>
<td>相等</td>
<td>Inter-area路由。</td>
</tr>
<tr>
<td>远端域标识符=本地主域标识符，或者远端域标识符=本地从域标识符中的一个</td>
<td>相等</td>
<td>Inter-area路由。</td>
</tr>
<tr>
<td>远端标识符≠本地主从标识符，并且远端标识符≠本地从域标识符中的任何一个</td>
<td>不相等</td>
<td>如果本地是非NSSA（Not So Stubby Area）区域，生成External路由。如果是NSSA区域，生成NSSA路由。</td>
</tr>
</tbody></table>
<h5 id="路由环路预防"><a href="#路由环路预防" class="headerlink" title="路由环路预防"></a>路由环路预防</h5><p>PE和CE之间，如果OSPF与BGP的路由相互学习，则有可能导致路由环路问题。</p>
<p><strong>图6-39</strong>  OSPF VPN路由环路<br><img src="http://support.huawei.com/enterprise/product/images/227a2a099c884a5a8ae5810fdb2601ab" alt="img" loading="lazy"></p>
<p>如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_000805">图6-39</a>所示，PE1上OSPF引入了目的地址为10.1.1.1/32的BGP路由，产生5类或7类LSA发布给CE1，CE1上学到一条目的地址为10.1.1.1/32，下一跳为PE1的OSPF路由，并发布给PE2，这样PE2上就学到一条目的地址为10.1.1.1/32，下一跳为CE1的OSPF路由。</p>
<p>同理，CE1上也会学到一条目的地址为10.1.1.1/32，下一跳为PE2的OSPF路由，PE1上学到一条目的地址为10.1.1.1/32，下一跳为CE1的OSPF路由。</p>
<p>此时，CE1上存在两条等价路由，分别指向PE1和PE2，而PE1和PE2上到10.1.1.1/32的下一跳也都指向CE1，环路就产生了。</p>
<p>同时，由于OSPF路由的优先级高于BGP路由，PE1和PE2上到10.1.1.1/32的BGP路由被OSPF路由所替代，也就是说，PE1和PE2的路由表中活跃的是到10.1.1.1/32，下一跳为CE1的OSPF路由。</p>
<p>既然BGP路由转为不活跃状态，之前OSPF引入这条BGP路由时所产生的LSA就会被删除，而这样又会导致OSPF路由被撤消。路由表中没有了OSPF路由，BGP路由又变为活跃状态，继续重复之前的循环，导致路由振荡。</p>
<p>OSPF VPN特性专门针对这种情况提供了解决方案，如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#tab_dc_feature_ospf_000802">表6-9</a>所列。</p>
<p><strong>表6-9</strong>  路由环路预防</p>
<table>
<thead>
<tr>
<th>特性名</th>
<th>定义</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>DN-bit</td>
<td>为了防止路由环路，OSPF多实例进程使用一个bit位作为标志位，称为DN位。</td>
<td>PE在生成Type3、Type5或Type7 LSA发布给CE时，都将DN位置位（值为1），其他类型LSA的DN位不置位（值为0）。PE的OSPF多实例进程在进行计算时，忽略DN置位的LSA。这样就防止了PE又从CE学到发出的LSA而引起的环路。</td>
</tr>
<tr>
<td>VPN Route Tag</td>
<td>VPN路由标记（VPN Route Tag），PE根据收到的BGP的私网路由产生的5/7类LSA中必须包含这个参数。VPN路由标记不在BGP的扩展团体属性中传递，只是本地概念，只在收到BGP路由并且产生OSPF LSA的PE上有意义。</td>
<td>当PE发现LSA的VPN路由标记（LSA的Tag值）和自己的一样，就会忽略这条LSA，因此避免了环路。</td>
</tr>
<tr>
<td>缺省路由</td>
<td>目的地址和掩码全为0的路由。</td>
<td>缺省路由用于转发源自CE和CE所在Site的流量。</td>
</tr>
</tbody></table>
<h5 id="解除路由环路预防"><a href="#解除路由环路预防" class="headerlink" title="解除路由环路预防"></a>解除路由环路预防</h5><p><img src="http://support.huawei.com/enterprise/product/images/5bf7fc7c2b06498782a61a01fdd10e10" alt="img" loading="lazy"> 注意：</p>
<p>解除路由环路预防可能导致路由环路，进行该操作时应谨慎。</p>
<p>在BGP/OSPF路由进行交互的过程中，路由环路预防功能能够防止OSPF路由在VPN站点内的路由环路。</p>
<p>但在跨域VPN-OptionA方式场景下，当ASBR之间运行OSPF协议来发送VPN路由信息时，由于系统路由环路预防机制，将导致对端ASBR不能学习到本端ASBR发送的OSPF路由。</p>
<p>如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_000803">图6-40</a>所示，采用OptionA方式实现跨域VPN。以CE1发送VPN路由到CE2为例说明（PE1与CE1之间运行OSPF协议为例）:</p>
<p><strong>图6-40</strong>  跨域VPN-OptionA组网图<br><img src="http://support.huawei.com/enterprise/product/images/e465d3869b7a48b59059d7236a1b5917" alt="img" loading="lazy"></p>
<ol>
<li>PE1通过私网OSPF进程学习到了去往CE1站点的路由，并将这些路由引入到MP-BGP中，发送给ASBR1。</li>
<li>ASBR1收到MP-BGP路由后，会将这些路由引入到私网OSPF进程中，在生成Type3、Type5或Type7 LSA时，会将DN位置为1。</li>
<li>ASBR2通过OSPF协议学习到这些LSA时，会对LSA中的DN位进行检查。发现这些LSA的DN位为1，将忽略这些路由。</li>
</ol>
<p>综上，由于系统的路由环路预防机制，导致ASBR2上学习不到对端ASBR1发来的OSPF路由，导致了CE1与CE3之间不能互通。</p>
<p>为解决上面的问题，有以下的解决方法：</p>
<ul>
<li>不对DN位置位：在将BGP路由引入到OSPF过程中，不对LSA的DN位置位。例如ASBR1在将MP-BGP路由引入到OSPF中时，不对DN位置位，ASBR2收到这些路由时，检查DN位为0，可以参加选路。</li>
<li>不对DN位检查：在收到LSA后，不检查DN位。例如ASBR1在将MP-BGP路由引入到OSPF中时，对DN位置位，ASBR2收到这些路由时，不进行DN位检查。</li>
</ul>
<p>为增加上述方式使用的灵活性，可以只针对特定Type类型的LSA应用。对于Type3 LSA，还可以根据生成LSA设备的OSPF的router-id决定是否进行DN位置位或者检查。</p>
<p>如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_000804">图6-41</a>所示，跨域VPN-OptionA方式，下ASBR之间为全连接，且都运行OSPF协议。对于ASBR2而言，可能会收到ASBR4上产生的Type3、Type5或Type7 LSA，如果在ASBR2上设置不对DN位检查，Type3 LSA会被接收，按照<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_000804">图6-41</a>中的描述，会引起路由的环路。而对于Type5或Type7 LSA，因为LSA中携带的Route Tag与ASBR2上OSPF进程默认的VPN Route Tag一致，ASBR2上会忽略这些LSA。</p>
<p>针对Type 3类型的LSA容易引起路由环路的问题，可以在ASBR2上设置只针对OSPF Router ID为10.1.1.1和10.3.3.3的Type 3类型的LSA不进行DN位检查。设置后，当ASBR2再收到ASBR4产生的Type3 LSA时，因为该LSA的OSPF Router ID为10.4.4.4，ASBR2会进行DN位的检查，发现DN位已置位，从而忽略这些LSA。</p>
<p><strong>图6-41</strong>  跨域VPN-OptionA ASBR全连接组网图<br><img src="http://support.huawei.com/enterprise/product/images/d08ba32e6dd440c1a29985222cf8cdbb" alt="img" loading="lazy"></p>
<h5 id="Multi-VPN-Instance-CE"><a href="#Multi-VPN-Instance-CE" class="headerlink" title="Multi-VPN-Instance CE"></a>Multi-VPN-Instance CE</h5><p>OSPF多实例通常运行在PE上，在用户局域网内部运行OSPF多实例的设备称为Multi-VPN-Instance CE（MCE），即多实例CE。</p>
<p>与PE上的OSPF多实例相比：</p>
<ul>
<li>Multi-VPN-Instance CE不需要支持BGP/OSPF互相引入功能。</li>
<li>Multi-VPN-Instance CE通过为不同的业务建立各自的OSPF实例，相当于不同的业务使用不同的虚拟CE，从而以较低的成本解决局域网的安全问题。</li>
<li>Multi-VPN-Instance CE在同一台CE上实现不同的OSPF多实例。其实现的关键在于禁止路由环路的检查，直接进行路由计算。也就是说，MCE收到了带有DN-bit的LSA也会用于路由计算。</li>
</ul>
<h4 id="6-2-2-2-OSPF-TE"><a href="#6-2-2-2-OSPF-TE" class="headerlink" title="6.2.2.2  OSPF TE"></a>6.2.2.2  OSPF TE</h4><p>OSPF TE（OSPF Traffic Engineering，即OSPF流量工程）是为了支持MPLS流量工程（MPLS TE），支持建立和维护TE的标签交换路径LSP（Label Switch Path）而在OSPF协议基础上扩展的新特性。在MPLS TE架构中OSPF扮演了信息发布组件的角色，负责收集扩散MPLS流量工程信息。</p>
<p>除了网络的拓扑信息外，流量工程还需要知道网络的约束信息（包括带宽、TE度量值、管理组和亲和属性等）。但OSPF现有的功能不足以满足这些要求。因此需要对现有的OSPF进行扩展，通过引入新类型的LSA来发布这些信息，CSPF（Constrained Shortest Path First）算法利用这些信息就可以计算出满足各种约束条件的路径。</p>
<p><strong>图6-42</strong>  OSPF在MPLS-TE体系中的作用<br><img src="http://support.huawei.com/enterprise/product/images/a9ecd4b1af4b43f7ad078a5d3d58184a" alt="img" loading="lazy"></p>
<h5 id="OSPF在MPLS-TE中的作用"><a href="#OSPF在MPLS-TE中的作用" class="headerlink" title="OSPF在MPLS-TE中的作用"></a>OSPF在MPLS-TE中的作用</h5><p>在MPLS-TE体系结构中OSPF起到了信息发布组件的作用：</p>
<ul>
<li>收集TE相关信息。</li>
<li>在同一个区域中的各设备间扩散TE信息。</li>
<li>把同步收集到的TE信息组成流量工程数据库TEDB（TE DataBase）提供给CSPF计算。</li>
</ul>
<p>除此之外，OSPF并不关心信息具体是什么以及MPLS如何使用这些信息。</p>
<h5 id="TE-LSA"><a href="#TE-LSA" class="headerlink" title="TE-LSA"></a>TE-LSA</h5><p>OSPF通过新增Type10 Opaque LSA来实现收集和发布流量工程信息的目的。这种LSA中包含了流量工程所需要的链路状态信息，包括最大链路带宽、最大可预留带宽、当前预留带宽、链路颜色等信息。Type10 Opaque LSA利用OSPF泛洪机制在一个区域内的设备间同步这些信息，最终形成统一的TEDB，为路径计算做好准备。</p>
<h5 id="OSPF-TE与CSPF交互"><a href="#OSPF-TE与CSPF交互" class="headerlink" title="OSPF TE与CSPF交互"></a>OSPF TE与CSPF交互</h5><p>OSPF通过Type10-LSA收集区域内的TE信息，包括带宽、优先级、链路开销（Metric）等，经过处理后，把这些信息提供给CSPF进行路径计算。</p>
<h5 id="IGP-Shortcut和转发邻接"><a href="#IGP-Shortcut和转发邻接" class="headerlink" title="IGP Shortcut和转发邻接"></a>IGP Shortcut和转发邻接</h5><p>OSPF支持IGP Shortcut和转发邻接（Forwarding Adjacency）特性，这两个特性允许OSPF使用隧道接口（Tunnel接口）作为到达某个目的地址的出接口。</p>
<p>IGP Shortcut和转发邻接的区别在于：</p>
<ul>
<li>使能IGP Shortcut特性的设备使用隧道接口作为出接口，但不将这个隧道接口链路发布给邻居，因此，其他设备不能使用此隧道。</li>
<li>使能转发邻接特性的设备在使用隧道接口作为出接口的同时，也将这个隧道接口发布给邻居，因此，其他设备能够使用此隧道。</li>
<li>IGP Shortcut是单向的，只需要在使用该特性的设备上配置即可。</li>
</ul>
<h5 id="OSPF-DS-TE"><a href="#OSPF-DS-TE" class="headerlink" title="OSPF DS-TE"></a>OSPF DS-TE</h5><p>DS-TE（DiffSer Aware Traffic Engineering）综合了MPLS TE和差分服务模型Diff-Ser（Differentiated Services）的优点，在精确控制流量流经的路径的基础上，可以根据业务的不同服务等级，有差别地进行流量的控制和转发，从而支持在有效利用网络资源的同时，为不同的业务流预留所需的资源。</p>
<p>为了支持MPLS中DS-TE的应用，OSPF支持在TE-LSA中携带子TLV（Local Overbooking Multiplier Type-Length-Value）和带宽约束BC（Bandwidth Constraint）TLV，用于发布和收集链路上各优先级的每个CT（Class Type，一条或一组LSP的相同服务等级的带宽集合）的可预留带宽。</p>
<h5 id="OSPF-SRLG"><a href="#OSPF-SRLG" class="headerlink" title="OSPF SRLG"></a>OSPF SRLG</h5><p>OSPF通过获取在同一个区域的各设备间扩散TE的共享风险链路组（Shared Risk Link Group，SRLG）信息来支持MPLS中SRLG的应用。</p>
<h4 id="6-2-2-3-OSPF安全"><a href="#6-2-2-3-OSPF安全" class="headerlink" title="6.2.2.3  OSPF安全"></a>6.2.2.3  OSPF安全</h4><h5 id="OSPF-GTSM"><a href="#OSPF-GTSM" class="headerlink" title="OSPF GTSM"></a>OSPF GTSM</h5><p>GTSM（Generalized TTL Security Mechanism），即通用TTL安全保护机制，通过检查IP报文头中的TTL值是否在一个预先定义好的范围内来对IP层以上业务进行保护，从而达到防止攻击的目的。如果攻击者模拟真实的OSPF协议单播报文，对一台交换机不断地发送报文，交换机收到这些报文后，发现是本机报文，则直接上送控制层面的OSPF协议处理，而不加辨别其“合法性”，这样导致交换机控制层面因为处理这些“合法”报文，系统异常繁忙，CPU占用率高。</p>
<p>在实际应用中，GTSM特性主要用于保护建立在TCP/IP基础上的控制层面（路由协议等）免受CPU利用（CPU-utilization）类型的攻击，如CPU过载（CPU overload）。</p>
<p>使能了GTSM特性和策略的设备会对收到的所有报文进行策略检查。对于没有通过策略的报文丢弃或者上送控制平面，从而达到防止攻击的目的。策略内容包括：</p>
<ul>
<li>发送给本机IP报文的源地址。</li>
<li>报文所属的VPN实例。</li>
<li>IP报文的协议号（OSPF是89，BGP是6）。</li>
<li>TCP/UDP之上协议的协议源端口号、目的端口号。</li>
<li>有效TTL范围。</li>
</ul>
<p>GTSM的实现手段如下：</p>
<ul>
<li>对于直连的协议邻居：将需要发出的单播协议报文的TTL值设定为255。</li>
<li>对于多跳的邻居：可以定义一个合理的TTL范围。</li>
</ul>
<p>GTSM的应用范围是：</p>
<ul>
<li>GTSM对单播报文有效，对组播报文无效。这是因为组播报文本身具有TTL值为255的限制，不需要使用GTSM进行保护。</li>
<li>GTSM不支持基于Tunnel的邻居。</li>
</ul>
<h5 id="OSPF报文认证"><a href="#OSPF报文认证" class="headerlink" title="OSPF报文认证"></a>OSPF报文认证</h5><p>OSPF支持报文验证功能，只有通过验证的OSPF报文才能接收，否则将不能正常建立邻居。</p>
<p>路由器支持两种验证方式：</p>
<ul>
<li>区域验证方式</li>
<li>接口验证方式</li>
</ul>
<p>当两种验证方式都存在时，优先使用接口验证方式。</p>
<h4 id="6-2-2-4-OSPF-GR"><a href="#6-2-2-4-OSPF-GR" class="headerlink" title="6.2.2.4  OSPF GR"></a>6.2.2.4  OSPF GR</h4><p>随着路由设备普遍采用了控制和转发分离的技术，在网络拓扑保持稳定的情况下，控制层面的重启并不会影响转发层面，转发层面仍然可以很好地完成数据转发任务，从而保证业务不受影响。</p>
<p>GR技术保证了在重启过程中转发层面能够继续指导数据的转发，同时控制层面邻居关系的重建以及路由计算等动作不会影响转发层面的功能，从而避免了路由震荡引发的业务中断，提高了整网的可靠性。</p>
<h5 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h5><p>GR是Graceful Restart的简称，又被称为平滑重启，是一种用于保证当路由协议重启时数据正常转发并且不影响关键业务的技术。</p>
<p>如果没有特殊说明，以下所说GR均表示RFC3623所规定的GR技术。</p>
<p>GR技术是属于高可靠性（HA，High Availability）技术的一种。HA是一整套综合技术，主要包括冗余容错、链路保证、节点故障修复及流量工程。GR是一种冗余容错技术，目前已经被广泛的使用在主备切换和系统升级方面，以保证关键业务的不间断转发。</p>
<p>和GR相关的概念如下：</p>
<ul>
<li><p>Grace-LSA</p>
<p>OSPF通过新增Grace-LSA来支持GR功能。这种LSA用于在开始GR和退出GR时向邻居通告GR的时间、原因以及接口地址等内容。</p>
</li>
<li><p>交换机在GR中的角色</p>
<ul>
<li>Restarter：重启交换机。可以通过配置支持完全GR或者部分GR。</li>
<li>Helper：协助重启交换机。可以通过配置支持有计划GR、无计划GR或者通过策略有选择支持GR。</li>
</ul>
</li>
<li><p>GR的原因</p>
<ul>
<li>Unknown：未知原因导致的GR操作。</li>
<li>Software restart：通过命令行主动触发的GR操作。</li>
<li>Software reload/upgrade：软件重启或升级导致的GR操作。</li>
<li>Switch to redundant control processor：异常主备倒换导致的GR操作。</li>
</ul>
</li>
<li><p>GR的持续时间</p>
<p>GR持续时间最长不超过1800秒。GR成功或失败都可以提前退出，不必等到超时才退出。</p>
</li>
</ul>
<h5 id="GR的分类"><a href="#GR的分类" class="headerlink" title="GR的分类"></a>GR的分类</h5><ul>
<li>完全GR（Totally GR）：指当有一个邻居不支持GR功能时，整个交换机退出GR状态。</li>
<li>部分GR（Partly GR）：指当有一个邻居不支持GR时，仅该邻居所关联的接口退出GR，其它接口正常进行GR过程。</li>
<li>有计划GR（Planned GR）：指手动通过命令使交换机执行重启或主备倒换。在进行重启或主备倒换前Restarter会先发送Grace-LSA。</li>
<li>非计划GR（UnPlanned GR）：与Planned GR的区别在于，交换机是由于故障等原因进行重启或主备倒换，并且在主备倒换前不会事先发送Grace-LSA，而是直接开始主备倒换，在备板正常Up后才进入GR过程。以下的步骤同Planned GR。</li>
</ul>
<h5 id="GR的过程"><a href="#GR的过程" class="headerlink" title="GR的过程"></a>GR的过程</h5><p>OSPF GR分为开始、进行中和退出三个过程，如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_001701">图6-43</a>所示。</p>
<p><strong>图6-43</strong>  OSPF GR过程<br><img src="http://support.huawei.com/enterprise/product/images/f54579d8161e40febf1619520cf29708" alt="img" loading="lazy"></p>
<ol>
<li><p>OSPF GR开始</p>
<ol>
<li>交换机执行主备倒换后，Restarter首先向每个邻居发送一个Grace-LSA，通知邻居GR的开始以及GR的周期、原因等。</li>
</ol>
</li>
</ol>
<pre><code>   说明：

  如果是Planned-GR，Restarter会向每个邻居发送Grace-LSA，而如果是Unplanned-GR，Restarter则不发送Grace-LSA。</code></pre>
<ol start="2">
<li><p>Restarter进入GR状态前会发送一个Grace-LSA，以维持OSPF邻居关系。</p>
</li>
<li><p>当备板状态为Up后，交换机立即发送一个Grace-LSA，通知邻居自己进入GR，包括GR的周期、原因等，然后会再向每个邻居连续发送五个Grace-LSA。</p>
</li>
</ol>
<pre><code>   说明：

  连续发送五个Grace-LSA是为了确保邻居收到该Grace-LSA，此规定为各厂商的实现方案，非协议规定。</code></pre>
<p>   此时，发送的Grace-LSA是为了告知邻居自己进入GR状态，邻居会在GR期间保持与Restarter的邻居关系，让其它交换机感知不到Restarter的倒换。</p>
<ol start="2">
<li><p>OSPF GR进行中</p>
<ol>
<li>在Restarter和Helper之间建立OSPF邻接关系。</li>
<li>Helper检测会话对端Restarter的状态，如果发现Restarter的状态为Down，Helper则会认为Restarter能在设定的GR时间内恢复业务。在GR时间超时之前，Helper既不结束对话也不删除Restarter的拓扑或路由信息。</li>
<li>Restarter恢复后，会向每个邻居发送信号，并在收到响应后重新建立邻居关系列表。</li>
<li>Restarter通过与所有邻居建立会话可获得拓扑或路由信息，根据收到的拓扑或路由信息计算自己的路由表。</li>
</ol>
<p>管理员或故障都可触发GR Restarter倒换和GR重启。GR Restarter在发生故障倒换时既不删除路由表/转发表中的路由信息也不复位接口板，因此整个系统可以不间断地转发IP报文。</p>
</li>
<li><p>GR退出</p>
<ul>
<li><p>如果GR成功，则Restarter在GR超时前与主备倒换前的所有邻居都重新建立好邻居关系，Helper收到Restarter发送的Age为3600秒的Grace-LSA时与Restarter的邻居关系为Full状态。</p>
</li>
<li><p>如果GR失败，则Restarter端的表现为：</p>
<ul>
<li>GR超时并且邻居关系尚未完全恢复。</li>
<li>Helper发送的Router-LSA或Network-LSA导致Restarter端进行双向检查时失败。</li>
<li>Restarter接口状态变化。</li>
<li>Restarter收到Helper发送的1-way Hello报文。</li>
<li>Restarter收到同一网段上另一台交换机产生的Grace-LSA。同一网段同一时间只能有一台交换机做GR。</li>
<li>Restarter同一个网段的邻居之间存在DR/BDR不一致的情况（拓扑变化）。</li>
</ul>
<p>Helper端的表现为：</p>
<ul>
<li>在邻居关系超时前没有收到Restarter发送的Grace-LSA。</li>
<li>Helper接口状态发生变化。</li>
<li>收到其它交换机发送的与Helper本地数据库不一致的LSA。（可以通过配置不进行严格LSA检查排除这种情况。）</li>
<li>同一网段上同一时间收到两台交换机发送的Grace-LSA。</li>
<li>与其它交换机邻居关系变化。</li>
</ul>
</li>
</ul>
</li>
</ol>
<h5 id="有无GR技术的比较"><a href="#有无GR技术的比较" class="headerlink" title="有无GR技术的比较"></a>有无GR技术的比较</h5><p><strong>表6-10</strong>  有无GR技术的比较</p>
<table>
<thead>
<tr>
<th>无GR技术的主备倒换</th>
<th>有GR技术的主备倒换</th>
</tr>
</thead>
<tbody><tr>
<td>OSPF邻居重建路由重新计算转发表变化整网感知路由变化，路由短时震荡转发流量丢失，业务中断</td>
<td>OSPF邻居重建路由重新计算转发表保持不变除主备倒换设备的邻居外的其他交换机感知不到路由变化转发流量零丢失，业务不受影响</td>
</tr>
</tbody></table>
<h4 id="6-2-2-5-OSPF邻居震荡抑制"><a href="#6-2-2-5-OSPF邻居震荡抑制" class="headerlink" title="6.2.2.5  OSPF邻居震荡抑制"></a>6.2.2.5  OSPF邻居震荡抑制</h4><p>OSPF邻居震荡抑制功能是一种震荡抑制方式，通过延迟邻居建立或调整链路开销为最大值的方法达到抑制震荡的目的。</p>
<h5 id="产生原因"><a href="#产生原因" class="headerlink" title="产生原因"></a>产生原因</h5><p>如果承载OSPF业务的接口状态在Up和Down之间切换，就会引起邻居状态的频繁震荡。此时，OSPF会快速发送Hello报文重新建立邻居，同步数据库LSDB，触发路由计算，会造成大量报文交互，影响现有邻居的稳定性，对OSPF业务造成较大影响，同时也会影响依赖OSPF的其他业务（如：LDP、BGP）的正常运行。为了解决这个问题，OSPF实现了邻居震荡抑制功能，即在邻居频繁震荡时，启动震荡抑制，实现邻居延迟建立，或实现业务流量延迟经过频繁震荡的链路，达到抑制震荡的目的。</p>
<h5 id="相关概念"><a href="#相关概念" class="headerlink" title="相关概念"></a>相关概念</h5><p><strong>flapping_event</strong>：震荡事件，接口上最后一次邻居状态由Full切换为非Full，称之为flapping_event。flapping_event作为震荡源输入，用来触发震荡检测机制启动工作。</p>
<p><strong>flapping_count</strong>：当前震荡次数。</p>
<p><strong>detect-interval</strong>：震荡检测间隔，用于判断是否触发一次有效震荡事件。</p>
<p><strong>threshold</strong>：震荡抑制阈值，有效震荡事件触发累计大于等于该值时，进入震荡抑制阶段。</p>
<p><strong>resume-interval</strong>：恢复间隔，连续两次有效震荡时间间隔超过该值时，退出震荡抑制阶段。</p>
<h5 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h5><p>震荡检测</p>
<p>OSPF接口启动一个flapping_count计数器，相邻两次flapping_event产生时间的间隔在detect-interval之内，记为一次有效震荡事件。flapping_count计数加1，当flapping_count计数大于threshold时，系统判定震荡发生，需要进入震荡抑制阶段。进入震荡抑制阶段后，flapping_count清0。在flapping_count大于threshold之前，如果两次flapping_event的间隔大于resume-interval，则flapping_count清0。邻居震荡抑制从最后一次邻居状态变为ExStart或Down开始计时。</p>
<p>用户可以通过命令行配置detect-interval，threshold，resume-interval三个震荡检测的关键参数。</p>
<p>震荡抑制</p>
<p>震荡抑制分为Hold-down和Hold-max-cost两种模式：</p>
<ul>
<li>Hold-down模式：针对邻居建立过程中的频繁泛洪和拓扑变化的问题，在一段时间内禁止该邻居重新建立，避免频繁的数据库同步和大量的报文交互。</li>
<li>Hold-max-cost模式：针对用户业务流量频繁切换的问题，在一段时间内将链路开销值设置为最大值Max-cost（65535），避免用户的业务流量经过频繁震荡的链路。</li>
</ul>
<p>Hold-down模式和Hold-max-cost模式可以叠加使用，同时生效时，先进入Hold-down模式，待Hold-down模式退出后，再进入Hold-max-cost模式。</p>
<p>缺省情况下，OSPF使能Hold-max-cost模式，用户可以通过命令行修改震荡抑制方案和震荡抑制周期。</p>
<p> 说明：</p>
<p>接口进入震荡抑制阶段后，接口下的全部邻居都会进入震荡抑制阶段。</p>
<p>退出震荡抑制</p>
<p>退出震荡抑制有以下几种方式：</p>
<ul>
<li>抑制定时器超时。</li>
<li>复位OSPF进程。</li>
<li>用户通过命令行强制退出震荡抑制状态。</li>
</ul>
<h5 id="典型场景"><a href="#典型场景" class="headerlink" title="典型场景"></a>典型场景</h5><p>基本场景</p>
<p>如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_111401">图6-44</a>所示，正常的业务流量路径是Switch A-&gt;Switch B-&gt;Switch C-&gt;Switch E。链路故障时，业务流量路径切换为Switch A-&gt;Switch B-&gt;Switch D-&gt;Switch E。在主备路径切换初期，Switch B和Switch C之间很可能会发生邻居状态频繁震荡，导致Switch A到Switch E的用户流量在两条路径不断切换，并且每次故障引发的切换都会导致用户流量部分丢失，影响网络稳定性。此时，如果Switch B和Switch C之间邻居震荡满足抑制条件时，设备就会启动震荡抑制功能。</p>
<ul>
<li>采用Hold-down模式：在一段时间内禁止Switch B和Switch C建立邻居关系，达到将业务流量切换到Switch A-&gt;Switch B-&gt;Switch D-&gt;Switch E路径的目的。</li>
<li>采用Hold-max-cost模式：在一段时间内将Switch B和Switch C之间的链路开销值设置为最大值Max-cost（65535），达到将业务流量切换到Switch A-&gt;Switch B-&gt;Switch D-&gt;Switch E路径的目的。</li>
</ul>
<p><strong>图6-44</strong>  基本场景的邻居震荡抑制<br><img src="http://support.huawei.com/enterprise/product/images/50c4863a207b415ca7a19cb852646619" alt="img" loading="lazy"></p>
<p>关键路径场景</p>
<p>网络中只有唯一的流量转发路径，转发路径上的任何邻居断开都会导致用户流量中断。如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_111402">图6-45</a>所示，唯一的业务流量路径是Switch A-&gt;Switch B-&gt;Switch C-&gt;Switch E，如果Switch B和Switch C之间发生邻居震荡，满足抑制条件，进入震荡抑制阶段。但是，Switch B和Switch C之间的链路是组网中的关键链路，一旦断开，整个网络将被分割为互不连通的两个网络。因此，关键路径场景不建议采用Hold-down模式断开邻居关系，推荐采用Hold-max-cost模式抑制震荡，在一段时间内将Switch B和Switch C间的链路开销值设置为最大值Max-cost（65535），进行震荡抑制。待网络稳定后，抑制定时器超时，自动退出抑制状态，迅速恢复业务链路。</p>
<p> 说明：</p>
<p>缺省情况下，OSPF使能Hold-max-cost模式。</p>
<p><strong>图6-45</strong>  关键路径场景的邻居震荡抑制<br><img src="http://support.huawei.com/enterprise/product/images/9d04f2a7f407457cab4fee4b4b962fef" alt="img" loading="lazy"></p>
<p>广播网场景</p>
<p>如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_111403">图6-46</a>所示，四台设备分别通过交换机接入到同一个广播网中，相互之间建立广播网邻居。此时，如果Switch C因为链路原因一直处于震荡状态，并且Switch A和Switch B接入网络的时间不一致（例如，Switch A更早一点），或者Switch A和Switch B的震荡检测参数配置不一致，导致的结果是，Switch A先检测到Switch C处于震荡状态，抑制了Switch C，在Switch A发布的Hello报文中就不会携带Switch C的Switch ID，但是，Switch B无法检测到Switch C处于震荡状态，仍然认为Switch C为合法节点。在DR选举时，Switch A识别到的参与DR选举的设备集合包括Switch B和Switch D，Switch B识别到的参与DR选举的设备集合包括Switch A、Switch C和Switch D。两者备选集合不相同，选举结果也会不一致，这样就会导致广播网中的设备对网络理解的差异，造成路由计算错误。因此，在广播网或P2MP、NBMA等一个接口下存在多个邻居的场景中，不能单独抑制某个邻居，需要对接口下的全部邻居都进行抑制，震荡检测也不能以某个邻居为单位进行检测，需要检测接口上最后一个邻居状态为ExStart或Down的震荡事件。也就是说，如果Switch C震荡，广播网中的Switch A、Switch B和Switch D都会被抑制，待网络稳定后，抑制定时器超时，自动退出抑制状态，Switch A、Switch B和Switch D都会恢复到正常业务状态。</p>
<p><strong>图6-46</strong>  广播网场景的邻居震荡抑制<br><img src="http://support.huawei.com/enterprise/product/images/14f206dabba3413f831e92a666aa27ef" alt="img" loading="lazy"></p>
<p>多区域组网场景</p>
<p>如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_111404">图6-47</a>所示，Switch A、Switch B、Switch C、Switch E和Switch F通过Area 1连接，Switch B、Switch D和Switch E通过骨干区域Area 0连接。Switch A到Switch F的正常的业务流量优先选取区域内路由，路径是Switch A-&gt;Switch B-&gt;Switch C-&gt;Switch E-&gt;Switch F。当Switch B和Switch C之间发生邻居震荡，满足抑制条件，进入震荡抑制阶段时，缺省情况采用Hold-max-cost模式。但是，根据OSPF路由优选规则，区域内路由和区域间路由相互不会比较链路的开销值，区域内路由优先级大于区域间路由，也就是说，发生邻居震荡后，Switch A到Switch F的业务流量路径仍然是Switch A-&gt;Switch B-&gt;Switch C-&gt;Switch E-&gt;Switch F，Hold-max-cost模式在此时无法达到抑制流量路径切换的目的。因此，多区域组网场景的邻居震荡抑制只能采用Hold-down模式，即在一段时间内禁止Switch B和Switch C建立邻居关系，达到将业务流量切换到Switch A-&gt;Switch B-&gt;Switch D-&gt;Switch E-&gt;Switch F路径的目的。</p>
<p> 说明：</p>
<p>缺省情况下，OSPF使能Hold-max-cost模式，用户可以通过命令行修改为Hold-down模式。</p>
<p><strong>图6-47</strong>  多区域组网场景的邻居震荡抑制<br><img src="http://support.huawei.com/enterprise/product/images/26ed5d6cc3ca49e7b7f41ff8a216fbc0" alt="img" loading="lazy"></p>
<p>IGP-LDP联动和邻居震荡抑制同时部署的场景</p>
<p>如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_111405">图6-48</a>所示，PE1和P1之间链路发生故障时，LDP快速回切，导致新的LSP还没有完全建立时老的LSP就已经被拆除，为了避免引起业务中断，需要部署IGP-LDP联动。部署IGP-LDP联动特性后，设置新建立的邻居发布的链路开销值为最大值Max-cost（65535），避免IGP路由回切，等新的LSP建立完成后，再修改链路开销值为配置值，触发IGP路由回切，删除老的LSP，LDP业务流量切换到新建立的路径上。</p>
<p>IGP-LDP联动分为Hold-down模式和Hold-max-cost模式两种，邻居震荡抑制也分为Hold-down模式和Hold-max-cost模式两种。同时部署邻居震荡抑制和IGP-LDP联动时，优先生效Hold-down模式，次优生效Hold-max-cost模式，最后生效链路上配置的开销值。优先生效原则不以业务类型为条件，以最终生效的状态（Hold-down、Hold-max-cost、退出）为条件，详细情况请参考<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#tab_dc_feature_ospf_111401">表6-11</a>。</p>
<p><strong>表6-11</strong>  震荡抑制模式优先生效原则</p>
<table>
<thead>
<tr>
<th>IGP-LDP联动抑制模式/邻居震荡抑制模式</th>
<th>IGP-LDP联动抑制Hold-down模式</th>
<th>IGP-LDP联动抑制Hold-max-cost模式</th>
<th>退出IGP-LDP联动抑制</th>
</tr>
</thead>
<tbody><tr>
<td>邻居震荡抑制Hold-down模式</td>
<td>Hold-down模式</td>
<td>Hold-down模式</td>
<td>Hold-down模式</td>
</tr>
<tr>
<td>邻居震荡抑制Hold-max-cost模式</td>
<td>Hold-down模式</td>
<td>Hold-max-cost模式</td>
<td>Hold-max-cost模式</td>
</tr>
<tr>
<td>退出邻居震荡抑制</td>
<td>Hold-down模式</td>
<td>Hold-max-cost模式</td>
<td>退出IGP-LDP联动和邻居震荡抑制</td>
</tr>
</tbody></table>
<p>例如，如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_111405">图6-48</a>所示，PE1和P1之间发生频繁震荡。同时部署邻居震荡抑制和IGP-LDP联动，通过震荡抑制模式优先生效原则选取抑制模式，即在一段时间内禁止PE1和P1建立邻居关系或将PE1和P1之间的链路开销值设置为最大值Max-cost（65535），达到将业务流量切换到PE1-&gt;P4-&gt;P3-&gt;PE2路径的目的。</p>
<p><strong>图6-48</strong>  IGP-LDP联动和邻居震荡抑制同时部署的场景<br><img src="http://support.huawei.com/enterprise/product/images/1717dffcdd0d4af69959cefeda101cf3" alt="img" loading="lazy"></p>
<p>误码倒换和邻居震荡抑制同时部署的场景</p>
<p>误码倒换特性用于保护链路质量，当链路质量检测发现链路质量差，误码率高，就会上报误码事件，误码率高的链路上承载的用户业务会受到较大的影响，可能影响用户正常使用，因此需要将用户流量尽量调整到其他链路上。OSPF业务在收到误码事件后，会调整接口开销值为最大值Max-cost（65535），路由随即重新计算，重新选路，将业务流量切换到备选链路。误码倒换和邻居震荡抑制同时部署时，两种震荡抑制方式同时生效，优先生效Hold-down模式，次优生效Hold-max-cost模式，最后生效链路上配置的开销值。</p>
<h4 id="6-2-2-6-OSPF-Smart-discover"><a href="#6-2-2-6-OSPF-Smart-discover" class="headerlink" title="6.2.2.6  OSPF Smart-discover"></a>6.2.2.6  OSPF Smart-discover</h4><h5 id="定义-2"><a href="#定义-2" class="headerlink" title="定义"></a>定义</h5><p>通常情况下，路由器会周期性地从运行OSPF协议的接口上发送Hello报文。这个周期被称为Hello Interval，通过一个Hello Timer定时器控制Hello报文的发送。这种按固定周期发送报文的方式减缓了OSPF邻居关系的建立。</p>
<p>通过使能Smart-discover特性，可以在特定场景下加快OSPF邻居的建立。</p>
<p><strong>表6-12</strong>  OSPF Smart-discover</p>
<table>
<thead>
<tr>
<th>接口是否配置Smart-discover</th>
<th>处理</th>
</tr>
</thead>
<tbody><tr>
<td>接口没有配置Smart-discover</td>
<td>必须等待Hello Timer到时才能发送Hello报文；两次报文发送间隔为Hello Interval；在这期间邻居一直在等待接收报文。</td>
</tr>
<tr>
<td>接口上配置Smart-discover</td>
<td>直接发送Hello报文，不需要等待Hello Timer超时；邻居可以很快收到报文迅速进行状态迁移。</td>
</tr>
</tbody></table>
<h5 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h5><p>在以下场景中，使能了Smart-discover特性的接口不需要等待Hello Timer到时，可以主动向邻居发送Hello报文：</p>
<ul>
<li>当邻居状态首次到达2-way状态。</li>
<li>当邻居状态从2-way或更高状态迁移到Init状态。</li>
</ul>
<h4 id="6-2-2-7-OSPF-Database-Overflow"><a href="#6-2-2-7-OSPF-Database-Overflow" class="headerlink" title="6.2.2.7  OSPF Database Overflow"></a>6.2.2.7  OSPF Database Overflow</h4><h5 id="定义-3"><a href="#定义-3" class="headerlink" title="定义"></a>定义</h5><p>OSPF协议要求同一个区域中的路由器保存相同的链路状态数据库LSDB（Link-State Database）。</p>
<p>随着网络上路由数量不断增加，一些路由器由于系统资源有限，不能再承载如此多的路由信息，这种状态就被称为数据库超限（OSPF Database Overflow）。</p>
<h5 id="目的-2"><a href="#目的-2" class="headerlink" title="目的"></a>目的</h5><p>对于路由信息不断增加导致路由器系统资源耗尽而失效的问题，可以通过配置Stub或NSSA区域来解决，但Stub或NSSA区域的方案不能解决动态路由增长导致的数据库超限问题。为了解决数据库超限引发的问题，通过设置LSDB中External LSA的最大条目数，可以动态限制链路数据库的规模。</p>
<h5 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h5><p>通过设置路由器上非缺省外部路由数量的上限，来避免数据库超限。</p>
<p>OSPF网络中所有路由器都必须配置相同的上限值。这样，只要路由器上外部路由的数量达到该上限，路由器就进入Overflow状态，并同时启动超限状态定时器（默认超时时间为5秒），路由器在定时器超过5秒后自动退出超限状态。</p>
<p><strong>表6-13</strong>  OSPF Database Overflow</p>
<table>
<thead>
<tr>
<th>Overflow状态阶段</th>
<th>OSPF处理流程</th>
</tr>
</thead>
<tbody><tr>
<td>进入Overflow状态时</td>
<td>路由器删除所有自己产生的非缺省外部路由。</td>
</tr>
<tr>
<td>处于Overflow状态中</td>
<td>不产生非缺省外部路由。丢弃新收到的非缺省外部路由，不回复确认报文。当超限状态定时器超时，检查外部路由数量是否仍然超过上限。N=&gt;退出超限状态。Y=&gt;重启定时器。</td>
</tr>
<tr>
<td>退出Overflow状态时</td>
<td>删除超限状态定时器。产生非缺省外部路由。接收新收到的非缺省外部路由，回复确认报文。准备下一次进入超限状态。</td>
</tr>
</tbody></table>
<h4 id="6-2-2-8-OSPF-Mesh-Group"><a href="#6-2-2-8-OSPF-Mesh-Group" class="headerlink" title="6.2.2.8  OSPF Mesh-Group"></a>6.2.2.8  OSPF Mesh-Group</h4><h5 id="定义-4"><a href="#定义-4" class="headerlink" title="定义"></a>定义</h5><p>OSPF Mesh-Group是将并行链路场景中的链路分组，从而洪泛时从群组中选取代表链路进行洪泛，避免重复洪泛而造成不必要的系统压力。</p>
<p>缺省情况下，不使能Mesh-Group功能。</p>
<h5 id="目的-3"><a href="#目的-3" class="headerlink" title="目的"></a>目的</h5><p>当OSPF进程收到一个LSA或者新产生一个LSA时，会进行洪泛操作。并行链路场景下，OSPF会对每一条链路洪泛LSA，发送Update报文。</p>
<p>这样，如果有2000条并行链路，则每个LSA洪泛都要发送2000次，然而只有一次洪泛是有效的，其他1999次洪泛为重复洪泛。</p>
<p>为了避免这种重复洪泛而造成的系统压力，使能Mesh Group特性，可以将并行链路进行归组，选取代表链路进行洪泛。</p>
<h5 id="原理-2"><a href="#原理-2" class="headerlink" title="原理"></a>原理</h5><p>如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_002001">图6-49</a>所示，RouterA和RouterB建立OSPF邻居关系，通过3条链路相连。当RouterA从接口4接收到新的LSA后，会将该LSA通过1、2、3接口洪泛到RouterB。</p>
<p>这种洪泛方式会造成并行链路的压力，因为对于存在多条并行链路的邻居来说，只需要选取一条主链路进行洪泛LSA即可。</p>
<p><strong>图6-49</strong>  没有使能OSPF Mesh-Group特性时LSA的洪泛情况<br><img src="http://support.huawei.com/enterprise/product/images/85a9e2ea85a444c69528313584ba50af" alt="img" loading="lazy"></p>
<p>使能了OSPF Mesh-Group特性的设备和邻居存在多条并行链路时，当其收到LSA后，会选取一条主链路进行泛洪，如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_002002">图6-50</a>所示。</p>
<p>当主链路上接口状态低于Exchange时，OSPF会在并行链路中重新选取主链路，并继续洪泛LSA，这是因为，OSPF规定，只有当邻居状态达到Exchange时，才能洪泛LSA。并且，当RouterB从链路1收到来自RouterA洪泛的LSA后，不会再将该LSA从链路2、3反向洪泛给RouterA。</p>
<p><strong>图6-50</strong>  使能OSPF Mesh-Group特性时LSA的洪泛情况<br><img src="http://support.huawei.com/enterprise/product/images/affeb831396b4afcb3c99e7f929bbae2" alt="img" loading="lazy"></p>
<p>Mesh-Group以邻居的Router ID唯一标识一个群组，接口状态大于Exchange且与同一个邻居相连的接口属于同一个Mesh-Group。</p>
<p>如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_002003">图6-51</a>所示，RouterA在区域0中有一个群组，分别是接口1和接口2所在的链路。由于接口3所在的链路为广播链路，有超过一个邻居，所以不能加入到群组中。</p>
<p><strong>图6-51</strong>  接口不能加入到群组中的情况<br><img src="http://support.huawei.com/enterprise/product/images/4783d38322d5480ba88f1376e22d5d29" alt="img" loading="lazy"></p>
<p> 说明：</p>
<p>另外，路由器使能Mesh-Group后，若其直连的邻居路由器Router ID配置重复，会引起全网LSDB不同步、路由计算不正确的情况，需要重新配置邻居路由器的Router ID（注：配置重复Router ID属于错误配置）。</p>
<h3 id="6-2-3-OSPF与其它协议联动"><a href="#6-2-3-OSPF与其它协议联动" class="headerlink" title="6.2.3  OSPF与其它协议联动"></a>6.2.3  OSPF与其它协议联动</h3><h4 id="OSPF与BFD联动"><a href="#OSPF与BFD联动" class="headerlink" title="OSPF与BFD联动"></a>OSPF与BFD联动</h4><p>双向转发检测BFD（Bidirectional Forwarding Detection）是一种用于检测转发引擎之间通信故障的检测机制。</p>
<p>BFD对两个系统间的、同一路径上的同一种数据协议的连通性进行检测，这条路径可以是物理链路或逻辑链路，包括隧道。</p>
<p>OSPF与BFD联动就是将BFD和OSPF协议关联起来，将BFD对链路故障的快速感应通知OSPF协议，从而加快OSPF协议对于网络拓扑变化的响应。</p>
<p>网络上的链路故障或拓扑变化都会导致设备重新进行路由计算，所以缩短路由协议的收敛时间对于提高网络的性能是非常重要的。</p>
<p>由于链路故障是无法完全避免的，因此，加快故障感知速度并将故障快速通告给路由协议是一种可行的方案。BFD和OSPF相关联，一旦与邻居之间的链路出现故障，BFD的快速性能够加快OSPF的收敛速度。</p>
<p><strong>表6-14</strong>  有无OSPF与BFD联动功能对比</p>
<table>
<thead>
<tr>
<th>有无BFD</th>
<th>链路故障检测机制</th>
<th>收敛速度</th>
</tr>
</thead>
<tbody><tr>
<td>无BFD</td>
<td>OSPF Dead定时器超时（默认配置40s）</td>
<td>秒级</td>
</tr>
<tr>
<td>有BFD</td>
<td>BFD会话状态为Down</td>
<td>毫秒级</td>
</tr>
</tbody></table>
<p>OSPF与BFD联动的原理如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_112901">图6-52</a>所示。</p>
<p><strong>图6-52</strong>  OSPF与BFD联动<br><img src="http://support.huawei.com/enterprise/product/images/c29e59e493ca402dbe3638b906176d00" alt="img" loading="lazy"></p>
<ol>
<li>SwitchA、SwitchB、SwitchC之间建立OSPF邻居关系。</li>
<li>邻居状态到达Full状态时通知BFD建立BFD会话。</li>
<li>SwitchA到SwitchB的路由出接口为GE0/0/2，当这两台设备间的链路出现故障后，BFD首先感知到并通知SwitchA。</li>
<li>SwitchA处理邻居Down事件，重新进行路由计算，新的路由出接口为GE0/0/1，经过SwitchC到达SwitchB。</li>
</ol>
<h4 id="OSPF与BGP联动"><a href="#OSPF与BGP联动" class="headerlink" title="OSPF与BGP联动"></a>OSPF与BGP联动</h4><p>当有新的设备加入到网络中，或者设备重启时，可能会出现在BGP收敛期间内网络流量丢失的现象。这是由于IGP收敛速度比BGP快而造成的。</p>
<p>通过使能OSPF与BGP联动特性可以解决这个问题。</p>
<p>在存在备份链路的情况下，BGP在链路回切时，由于路由收敛速度滞后于OSPF路由收敛速度，从而造成流量丢失。</p>
<p>如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_112902">图6-53</a>所示，四台设备SwitchA、SwitchB、SwitchC、SwitchD之间运行OSPF协议，并建立IBGP连接。SwitchC为SwitchB的备份设备。当网络环境稳定时，BGP与OSPF在设备上是完全收敛的。</p>
<p>正常情况下，从SwitchA到10.3.1.0/30的流量会途经SwitchB。当SwitchB发生故障后，流量切换到SwitchC。SwitchB故障恢复以后，流量回切到SwitchB，此时会有流量丢失。</p>
<p>这是因为，在流量回切到SwitchB的过程中，IGP收敛速度比BGP快，因此OSPF先收敛，BGP还没有完成收敛，导致SwitchB不知如何到达10.3.1.0/30。</p>
<p>这样，当从SwitchA去往10.3.1.0/30的流量被发送给SwitchB时，由于没有必要的路由选择信息，这些流量就会被丢弃。</p>
<p><strong>图6-53</strong>  OSPF与BGP联动<br><img src="http://support.huawei.com/enterprise/product/images/148aa1440b9f4feeb23e04e38ac34a7d" alt="img" loading="lazy"></p>
<p>使能了OSPF与BGP联动特性的设备会在设定的联动时间内保持为Stub路由器，也就是说，该设备发布的LSA中的链路度量值为最大值（65535），从而告知其它OSPF设备不要使用这个路由器来转发数据。</p>
<p><a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_112902">图6-53</a>中，在RoutetB上使能BGP联动，这样，在BGP收敛完成前，SwitchA不把流量转发到SwitchB上，而是继续使用备份设备SwitchC转发流量，直到SwitchB上的BGP路由完成收敛。</p>
<h4 id="OSPF-LDP联动"><a href="#OSPF-LDP联动" class="headerlink" title="OSPF-LDP联动"></a>OSPF-LDP联动</h4><p>在存在主备链路的网络中，当主链路故障恢复后，流量会从备份链路切换到主链路。</p>
<p>由于IGP的收敛在LDP会话建立之前完成，导致旧的LSP已经删除，新的LSP还没有建立，因此LSP流量中断。</p>
<p>如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_112903">图6-54</a>所示，PE1-P1-P2-P3-PE2为主链路，PE1-P1-P4-P3-PE2为备份链路。</p>
<p>主链路发生故障，流量从主链路切换到备份链路。主链路故障恢复，流量从备份链路回切到主链路，此时流量会有较长时间的中断。</p>
<p><strong>图6-54</strong>  OSPF-LDP联动<br><img src="http://support.huawei.com/enterprise/product/images/d3f18cc658c9446988f147136a6363bf" alt="img" loading="lazy"></p>
<p>通过在P1和P2上配置标签分发协议LDP（Label Distribution Protocol）和IGP同步功能，能够缩短流量从备份链路切换到主链路时的中断时间。</p>
<p><strong>表6-15</strong>  OSPF-LDP联动</p>
<table>
<thead>
<tr>
<th>是否使能OSPF-LDP联动特性</th>
<th>流量中断时间</th>
</tr>
</thead>
<tbody><tr>
<td>不使能OSPF-LDP联动特性</td>
<td>秒级</td>
</tr>
<tr>
<td>使能OSPF-LDP联动特性</td>
<td>毫秒级</td>
</tr>
</tbody></table>
<p>LDP和IGP同步的基本原理是：通过抑制IGP建立邻居关系来推迟路由的回切，直至LDP完成收敛。也就是在主链路的LSP建立之前，先保留备份链路，让流量继续从备份链路转发，直至主链路的LSP建立成功，再删除备份链路。</p>
<p>LDP和IGP同步包括三个定时器：</p>
<ul>
<li>Hold-down</li>
<li>Hold-max-cost</li>
<li>Delay</li>
</ul>
<p>当主链路故障恢复后，路由器进行以下操作：</p>
<ol>
<li>启动Hold-down定时器，IGP接口先不建立IGP邻居，等待LDP会话的建立。</li>
<li>Hold-down定时器超时后，启动Hold-max-cost定时器。IGP在本地路由器的链路状态通告中，向主链路通告接口链路的最大metric值。</li>
<li>故障链路的LDP会话重新建立以后，启动Delay定时器等待LSP的建立。</li>
<li>Delay定时器超时以后，无论IGP的状态如何，LDP都通知IGP同步流程结束。</li>
</ol>
<h2 id="6-3-应用"><a href="#6-3-应用" class="headerlink" title="6.3  应用"></a>6.3  应用</h2><p>介绍OSPF的应用。</p>
<h3 id="6-3-1-OSPF-GR"><a href="#6-3-1-OSPF-GR" class="headerlink" title="6.3.1  OSPF GR"></a>6.3.1  OSPF GR</h3><p>如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_002201">图6-55</a>所示，RouterA、RouterB、RouterC和RouterD运行OSPF协议实现网络互通，RouterA和RouterB使能了GR功能。当RouterA重启时，RouterB协助RouterA完成平滑重启，但并不通告给其它邻居，网络流量并不中断。</p>
<p><strong>图6-55</strong>  OSPF GR<br><img src="http://support.huawei.com/enterprise/product/images/1be62ec2e84748168adcf46cc4827a6c" alt="img" loading="lazy"></p>
<h3 id="6-3-2-OSPF-GTSM"><a href="#6-3-2-OSPF-GTSM" class="headerlink" title="6.3.2  OSPF GTSM"></a>6.3.2  OSPF GTSM</h3><p>如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_002301">图6-56</a>所示，各路由器间运行OSPF协议，在RouterC上启用GTSM保护功能。各路由器发往RouterC的报文有效TTL范围如下：</p>
<ul>
<li>RouterA和RouterE是RouterC的相邻路由器，报文有效TTL范围是255－hops+1到255。</li>
<li>RouterB、RouterD、RouterF发往RouterC的报文有效TTL范围分别是254到255、253到255、252到255。</li>
</ul>
<p><strong>图6-56</strong>  OSPF GTSM<br><img src="http://support.huawei.com/enterprise/product/images/d3e5c409c021434ca486645a7623bc6f" alt="img" loading="lazy"></p>
<h2 id="6-4-OSPF部署指南"><a href="#6-4-OSPF部署指南" class="headerlink" title="6.4  OSPF部署指南"></a>6.4  OSPF部署指南</h2><h3 id="6-4-1-OSPF网络规划设计原则"><a href="#6-4-1-OSPF网络规划设计原则" class="headerlink" title="6.4.1  OSPF网络规划设计原则"></a>6.4.1  OSPF网络规划设计原则</h3><h4 id="保持OSPF网络的稳定性：Router-ID的规划"><a href="#保持OSPF网络的稳定性：Router-ID的规划" class="headerlink" title="保持OSPF网络的稳定性：Router ID的规划"></a>保持OSPF网络的稳定性：Router ID的规划</h4><p>在OSPF网络设计和实施中需要考虑的第一点就是Router ID的选择。</p>
<p>OSPF作为一种链路状态路由协议其计算路由的依据是LSA。每台运行OSPF的路由器都会发送并泛洪LSA报文到整个网络，这样网络中每台运行OSPF的路由器都会收集到其他设备发送过来的LSA并且放入LSDB，然后根据SPF算法计算出一棵以自己为根的到其他网络的无环树。由此可以看出保持每台路由器的LSDB的稳定性是保证OSPF网络稳定的前提。在LSDB中，不同OSPF路由器发送来的LSA是通过Router ID进行区分的。如果一台路由器的Router ID发生变化，那么此路由器会重新进行LSA泛洪，从而导致全网OSPF路由器都会更新其LSDB并且重新进行SPF计算，使得OSPF网络发生振荡。因此选择一个稳定的Router ID是OSPF网络设计的首要工作。</p>
<p>路由器的Router ID可以手工配置，如果没有通过命令指定Router ID，系统会从当前接口的IP地址中自动选取一个作为路由器的Router ID。其选择规则如下：</p>
<ol>
<li>优先从Loopback地址中选择最大的IP地址作为路由器的Router ID。</li>
<li>如果没有配置Loopback接口，则在接口地址中选取最大的IP地址作为路由器的Router ID。</li>
<li>只有当被选举为Router ID的接口IP地址被删除或修改后，才会进行Router ID的重新选举。</li>
</ol>
<p>在实际工程中，推荐手工指定OSPF路由设备的Router ID。首先规划出一个私有网段用于OSPF的Router ID选择，例如：192.168.1.0/24。在启用OSPF进程前在每个OSPF路由器上建立一个Loopback接口，使用一个32位掩码的私有地址作为其IP地址，这个32位的私有地址即作为该路由设备的Router ID。如果没有特殊要求，这个Loopback接口地址可以不发布在OSPF网络中。</p>
<h4 id="层次化的网络设计：OSPF区域的规划"><a href="#层次化的网络设计：OSPF区域的规划" class="headerlink" title="层次化的网络设计：OSPF区域的规划"></a>层次化的网络设计：OSPF区域的规划</h4><p>OSPF是一个需要层次化设计的网络协议。在OSPF网络中使用了区域的概念，从层次化的角度来看区域被分为两种：骨干区域和非骨干区域。骨干区域的编号为0，非骨干区域的编号从1到4294967295。处于骨干区域和非骨干区域边界的OSPF路由器被称为ABR。</p>
<p>实际上OSPF区域的规划也就是把网络中的OSPF路由器归类的过程。在设计OSPF区域时，需要考虑的第一点是网络的规模。对于小型的网络，例如只有几台路由设备作为核心层和汇聚层设备的网络可以考虑仅规划一个骨干区域。但是在大型的OSPF网络中，网络的层次化设计是必须要考虑的。</p>
<p>对于大型的OSPF网络，在规划上会遵循核心、汇聚、接入的分层原则，且OSPF骨干路由器的选择一般包含出口路由器和核心交换机。这些设备通常都是高端路由设备，例如华为NE系列高端路由器、华为S系列框式交换机。非骨干区域的设计则是根据地理位置和设备性能而定。如果在单个非骨干区域中使用了较多的低端三层交换产品，由于其产品定位和性能的限制，应该尽量减少其路由条目数量，把区域规划得更小一些或者使用特殊区域。</p>
<p>实际工程中对于非骨干区域的Area编号的规划也是有讲究的，尽量不要使用类似Area 1、2、3这种连续的编号，推荐使用Area 10、20、30这种递增方式，以便在后期网络扩容的时候用户增加区域编号。</p>
<h4 id="非骨干区域的路由表项优化：特殊区域的使用"><a href="#非骨干区域的路由表项优化：特殊区域的使用" class="headerlink" title="非骨干区域的路由表项优化：特殊区域的使用"></a>非骨干区域的路由表项优化：特殊区域的使用</h4><p>特殊区域的使用可以达到优化非骨干区域的路由表项的目的。实际上对于非骨干区域，一般可能存在如下两种情况需要减少路由表项的规模：</p>
<ul>
<li>非骨干区域仅有一个ABR做出口，任何访问区域外的流量都要经过这个出口设备。此时该非骨干区域内的路由器不需要了解外部网络的细节，仅需要有个出口能够出去即可。</li>
<li>非骨干区域的设备使用了一些低端的三层交换机，设备性能使得其不可能承受过多的路由条目。为了精简设备上的路由条目数量，可以采用配置特殊区域的方法进行路由表项的优化。</li>
</ul>
<p>交换机支持OSPF协议中定义四种特殊区域类型：Stub区域，Totally Stub区域，NSSA区域，Totally NSSA区域。</p>
<p>在绝大部分的情况下，典型OSPF网络的非骨干区域中都只需要知道缺省路由出口在哪里，因此建议把非骨干区域统一规划成Totally NSSA区域，这样极大地减少了非骨干区域内部路由器的路由条目数量和区域内部OSPF交互的报文数量。对于少数存在特殊需求的网络，可根据实际情况灵活使用几种区域类型。</p>
<h4 id="骨干区域的路由表项优化：非骨干区域IP子网规划和路由汇聚"><a href="#骨干区域的路由表项优化：非骨干区域IP子网规划和路由汇聚" class="headerlink" title="骨干区域的路由表项优化：非骨干区域IP子网规划和路由汇聚"></a>骨干区域的路由表项优化：非骨干区域IP子网规划和路由汇聚</h4><p>由于OSPF骨干区域需要负责区域之间的路由交互，所以骨干区域路由器的路由表规模会比较大。通过对非骨干区域使用的IP网段作出合理规划、聚合区域边界的路由，可以优化OSPF骨干区域的路由器的路由表项。</p>
<p>建议新建OSPF网络时设计利于路由汇总的IP网络，对于扩建的网络尽量进行IP地址的重新规划，通过路由汇聚能精简骨干区域路由器的路由表，减少骨干区域内OSPF交互的报文数量。同时，路由汇总以后，单点的链路故障或者网络震荡不至于影响整个网络的路由更新，因此路由汇聚还可以提高网络的稳定性。</p>
<h4 id="上行流量的引导：OSPF缺省路由的引入和选路优化"><a href="#上行流量的引导：OSPF缺省路由的引入和选路优化" class="headerlink" title="上行流量的引导：OSPF缺省路由的引入和选路优化"></a>上行流量的引导：OSPF缺省路由的引入和选路优化</h4><p>对于一个大型OSPF网络来说，大部分的业务流量并不在网络内部，而是通往Internet出口，因此缺省路由的设计是OSPF网络设计要点。</p>
<p>在实际工程中，OSPF网络的出口有可能不止一个，如何有效地将出口流量分担到多条链路上就成为了OSPF设计中的一个难点。虽然有很多种手段能够达到分担流量的目的，但是最简单、最安全的方法是使用OSPF内在的选路机制。OSPF路由器对一条路由的优劣衡量是通过计算其cost值来实现的，cost值小的路由会被路由器优先放入路由表。因此，通过调整OSPF接口的cost值可以使得路由器选择不同的链路出口来达到负载分担的目的。</p>
<p>OSPFv2出现的时间较早，没有考虑到带宽的飞速发展，因此缺省情况下，OSPF计算cost值使用的参考带宽为100Mbit/s。也就是说，缺省情况下，OSPF认为100Mbit/s带宽以上的端口其cost是1。在网络骨干带宽迈向10Tbit/s的今天已经显得非常不合时宜。交换机提供了更改参考带宽的功能，使用<strong>bandwidth-reference</strong>命令选择一个合适的参考带宽成为OSPF网络建设中必要的一项工作。对于OSPF网络的选路优化，推荐首先选择合适的参考带宽，然后通过调整OSPF接口cost值来实现。</p>
<h4 id="路由汇总场景下的防环设计：黑洞路由的使用"><a href="#路由汇总场景下的防环设计：黑洞路由的使用" class="headerlink" title="路由汇总场景下的防环设计：黑洞路由的使用"></a>路由汇总场景下的防环设计：黑洞路由的使用</h4><p>在很多场景下路由聚合确实能够做到精简路由，提高网络稳定性的作用，但路由聚合容易产生路由环路，而黑洞路由可以用来弥补这种缺陷。在路由器上，命中黑洞路由的报文会被丢弃，而且路由器不向报文发送者反馈任何差错信息。所以OSPF网络设计中，路由聚合和黑洞路由经常配合使用。</p>
<h4 id="OSPF网络基本安全：OSPF静默接口的使用"><a href="#OSPF网络基本安全：OSPF静默接口的使用" class="headerlink" title="OSPF网络基本安全：OSPF静默接口的使用"></a>OSPF网络基本安全：OSPF静默接口的使用</h4><p>对于一个大型OSPF网络来说，安全性是必须要考虑到的问题。在OSPF网络设计中，通常会禁止将OSPF报文发往用户端，这是为了防止终端用户窥探OSPF报文信息。如果用户能截获OSPF报文，就可能知道如何加入此OSPF网络，此时OSPF网络容易被攻击或破坏。例如，接入一台路由器到OSPF网络中并且使该路由器的OSPF进程处于不稳定的状态中，就会导致OSPF网络发生振荡甚至瘫痪。</p>
<p>在实际工程中，为了保证OSPF网络的安全与稳定，推荐在OSPF网络的边缘设备上使用静默接口的方式来阻止通往用户侧的OSPF报文。这样，该接口就被禁止接收和发送OSPF报文，该接口的直连路由仍可以发布出去，但接口的Hello报文将被阻塞，接口上无法建立邻居关系。</p>
<h3 id="6-4-2-OSPF网络设计部署案例"><a href="#6-4-2-OSPF网络设计部署案例" class="headerlink" title="6.4.2  OSPF网络设计部署案例"></a>6.4.2  OSPF网络设计部署案例</h3><p><a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_113201">图6-57</a>是一个典型园区网的拓扑图，可以看到这是一个大型园区网络，核心、汇聚、接入三层分明，有多出口到Internet，网络内部存在双链路冗余，核心、汇聚交换机部署集群保护等。这种大型园区网络，园区出口设备一般选用华为NE系列高端路由器，核心交换机和汇聚层交换机选用华为园区框式交换机集群。用户网关部署在汇聚层上，汇聚层作为二层和三层的分界点。</p>
<p><strong>图6-57</strong>  典型园区网络拓扑图<br><img src="http://support.huawei.com/enterprise/product/images/42db71da25894242b3c5af3371386223" alt="img" loading="lazy"></p>
<p>由于上述典型园区网络中核心交换机和汇聚交换机都属于集群系统，因此它们在逻辑上相当于一台设备，多链路捆绑在逻辑上也属于一条链路。为了简化问题的描述，这里把上述网络拓扑经过抽象形成<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_113202">图6-58</a>所示的逻辑拓扑图，园区网中可能存在很多栋楼，这里以3栋为例进行描述。</p>
<p><strong>图6-58</strong>  典型园区网络的逻辑拓扑图<br><img src="http://support.huawei.com/enterprise/product/images/ab53c9a2427640e8bafd9f4d93ab2c8d" alt="img" loading="lazy"></p>
<h4 id="保持OSPF网络的稳定性：Router-ID的规划-1"><a href="#保持OSPF网络的稳定性：Router-ID的规划-1" class="headerlink" title="保持OSPF网络的稳定性：Router ID的规划"></a>保持OSPF网络的稳定性：Router ID的规划</h4><p>部署OSPF的首要工作就是设计和部署Router ID。一般情况下，使用一个合适的私有IP地址段即可。本例选用的Router ID地址段为10.0.0.0/24。</p>
<p>选取完Router ID地址段后，接下来需要做的工作是在每个OSPF设备上创建相应的Loopback接口并配置接口IP为10.0.0.X/32。</p>
<p>Router ID的配置以核心层交换机框式交换机集群为例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[HUAWEI] interface LoopBack 0</span><br><span class="line">[HUAWEI-LoopBack0] ip address 10.0.0.3 32  &#x2F;&#x2F;为环回接口0配置32位掩码的IP地址</span><br><span class="line">[HUAWEI-LoopBack0] quit</span><br><span class="line">[HUAWEI] ospf 1 router-id 10.0.0.3  &#x2F;&#x2F;创建OSPF进程1并设置Router ID为10.0.0.3</span><br></pre></td></tr></table></figure>



<p> 说明：</p>
<p>如无特殊要求，建议不要在OSPF进程中发布Loopback0的接口地址，以减少无用的OSPF信息交互报文。</p>
<p>规划Router ID后的网络拓扑图如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_113203">图6-59</a>所示。</p>
<p><strong>图6-59</strong>  规划Router ID后的网络拓扑图<br><img src="http://support.huawei.com/enterprise/product/images/0d78a236994a4260864b8dd26df155a7" alt="img" loading="lazy"></p>
<h4 id="层次化的网络设计：OSPF区域的规划-1"><a href="#层次化的网络设计：OSPF区域的规划-1" class="headerlink" title="层次化的网络设计：OSPF区域的规划"></a>层次化的网络设计：OSPF区域的规划</h4><p>在分配完Router ID后，需要对整个OSPF网络进行区域划分。对于层次分明的网络，划分OSPF区域时，可以直接把出口路由器和核心交换机包含到Area 0，再按照地理位置来区分非骨干区域。规划非骨干区域Area编号时需要注意编号之间的差值，方便后续网络扩容时添加新的区域。本例中按照地理位置，把出口路由器和核心交换机划分到骨干区域，把每栋楼的汇聚交换机划分为一个非骨干区域。<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_113204">图6-60</a>是划分区域后的OSPF网络拓扑图。</p>
<p><strong>图6-60</strong>  规划区域后的OSPF网络拓扑图<br><img src="http://support.huawei.com/enterprise/product/images/159689dba7de441db3f92d31373fd7a3" alt="img" loading="lazy"></p>
<p>区域划分的配置以核心层交换机集群的Area 0和Area 10的配置为例。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[HUAWEI] ospf 1  &#x2F;&#x2F;进入OSPF进程视图</span><br><span class="line">[HUAWEI-ospf-1] area 0  &#x2F;&#x2F;进入Area 0区域视图</span><br><span class="line">[HUAWEI-ospf-1-area-0.0.0.0] network 10.200.10.0 0.0.0.3  &#x2F;&#x2F;将上行口的网段发布进Area 0</span><br><span class="line">[HUAWEI-ospf-1-area-0.0.0.0] network 10.200.20.0 0.0.0.3  &#x2F;&#x2F;将上行口的网段发布进Area 0</span><br><span class="line">[HUAWEI-ospf-1-area-0.0.0.0] quit</span><br><span class="line">[HUAWEI-ospf-1] area 10  &#x2F;&#x2F;进入Area 10区域视图</span><br><span class="line">[HUAWEI-ospf-1-area-0.0.0.10] network 10.100.10.0 0.0.0.3  &#x2F;&#x2F;将下行口的网段发布进Area 10</span><br><span class="line">[HUAWEI-ospf-1-area-0.0.0.10] quit</span><br></pre></td></tr></table></figure>

<p>从配置命令中可以看到OSPF区域是以OSPF设备为边界的，例如此拓扑中核心层交换机集群上行接口属于Area 0，下行接口属于Area 10，也就是说此交换机集群跨越了两个区域，是ABR。</p>
<p> 说明：</p>
<p>在单个区域包含过多的低端路由器或者三层交换机是一种不好的设计，如果出现这种情况应该考虑缩小区域范围。</p>
<h4 id="非骨干区域的路由表项优化：特殊区域的使用-1"><a href="#非骨干区域的路由表项优化：特殊区域的使用-1" class="headerlink" title="非骨干区域的路由表项优化：特殊区域的使用"></a>非骨干区域的路由表项优化：特殊区域的使用</h4><p>划分完OSPF网络区域后可以看到非骨干区域的路由表项的规模相对较大。如果非骨干区域的设备性能较低且用户不希望路由表项规模过大，此时可以考虑运用特殊区域。本例中非骨干区域一律采用Totally NSSA区域，具体拓扑如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_113205">图6-61</a>所示。</p>
<p><strong>图6-61</strong>  非骨干区域划分特殊区域后的网络拓扑图<br><img src="http://support.huawei.com/enterprise/product/images/e78eca4d41394439886ab90a62ad9a12" alt="img" loading="lazy"></p>
<p>Totally NSSA区域的配置以Area 10中的核心层交换机集群和汇聚层交换机集群为例。</p>
<p>核心层交换机集群的配置如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[HUAWEI] ospf 1  &#x2F;&#x2F;进入OSPF进程视图</span><br><span class="line">[HUAWEI-ospf-1] area 10  &#x2F;&#x2F;进入Area 10区域视图</span><br><span class="line">[HUAWEI-ospf-1-area-0.0.0.10] nssa no-summary  &#x2F;&#x2F;ABR需要配置nssa no-summary</span><br><span class="line">[HUAWEI-ospf-1-area-0.0.0.10] quit</span><br></pre></td></tr></table></figure>

<p>汇聚层交换机集群的配置如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[HUAWEI] ospf 1  &#x2F;&#x2F;进入OSPF进程视图</span><br><span class="line">[HUAWEI-ospf-1] area 10  &#x2F;&#x2F;进入Area 10区域视图</span><br><span class="line">[HUAWEI-ospf-1-area-0.0.0.10] nssa  &#x2F;&#x2F;非ABR设备配置nssa</span><br><span class="line">[HUAWEI-ospf-1-area-0.0.0.10] quit</span><br></pre></td></tr></table></figure>

<p>配置Totally NSSA区域前，汇聚层交换机集群上的非骨干区域路由表项如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;HUAWEI&gt; display ip routing-table</span><br><span class="line">Route Flags: R - relay, D - download to fib</span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line">Routing Tables: Public</span><br><span class="line">         Destinations : 21        Routes : 21        </span><br><span class="line"></span><br><span class="line">Destination&#x2F;Mask    Proto   Pre  Cost      Flags NextHop         Interface</span><br><span class="line"></span><br><span class="line">      10.0.0.4&#x2F;32   Direct  0    0           D   127.0.0.1       LoopBack0</span><br><span class="line">     10.10.1.0&#x2F;24   Direct  0    0           D   10.10.1.1       Vlanif100</span><br><span class="line">     10.10.1.1&#x2F;32   Direct  0    0           D   127.0.0.1       Vlanif100</span><br><span class="line">     10.10.2.0&#x2F;24   Direct  0    0           D   10.10.2.1       Vlanif200</span><br><span class="line">     10.10.2.1&#x2F;32   Direct  0    0           D   127.0.0.1       Vlanif200</span><br><span class="line">     10.10.3.0&#x2F;24   Direct  0    0           D   10.10.3.1       Vlanif300</span><br><span class="line">     10.10.3.1&#x2F;32   Direct  0    0           D   127.0.0.1       Vlanif300</span><br><span class="line">     10.20.1.0&#x2F;24   OSPF    10   3           D   10.100.10.1     Vlanif10</span><br><span class="line">     10.20.2.0&#x2F;24   OSPF    10   3           D   10.100.10.1     Vlanif10</span><br><span class="line">     10.20.3.0&#x2F;24   OSPF    10   3           D   10.100.10.1     Vlanif10</span><br><span class="line">     10.30.1.0&#x2F;24   OSPF    10   3           D   10.100.10.1     Vlanif10</span><br><span class="line">     10.30.2.0&#x2F;24   OSPF    10   3           D   10.100.10.1     Vlanif10</span><br><span class="line">     10.30.3.0&#x2F;24   OSPF    10   3           D   10.100.10.1     Vlanif10</span><br><span class="line">   10.100.10.0&#x2F;30   Direct  0    0           D   10.100.10.2     Vlanif10</span><br><span class="line">   10.100.10.2&#x2F;32   Direct  0    0           D   127.0.0.1       Vlanif10</span><br><span class="line">   10.100.20.0&#x2F;30   OSPF    10   2           D   10.100.10.1     Vlanif10</span><br><span class="line">   10.100.30.0&#x2F;30   OSPF    10   2           D   10.100.10.1     Vlanif10</span><br><span class="line">   10.200.10.0&#x2F;30   OSPF    10   2           D   10.100.10.1     Vlanif10</span><br><span class="line">   10.200.20.0&#x2F;30   OSPF    10   2           D   10.100.10.1     Vlanif10</span><br><span class="line">      127.0.0.0&#x2F;8   Direct  0    0           D   127.0.0.1       InLoopBack0</span><br><span class="line">      127.0.0.1&#x2F;32  Direct  0    0           D   127.0.0.1       InLoopBack0</span><br></pre></td></tr></table></figure>

<p>配置Totally NSSA区域后，汇聚层交换机集群上的非骨干区域路由表项如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;HUAWEI&gt; display ip routing-table</span><br><span class="line">Route Flags: R - relay, D - download to fib</span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line">Routing Tables: Public</span><br><span class="line">         Destinations : 12        Routes : 12        </span><br><span class="line"></span><br><span class="line">Destination&#x2F;Mask    Proto   Pre  Cost      Flags NextHop         Interface</span><br><span class="line"></span><br><span class="line">       0.0.0.0&#x2F;0    OSPF    10   2           D   10.100.10.1     Vlanif10</span><br><span class="line">      10.0.0.4&#x2F;32   Direct  0    0           D   127.0.0.1       LoopBack0</span><br><span class="line">     10.10.1.0&#x2F;24   Direct  0    0           D   10.10.1.1       Vlanif100</span><br><span class="line">     10.10.1.1&#x2F;32   Direct  0    0           D   127.0.0.1       Vlanif100</span><br><span class="line">     10.10.2.0&#x2F;24   Direct  0    0           D   10.10.2.1       Vlanif200</span><br><span class="line">     10.10.2.1&#x2F;32   Direct  0    0           D   127.0.0.1       Vlanif200</span><br><span class="line">     10.10.3.0&#x2F;24   Direct  0    0           D   10.10.3.1       Vlanif300</span><br><span class="line">     10.10.3.1&#x2F;32   Direct  0    0           D   127.0.0.1       Vlanif300</span><br><span class="line">   10.100.10.0&#x2F;30   Direct  0    0           D   10.100.10.2     Vlanif10</span><br><span class="line">   10.100.10.2&#x2F;32   Direct  0    0           D   127.0.0.1       Vlanif10</span><br><span class="line">      127.0.0.0&#x2F;8   Direct  0    0           D   127.0.0.1       InLoopBack0</span><br><span class="line">      127.0.0.1&#x2F;32  Direct  0    0           D   127.0.0.1       InLoopBack0</span><br></pre></td></tr></table></figure>

<p>可以明显看出，配置Totally NSSA区域以后，Area 10的路由表的规模明显减小，说明在非骨区域通过配置Totally NSSA区域可以达到降低路由表项规模的作用。</p>
<h4 id="骨干区域的路由表项优化：非骨干区域IP子网规划和路由汇聚-1"><a href="#骨干区域的路由表项优化：非骨干区域IP子网规划和路由汇聚-1" class="headerlink" title="骨干区域的路由表项优化：非骨干区域IP子网规划和路由汇聚"></a>骨干区域的路由表项优化：非骨干区域IP子网规划和路由汇聚</h4><p>在非骨区域通过配置Totally NSSA区域后，非骨干区域内部路由器的路由表得到极大的精简并且减少了区域内部OSPF路由器之间的信息交互量。在骨干区域也需要作出适当的操作来达到同样的目的，这就要对非骨干区域使用的IP子网作出合理规划并在ABR进行汇总。</p>
<p><a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_113206">图6-62</a>显示了Area 10作出合理的IP规划后往Area 0通告的路由汇总表项。</p>
<p><strong>图6-62</strong>  通过路由汇总实现骨干区域的路由表项优化<br><img src="http://support.huawei.com/enterprise/product/images/4c4b01155c2c4fbf9c732349e2a61ba0" alt="img" loading="lazy"></p>
<p>区域路由汇总会抑制明细路由条目的通告，这样Area 10的ABR就只会向Area 0内注入一条汇总路由10.10.0.0/16，这样可以精简骨干路由器路由表项，减少Area 0的OSPF报文交互量和保证其路由表的稳定。建议在设计OSPF网络时合理规划IP地址，以方便进行路由汇总。</p>
<p>路由汇总的配置以Area 10中的ABR（核心层交换机集群）为例，配置如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[HUAWEI] ospf 1  &#x2F;&#x2F;进入OSPF进程视图</span><br><span class="line">[HUAWEI-ospf-1] area 10  &#x2F;&#x2F;进入Area 10区域视图</span><br><span class="line">[HUAWEI-ospf-1-area-0.0.0.10] abr-summary 10.10.0.0 255.255.0.0  &#x2F;&#x2F;ABR进行路由汇总</span><br><span class="line">[HUAWEI-ospf-1-area-0.0.0.10] quit</span><br></pre></td></tr></table></figure>



<p> 说明：</p>
<p><strong>abr-summary</strong>命令只能在ABR上配置，区域内部路由器上不要使用此条命令，否则会造成路由表项错误。</p>
<p>路由汇总前，NE40E-1上的路由表项如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;NE40E-1&gt; display ip routing-table</span><br><span class="line">Route Flags: R - relay, D - download to fib</span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line">Routing Tables: Public</span><br><span class="line">         Destinations : 12        Routes : 12        </span><br><span class="line"></span><br><span class="line">Destination&#x2F;Mask    Proto   Pre  Cost      Flags NextHop         Interface</span><br><span class="line"></span><br><span class="line">      10.0.0.1&#x2F;32   Direct  0    0           D   127.0.0.1       LoopBack0</span><br><span class="line">     10.10.1.0&#x2F;24   OSPF    10   3           D   10.200.10.2     GigabitEthernet0&#x2F;0&#x2F;1</span><br><span class="line">     10.10.2.0&#x2F;24   OSPF    10   3           D   10.200.10.2     GigabitEthernet0&#x2F;0&#x2F;1</span><br><span class="line">     10.10.3.0&#x2F;24   OSPF    10   3           D   10.200.10.2     GigabitEthernet0&#x2F;0&#x2F;1</span><br></pre></td></tr></table></figure>

<p>路由汇总后，NE40E-1上的路由表项如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;NE40E-1&gt; display ip routing-table</span><br><span class="line">Route Flags: R - relay, D - download to fib</span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line">Routing Tables: Public</span><br><span class="line">         Destinations : 12        Routes : 12        </span><br><span class="line"></span><br><span class="line">Destination&#x2F;Mask    Proto   Pre  Cost      Flags NextHop         Interface</span><br><span class="line"></span><br><span class="line">      10.0.0.1&#x2F;32   Direct  0    0           D   127.0.0.1       LoopBack0</span><br><span class="line">     10.10.0.0&#x2F;16   OSPF    10   3           D   10.200.10.2     GigabitEthernet0&#x2F;0&#x2F;1</span><br></pre></td></tr></table></figure>

<p>可以看出，路由汇总之前骨干区域内有用户网段的明细路由。在ABR上配置路由汇总后，骨干区域的NE40E-1上只有一条16位掩码的汇总的用户网段路由。这样，在有很多用户网段的情况下，通过汇可以在很大程度上精简骨干区域的路由，减少骨干区域和非骨干区域的LSA交互数量，提高网络的稳定性。</p>
<h4 id="上行流量的引导：OSPF缺省路由的引入和选路优化-1"><a href="#上行流量的引导：OSPF缺省路由的引入和选路优化-1" class="headerlink" title="上行流量的引导：OSPF缺省路由的引入和选路优化"></a>上行流量的引导：OSPF缺省路由的引入和选路优化</h4><p>对于一个园区网络，很大一部分流量是流向Internet的，因此对于这种多出口的网络拓扑，引入缺省路由和多出口流量分担是必须要考虑的问题。</p>
<p>引入缺省路由的方式有多种，建议的做法是在ABR上通过OSPF“非强制”下发缺省路由来实现。OSPF“非强制”下发缺省路由，是指只有ABR自身的IP路由表中存在缺省路由的时候才能发布缺省路由，否则就不能发布。这样可以防止在特殊场景下产生环路或者次优路由。</p>
<p>在本例中两台ABR发布缺省路由后，核心层交换机集群会收到两条缺省路由，下一跳分别指向两个出口路由器。此时核心层交换机集群可以选择其中一条链路作为上行，也可以选择两条上行链路负载分担。具体如何分配流量，可以根据实际的网络情况灵活配置。核心层交换机集群的缺省路由和流量的走向如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_113207">图6-63</a>所示。</p>
<p><strong>图6-63</strong>  通过缺省路由引导核心层交换机集群的上行流量<br><img src="http://support.huawei.com/enterprise/product/images/fb1e65e32c534fff8faea1de9ef9ad00" alt="img" loading="lazy"></p>
<p>NE40E-1上发布缺省路由的配置如下，NE40E-2上的配置类似，不再赘述。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[NE40E-1] ip route-static 0.0.0.0 0.0.0.0 202.10.10.1  &#x2F;&#x2F;在NE40E-1上手工配置一条下一跳指向电信运营商的公网地址的缺省路由</span><br><span class="line">[NE40E-1] ospf 1  &#x2F;&#x2F;进入OSPF进程视图</span><br><span class="line">[NE40E-1-ospf-1] default-route-advertise  &#x2F;&#x2F;发布缺省路由，不携带always参数，即非强制下发缺省路由</span><br></pre></td></tr></table></figure>

<p>完成上述配置后，核心层交换机集群会学习到两条等价的缺省路由，如下所示。此时核心层交换机集群的上行流量将会采取负载分担的方式进行转发。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;HUAWEI&gt; display ip routing-table</span><br><span class="line">Route Flags: R - relay, D - download to fib</span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line">Routing Tables: Public</span><br><span class="line">         Destinations : 23        Routes : 24        </span><br><span class="line"></span><br><span class="line">Destination&#x2F;Mask    Proto   Pre  Cost      Flags NextHop         Interface</span><br><span class="line"></span><br><span class="line">      10.0.0.1&#x2F;32   O_ASE   150  1           D   10.200.10.1     Vlanif40</span><br><span class="line">                    O_ASE   150  1           D   10.200.10.1     Vlanif50</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>如果用户想让核心层交换机集群上行的两条链路采取主备份的形式，正常情况下上行流量发送到NE40E-1，当NE40E-1发生故障时流量自动切换到NE40E-2，最简单直接的方法就是使用OSPF自身的选路机制，通过修改cost值来影响选路。</p>
<p>为了实现路由的主备份，可以修改核心层交换机集群到达NE40-2这条链路的cost，使得核心层交换机集群到达NE40-2这条链路的cost值大于核心层交换机集群到达NE40-1这条链路。</p>
<p>核心层交换机集群的配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[HUAWEI] interface vlanif 50  &#x2F;&#x2F;进入OSPF接口视图</span><br><span class="line">[HUAWEI-Vlanif50] ospf cost 10  &#x2F;&#x2F;修改该接口的OSPF cost值为10</span><br></pre></td></tr></table></figure>

<p>NE40E-2的配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[NE40E-2] interface gigabitethernet 0&#x2F;0&#x2F;1  &#x2F;&#x2F;进入OSPF接口视图</span><br><span class="line">[NE40E-2-GigabitEthernet0&#x2F;0&#x2F;1] ospf cost 10  &#x2F;&#x2F;修改该接口的OSPF cost值为10</span><br></pre></td></tr></table></figure>



<p> 说明：</p>
<p>如果需要调整cost值来影响OSPF的选路，则需要在链路两侧的设备上都调整cost值，否则会形成不对称路由，引起网络故障。</p>
<p>缺省情况下百兆带宽以上的链路OSPF的cost为1，将核心层交换机集群到NE40E-2之间的链路的OSPF cost值修改为10以后，核心层交换机集群将优选到NE40E-1的链路作为上行流量的出口。此时核心层交换机集群的IP路由表中将会仅存在一条指向NE40E-1的缺省路由，如下所示。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;HUAWEI&gt; display ip routing-table</span><br><span class="line">Route Flags: R - relay, D - download to fib</span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line">Routing Tables: Public</span><br><span class="line">         Destinations : 23        Routes : 23        </span><br><span class="line"></span><br><span class="line">Destination&#x2F;Mask    Proto   Pre  Cost      Flags NextHop         Interface</span><br><span class="line"></span><br><span class="line">      10.0.0.1&#x2F;32   O_ASE   150  1           D   10.200.10.1     Vlanif40</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<h4 id="路由汇总场景下的防环设计：黑洞路由的使用-1"><a href="#路由汇总场景下的防环设计：黑洞路由的使用-1" class="headerlink" title="路由汇总场景下的防环设计：黑洞路由的使用"></a>路由汇总场景下的防环设计：黑洞路由的使用</h4><p>经过上述规划与部署，该网络已经具备基本的OSPF功能，路由表项也得到了优化。但是，该网络当前存在产生环路的风险，原因是路由汇总通常容易产生环路。</p>
<p>对于园区网来说，来自内部的网络攻击是很常见的。假设1号楼内的某台主机受到病毒攻击，这种攻击会导致主机遍历并访问10.0.0.0网段的IP地址。此时就有很大的风险产生环路。</p>
<p>假设主机访问10.10.50.1这个地址（1号楼实际上不存在这个地址）。环路产生的过程如下：</p>
<ol>
<li>主机发送数据包时，数据包会不发送至主机的网关，即1号楼的汇聚层交换机集群1。</li>
<li>汇聚层交换机集群1上不存在这个目的地址的明细路由，所以会匹配默认路由发送至核心层交换机集群。</li>
<li>由于10.10.50.1这个地址在整个园区网中根本不存在，所以数据包到达核心层交换机集群后只能匹配缺省路由，发送至NE40E-1。</li>
<li>NE40E-1上学习到的路由是核心层交换机集群通过路由汇总发布出去的，所以会匹配到10.10.0.0/16这条路由，所以数据包又重新发回核心层交换机集群。</li>
</ol>
<p>这样，核心层交换机集群和NE40E-1之间就形成了路由环路，如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_113208">图6-64</a>所示。一旦形成路由环路，将会严重影响网络的运行，甚至导致整网的瘫痪。所以做路由汇总的场景下，必须考虑如何防止路由环路。</p>
<p><strong>图6-64</strong>  路由环路<br><img src="http://support.huawei.com/enterprise/product/images/3ef4f0987d274d6c9acced469f57e57c" alt="img" loading="lazy"></p>
<p>形成路由环路的主要原因是在核心层交换机集群上把目的地址为一个园区网内不存在的地址的数据包匹配默认路由发送给和骨干区域，同时骨干区域又通过汇总的回程路由回送回来。</p>
<p>解决这个路由环路的方法就是在核心层交换机集群上阻断目的地址为一个园区网内不存在的地址的数据包，推荐使用的方法就是配置黑洞路由。配置如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[HUAWEI] ip route-static 10.10.0.0 255.255.0.0 NULL0</span><br></pre></td></tr></table></figure>

<p>配置黑洞路由后，回程到10.10.0.0这个网段的数据包都会由明细路由引导回到用户网段。如果找不到这个明细路由，则证明园区网内不存在这个主机地址。此时数据包就会匹配这条黑洞路由而被丢弃，从而防止产生路由环路。其他区域中也需要在配置路由汇总的同时配置黑洞路由用来防止路由环路的产生。</p>
<h4 id="OSPF网络基本安全：OSPF静默接口的使用-1"><a href="#OSPF网络基本安全：OSPF静默接口的使用-1" class="headerlink" title="OSPF网络基本安全：OSPF静默接口的使用"></a>OSPF网络基本安全：OSPF静默接口的使用</h4><p>完成上述部署后，整个OSPF网络已经能够正常的运行。但是这个网络存在一个较大的安全漏洞，即用户侧能够接收到OSPF的Hello报文，使用网络嗅探工具可以很轻易地获得基本的网络信息，并作出下一步的攻击行为。</p>
<p>为了实现OSPF网络的基本安全，推荐使用静默接口的方式来阻止发往用户的OSPF报文，如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_feature_ospf_113209">图6-65</a>所示。</p>
<p><strong>图6-65</strong>  使用静默接口阻止发往用户的OSPF报文<br><img src="http://support.huawei.com/enterprise/product/images/4e58271662bb4091ab3657d6bef4b9b8" alt="img" loading="lazy"></p>
<p>以Area 10中的汇聚层交换机集群1为例，静默接口的配置如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[HUAWEI] ospf 1</span><br><span class="line">[HUAWEI-ospf-1] silent-interface vlanif100</span><br><span class="line">[HUAWEI-ospf-1] silent-interface vlanif200</span><br><span class="line">[HUAWEI-ospf-1] silent-interface vlanif300</span><br></pre></td></tr></table></figure>



<p> 说明：</p>
<p><strong>silent-interface</strong>命令会禁止接口接收和发送OSPF报文，一般只用于用户侧接口上。应用于OSPF路由器之间的链路会导致OSPF邻居无法建立。</p>
<h2 id="6-5-配置任务概览"><a href="#6-5-配置任务概览" class="headerlink" title="6.5  配置任务概览"></a>6.5  配置任务概览</h2><p>完成配置OSPF的基本功能后，即可以实现通过OSPF协议构建三层网络。如果还需要OSPF的其他功能，还需要根据相应章节进行配置。</p>
<p>OSPF的配置任务如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_cfg_ripng_1000_1_mMcCpPsS_tab_01">表6-16</a>所示。</p>
<p><strong>表6-16</strong>  OSPF配置任务概览</p>
<table>
<thead>
<tr>
<th>场景</th>
<th>描述</th>
<th>对应任务</th>
</tr>
</thead>
<tbody><tr>
<td>配置OSPF的基本功能</td>
<td>配置OSPF的基本功能是能够使用OSPF特性的前提。</td>
<td><a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_cfg_ospf_0004">6.8 配置OSPF的基本功能</a><a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_cfg_ospf_0009">6.9 配置OSPF邻居或邻接的会话参数</a><a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_cfg_ospf_0013">6.10 配置OSPF在不同网络类型中的属性</a></td>
</tr>
<tr>
<td>配置OSPF区域</td>
<td>STUB区域是一些特定的区域，STUB区域的ABR不传播它们接收到的自治系统外部路由，在这些区域中设备的路由表规模以及路由信息传递的数量都会大大减少。OSPF NSSA（Not-So-Stubby Area）区域是OSPF特殊的区域类型。NSSA区域与STUB区域有许多相似的地方，两者都不传播来自OSPF网络其它区域的外部路由。差别在于STUB区域不能引入外部路由，NSSA区域能够将自治域外部路由引入并传播到整个OSPF自治域中。</td>
<td><a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_cfg_ospf_0020">6.11 配置OSPF的Stub区域</a><a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_cfg_ospf_0024">6.12 配置OSPF的NSSA区域</a></td>
</tr>
<tr>
<td>调整OSPF的选路</td>
<td>为了在现网中更灵活的应用OSPF，满足用户的各种需求，可以通过配置不同的参数，实现对OSPF路由的控制。</td>
<td><a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_cfg_ospf_0025">6.13 调整OSPF的选路</a></td>
</tr>
<tr>
<td>控制OSPF的路由信息</td>
<td>在实际应用中，可以通过配置不同的参数，实现对OSPF路由信息的发布和接收进行更为精确的控制，以满足网络需要。</td>
<td><a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_cfg_ospf_0031">6.14 控制OSPF的路由信息</a></td>
</tr>
<tr>
<td>配置OSPF网络的快速收敛</td>
<td>当需要OSPF快速感知网络中的变化时，可以配置加快OSPF网络的收敛速度。当需要减少防止路由震荡对网络的影响、减轻设备负担时，可以配置减慢OSPF网络的收敛速度。</td>
<td><a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_cfg_ospf_0050">6.17 配置OSPF网络的快速收敛</a></td>
</tr>
<tr>
<td>提高OSPF网络可靠性</td>
<td>配置指定进程或指定接口的BDF for OSPF特性，可以快速检测链路的状态，故障检测时间可以达到毫秒级，提高链路状态变化时OSPF的收敛速度。配置OSPF GR可以避免流量中断和主备板切换带来的路由震荡。</td>
<td><a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_cfg_ospf_0044">6.15 配置OSPF与BFD联动</a><a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_vrp_cfg_016259">6.18 配置OSPF GR</a></td>
</tr>
<tr>
<td>提高OSPF网络的稳定性</td>
<td>在实际应用中，可以通过提高OSPF网络的稳定性来使得OSPF网络路由振荡少，并且让设备常时间工作在正常的环境下。</td>
<td><a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_cfg_ospf_0063">6.19 提高OSPF网络的稳定性</a></td>
</tr>
<tr>
<td>提高OSPF网络的安全性</td>
<td>如果将OSPF部署在安全性较高的网络中，可以通过配置OSPF认证特性和GTSM机制来提高OSPF网络的安全性。</td>
<td><a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_cfg_ospf_0071">6.20 提高OSPF网络的安全性</a></td>
</tr>
</tbody></table>
<h2 id="6-6-配置注意事项"><a href="#6-6-配置注意事项" class="headerlink" title="6.6  配置注意事项"></a>6.6  配置注意事项</h2><p>介绍OSPF的配置注意事项。</p>
<h3 id="涉及网元"><a href="#涉及网元" class="headerlink" title="涉及网元"></a>涉及网元</h3><p>需要其他网元支持OSPF协议。</p>
<h3 id="License支持"><a href="#License支持" class="headerlink" title="License支持"></a>License支持</h3><p>本特性是交换机的基本特性，无需获得License许可即可应用此功能。</p>
<h3 id="版本支持"><a href="#版本支持" class="headerlink" title="版本支持"></a>版本支持</h3><p><strong>表6-17</strong>  产品形态和软件版本支持情况</p>
<table>
<thead>
<tr>
<th>系列</th>
<th>产品</th>
<th>支持版本</th>
</tr>
</thead>
<tbody><tr>
<td>S1700</td>
<td>S1720GFR</td>
<td>不支持</td>
</tr>
<tr>
<td>S1720GW-E、S1720GWR-E</td>
<td>V200R010C00、V200R011C00、V200R011C10</td>
<td></td>
</tr>
<tr>
<td>S1720X-E</td>
<td>V200R011C00、V200R011C10</td>
<td></td>
</tr>
<tr>
<td>S2700</td>
<td>S2700SI</td>
<td>不支持</td>
</tr>
<tr>
<td>S2700EI</td>
<td>不支持</td>
<td></td>
</tr>
<tr>
<td>S2710SI</td>
<td>不支持</td>
<td></td>
</tr>
<tr>
<td>S2720EI</td>
<td>V200R011C10</td>
<td></td>
</tr>
<tr>
<td>S2750EI</td>
<td>不支持</td>
<td></td>
</tr>
<tr>
<td>S3700</td>
<td>S3700SI</td>
<td>不支持</td>
</tr>
<tr>
<td>S3700EI</td>
<td>V100R005C01、V100R006（C00&amp;C01&amp;C03&amp;C05）</td>
<td></td>
</tr>
<tr>
<td>S3700HI</td>
<td>V100R006C01、V200R001C00</td>
<td></td>
</tr>
<tr>
<td>S5700</td>
<td>S5700LI/S5700S-LI</td>
<td>不支持</td>
</tr>
<tr>
<td>S5710-C-LI</td>
<td>不支持</td>
<td></td>
</tr>
<tr>
<td>S5710-X-LI</td>
<td>不支持</td>
<td></td>
</tr>
<tr>
<td>S5700SI</td>
<td>不支持</td>
<td></td>
</tr>
<tr>
<td>S5700EI</td>
<td>V100R005C01、V100R006（C00&amp;C01）、V200R001（C00&amp;C01）、V200R002C00、V200R003C00、V200R005（C00&amp;C01&amp;C02&amp;C03）</td>
<td></td>
</tr>
<tr>
<td>S5710EI</td>
<td>V200R001C00、V200R002C00、V200R003C00、V200R005（C00&amp;C02）</td>
<td></td>
</tr>
<tr>
<td>S5720EI</td>
<td>V200R007C00、V200R008C00、V200R009C00、V200R010C00、V200R011C00、V200R011C10</td>
<td></td>
</tr>
<tr>
<td>S5720LI/S5720S-LI</td>
<td>V200R010C00、V200R011C00、V200R011C10</td>
<td></td>
</tr>
<tr>
<td>S5720SI/S5720S-SI</td>
<td>V200R008C00、V200R009C00、V200R010C00、V200R011C00、V200R011C10</td>
<td></td>
</tr>
<tr>
<td>S5730SI</td>
<td>V200R011C10</td>
<td></td>
</tr>
<tr>
<td>S5730S-EI</td>
<td>V200R011C10</td>
<td></td>
</tr>
<tr>
<td>S5700HI</td>
<td>V100R006C01、V200R001（C00&amp;C01）、V200R002C00、V200R003C00、V200R005（C00SPC500&amp;C01&amp;C02）</td>
<td></td>
</tr>
<tr>
<td>S5710HI</td>
<td>V200R003C00、V200R005（C00&amp;C02&amp;C03）</td>
<td></td>
</tr>
<tr>
<td>S5720HI</td>
<td>V200R006C00、V200R007（C00&amp;C10）、V200R008C00、V200R009C00、V200R010C00、V200R011C00、V200R011C10</td>
<td></td>
</tr>
<tr>
<td>S6700</td>
<td>S6700EI</td>
<td>V100R006C00、V200R001（C00&amp;C01）、V200R002C00、V200R003C00、V200R005（C00&amp;C01&amp;C02）</td>
</tr>
<tr>
<td>S6720EI</td>
<td>V200R008C00、V200R009C00、V200R010C00、V200R011C00、V200R011C10</td>
<td></td>
</tr>
<tr>
<td>S6720S-EI</td>
<td>V200R009C00、V200R010C00、V200R011C00、V200R011C10</td>
<td></td>
</tr>
<tr>
<td>S6720SI、S6720S-SI</td>
<td>V200R011C00、V200R011C10</td>
<td></td>
</tr>
<tr>
<td>S6720LI、S6720S-LI</td>
<td>V200R011C00、V200R011C10</td>
<td></td>
</tr>
</tbody></table>
<p> 说明：</p>
<p>如需了解交换机软件配套详细信息，请参见<a target="_blank" rel="noopener" href="http://support.huawei.com/onlinetoolsweb/select-x7/cn/x7/index_version_search.html">华为交换机版本配套速查</a>。</p>
<h3 id="特性依赖和限制"><a href="#特性依赖和限制" class="headerlink" title="特性依赖和限制"></a>特性依赖和限制</h3><p>无</p>
<h2 id="6-7-缺省配置"><a href="#6-7-缺省配置" class="headerlink" title="6.7  缺省配置"></a>6.7  缺省配置</h2><p>介绍OSPF的缺省配置，实际应用的配置可以基于缺省配置进行修改。</p>
<p>OSPF的缺省配置如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#tab_dc_cfg_ospf_000301">表6-18</a>所示。</p>
<p><strong>表6-18</strong>  OSPF缺省配置</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>缺省值</th>
</tr>
</thead>
<tbody><tr>
<td>OSPF特性</td>
<td>不使能</td>
</tr>
<tr>
<td>Hello报文发送间隔</td>
<td>P2P、Broadcast类型接口为10秒；P2MP、NBMA类型接口为30秒</td>
</tr>
<tr>
<td>邻居失效时间</td>
<td>P2P、Broadcast类型接口为40秒；P2MP、NBMA类型接口为120秒</td>
</tr>
<tr>
<td>Stub router保持时间</td>
<td>500秒</td>
</tr>
<tr>
<td>计算接口开销的带宽参考值</td>
<td>100Mbit/s</td>
</tr>
</tbody></table>
<h2 id="6-8-配置OSPF的基本功能"><a href="#6-8-配置OSPF的基本功能" class="headerlink" title="6.8  配置OSPF的基本功能"></a>6.8  配置OSPF的基本功能</h2><p>配置完OSPF的基本功能，就可以组建起最基本的OSPF网络。</p>
<h3 id="应用环境"><a href="#应用环境" class="headerlink" title="应用环境"></a>应用环境</h3><p>在同一区域内配置多台交换机时，大多数的配置数据（如定时器、过滤、聚合等）都应该以区域为单位进行统一规划。错误的配置可能会导致相邻交换机之间无法相互传递信息，甚至导致路由信息的阻塞或者自环。</p>
<p>在接口视图下配置的OSPF命令不受OSPF是否使能的限制。在关闭OSPF后，原来在接口下配置的相关命令仍然存在。</p>
<h3 id="前置任务"><a href="#前置任务" class="headerlink" title="前置任务"></a>前置任务</h3><p>在配置OSPF的基本功能之前，需完成以下任务：</p>
<ul>
<li>配置接口的网络层地址，使各相邻节点网络层可达。</li>
</ul>
<h3 id="6-8-1-创建OSPF进程"><a href="#6-8-1-创建OSPF进程" class="headerlink" title="6.8.1  创建OSPF进程"></a>6.8.1  创建OSPF进程</h3><h4 id="背景信息"><a href="#背景信息" class="headerlink" title="背景信息"></a>背景信息</h4><p>一台交换机如果要运行OSPF协议，必须存在Router ID。交换机的Router ID是一个32比特无符号整数，是一台交换机在自治系统中的唯一标识。为保证OSPF运行的稳定性，在进行网络规划时应该确定Router ID的划分并手工配置。</p>
<h4 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>ospf</strong> [ <em>process-id</em> | <strong>router-id</strong> <em>router-id</em> | <strong>vpn-instance</strong> <em>vpn-instance-name</em> ] *，启动OSPF进程，进入OSPF视图。</p>
</li>
</ol>
<ul>
<li><p><em>process-id</em>为进程号，缺省值为1。</p>
<p>交换机支持OSPF多进程，可以根据业务类型划分不同的进程。进程号是本地概念，不影响与其它交换机之间的报文交换。因此，不同的交换机之间，即使进程号不同也可以进行报文交换。</p>
</li>
<li><p><strong>router-id</strong> <em>router-id</em>为交换机的ID号。</p>
<p>缺省情况下，交换机系统会从当前接口的IP地址中自动选取一个最大值作为Router ID。手动配置Router ID时，必须保证自治系统中任意两台Router ID都不相同。通常的做法是将Router ID配置为与该设备某个接口的IP地址一致。</p>
</li>
</ul>
<pre><code>  说明：

 每个OSPF进程的Router ID要保证在OSPF网络中唯一，否则会导致邻居不能正常建立、路由信息不正确的问题。建议在OSPF设备上单独为每个OSPF进程配置全网唯一的Router ID。</code></pre>
<ul>
<li><p><strong>vpn-instance</strong> <em>vpn-instance-name</em>表示VPN实例。</p>
<p>如果指定了VPN实例，那么此OSPF进程属于指定的VPN实例，如果未指定则属于公网实例。</p>
</li>
</ul>
<h3 id="6-8-2-创建OSPF区域"><a href="#6-8-2-创建OSPF区域" class="headerlink" title="6.8.2  创建OSPF区域"></a>6.8.2  创建OSPF区域</h3><h4 id="背景信息-1"><a href="#背景信息-1" class="headerlink" title="背景信息"></a>背景信息</h4><p>随着网络规模日益扩大，设备数量的增多会导致LSDB非常庞大，导致设备负担很重。OSPF协议通过将自治系统划分成不同的区域（Area）来解决上述问题。区域是从逻辑上将设备划分为不同的组，每个组用区域号（Area ID）来标识。区域的边界是设备，而不是链路。一个网段（链路）只能属于一个区域，或者说每个运行OSPF的接口必须指明属于哪一个区域。</p>
<h4 id="操作步骤-1"><a href="#操作步骤-1" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>ospf</strong> [ <em>process-id</em> | <strong>router-id</strong> <em>router-id</em> | <strong>vpn-instance</strong> <em>vpn-instance-name</em> ] *，启动OSPF进程，进入OSPF视图。</p>
</li>
<li><p>执行命令<strong>area</strong> <em>area-id</em>，创建并进入OSPF区域视图。</p>
</li>
</ol>
<p>   并非所有的区域都是平等的关系。其中区域号（Area ID）是0的称为骨干区域。骨干区域负责区域之间的路由，非骨干区域之间的路由信息必须通过骨干区域来转发。</p>
<h3 id="6-8-3-使能OSPF"><a href="#6-8-3-使能OSPF" class="headerlink" title="6.8.3  使能OSPF"></a>6.8.3  使能OSPF</h3><h4 id="背景信息-2"><a href="#背景信息-2" class="headerlink" title="背景信息"></a>背景信息</h4><p>创建OSPF进程后，还需要配置区域所包含的网段。一个网段只能属于一个区域，或者说每个运行OSPF协议的接口必须指明属于某一个特定的区域。该处的网段是指运行OSPF协议接口的IP地址所在的网段。</p>
<p>OSPF需要对接收到的Hello报文做网络掩码检查，当接收到的Hello报文中携带的网络掩码和本设备不一致时，则丢弃这个Hello报文，即不能建立邻居关系。</p>
<h4 id="操作步骤-2"><a href="#操作步骤-2" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>ospf</strong> [ <em>process-id</em> ]，进入OSPF进程视图。</p>
</li>
<li><p>执行命令<strong>area</strong> <em>area-id</em>，进入OSPF区域视图。</p>
</li>
</ol>
<p>   可以在OSPF区域和指定接口中使能OSPF。</p>
<ul>
<li>在OSPF区域中使能OSPF。</li>
</ul>
<ol>
<li>执行命令<strong>network</strong> <em>ip-address</em> <em>wildcard-mask</em>，配置区域所包含的网段。</li>
</ol>
<pre><code>  满足下面两个条件，接口上才能正常运行OSPF协议：

  - 接口的IP地址掩码长度≥**network**命令指定的掩码长度。
  - 接口的主IP地址必须在**network**命令指定的网段范围内。

  缺省情况下，OSPF以32位主机路由的方式对外发布Loopback接口的IP地址，与Loopback接口上配置的掩码长度无关。如果要发布Loopback接口的网段路由，需要在接口下配置网络类型为NBMA或广播型。请参考[配置接口的网络类型](http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&amp;partNo=10092#dc_cfg_ospf_0014)。</code></pre>
<ul>
<li>在指定接口中使能OSPF。</li>
</ul>
<ol>
<li><p>在系统视图中执行命令<strong>interface</strong> <em>interface-type</em> <em>interface-number</em>，进入接口视图。</p>
</li>
<li><p>（可选）对于以太网接口，执行命令<strong>undo portswitch</strong>，配置接口切换到三层模式。</p>
<p>缺省情况下，以太网接口处于二层模式。</p>
</li>
</ol>
<pre><code>   说明：

  仅S5720HI、S5720EI、S6720EI和S6720S-EI支持二层模式与三层模式切换。</code></pre>
<ol start="3">
<li>执行命令<strong>ospf enable</strong> [ <em>process-id</em> ] <strong>area</strong> <em>area-id</em>，在接口上使能OSPF。</li>
</ol>
<pre><code>  区域ID可以采用十进制整数或IPv4地址形式输入，但显示时使用IPv4地址形式。</code></pre>
<h3 id="6-8-4-（可选）创建虚连接"><a href="#6-8-4-（可选）创建虚连接" class="headerlink" title="6.8.4  （可选）创建虚连接"></a>6.8.4  （可选）创建虚连接</h3><h4 id="背景信息-3"><a href="#背景信息-3" class="headerlink" title="背景信息"></a>背景信息</h4><p>在划分OSPF区域之后，非骨干区域之间的OSPF路由更新是通过骨干区域来交换完成的。因此，OSPF要求所有非骨干区域必须与骨干区域保持连通，并且骨干区域之间也要保持连通。但在实际应用中，因为各方面条件的限制，可能无法满足这个要求，这时可以通过配置OSPF虚连接解决。</p>
<p>请在运行OSPF协议的设备上进行以下配置。</p>
<h4 id="操作步骤-3"><a href="#操作步骤-3" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>ospf</strong> [ <em>process-id</em> ]，进入OSPF进程视图。</p>
</li>
<li><p>执行命令<strong>area</strong> <em>area-id</em>，进入OSPF区域视图。</p>
</li>
<li><p>执行命令<strong>vlink-peer</strong> <em>router-id</em> [ <strong>smart-discover</strong> | <strong>hello</strong> <em>hello-interval</em> | <strong>retransmit</strong> <em>retransmit-interval</em> | <strong>trans-delay</strong> <em>trans-delay-interval</em> | <strong>dead</strong> <em>dead-interval</em> | [ <strong>simple</strong> [ <strong>plain</strong> <em>plain-text</em> | [ <strong>cipher</strong> ] <em>cipher-text</em> ] | { <strong>md5</strong> | <strong>hmac-md5</strong> | <strong>hmac-sha256</strong> } [ <em>key-id</em> { <strong>plain</strong> <em>plain-text</em> | [ <strong>cipher</strong> ] <em>cipher-text</em> } ] | <strong>authentication-null</strong> | <strong>keychain</strong> <em>keychain-name</em> ] ] *，创建并配置虚连接。</p>
</li>
</ol>
<p>   在虚连接的另一端也需要配置此命令。</p>
<p>   <img src="http://support.huawei.com/enterprise/product/images/5bf7fc7c2b06498782a61a01fdd10e10" alt="img" loading="lazy"> 注意：</p>
<p>   如果使用<strong>plain</strong>选项，密码将以明文形式保存在配置文件中，存在安全隐患。建议使用<strong>cipher</strong>选项，将密码加密保存。</p>
<p>   MD5和HMAC-MD5认证模式存在风险，推荐使用HMAC-SHA256认证模式。</p>
<pre><code>说明：</code></pre>
<p>   仅S6720EI、S6720S-EI、S5720HI和S5720EI支持<strong>keychain</strong> <em>keychain-name</em>参数。</p>
<h4 id="后续处理"><a href="#后续处理" class="headerlink" title="后续处理"></a>后续处理</h4><p>建立虚连接后，不同的设备制造商可能会使用不同的MTU（maximum transmission unit）缺省设置。为了保证一致，应该设置接口发送DD报文时MTU值为缺省值0。参见<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_cfg_ospf_0011">使能在DD报文中填充接口的实际MTU</a>。</p>
<h3 id="6-8-5-（可选）配置对OSPF更新LSA的泛洪限制"><a href="#6-8-5-（可选）配置对OSPF更新LSA的泛洪限制" class="headerlink" title="6.8.5  （可选）配置对OSPF更新LSA的泛洪限制"></a>6.8.5  （可选）配置对OSPF更新LSA的泛洪限制</h3><h4 id="背景信息-4"><a href="#背景信息-4" class="headerlink" title="背景信息"></a>背景信息</h4><p>当邻居数量或者需要泛洪的LSA报文数量较多时，邻居路由器会在短时间内收到大量的更新报文。如果邻居路由器不能及时处理这些突发的大量报文，则有可能因为忙于处理更新报文而丢弃了维护邻居关系的Hello报文，造成邻居断开。而重建邻居时，需要交互的报文数量将会更大，由此导致报文数量过大的情况进一步恶化。通过对OSPF更新LSA的泛洪限制可以有效避免以上情况的发生，起到了维护邻居关系的目的。</p>
<p>请在运行OSPF协议的交换机上进行以下配置。</p>
<h4 id="操作步骤-4"><a href="#操作步骤-4" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>ospf</strong> [ <em>process-id</em> ]，进入OSPF进程视图。</p>
</li>
<li><p>执行命令<strong>flooding-control</strong> [ <strong>number</strong> <em>transmit-number</em> | <strong>timer-interval</strong> <em>transmit-interval</em> ] *，配置对OSPF更新LSA的泛洪限制。</p>
</li>
</ol>
<p>   缺省情况下，每次泛洪更新LSA的数量的缺省值是50，泛洪更新LSA的时间间隔是30秒。</p>
<p>   配置<strong>flooding-control</strong>命令后，控制对OSPF更新LSA的泛洪的这个功能立刻生效。</p>
<p>   若没有配置<strong>flooding-control</strong>命令，当邻居数量超过256个时自动使能该功能。</p>
<h3 id="6-8-6-检查配置结果"><a href="#6-8-6-检查配置结果" class="headerlink" title="6.8.6  检查配置结果"></a>6.8.6  检查配置结果</h3><h4 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h4><p>已经完成OSPF基本功能的所有配置。</p>
<h4 id="操作步骤-5"><a href="#操作步骤-5" class="headerlink" title="操作步骤"></a>操作步骤</h4><ul>
<li>在任意视图下执行<strong>display ospf</strong> [ <em>process-id</em> ] <strong>peer</strong>命令，查看OSPF邻居的信息。</li>
<li>在任意视图下执行<strong>display ospf</strong> [ <em>process-id</em> ] <strong>interface</strong>命令，查看OSPF接口的信息。</li>
<li>在任意视图下执行<strong>display ospf</strong> [ <em>process-id</em> ] <strong>routing</strong>命令，查看OSPF路由表的信息。</li>
<li>在任意视图下执行<strong>display ospf</strong> [ <em>process-id</em> ] <strong>lsdb</strong>命令，查看OSPF的LSDB信息。</li>
</ul>
<h2 id="6-9-配置OSPF邻居或邻接的会话参数"><a href="#6-9-配置OSPF邻居或邻接的会话参数" class="headerlink" title="6.9  配置OSPF邻居或邻接的会话参数"></a>6.9  配置OSPF邻居或邻接的会话参数</h2><p>OSPF网络中，所有链路状态信息都在邻居或邻接中传递、交换。配置合理的OSPF邻居或邻接关系的会话参数，对整网的稳定性起着重要作用。</p>
<h3 id="前置任务-1"><a href="#前置任务-1" class="headerlink" title="前置任务"></a>前置任务</h3><p>在配置OSPF邻居或邻接关系的会话参数之前，需完成以下任务：</p>
<ul>
<li>配置链路层协议。</li>
<li>配置接口的网络层地址，使各相邻节点网络层可达。</li>
<li><a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_cfg_ospf_0004">6.8 配置OSPF的基本功能</a>。</li>
</ul>
<h3 id="配置流程"><a href="#配置流程" class="headerlink" title="配置流程"></a>配置流程</h3><p>以下配置任务（不含检查配置结果），根据应用环境选择其中一项或几项进行配置。</p>
<h3 id="6-9-1-配置OSPF报文重传限制"><a href="#6-9-1-配置OSPF报文重传限制" class="headerlink" title="6.9.1  配置OSPF报文重传限制"></a>6.9.1  配置OSPF报文重传限制</h3><h4 id="背景信息-5"><a href="#背景信息-5" class="headerlink" title="背景信息"></a>背景信息</h4><p>OSPF</p>
<p>交换机</p>
<p>发送完以下这三种报文后，若没有在规定时间内收到相应的LSAck报文，会再次重传。当达到限定报文重传次数后，本端就断开和对方的邻接关系。</p>
<ul>
<li>DD报文</li>
<li>LSU报文</li>
<li>LSR报文</li>
</ul>
<h4 id="操作步骤-6"><a href="#操作步骤-6" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>ospf</strong> [ <em>process-id</em> ]，进入OSPF进程视图。</p>
</li>
<li><p>执行命令<strong>retransmission-limit</strong> [ <em>max-number</em> ]，配置OSPF重传限制功能。</p>
</li>
</ol>
<p>   缺省情况下，不使能此功能。最大重传限制数的缺省值是30。</p>
<h3 id="6-9-2-使能在DD报文中填充接口的实际MTU"><a href="#6-9-2-使能在DD报文中填充接口的实际MTU" class="headerlink" title="6.9.2  使能在DD报文中填充接口的实际MTU"></a>6.9.2  使能在DD报文中填充接口的实际MTU</h3><h4 id="背景信息-6"><a href="#背景信息-6" class="headerlink" title="背景信息"></a>背景信息</h4><p>建立虚连接后，不同的设备制造商可能会使用不同的MTU缺省设置。为了保证一致，应该设置接口发送DD报文时MTU值为缺省值0。</p>
<h4 id="操作步骤-7"><a href="#操作步骤-7" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>interface</strong> <em>interface-type</em> <em>interface-number</em>，进入运行OSPF协议的接口视图。</p>
</li>
<li><p>（可选）对于以太网接口，执行命令<strong>undo portswitch</strong>，配置接口切换到三层模式。</p>
</li>
</ol>
<p>   缺省情况下，以太网接口处于二层模式。</p>
<pre><code>说明：</code></pre>
<p>   仅S5720HI、S5720EI、S6720EI和S6720S-EI支持二层模式与三层模式切换。</p>
<ol start="4">
<li>执行命令<strong>ospf mtu-enable</strong>，使能接口发送DD报文时填充MTU值，同时还会检查邻居DD报文所携带的MTU是否超过本端的MTU值。</li>
</ol>
<p>   缺省情况下，接口发送DD报文的MTU值为0。</p>
<p>   <img src="http://support.huawei.com/enterprise/product/images/5bf7fc7c2b06498782a61a01fdd10e10" alt="img" loading="lazy"> 注意：</p>
<p>   当配置DD报文MTU值后，会引起邻居关系重新建立。</p>
<h3 id="6-9-3-检查配置结果"><a href="#6-9-3-检查配置结果" class="headerlink" title="6.9.3  检查配置结果"></a>6.9.3  检查配置结果</h3><h4 id="前提条件-1"><a href="#前提条件-1" class="headerlink" title="前提条件"></a>前提条件</h4><p>已经完成配置OSPF邻居或邻接的会话参数的所有配置。</p>
<h4 id="操作步骤-8"><a href="#操作步骤-8" class="headerlink" title="操作步骤"></a>操作步骤</h4><ul>
<li>使用<strong>display ospf</strong> [ <em>process-id</em> ] <strong>peer</strong>命令查看OSPF邻居的信息。</li>
<li>使用<strong>display ospf</strong> [ <em>process-id</em> ] <strong>brief</strong>命令查看OSPF的概要信息。</li>
<li>使用<strong>display ospf</strong> [ <em>process-id</em> ] <strong>retrans-queue</strong> [ <em>interface-type</em> <em>interface-number</em> ] [ <em>neighbor-id</em> ] [ <strong>low-level-of-retrans-times-range</strong> <em>min-time</em> ] [ <strong>high-level-of-retrans-times-range</strong> <em>max-time</em> ]命令查看OSPF重传列表。</li>
</ul>
<h2 id="6-10-配置OSPF在不同网络类型中的属性"><a href="#6-10-配置OSPF在不同网络类型中的属性" class="headerlink" title="6.10  配置OSPF在不同网络类型中的属性"></a>6.10  配置OSPF在不同网络类型中的属性</h2><p>通过配置OSPF接口的网络类型和调整属性，可以灵活组建OSPF网络。</p>
<h3 id="应用环境-1"><a href="#应用环境-1" class="headerlink" title="应用环境"></a>应用环境</h3><p>OSPF根据链路层协议类型将网络分为四种不同的类型。如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#tab_dc_vrp_cfg_01621601">表6-19</a>所示。</p>
<p><strong>表6-19</strong>  OSPF的网络类型和特点</p>
<table>
<thead>
<tr>
<th>网络类型</th>
<th>特点</th>
<th>缺省选择</th>
</tr>
</thead>
<tbody><tr>
<td>广播类型（Broadcast）</td>
<td>在该类型的网络中，通常以组播形式发送Hello报文、LSU报文和LSAck报文，以单播形式发送DD报文和LSR报文。</td>
<td>当链路层协议是Ethernet、FDDI时，缺省情况下，OSPF认为网络类型是Broadcast。</td>
</tr>
<tr>
<td>NBMA类型（Non-broadcast multiple access）</td>
<td>在该类型的网络中，以单播形式发送Hello报文、DD报文、LSR报文、LSU报文、LSAck报文。NBMA网络必须是全连通的，即网络中任意两台交换机之间都必须直接可达。</td>
<td>当链路层协议是ATM时，缺省情况下，OSPF认为网络类型是NBMA。</td>
</tr>
<tr>
<td>点到点P2P类型（point-to-point）</td>
<td>在该类型的网络中，以组播形式发送Hello报文、DD报文、LSR报文、LSU报文、LSAck报文。</td>
<td>当链路层协议是PPP、HDLC和LAPB时，缺省情况下，OSPF认为网络类型是P2P。</td>
</tr>
<tr>
<td>点到多点P2MP类型（Point-to-Multipoint）</td>
<td>在该类型的网络中：以组播形式发送Hello报文，以单播形式发送DD报文、LSR报文、LSU报文、LSAck报文。</td>
<td>没有一种链路层协议会被缺省的认为是P2MP类型，P2MP必须是由其他的网络类型强制更改的。</td>
</tr>
</tbody></table>
<p>由<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#tab_dc_vrp_cfg_01621601">表6-19</a>可以看出，OSPF协议在上述四种网络类型中的差异主要集中在发送报文形式不同，因此，在四种网络类型中配置的OSPF协议，配置差异主要体现在协议报文的发送形式的配置。</p>
<h3 id="前置任务-2"><a href="#前置任务-2" class="headerlink" title="前置任务"></a>前置任务</h3><p>在配置OSPF在不同网络类型中的属性之前，需完成以下任务：</p>
<ul>
<li>配置接口的网络层地址，使各相邻节点网络层可达。</li>
<li><a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_cfg_ospf_0004">6.8 配置OSPF的基本功能</a>。</li>
</ul>
<h3 id="配置流程-1"><a href="#配置流程-1" class="headerlink" title="配置流程"></a>配置流程</h3><p>配置接口的网络类型是配置P2MP和NBMA网络属性的前置任务。</p>
<h3 id="6-10-1-配置接口的网络类型"><a href="#6-10-1-配置接口的网络类型" class="headerlink" title="6.10.1  配置接口的网络类型"></a>6.10.1  配置接口的网络类型</h3><h4 id="背景信息-7"><a href="#背景信息-7" class="headerlink" title="背景信息"></a>背景信息</h4><p>下面三种情况是配置接口网络类型的最常见情况：</p>
<ul>
<li>P2MP网络类型：由于P2MP不存在于链路层协议中，所以P2MP都是由其他网络类型强制更改的。</li>
<li>NBMA网络类型：由于NBMA网络必须是全连通的，所以网络中任意两台交换机之间都必须直接可达。但在很多情况下，这个要求无法满足，这时就需要通过命令强制改变网络的类型。</li>
<li>广播网络类型：为了提高建立邻居速度，可以将广播类型网络更改为P2P网络。</li>
</ul>
<h4 id="操作步骤-9"><a href="#操作步骤-9" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>interface</strong> <em>interface-type</em> <em>interface-number</em>，进入运行OSPF的接口视图。</p>
</li>
<li><p>（可选）对于以太网接口，执行命令<strong>undo portswitch</strong>，配置接口切换到三层模式。</p>
</li>
</ol>
<p>   缺省情况下，以太网接口处于二层模式。</p>
<pre><code>说明：</code></pre>
<p>   仅S5720HI、S5720EI、S6720EI和S6720S-EI支持二层模式与三层模式切换。</p>
<ol start="4">
<li>执行命令<strong>ospf network-type</strong> { <strong>broadcast</strong> | <strong>nbma</strong> | <strong>p2mp</strong> | <strong>p2p</strong> [ <strong>peer-ip-ignore</strong> ] }，配置OSPF接口的网络类型。</li>
</ol>
<p>   缺省情况下，接口的网络类型根据物理接口而定。以太网接口的网络类型为广播。</p>
<p>   当用户为接口配置了新的网络类型后，原接口的网络类型将被替换。</p>
<p>   根据实际情况配置接口的网络类型，例如：</p>
<ul>
<li>如果接口的网络类型是广播，但在广播网络上有不支持组播地址的交换机，可以将接口的网络类型改为NBMA网络。</li>
<li>如果接口的网络类型是NBMA，且网络是全连通的，即任意两台交换机都直接可达。此时，可以将接口类型改为广播网络，并且不必再配置邻居路由器。</li>
<li>如果接口的网络类型是NBMA，但网络不是全连通的，必须将接口的网络类型改为P2MP。这样，两台不能直接可达的交换机就可以通过一台与两者都直接可达的交换机来交换路由信息。接口的网络类型改为P2MP网络后，不必再配置邻居交换机。</li>
<li>如果同一网段内只有两台交换机运行OSPF协议，建议将接口的网络类型改为P2P网络。</li>
</ul>
<pre><code>说明：</code></pre>
<p>   OSPF协议不支持NULL接口的配置。</p>
<h3 id="6-10-2-配置P2MP网络属性"><a href="#6-10-2-配置P2MP网络属性" class="headerlink" title="6.10.2  配置P2MP网络属性"></a>6.10.2  配置P2MP网络属性</h3><h4 id="操作步骤-10"><a href="#操作步骤-10" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>配置忽略对网络掩码的检查。</p>
<ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>interface</strong> <em>interface-type</em> <em>interface-number</em>，进入接口视图。</p>
</li>
<li><p>（可选）对于以太网接口，执行命令<strong>undo portswitch</strong>，配置接口切换到三层模式。</p>
<p>缺省情况下，以太网接口处于二层模式。</p>
</li>
</ol>
</li>
</ol>
<pre><code>   说明：

  仅S5720HI、S5720EI、S6720EI和S6720S-EI支持二层模式与三层模式切换。</code></pre>
<ol start="4">
<li>执行命令<strong>ospf network-type</strong> <strong>p2mp</strong>，配置OSPF接口的网络类型。</li>
</ol>
<pre><code>  P2MP网络类型必须是由其他的网络类型强制更改的。详细描述参见[配置接口的网络类型](http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&amp;partNo=10092#dc_cfg_ospf_0014)。</code></pre>
<ol start="5">
<li><p>执行命令<strong>ospf p2mp-mask-ignore</strong>命令，配置在P2MP网络上忽略对网络掩码的检查。</p>
</li>
<li><p>执行命令<strong>quit</strong>，退出接口视图。</p>
</li>
</ol>
<ol start="2">
<li>（可选）配置P2MP网络上到指定邻居所需的开销值。</li>
</ol>
<p>   缺省情况下，P2MP网络上到指定邻居所需的开销值等于接口的开销值，当需要修改此开销值时，可以通过<strong>p2mp-peer</strong>命令进行配置。</p>
<ol>
<li>执行命令<strong>ospf</strong> [ <em>process-id</em> ]，进入OSPF进程视图。</li>
<li>执行命令<strong>p2mp-peer</strong> <em>ip-address</em> <strong>cost</strong> <em>cost</em>，配置P2MP网络上到指定邻居所需的开销值。</li>
</ol>
<ol start="3">
<li>配置对发送的LSA进行过滤。</li>
</ol>
<p>   当两台交换机之间存在多条链路时，通过对出方向的LSA进行过滤可以在某些链路上过滤LSA的传送，减少不必要的重传，节省带宽资源。</p>
<ol>
<li><p>执行命令<strong>ospf</strong> [ <em>process-id</em> ]，进入OSPF进程视图。</p>
</li>
<li><p>执行命令<strong>filter-lsa-out peer</strong> <em>ip-address</em> { <strong>all</strong> | { <strong>summary</strong> [ <strong>acl</strong> { <em>acl-number</em> | <em>acl-name</em> } ] | <strong>ase</strong> [ <strong>acl</strong> { <em>acl-number</em> | <em>acl-name</em> } ] | <strong>nssa</strong> [ <strong>acl</strong> { <em>acl-number</em> | <em>acl-name</em> } ] } * }，配置在P2MP网络中对发送的LSA进行过滤。</p>
</li>
</ol>
<pre><code>  缺省情况下，不对LSA进行过滤。</code></pre>
<h3 id="6-10-3-配置NBMA网络属性"><a href="#6-10-3-配置NBMA网络属性" class="headerlink" title="6.10.3  配置NBMA网络属性"></a>6.10.3  配置NBMA网络属性</h3><h4 id="操作步骤-11"><a href="#操作步骤-11" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li>（可选）配置NBMA网络类型。</li>
</ol>
<p>   由于NBMA网络必须是全连通的，所以网络中任意两台交换机之间都必须直接可达。但在很多情况下，这个要求无法满足，此时必须通过命令强制改变网络的类型为P2MP。详细描述参见<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_cfg_ospf_0014">配置接口的网络类型</a>。</p>
<ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>interface</strong> <em>interface-type</em> <em>interface-number</em>，进入接口视图。</p>
</li>
<li><p>（可选）对于以太网接口，执行命令<strong>undo portswitch</strong>，配置接口切换到三层模式。</p>
<p>缺省情况下，以太网接口处于二层模式。</p>
</li>
</ol>
<pre><code>   说明：

  仅S5720HI、S5720EI、S6720EI和S6720S-EI支持二层模式与三层模式切换。</code></pre>
<ol start="4">
<li>执行命令<strong>ospf network-type</strong> <strong>nbma</strong>，配置OSPF接口的网络类型为NBMA。</li>
</ol>
<ol start="2">
<li>（可选）配置NBMA网络发送轮询报文的时间间隔。</li>
</ol>
<p>   在NBMA网络上，当邻居失效后，交换机将按设置的轮询时间间隔定期地发送Hello报文。</p>
<ol>
<li>执行命令<strong>ospf timer poll</strong> <em>interval</em>，在NBMA接口上配置发送轮询报文的时间间隔。</li>
</ol>
<pre><code>  缺省情况下，时间间隔*interval*为120秒。</code></pre>
<ol start="3">
<li>配置NBMA网络的邻居。</li>
</ol>
<p>   网络类型为NBMA的接口，无法通过广播Hello报文的形式发现邻居交换机，必须在接口上手工配置邻居交换机的IP地址和邻居交换机是否有选举权。</p>
<ol>
<li>执行命令<strong>quit</strong>，退出接口视图。</li>
<li>执行命令<strong>ospf</strong> [ <em>process-id</em> ]，进入OSPF进程视图。</li>
<li>执行命令<strong>peer</strong> <em>ip-address</em> [ <strong>dr-priority</strong> <em>priority</em> ]，配置NBMA网络的邻居。</li>
</ol>
<h3 id="6-10-4-检查配置结果"><a href="#6-10-4-检查配置结果" class="headerlink" title="6.10.4  检查配置结果"></a>6.10.4  检查配置结果</h3><h4 id="前提条件-2"><a href="#前提条件-2" class="headerlink" title="前提条件"></a>前提条件</h4><p>已经完成OSPF在NBMA网络和P2MP网络中的属性的所有配置。</p>
<h4 id="操作步骤-12"><a href="#操作步骤-12" class="headerlink" title="操作步骤"></a>操作步骤</h4><ul>
<li>使用以下命令查看OSPF的LSDB信息：</li>
</ul>
<ul>
<li><strong>display ospf</strong> [ <em>process-id</em> ] <strong>lsdb</strong> [ <strong>brief</strong> ]</li>
<li><strong>display ospf</strong> [ <em>process-id</em> ] <strong>lsdb</strong> [ { <strong>router</strong> | <strong>network</strong> | <strong>summary</strong> | <strong>asbr</strong> | <strong>ase</strong> | <strong>nssa</strong> | <strong>opaque-link</strong> | <strong>opaque-area</strong> | <strong>opaque-as</strong> } [ <em>link-state-id</em> ] ] [ <strong>originate</strong>-<strong>router</strong> [ <em>advertising-router-id</em> ] | <strong>self</strong>-<strong>originate</strong> ] [ <strong>age</strong> { <strong>min-value</strong> <em>min-age-value</em> | <strong>max-value</strong> <em>max-age-value</em> } * ]</li>
</ul>
<ul>
<li><p>使用<strong>display ospf</strong> [ <em>process-id</em> ] <strong>peer</strong> [ [ <em>interface-type</em> <em>interface-number</em> ] <em>neighbor-id</em> | <strong>brief</strong> | <strong>last-nbr-down</strong> ]命令查看OSPF邻居的信息。</p>
</li>
<li><p>使用<strong>display ospf</strong> [ <em>process-id</em> ] <strong>nexthop</strong>查看OSPF的下一跳信息。</p>
</li>
<li><p>使用以下命令查看OSPF的路由表信息：</p>
</li>
</ul>
<ul>
<li><strong>display ospf</strong> [ <em>process-id</em> ] <strong>routing</strong> [ <em>ip-address</em> [ <em>mask</em> | <em>mask-length</em> ] ] [ <strong>interface</strong> <em>interface-type</em> <em>interface-number</em> ] [ <strong>nexthop</strong> <em>nexthop-address</em> ]</li>
<li><strong>display ospf</strong> [ <em>process-id</em> ] <strong>routing</strong> <strong>router-id</strong> [ <em>router-id</em> ]</li>
</ul>
<ul>
<li>使用<strong>display ospf</strong> [ <em>process-id</em> ] <strong>interface</strong> [ <strong>all</strong> | <em>interface-type</em> <em>interface-number</em> ] [ <strong>verbose</strong> ]查看OSPF的接口信息。</li>
</ul>
<h2 id="6-11-配置OSPF的Stub区域"><a href="#6-11-配置OSPF的Stub区域" class="headerlink" title="6.11  配置OSPF的Stub区域"></a>6.11  配置OSPF的Stub区域</h2><p>通过将位于AS边缘的一些非骨干区域配置成Stub，可以缩减LSDB和路由表规模，减少需要传递的路由信息数量。</p>
<h3 id="应用环境-2"><a href="#应用环境-2" class="headerlink" title="应用环境"></a>应用环境</h3><p>OSPF划分区域可以减少网络中LSA的数量。对于位于自治系统边界的非骨干区域，为了更多的缩减其路由表规模和降低LSA的数量，可以将它们配置为STUB区域。</p>
<p>STUB区域是一种可选的配置属性。</p>
<p>配置STUB区域时需要注意以下几点：</p>
<ul>
<li>骨干区域（Area0）不能配置成STUB区域。</li>
<li>如果要将一个区域配置成STUB区域，则该区域中的所有路由器都要配置STUB区域属性。</li>
<li>STUB区域内不能存在ASBR，即自治系统外部的路由不能在STUB区域内传播。</li>
<li>STUB区域内不能存在虚连接。</li>
</ul>
<h3 id="前置任务-3"><a href="#前置任务-3" class="headerlink" title="前置任务"></a>前置任务</h3><p>在配置OSPF的Stub区域前，需完成以下任务：</p>
<ul>
<li>配置接口的网络层地址，使各相邻节点网络层可达。</li>
<li><a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_cfg_ospf_0004">6.8 配置OSPF的基本功能</a>。</li>
</ul>
<h3 id="配置流程-2"><a href="#配置流程-2" class="headerlink" title="配置流程"></a>配置流程</h3><p><strong>图6-66</strong>  OSPF的Stub区域配置流程图<br><img src="http://support.huawei.com/enterprise/product/images/02e1c47ef46e4fd080b6ebdb038d065d" alt="img" loading="lazy"></p>
<h3 id="6-11-1-配置当前区域为Stub区域"><a href="#6-11-1-配置当前区域为Stub区域" class="headerlink" title="6.11.1  配置当前区域为Stub区域"></a>6.11.1  配置当前区域为Stub区域</h3><h4 id="操作步骤-13"><a href="#操作步骤-13" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>ospf</strong> [ <em>process-id</em> ]，进入OSPF进程视图。</p>
</li>
<li><p>执行命令<strong>area</strong> <em>area-id</em>，进入OSPF区域视图。</p>
</li>
<li><p>执行命令<strong>stub</strong> [ <strong>no-summary</strong> | <strong>default-route-advertise</strong> <strong>backbone-peer-ignore</strong> ] *，配置当前区域为STUB区域。</p>
</li>
</ol>
<p>   <strong>no-summary</strong>用来禁止ABR向Stub区域内发送Type-3 LSA（Summary LSA）。</p>
<p>   <strong>default-route-advertise</strong>用来在ABR上配置产生缺省的Type-3 LSA到Stub区域。</p>
<p>   <strong>backbone-peer-ignore</strong>用来忽略检查骨干区域的邻居状态。即骨干区域中只要存在Up状态的接口，无论是否存在Full状态的邻居，ABR都会产生缺省的Type-3 LSA到Stub区域。</p>
<pre><code>说明：</code></pre>
<ul>
<li>所有连接到STUB区域的交换机必须使用<strong>stub</strong>命令将该区域配置成STUB区域属性。</li>
<li>配置或取消STUB属性，会触发区域更新。只有在上一次区域更新完成后，才能进行再次配置或取消配置操作。</li>
</ul>
<h3 id="6-11-2-（可选）配置发送到Stub区域缺省路由的开销"><a href="#6-11-2-（可选）配置发送到Stub区域缺省路由的开销" class="headerlink" title="6.11.2  （可选）配置发送到Stub区域缺省路由的开销"></a>6.11.2  （可选）配置发送到Stub区域缺省路由的开销</h3><h4 id="操作步骤-14"><a href="#操作步骤-14" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>ospf</strong> [ <em>process-id</em> ]，进入OSPF进程视图。</p>
</li>
<li><p>执行命令<strong>area</strong> <em>area-id</em>，进入OSPF区域视图。</p>
</li>
<li><p>执行命令<strong>stub</strong> [ <strong>no-summary</strong> | <strong>default-route-advertise</strong> <strong>backbone-peer-ignore</strong> ] *，配置当前区域为STUB区域。</p>
</li>
</ol>
<p>   <strong>no-summary</strong>用来禁止ABR向Stub区域内发送Type-3 LSA（Summary LSA）。</p>
<p>   <strong>default-route-advertise</strong>用来在ABR上配置产生缺省的Type-3 LSA到Stub区域。</p>
<p>   <strong>backbone-peer-ignore</strong>用来忽略检查骨干区域的邻居状态。即骨干区域中只要存在Up状态的接口，无论是否存在Full状态的邻居，ABR都会产生缺省的Type-3 LSA到Stub区域。</p>
<pre><code>说明：</code></pre>
<ul>
<li>所有连接到STUB区域的交换机必须使用<strong>stub</strong>命令将该区域配置成STUB区域属性。</li>
<li>配置或取消STUB属性，会触发区域更新。只有在上一次区域更新完成后，才能进行再次配置或取消配置操作。</li>
</ul>
<ol start="5">
<li>执行命令<strong>default-cost</strong> <em>cost</em>，配置发送到Stub区域缺省路由的开销。</li>
</ol>
<p>   <em>cost</em>为发送到Stub区域的Type3缺省路由的开销，缺省值为1。</p>
<p>   当区域配置为STUB区域后，为保证到自治系统外的路由可达，STUB区域的ABR将生成一条缺省路由，并发布给STUB区域中的其他交换机。</p>
<h3 id="6-11-3-检查配置结果"><a href="#6-11-3-检查配置结果" class="headerlink" title="6.11.3  检查配置结果"></a>6.11.3  检查配置结果</h3><h4 id="操作步骤-15"><a href="#操作步骤-15" class="headerlink" title="操作步骤"></a>操作步骤</h4><p>使用以下命令查看OSPF的LSDB信息：</p>
<ul>
<li><strong>display ospf</strong> [ <em>process-id</em> ] <strong>lsdb</strong> [ <strong>brief</strong> ]</li>
<li><strong>display ospf</strong> [ <em>process-id</em> ] <strong>lsdb</strong> [ { <strong>router</strong> | <strong>network</strong> | <strong>summary</strong> | <strong>asbr</strong> | <strong>ase</strong> | <strong>nssa</strong> | <strong>opaque-link</strong> | <strong>opaque-area</strong> | <strong>opaque-as</strong> } [ <em>link-state-id</em> ] ] [ <strong>originate</strong>-<strong>router</strong> [ <em>advertising-router-id</em> ] | <strong>self</strong>-<strong>originate</strong> ] [ <strong>age</strong> { <strong>min-value</strong> <em>min-age-value</em> | <strong>max-value</strong> <em>max-age-value</em> } *]</li>
</ul>
<p>使用以下命令查看OSPF路由表的信息：</p>
<ul>
<li><strong>display ospf</strong> [ <em>process-id</em> ] <strong>routing</strong> [ <em>ip-address</em> [ <em>mask</em> | <em>mask-length</em> ] ] [ <strong>interface</strong> <em>interface-type</em> <em>interface-number</em> ] [ <strong>nexthop</strong> <em>nexthop-address</em> ]</li>
<li><strong>display ospf</strong> [ <em>process-id</em> ] <strong>routing</strong> <strong>router-id</strong> [ <em>router-id</em> ]</li>
</ul>
<p>使用<strong>display ospf</strong> [ <em>process-id</em> ] <strong>abr-asbr</strong> [ <em>router-id</em> ]命令查看OSPF ABR及ASBR信息。</p>
<h2 id="6-12-配置OSPF的NSSA区域"><a href="#6-12-配置OSPF的NSSA区域" class="headerlink" title="6.12  配置OSPF的NSSA区域"></a>6.12  配置OSPF的NSSA区域</h2><p>通过将位于自治系统边缘的非骨干区域配置成NSSA区域，可以缩减其路由表规模，减少需要传递的路由信息数量。</p>
<h3 id="应用环境-3"><a href="#应用环境-3" class="headerlink" title="应用环境"></a>应用环境</h3><p>NSSA区域适用于既需要引入外部路由又要避免外部路由带来的资源消耗的场景。</p>
<p>OSPF NSSA（Not-So-Stubby Area）区域是OSPF特殊的区域类型。NSSA区域与STUB区域有许多相似的地方，两者都不传播来自OSPF网络其它区域的外部路由。差别在于STUB区域是不能引入外部路由，NSSA区域能够将自治域外部路由引入并传播到整个OSPF自治域中。</p>
<p>在NSSA区域中使用Type7 LSA描述引入的外部路由信息。Type7 LSA由NSSA区域的自治域边界路由器（ASBR）产生，其扩散范围仅限于边界路由器所在的NSSA区域。NSSA区域的区域边界路由器（ABR）收到Type7 LSA时，会有选择地将其转化为Type5 LSA，以便将外部路由信息通告到OSPF网络的其它区域。</p>
<h3 id="前置任务-4"><a href="#前置任务-4" class="headerlink" title="前置任务"></a>前置任务</h3><p>在配置OSPF的NSSA区域之前，需完成以下任务：</p>
<ul>
<li>配置接口的网络层地址，使相邻节点之间网络层可达。</li>
<li><a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_cfg_ospf_0004">6.8 配置OSPF的基本功能</a>。</li>
</ul>
<h4 id="操作步骤-16"><a href="#操作步骤-16" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>ospf</strong> [ <em>process-id</em> ]，进入OSPF进程视图。</p>
</li>
<li><p>执行命令<strong>area</strong> <em>area-id</em>，进入OSPF区域视图。</p>
</li>
<li><p>执行命令<strong>nssa</strong> [ { <strong>default-route-advertise</strong> [ <strong>backbone-peer-ignore</strong> ] | <strong>suppress-default-route</strong> } | <strong>flush-waiting-timer</strong> <em>interval-value</em> | <strong>no-import-route</strong> | <strong>no-summary</strong> | <strong>set-n-bit</strong> | <strong>suppress-forwarding-address</strong> | <strong>translator-always</strong> | <strong>translator-interval</strong> <em>interval-value</em> | <strong>zero-address-forwarding</strong> | <strong>translator-strict</strong> ]*，配置当前区域为NSSA区域。</p>
</li>
</ol>
<pre><code>说明：</code></pre>
<ul>
<li><p>所有连接到NSSA区域的设备必须使用<strong>nssa</strong>命令将该区域配置成NSSA属性。</p>
</li>
<li><p>配置或取消NSSA属性，会触发区域更新，邻居中断。只有在上一次区域更新完成后，才能进行再次配置或取消配置操作。</p>
<p>nssa</p>
<p>命令参数的使用场景如下：</p>
</li>
<li><p><strong>default-route-advertise</strong>用来在ASBR上配置产生缺省的Type7 LSA到NSSA区域。</p>
<p>在ABR上无论路由表中是否存在缺省路由0.0.0.0/0，都会产生Type7 LSA缺省路由。在ASBR上只有当路由表中存在缺省路由0.0.0.0/0，才会产生Type7 LSA缺省路由。</p>
</li>
<li><p>当ASBR所在的区域被配置成NSSA时，在LSA洪泛区域中的其他交换机上仍会保留已经没用的Type5 LSA，这些LSA必须等到老化时间到达3600秒后才会被删除。由于大量的LSA会占用交换机内存，所以对设备的性能造成了一定影响。此时，通过配置<strong>flush-waiting-timer</strong>参数产生老化时间被置为最大值（3600秒）的Type5 LSA，及时清除其他交换机上已经没用的Type5 LSA。</p>
</li>
</ul>
<pre><code>  说明：

 - 当LSA报文头部的LS age（老化时间）达到3600秒时，该LSA会被删除。
 - 当ASBR同时还是ABR时，**flush-waiting-timer**功能不会生效，防止删除非NSSA区域的Type5 LSA。</code></pre>
<ul>
<li><p>当ASBR同时还是ABR时，通过配置<strong>no-import-route</strong>参数使OSPF通过<strong>import-route</strong>命令引入的外部路由不被通告到NSSA区域。</p>
</li>
<li><p>为了继续减少发送到NSSA区域的LSA的数量，可以配置ABR的</p>
<p>no-summary</p>
<p>属性，禁止ABR向NSSA区域内发送Summary LSA（Type3 LSA）。</p>
</li>
</ul>
<pre><code>  说明：

 配置**nssa** **default-route-advertise** **backbone-peer-ignore** **no-summary**命令后，骨干区域中只要存在Up状态的接口，无论是否存在Full状态的邻居，ABR会同时产生缺省的Type-7 LSA和缺省的Type-3 LSA，且缺省的Type-3 LSA优先生效。</code></pre>
<ul>
<li><p>设置了<strong>set-n-bit</strong>关键字后，交换机会与邻居交换机同步时在DD报文中设置N-bit位的标志。</p>
</li>
<li><p>当NSSA区域中有多个ABR时，系统会根据规则自动选择一个ABR作为转换器（通常情况下NSSA区域选择Router ID最大的设备），将Type7 LSA转换为Type5 LSA。通过在ABR上配置<strong>translator-always</strong>参数，可以将某一个ABR指定为转换器。如果需要指定某两个ABR进行负载分担，可以通过配置<strong>translator-always</strong>来指定两个转换器同时工作。如果需要某一个固定的转换器，防止由于转换器变动引起的LSA重新泛洪，可以预先使用此命令指定。</p>
</li>
<li><p><strong>translator-interval</strong>参数主要用于转换器切换过程，保障切换平滑进行。所以<em>interval-value</em>参数的缺省间隔要大于泛洪的时间。</p>
</li>
</ul>
<ol start="5">
<li>（可选）执行命令<strong>default-cost</strong> <em>cost</em>，配置ABR发送到NSSA区域的Type3 LSA的缺省路由的开销。</li>
</ol>
<p>   当区域配置为NSSA区域后，为保证到自治系统外的路由可达，NSSA区域的ABR将生成一条缺省路由，并发布给NSSA区域中的其他交换机。配置NSSA区域的缺省路由的开销，调整缺省路由的选路。</p>
<p>   缺省路由也可以通过Type7 LSA来表示，用于指导流量流向其它自治域。</p>
<p>   在NSSA区域中，可能同时存在多个边界路由器。为了防止路由环路产生，边界路由器之间不计算对方发布的缺省路由。</p>
<p>   缺省情况下，ABR发送到NSSA区域的缺省路由的开销为1。</p>
<h3 id="检查配置结果"><a href="#检查配置结果" class="headerlink" title="检查配置结果"></a>检查配置结果</h3><p>使用以下命令查看OSPF的LSDB信息：</p>
<ul>
<li><strong>display ospf</strong> [ <em>process-id</em> ] <strong>lsdb</strong> [ <strong>brief</strong> ]</li>
<li><strong>display ospf</strong> [ <em>process-id</em> ] <strong>lsdb</strong> [ { <strong>router</strong> | <strong>network</strong> | <strong>summary</strong> | <strong>asbr</strong> | <strong>ase</strong> | <strong>nssa</strong> | <strong>opaque-link</strong> | <strong>opaque-area</strong> | <strong>opaque-as</strong> } [ <em>link-state-id</em> ] ] [ <strong>originate</strong>-<strong>router</strong> [ <em>advertising-router-id</em> ] | <strong>self</strong>-<strong>originate</strong> ] [ <strong>age</strong> { <strong>min-value</strong> <em>min-age-value</em> | <strong>max-value</strong> <em>max-age-value</em> } *]</li>
</ul>
<p>使用以下命令查看OSPF的路由表信息：</p>
<ul>
<li><strong>display ospf</strong> [ <em>process-id</em> ] <strong>routing</strong> [ <em>ip-address</em> [ <em>mask</em> | <em>mask-length</em> ] ] [ <strong>interface</strong> <em>interface-type</em> <em>interface-number</em> ] [ <strong>nexthop</strong> <em>nexthop-address</em> ]</li>
<li><strong>display ospf</strong> [ <em>process-id</em> ] <strong>routing</strong> <strong>router-id</strong> [ <em>router-id</em> ]</li>
</ul>
<p>使用<strong>display ospf</strong> [ <em>process-id</em> ] <strong>interface</strong> [ <strong>all</strong> | <em>interface-type</em> <em>interface-number</em> ] [ <strong>verbose</strong> ]命令查看OSPF的接口信息。</p>
<h2 id="6-13-调整OSPF的选路"><a href="#6-13-调整OSPF的选路" class="headerlink" title="6.13  调整OSPF的选路"></a>6.13  调整OSPF的选路</h2><p>通过调整OSPF选路，使得网络以满足复杂环境中的需要。</p>
<h3 id="应用环境-4"><a href="#应用环境-4" class="headerlink" title="应用环境"></a>应用环境</h3><p>在复杂网络环境，通过调整OSPF的功能参数来达到灵活组网、优化网络负载分担。</p>
<h3 id="前置任务-5"><a href="#前置任务-5" class="headerlink" title="前置任务"></a>前置任务</h3><p>在调整OSPF的选路之前，需完成以下任务：</p>
<ul>
<li>配置接口的网络层地址，使各相邻节点网络层可达。</li>
<li><a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_cfg_ospf_0004">6.8 配置OSPF的基本功能</a>。</li>
</ul>
<h3 id="配置流程-3"><a href="#配置流程-3" class="headerlink" title="配置流程"></a>配置流程</h3><p>以下配置任务（不含检查配置结果），根据应用环境选择其中一项或几项进行配置。</p>
<h3 id="6-13-1-配置OSPF的接口开销"><a href="#6-13-1-配置OSPF的接口开销" class="headerlink" title="6.13.1  配置OSPF的接口开销"></a>6.13.1  配置OSPF的接口开销</h3><h4 id="背景信息-8"><a href="#背景信息-8" class="headerlink" title="背景信息"></a>背景信息</h4><p>OSPF既可以根据接口的带宽自动计算其链路开销值，也可以通过命令配置。</p>
<p>如果没有通过<strong>ospf cost</strong> <em>cost</em>命令配置OSPF接口的开销值，OSPF会根据该接口的带宽自动计算其开销值。计算公式为：接口开销=带宽参考值/接口带宽，取计算结果的整数部分作为接口开销值（当结果小于1时取1）。通过改变带宽参考值可以间接改变接口的开销值。</p>
<h4 id="操作步骤-17"><a href="#操作步骤-17" class="headerlink" title="操作步骤"></a>操作步骤</h4><ul>
<li><p>配置OSPF接口的开销值</p>
<ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>interface</strong> <em>interface-type</em> <em>interface-number</em>，进入运行OSPF的接口视图。</p>
</li>
<li><p>（可选）对于以太网接口，执行命令<strong>undo portswitch</strong>，配置接口切换到三层模式。</p>
<p>缺省情况下，以太网接口处于二层模式。</p>
</li>
</ol>
</li>
</ul>
<pre><code>  说明：

 仅S5720HI、S5720EI、S6720EI和S6720S-EI支持二层模式与三层模式切换。</code></pre>
<ol start="4">
<li>执行命令<strong>ospf cost</strong> <em>cost</em>，设置OSPF接口的开销值。</li>
</ol>
<ul>
<li><p>配置带宽参考值</p>
<ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>ospf</strong> [ <em>process-id</em> ]，进入OSPF进程视图。</p>
</li>
<li><p>执行命令<strong>bandwidth-reference</strong> <em>value</em>，配置带宽参考值。</p>
</li>
</ol>
</li>
</ul>
<pre><code> *value*为计算链路开销时所依据的参考值，单位是Mbit/s。



  说明：

 在配置带宽参考值时请注意，必须保证该进程中所有交换机的带宽参考值一致。</code></pre>
<h3 id="6-13-2-配置等价路由"><a href="#6-13-2-配置等价路由" class="headerlink" title="6.13.2  配置等价路由"></a>6.13.2  配置等价路由</h3><h4 id="背景信息-9"><a href="#背景信息-9" class="headerlink" title="背景信息"></a>背景信息</h4><p>当网络中到达同一目的地存在同一路由协议发现的多条路由，且这几条路由的开销值也相同，那么这些路由就是等价路由，可以实现负载分担。</p>
<p>例如，如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_cfg_ospf_011501">图6-67</a>所示。交换机A和交换机B之间的三条路由都运行OSPF协议，且几条路由的开销值也相同，那么这三条路由就是等价路由，形成了负载分担。</p>
<p><strong>图6-67</strong>  等价路由组网图<br><img src="http://support.huawei.com/enterprise/product/images/8b1576ffe3c94d419fc4efb4900385cb" alt="img" loading="lazy"></p>
<h4 id="操作步骤-18"><a href="#操作步骤-18" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>ospf</strong> [ <em>process-id</em> ]，进入OSPF进程视图。</p>
</li>
<li><p>执行命令<strong>maximum load-balancing</strong> <em>number</em>，配置最大等价路由数量。</p>
</li>
</ol>
<pre><code>说明：</code></pre>
<p>   缺省情况下，S6720SI、S6720S-SI、S5720S-SI和S5720SI最大等价路由条数为8，S5720EI、S5720HI、S6720S-EI和S6720EI最大等价路由条数为16。</p>
<ol start="4">
<li>（可选）执行命令<strong>nexthop</strong> <em>ip-address</em> <strong>weight</strong> <em>value</em>，配置OSPF的负载分担优先级。</li>
</ol>
<p>   当组网中存在的等价路由数量大于<strong>maximum load-balancing</strong>命令配置的等价路由数量时，会随机选取有效路由进行负载分担。如果需要指定负载分担的有效路由，可以通过<strong>nexthop</strong>命令配置路由的优先级，将需要指定的有效路由的优先级设置为高。</p>
<p>   <strong>weight</strong>值越小，路由优先级越高。<strong>weight</strong>的缺省值是255，表示等价路由间进行负载分担，不区分优先级。</p>
<h3 id="6-13-3-配置路由选择规则"><a href="#6-13-3-配置路由选择规则" class="headerlink" title="6.13.3  配置路由选择规则"></a>6.13.3  配置路由选择规则</h3><h4 id="背景信息-10"><a href="#背景信息-10" class="headerlink" title="背景信息"></a>背景信息</h4><p>由于RFC2328与RFC1583定义的路由选路规则不同，因此使能OSPF后，根据实际设备支持的路由选路的定义情况（支持RFC2328或支持RFC1583）配置OSPF域的路由选路规则。默认支持RFC1583，当设备支持的是RFC2328时，需要将RFC1583配置成RFC2328，使OSPF路由域中的所有设备配置为同一种路由选路规则。</p>
<h4 id="操作步骤-19"><a href="#操作步骤-19" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>ospf</strong> [ <em>process-id</em> ]，进入OSPF进程视图。</p>
</li>
<li><p>执行命令<strong>undo rfc1583 compatible</strong>，将RFC1583配置成RFC2328，配置OSPF域的路由选路规则。</p>
</li>
</ol>
<p>   缺省情况下，交换机支持RFC1583的选路规则。</p>
<h3 id="6-13-4-检查配置结果"><a href="#6-13-4-检查配置结果" class="headerlink" title="6.13.4  检查配置结果"></a>6.13.4  检查配置结果</h3><h4 id="前提条件-3"><a href="#前提条件-3" class="headerlink" title="前提条件"></a>前提条件</h4><p>已经完成OSPF路由属性的所有配置。</p>
<h4 id="操作步骤-20"><a href="#操作步骤-20" class="headerlink" title="操作步骤"></a>操作步骤</h4><ul>
<li>使用<strong>display ospf</strong> [ <em>process-id</em> ] <strong>interface</strong>命令查看OSPF接口的信息。</li>
<li>使用<strong>display ospf</strong> [ <em>process-id</em> ] <strong>routing</strong>命令查看OSPF路由表的信息。</li>
</ul>
<h2 id="6-14-控制OSPF的路由信息"><a href="#6-14-控制OSPF的路由信息" class="headerlink" title="6.14  控制OSPF的路由信息"></a>6.14  控制OSPF的路由信息</h2><p>控制OSPF路由信息包括引入外部路由以及对路由、LSA的过滤。</p>
<h3 id="前置任务-6"><a href="#前置任务-6" class="headerlink" title="前置任务"></a>前置任务</h3><p>在控制OSPF的路由信息之前，需完成以下任务：</p>
<ul>
<li>配置接口的网络层地址，使各相邻节点网络层可达。</li>
<li><a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_cfg_ospf_0004">6.8 配置OSPF的基本功能</a>。</li>
</ul>
<h3 id="配置流程-4"><a href="#配置流程-4" class="headerlink" title="配置流程"></a>配置流程</h3><p>以下配置任务（不含检查配置结果），根据应用环境选择其中一项或几项进行配置。</p>
<h3 id="6-14-1-配置OSPF引入外部路由"><a href="#6-14-1-配置OSPF引入外部路由" class="headerlink" title="6.14.1  配置OSPF引入外部路由"></a>6.14.1  配置OSPF引入外部路由</h3><h4 id="背景信息-11"><a href="#背景信息-11" class="headerlink" title="背景信息"></a>背景信息</h4><p>当OSPF网络中的设备需要访问运行其他协议的网络中的设备时，需要将其他协议的路由引入到OSPF网络中。</p>
<p>OSPF是一个无环路的动态路由协议，但这是针对域内路由和域间路由而言的，其对引入的外部路由环路没有很好的防范机制，所以在配置OSPF引入外部路由时一定要慎重，防止手工配置引起的环路。</p>
<p>请在运行OSPF协议的自治系统边界交换机ASBR上进行以下配置。</p>
<h4 id="操作步骤-21"><a href="#操作步骤-21" class="headerlink" title="操作步骤"></a>操作步骤</h4><ul>
<li><p>配置OSPF引入其它协议的路由</p>
<ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>ospf</strong> [ <em>process-id</em> ]，进入OSPF进程视图。</p>
</li>
<li><p>执行命令<strong>import-route</strong> { <strong>limit</strong> <em>limit-number</em> | { <strong>bgp</strong> [ <strong>permit-ibgp</strong> ] | <strong>direct</strong> | <strong>unr</strong> | <strong>rip</strong> [ <em>process-id-rip</em> ] | <strong>static</strong> | <strong>isis</strong> [ <em>process-id-isis</em> ] | <strong>ospf</strong> [ <em>process-id-ospf</em> ] } [ <strong>cost</strong> <em>cost</em> | <strong>type</strong> <em>type</em> | <strong>tag</strong> <em>tag</em> | <strong>route-policy</strong> <em>route-policy-name</em> ] * }，引入其它协议的路由信息。</p>
</li>
</ol>
</li>
</ul>
<pre><code>  说明：

 仅S6720EI、S6720S-EI、S5720HI、S5720EI、S6720SI、S6720S-SI、S5720SI和S5720S-SI支持**bgp** [ **permit-ibgp** ]参数和**isis** [ *process-id-isis* ]参数。</code></pre>
<ul>
<li><p>配置OSPF引入路由时的相关参数</p>
<ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>ospf</strong> [ <em>process-id</em> ]，进入OSPF进程视图。</p>
</li>
<li><p>执行命令<strong>default</strong> { <strong>cost</strong> { <em>cost-value</em> | <strong>inherit-metric</strong> } | <strong>limit</strong> <em>limit</em> | <strong>tag</strong> <em>tag</em> | <strong>type</strong> <em>type</em> } *，配置引入路由时的参数缺省值（路由度量、标记、类型）。</p>
</li>
</ol>
</li>
</ul>
<pre><code> 当OSPF引入外部路由时，可以配置一些额外参数的缺省值，如开销、路由数量、标记和类型。路由标记可以用来标识协议相关的信息，如OSPF接收BGP时用来区分自治系统的编号。

 缺省情况下，OSPF引入外部路由的缺省度量值为1，引入的外部路由类型为Type2，设置缺省标记值为1。



  说明：

 可以通过以下三条命令设置引入路由的开销值，其优先级依次递减：

 - 通过**apply cost**命令设置的路由开销值。
 - 通过**import-route**命令设置的引入路由开销值。
 - 通过**default**命令设置引入路由的缺省开销值。</code></pre>
<h3 id="6-14-2-配置OSPF将缺省路由通告到OSPF路由区域"><a href="#6-14-2-配置OSPF将缺省路由通告到OSPF路由区域" class="headerlink" title="6.14.2  配置OSPF将缺省路由通告到OSPF路由区域"></a>6.14.2  配置OSPF将缺省路由通告到OSPF路由区域</h3><h4 id="背景信息-12"><a href="#背景信息-12" class="headerlink" title="背景信息"></a>背景信息</h4><p>OSPF实际组网应用中，区域边界和自治系统边界通常都是由多个交换机组成的多出口冗余备份或者负载分担。此时，为了减少路由表的容量，可以配置缺省路由，保证网络的高可用性。</p>
<p>OSPF缺省路由通常应用于下面两种情况：</p>
<ol>
<li>由区域边界交换机（ABR）发布Type3 LSA，用来指导区域内路由器进行区域之间报文的转发。</li>
<li>由自治系统边界交换机（ASBR）发布Type5 LSA或Type7 LSA，用来指导OSPF路由域内路由器进行域外报文的转发。</li>
</ol>
<p>当路由器无精确匹配的路由时，就可以通过缺省路由进行报文转发。</p>
<p>Type3 LSA缺省路由的优先级要高于Type5 LSA或Type7 LSA路由。</p>
<p>OSPF缺省路由的发布方式取决于引入缺省路由的区域类型。如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#tab_dc_vrp_cfg_01623101">表6-20</a>所示。</p>
<p><strong>表6-20</strong>  缺省路由发布方式</p>
<table>
<thead>
<tr>
<th>区域类型</th>
<th>产生条件</th>
<th>发布方式</th>
<th>产生LSA的类型</th>
<th>泛洪范围</th>
</tr>
</thead>
<tbody><tr>
<td>普通区域</td>
<td>通过<strong>default-route-advertise</strong>命令配置</td>
<td>ASBR发布</td>
<td>Type5 LSA</td>
<td>普通区域</td>
</tr>
<tr>
<td>STUB区域</td>
<td>自动产生</td>
<td>ABR发布</td>
<td>Type3 LSA</td>
<td>STUB区域</td>
</tr>
<tr>
<td>NSSA区域</td>
<td>通过<strong>nssa</strong> [ <strong>default-route-advertise</strong> ]</td>
<td>ASBR发布</td>
<td>Type7 LSA</td>
<td>NSSA区域</td>
</tr>
<tr>
<td>完全NSSA区域</td>
<td>自动产生</td>
<td>ABR发布</td>
<td>Type3 LSA</td>
<td>NSSA区域</td>
</tr>
</tbody></table>
<p>请在运行OSPF协议的自治系统边界交换机ASBR上进行以下配置。</p>
<h4 id="操作步骤-22"><a href="#操作步骤-22" class="headerlink" title="操作步骤"></a>操作步骤</h4><ul>
<li><p>配置OSPF将缺省路由通告到OSPF路由区域</p>
<ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>ospf</strong> [ <em>process-id</em> ]，进入OSPF进程视图。</p>
</li>
<li><p>请根据实际情况选择以下配置。</p>
</li>
</ol>
</li>
</ul>
<pre><code> - 如果要将缺省路由通告到OSPF路由区域，则执行命令**default-route-advertise** [ [ **always** | **permit-calculate-other** ] | **cost** *cost* | **type** *type* | **route-policy** *route-policy-name* [ **match-any** ] ] *。
   - **always**表示无论本机是否存在激活的非本OSPF进程的缺省路由，都会产生并发布一个描述缺省路由的LSA。
   - **permit-calculate-other**表示在发布缺省路由后，仍允许计算其他交换机发布的缺省路由。
   - **route-policy** *route-policy-name*表示路由表中有匹配的非本OSPF进程产生的缺省路由表项时，按路由策略所配置的参数发布缺省路由的匹配规则。



  说明：

 - 本机必须存在激活的非本OSPF进程的缺省路由时才会产生并发布一个缺省路由的ASE LSA。
 - OSPF路由域中在通告缺省路由前，会比较缺省路由的优先级，如果在其中某OSPF交换机上同时配置了静态缺省路由，要使OSPF通告的缺省路由加入到当前的路由表中，则必须保证所配置的静态缺省路由的优先级比OSPF通告的缺省路由的优先级低。</code></pre>
<h3 id="6-14-3-配置OSPF路由聚合"><a href="#6-14-3-配置OSPF路由聚合" class="headerlink" title="6.14.3  配置OSPF路由聚合"></a>6.14.3  配置OSPF路由聚合</h3><h4 id="背景信息-13"><a href="#背景信息-13" class="headerlink" title="背景信息"></a>背景信息</h4><p>当OSPF网络规模较大时，配置路由聚合，可以有效减少路由表中的条目，减小对系统资源的占用，不影响系统的性能。此外，如果被聚合的IP地址范围内的某条链路频繁Up和Down，该变化并不会通告到被聚合的IP地址范围外的设备。因此，可以避免网络中的路由震荡，在一定程度上提高了网络的稳定性。</p>
<p>ABR向其它区域发送路由信息时，以网段为单位生成Type3 LSA。当区域中存在连续的网段（具有相同前缀的路由信息）时，可以通过<strong>abr-summary</strong>命令将这些网段聚合成一个网段，ABR向其他区域只发送一条聚合后的LSA，所有指定的聚合网段范围的LSA将不会再被单独发送。从而减小路由表的规模，提高交换机的性能。</p>
<p>请在运行OSPF协议的交换机上进行以下配置。</p>
<h4 id="操作步骤-23"><a href="#操作步骤-23" class="headerlink" title="操作步骤"></a>操作步骤</h4><ul>
<li><p>配置ABR路由聚合</p>
<ol>
<li>执行命令<strong>system-view</strong>，进入系统视图。</li>
<li>执行命令<strong>ospf</strong> [ <em>process-id</em> ]，进入OSPF进程视图。</li>
<li>执行命令<strong>area</strong> <em>area-id</em>，进入OSPF区域视图。</li>
<li>执行命令<strong>abr-summary</strong> <em>ip-address</em> <em>mask</em> [ [ <strong>cost</strong> { <em>cost</em> | <strong>inherit-minimum</strong> } | [ <strong>advertise</strong> [ <strong>generate-null0-route</strong> ] | <strong>not-advertise</strong> | <strong>generate-null0-route</strong> [ <strong>advertise</strong> ] ] ] * ]，配置OSPF的ABR路由聚合。</li>
</ol>
</li>
<li><p>配置ASBR路由聚合</p>
<ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>ospf</strong> [ <em>process-id</em> ]，进入OSPF进程视图。</p>
</li>
<li><p>（可选）执行命令<strong>asbr-summary</strong> <strong>type</strong> <strong>nssa-trans-type-reference</strong> [ <strong>cost</strong> <strong>nssa-trans-cost-reference</strong> ]，配置OSPF设置聚合路由类型（Type）和开销值（Cost）时考虑Type7转换到Type5的LSA。</p>
<p>缺省情况下，OSPF在设置聚合路由类型和开销时不考虑Type7转换到Type5的LSA。</p>
</li>
<li><p>执行命令<strong>asbr-summary</strong> <em>ip-address</em> <em>mask</em> [ <strong>not-advertise</strong> | <strong>tag</strong> <em>tag</em> | <strong>cost</strong> <em>cost</em> | <strong>distribute-delay</strong> <em>interval</em> ] *，配置OSPF的ASBR路由聚合。</p>
</li>
</ol>
</li>
</ul>
<pre><code>  说明：

 在配置路由聚合后，本地OSPF设备的路由表保持不变。但是其他OSPF设备的路由表中将只有一条聚合路由，没有具体路由。直到网络中被聚合的路由都出现故障而消失时，该聚合路由才会消失。</code></pre>
<h3 id="6-14-4-配置OSPF对接收的路由进行过滤"><a href="#6-14-4-配置OSPF对接收的路由进行过滤" class="headerlink" title="6.14.4  配置OSPF对接收的路由进行过滤"></a>6.14.4  配置OSPF对接收的路由进行过滤</h3><h4 id="操作步骤-24"><a href="#操作步骤-24" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>ospf</strong> [ <em>process-id</em> ]，进入OSPF进程视图。</p>
</li>
<li><p>执行命令<strong>filter-policy</strong> { <em>acl-number</em> | <strong>acl-name</strong> <em>acl-name</em> | <strong>ip-prefix</strong> <em>ip-prefix-name</em> | <strong>route-policy</strong> <em>route-policy-name</em> [ <strong>secondary</strong> ] } <strong>import</strong>，配置对接收的路由进行过滤。</p>
</li>
</ol>
<ul>
<li><em>acl-number</em>为基本访问控制列表号。</li>
<li><strong>acl-name</strong> <em>acl-name</em>为访问控制列表名称。</li>
<li><strong>ip-prefix</strong> <em>ip-prefix-name</em>为地址前缀列表名称。</li>
</ul>
<p>   <strong>filter-policy import</strong>命令是对OSPF计算出来的路由进行过滤，不能对发布和接收的LSA进行过滤，只有通过过滤的路由才被添加到路由表中，没有通过过滤的路由不会被添加进OSPF路由表，但不影响对外发布出去。</p>
<h3 id="6-14-5-配置OSPF对发布的路由进行过滤"><a href="#6-14-5-配置OSPF对发布的路由进行过滤" class="headerlink" title="6.14.5  配置OSPF对发布的路由进行过滤"></a>6.14.5  配置OSPF对发布的路由进行过滤</h3><h4 id="操作步骤-25"><a href="#操作步骤-25" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>ospf</strong> [ <em>process-id</em> ]，进入OSPF进程视图。</p>
</li>
<li><p>执行命令<strong>filter-policy</strong> { <em>acl-number</em> | <strong>acl-name</strong> <em>acl-name</em> | <strong>ip-prefix</strong> <em>ip-prefix-name</em> | <strong>route-policy</strong> <em>route-policy-name</em> } <strong>export</strong> [ <em>protocol</em> [ <em>process-id</em> ] ]，配置对通过<strong>import-route</strong>命令引入的路由进行过滤，只有通过过滤的路由才能被发布出去。</p>
</li>
</ol>
<ul>
<li><p><em>acl-number</em>为基本访问控制列表号。</p>
</li>
<li><p><strong>acl-name</strong> <em>acl-name</em>为访问控制列表名称。</p>
</li>
<li><p><strong>ip-prefix</strong> <em>ip-prefix-name</em>为地址前缀列表名称。</p>
</li>
<li><p><strong>route-policy</strong> <em>route-policy-name</em>为路由策略名称。</p>
<p>用户可以通过指定<em>protocol</em> [ <em>process-id</em> ]对特定的某一种协议或某一进程的路由信息进行过滤。如果没有指定<em>protocol</em> [ <em>process-id</em> ]，则OSPF将对所有引入的路由信息进行过滤。</p>
</li>
</ul>
<pre><code>说明：</code></pre>
<ul>
<li><strong>import-route</strong>命令不能引入外部路由的缺省路由。</li>
<li>OSPF对引入的路由进行过滤，是指OSPF只将满足条件的外部路由生成的Type5 LSA发布出去。</li>
</ul>
<h3 id="6-14-6-配置对发送的LSA进行过滤"><a href="#6-14-6-配置对发送的LSA进行过滤" class="headerlink" title="6.14.6  配置对发送的LSA进行过滤"></a>6.14.6  配置对发送的LSA进行过滤</h3><h4 id="背景信息-14"><a href="#背景信息-14" class="headerlink" title="背景信息"></a>背景信息</h4><p>当两台交换机之间存在多条链路时，通过对发送的LSA进行过滤可以在某些链路上过滤LSA的传送，减少不必要的重传，节省带宽资源。</p>
<p>请在运行OSPF协议的交换机上进行以下配置。</p>
<h4 id="操作步骤-26"><a href="#操作步骤-26" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>interface</strong> <em>interface-type</em> <em>interface-number</em>，进入接口视图。</p>
</li>
<li><p>（可选）对于以太网接口，执行命令<strong>undo portswitch</strong>，配置接口切换到三层模式。</p>
</li>
</ol>
<p>   缺省情况下，以太网接口处于二层模式。</p>
<pre><code>说明：</code></pre>
<p>   仅S5720HI、S5720EI、S6720EI和S6720S-EI支持二层模式与三层模式切换。</p>
<ol start="4">
<li>执行命令<strong>ospf filter-lsa-out</strong> { <strong>all</strong> | { <strong>summary</strong> [ <strong>acl</strong> { <em>acl-number</em> | <em>acl-name</em> } ] | <strong>ase</strong> [ <strong>acl</strong> { <em>acl-number</em> | <em>acl-name</em> } ] | <strong>nssa</strong> [ <strong>acl</strong> { <em>acl-number</em> | <em>acl-name</em> } ] } * }，配置对出方向的LSA进行过滤。</li>
</ol>
<p>   缺省情况下，不对发送的LSA进行过滤。</p>
<h3 id="6-14-7-配置对ABR-Type3-LSA进行过滤"><a href="#6-14-7-配置对ABR-Type3-LSA进行过滤" class="headerlink" title="6.14.7  配置对ABR Type3 LSA进行过滤"></a>6.14.7  配置对ABR Type3 LSA进行过滤</h3><h4 id="背景信息-15"><a href="#背景信息-15" class="headerlink" title="背景信息"></a>背景信息</h4><p>通过对区域内出、入方向ABR Type3 LSA（Summary LSA）设置过滤条件，只有通过过滤的信息才能被发布、接收。</p>
<p>此功能仅在ABR上配置。</p>
<h4 id="操作步骤-27"><a href="#操作步骤-27" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>ospf</strong> [ <em>process-id</em> ]，进入OSPF进程视图。</p>
</li>
<li><p>执行命令<strong>area</strong> <em>area-id</em>，进入OSPF区域视图。</p>
</li>
<li><p>请根据需要，配置对ABR Type3 LSA进行过滤。</p>
</li>
</ol>
<ul>
<li>执行命令<strong>filter</strong> { <em>acl-number</em> | <strong>acl-name</strong> <em>acl-name</em> | <strong>ip-prefix</strong> <em>ip-prefix-name</em> | <strong>route-policy</strong> <em>route-policy-name</em> } <strong>export</strong>，配置对本区域出方向的Summary LSA进行过滤。</li>
<li>执行命令<strong>filter</strong> { <em>acl-number</em> | <strong>acl-name</strong> <em>acl-name</em> | <strong>ip-prefix</strong> <em>ip-prefix-name</em> | <strong>route-policy</strong> <em>route-policy-name</em> } <strong>import</strong>，配置对进入本区域的Summary LSA进行过滤。</li>
</ul>
<h3 id="6-14-8-（可选）使能Mesh-Group特性"><a href="#6-14-8-（可选）使能Mesh-Group特性" class="headerlink" title="6.14.8  （可选）使能Mesh-Group特性"></a>6.14.8  （可选）使能Mesh-Group特性</h3><h4 id="背景信息-16"><a href="#背景信息-16" class="headerlink" title="背景信息"></a>背景信息</h4><p>当交换机和邻居存在并行链路时，使能Mesh-Group特性，可以减轻链路的压力。</p>
<p>Mesh-Group时以邻居的Router-id唯一标识一个Group。是几条并行的LSA，合并为一个组，只泛洪一次。只有同时满足以下三个条件的接口才能属于同一个Mesh-Group：</p>
<ul>
<li>属于相同区域和OSPF进程</li>
<li>接口状态大于Exchange</li>
<li>只连着同一个邻居</li>
</ul>
<p>请在运行OSPF协议的交换机上进行以下配置。</p>
<h4 id="操作步骤-28"><a href="#操作步骤-28" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>ospf</strong> [ <em>process-id</em> ]，进入OSPF进程视图。</p>
</li>
<li><p>执行命令<strong>mesh-group enable</strong>，使能Mesh-Group特性。</p>
</li>
</ol>
<p>   缺省情况下，不使能Mesh-Group特性。</p>
<h3 id="6-14-9-配置LSDB中External-LSA的最大数量"><a href="#6-14-9-配置LSDB中External-LSA的最大数量" class="headerlink" title="6.14.9  配置LSDB中External LSA的最大数量"></a>6.14.9  配置LSDB中External LSA的最大数量</h3><h4 id="操作步骤-29"><a href="#操作步骤-29" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li>执行命令<strong>system-view</strong>，进入系统视图。</li>
<li>执行命令<strong>ospf</strong> [ <em>process-id</em> ]，进入OSPF进程视图。</li>
<li>执行命令<strong>lsdb-overflow-limit</strong> <em>number</em>，配置LSDB中External LSA的最大数量。</li>
</ol>
<h3 id="6-14-10-检查配置结果"><a href="#6-14-10-检查配置结果" class="headerlink" title="6.14.10  检查配置结果"></a>6.14.10  检查配置结果</h3><h4 id="前提条件-4"><a href="#前提条件-4" class="headerlink" title="前提条件"></a>前提条件</h4><p>已经完成控制OSPF路由信息的所有配置。</p>
<h4 id="操作步骤-30"><a href="#操作步骤-30" class="headerlink" title="操作步骤"></a>操作步骤</h4><ul>
<li>使用以下命令查看OSPF路由表信息：</li>
</ul>
<ul>
<li><strong>display ospf</strong> [ <em>process-id</em> ] <strong>routing</strong> [ <em>ip-address</em> [ <em>mask</em> | <em>mask-length</em> ] ] [ <strong>interface</strong> <em>interface-type</em> <em>interface-number</em> ] [ <strong>nexthop</strong> <em>nexthop-address</em> ]</li>
<li><strong>display ospf</strong> [ <em>process-id</em> ] <strong>routing</strong> <strong>router-id</strong> [ <em>router-id</em> ]</li>
</ul>
<ul>
<li><p>使用<strong>display ospf</strong> [ <em>process-id</em> ] <strong>interface</strong> [ <strong>all</strong> | <em>interface-type</em> <em>interface-number</em> ] [ <strong>verbose</strong> ]命令查看OSPF的接口信息。</p>
</li>
<li><p>使用<strong>display ospf</strong> [ <em>process-id</em> ] <strong>asbr-summary</strong> [ <em>ip-address</em> <em>mask</em> ]命令查看OSPF ASBR聚合信息。</p>
</li>
</ul>
<h2 id="6-15-配置OSPF与BFD联动"><a href="#6-15-配置OSPF与BFD联动" class="headerlink" title="6.15  配置OSPF与BFD联动"></a>6.15  配置OSPF与BFD联动</h2><p>如果需要提高链路状态变化时OSPF的收敛速度，可以在运行OSPF的链路上配置BFD特性。当BFD检测到链路故障时，能够将故障通告给路由协议，触发路由协议的快速收敛；当邻居关系为Down时，则动态删除BFD会话。</p>
<h3 id="应用环境-5"><a href="#应用环境-5" class="headerlink" title="应用环境"></a>应用环境</h3><p>OSPF通过周期性的向邻居发送Hello报文来实现邻居检测，检测到故障所需时间比较长，超过1秒钟。随着科技的发展，语音、视频及其它点播业务应用广泛，而这些业务对于丢包和延时非常敏感，当数据达到吉比特速率级时，较长的检测时间会导致大量数据丢失，无法满足电信级网络高可靠性的需求。</p>
<p>为了解决上述问题，配置指定进程或指定接口的BDF for OSPF特性，可以快速检测链路的状态，故障检测时间可以达到毫秒级，提高链路状态变化时OSPF的收敛速度。</p>
<p> 说明：</p>
<p>仅S6720EI、S6720S-EI、S5720HI、S5720EI、S6720SI、S6720S-SI、S5720SI和S5720S-SI支持OSPF与BFD联动。</p>
<h3 id="前置任务-7"><a href="#前置任务-7" class="headerlink" title="前置任务"></a>前置任务</h3><p>在配置OSPF与BFD联动前，需完成以下任务：</p>
<ul>
<li>配置接口的网络层地址，使各相邻节点网络层可达。</li>
<li><a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_cfg_ospf_0004">6.8 配置OSPF的基本功能</a>。</li>
</ul>
<h3 id="配置流程-5"><a href="#配置流程-5" class="headerlink" title="配置流程"></a>配置流程</h3><p><strong>图6-68</strong>  OSPF与BFD联动配置流程图<br><img src="http://support.huawei.com/enterprise/product/images/905536776fa642cd98f85bf457c55d31" alt="img" loading="lazy"></p>
<h3 id="6-15-1-配置全局BFD功能"><a href="#6-15-1-配置全局BFD功能" class="headerlink" title="6.15.1  配置全局BFD功能"></a>6.15.1  配置全局BFD功能</h3><h4 id="操作步骤-31"><a href="#操作步骤-31" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li>执行命令<strong>system-view</strong>，进入系统视图。</li>
<li>执行命令<strong>bfd</strong>，配置全局BFD功能并进入到全局BFD视图。</li>
</ol>
<h3 id="6-15-2-配置OSPF的BFD特性"><a href="#6-15-2-配置OSPF的BFD特性" class="headerlink" title="6.15.2  配置OSPF的BFD特性"></a>6.15.2  配置OSPF的BFD特性</h3><h4 id="操作步骤-32"><a href="#操作步骤-32" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>ospf</strong> [ <em>process-id</em> ]，进入OSPF视图。</p>
</li>
<li><p>执行命令<strong>bfd all-interfaces enable</strong>，打开OSPF BFD特性的开关，建立BFD会话。</p>
</li>
</ol>
<p>   当配置了全局BFD特性，且邻居状态达到Full时，OSPF为该进程下所有具有邻接关系的邻居建立BFD会话。</p>
<ol start="4">
<li>（可选）如果需要配置BFD参数请执行<strong>bfd all-interfaces</strong> { <strong>min-rx-interval</strong> <em>receive-interval</em> | <strong>min-tx-interval</strong> <em>transmit-interval</em> | <strong>detect-multiplier</strong> <em>multiplier-value</em> } *命令，指定需要建立BFD会话的各个参数值。</li>
</ol>
<ul>
<li><strong>min-rx-interval</strong> <em>receive-interval</em>表示期望从对端接收BFD报文的最小接收间隔。</li>
<li><strong>min-tx-interval</strong> <em>transmit-interval</em>表示向对端发送BFD报文的最小发送间隔。</li>
<li><strong>detect-multiplier</strong> <em>multiplier-value</em>表示本地检测倍数。</li>
</ul>
<pre><code>说明：</code></pre>
<p>   BFD报文实际收发时间间隔和检测倍数一般推荐使用缺省值。</p>
<p>   具体参数如何配置取决于网路状况以及对网络可靠性的要求，对于网络可靠性要求较高链路，可以配置减小BFD报文实际发送时间间隔；对于网络可靠性要求较低的链路，可以配置增大BFD报文实际发送时间间隔。</p>
<pre><code>说明：</code></pre>
<ul>
<li><p>本地BFD报文实际发送时间间隔＝MAX { 本地配置的发送时间间隔<em>transmit-interval</em>，对端配置的接收时间间隔<em>receive-interval</em> }</p>
</li>
<li><p>本地BFD报文实际接收时间间隔＝MAX { 对端配置的发送时间间隔<em>transmit-interval</em>，本地配置的接收时间间隔<em>receive-interval</em> }</p>
</li>
<li><p>本地BFD报文实际检测时间＝本地实际接收时间间隔×对端配置的BFD检测倍数<em>multiplier-value</em></p>
<p>例如，</p>
</li>
<li><p>本地配置的发送时间间隔为200ms，本地配置的接收时间间隔为300ms，本地检测倍数为4。</p>
</li>
<li><p>对端配置的发送时间间隔为100ms，对端配置的接收时间间隔为600ms，对端检测倍数为5。</p>
<p>则：</p>
</li>
<li><p>本地实际的发送时间间隔为MAX { 200ms，600ms }＝600ms，本地实际接收时间间隔为MAX { 100ms，300ms }＝300ms，本地实际检测时间间隔为300ms×5＝1500ms。</p>
</li>
<li><p>对端实际的发送时间间隔为MAX { 100ms，300ms }＝300ms，对端实际接收时间间隔为MAX { 200ms，600ms }＝600ms，对端实际检测时间间隔为600ms×4＝2400ms。</p>
</li>
</ul>
<h3 id="6-15-3-（可选）阻止接口动态创建BFD会话"><a href="#6-15-3-（可选）阻止接口动态创建BFD会话" class="headerlink" title="6.15.3  （可选）阻止接口动态创建BFD会话"></a>6.15.3  （可选）阻止接口动态创建BFD会话</h3><h4 id="背景信息-17"><a href="#背景信息-17" class="headerlink" title="背景信息"></a>背景信息</h4><p>如果在OSPF进程中执行<strong>bfd all-interfaces enable</strong>命令后，该进程下所有使能OSPF且邻居状态为Full的邻居都将创建BFD会话。此时，如果不希望某个接口创建BFD会话可以阻止接口动态创建BFD会话。</p>
<h4 id="操作步骤-33"><a href="#操作步骤-33" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>interface</strong> <em>interface-type</em> <em>interface-number</em>，进入运行OSPF与BFD联动的接口视图。</p>
</li>
<li><p>（可选）对于以太网接口，执行命令<strong>undo portswitch</strong>，配置接口切换到三层模式。</p>
</li>
</ol>
<p>   缺省情况下，以太网接口处于二层模式。</p>
<pre><code>说明：</code></pre>
<p>   仅S5720HI、S5720EI、S6720EI和S6720S-EI支持二层模式与三层模式切换。</p>
<ol start="4">
<li>执行命令<strong>ospf bfd block</strong>，阻止接口动态创建BFD会话。</li>
</ol>
<h3 id="6-15-4-（可选）配置指定接口的BFD特性"><a href="#6-15-4-（可选）配置指定接口的BFD特性" class="headerlink" title="6.15.4  （可选）配置指定接口的BFD特性"></a>6.15.4  （可选）配置指定接口的BFD特性</h3><h4 id="背景信息-18"><a href="#背景信息-18" class="headerlink" title="背景信息"></a>背景信息</h4><p>如果希望单独只对某些指定的接口配置BFD for OSPF特性，当这些接口的链路发生故障时，交换机可以快速的感知，并及时通知OSPF重新计算路由，从而提高OSPF的收敛速度。当邻居关系为Down时，则动态删除BFD会话。</p>
<p>OSPF创建BFD会话需要先使能全局BFD功能。</p>
<p>请在指定接口配置BFD会话的交换机上进行以下配置。</p>
<h4 id="操作步骤-34"><a href="#操作步骤-34" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>interface</strong> <em>interface-type</em> <em>interface-number</em>，进入运行OSPF与BFD联动的接口视图。</p>
</li>
<li><p>（可选）对于以太网接口，执行命令<strong>undo portswitch</strong>，配置接口切换到三层模式。</p>
</li>
</ol>
<p>   缺省情况下，以太网接口处于二层模式。</p>
<pre><code>说明：</code></pre>
<p>   仅S5720HI、S5720EI、S6720EI和S6720S-EI支持二层模式与三层模式切换。</p>
<ol start="4">
<li>执行命令<strong>ospf bfd enable</strong>，打开接口BFD特性的开关，建立BFD会话。</li>
</ol>
<p>   当配置了全局BFD特性，且邻居状态为Full时，OSPF为指定的接口建立了使用缺省参数值的BFD会话。</p>
<pre><code>说明：</code></pre>
<p>   接口上配置BFD for OSPF特性的优先级高于进程中配置BFD for OSPF特性的优先级。</p>
<p>   如果需要单独配置BFD参数请执行命令<strong>ospf bfd</strong> { <strong>min-rx-interval</strong> <em>receive-interval</em> | <strong>min-tx-interval</strong> <em>transmit-</em> <em>interval</em> | <strong>detect-multiplier</strong> <em>multiplier-value</em> } *，指定BFD会话的参数值。</p>
<p>   BFD报文实际收发时间间隔和检测倍数一般推荐使用缺省值，即不执行该命令。</p>
<p>   具体参数如何配置取决于网络状况以及对网络可靠性的要求，对于网络可靠性要求较高链路，可以配置减小BFD报文实际发送时间间隔；对于网络可靠性要求较低的链路，可以配置增大BFD报文实际发送时间间隔。</p>
<pre><code>说明：</code></pre>
<ul>
<li><p>本地BFD报文实际发送时间间隔＝MAX { 本地配置的发送时间间隔<em>transmit-interval</em>，对端配置的接收时间间隔<em>receive-interval</em> }</p>
</li>
<li><p>本地BFD报文实际接收时间间隔＝MAX { 对端配置的发送时间间隔<em>transmit-interval</em>，本地配置的接收时间间隔<em>receive-interval</em> }</p>
</li>
<li><p>本地BFD报文实际检测时间＝本地实际接收时间间隔×对端配置的BFD检测倍数<em>multiplier-value</em></p>
<p>例如，</p>
</li>
<li><p>本地配置的发送时间间隔为200ms，本地配置的接收时间间隔为300ms，本地检测倍数为4。</p>
</li>
<li><p>对端配置的发送时间间隔为100ms，对端配置的接收时间间隔为600ms，对端检测倍数为5。</p>
<p>则：</p>
</li>
<li><p>本地实际的发送时间间隔为MAX { 200ms，600ms }＝600ms，本地实际接收时间间隔为MAX { 100ms，300ms }＝300ms，本地实际检测时间间隔为300ms×5＝1500ms。</p>
</li>
<li><p>对端实际的发送时间间隔为MAX { 100ms，300ms }＝300ms，对端实际接收时间间隔为MAX { 200ms，600ms }＝600ms，对端实际检测时间间隔为600ms×4＝2400ms。</p>
</li>
</ul>
<h3 id="6-15-5-检查配置结果"><a href="#6-15-5-检查配置结果" class="headerlink" title="6.15.5  检查配置结果"></a>6.15.5  检查配置结果</h3><h4 id="前提条件-5"><a href="#前提条件-5" class="headerlink" title="前提条件"></a>前提条件</h4><p>已经完成OSPF与BFD联动的所有配置。</p>
<h4 id="操作步骤-35"><a href="#操作步骤-35" class="headerlink" title="操作步骤"></a>操作步骤</h4><ul>
<li>选择如下命令查看OSPF与BFD联动的会话信息。</li>
</ul>
<ul>
<li><strong>display ospf</strong> [<em>process-id</em> ] <strong>bfd</strong> <strong>session</strong> <em>interface-type</em> <em>interface-number</em> [ <em>router-id</em> ]</li>
<li><strong>display ospf</strong> [<em>process-id</em> ] <strong>bfd</strong> <strong>session</strong> { <em>router-id</em> | <strong>all</strong> }</li>
</ul>
<h2 id="6-16-配置OSPF-IP-FRR"><a href="#6-16-配置OSPF-IP-FRR" class="headerlink" title="6.16  配置OSPF IP FRR"></a>6.16  配置OSPF IP FRR</h2><p>配置OSPF IP FRR可以将故障链路的流量快速切换到备份链路上，保证流量不中断，从而达到保护流量的目的，因此极大的提高了OSPF网络的可靠性。</p>
<p> 说明：</p>
<p>仅S5720EI、S5720HI、S6720S-EI和S6720EI支持OSPF IP FRR。</p>
<h3 id="6-16-1-使能OSPF-IP-FRR"><a href="#6-16-1-使能OSPF-IP-FRR" class="headerlink" title="6.16.1  使能OSPF IP FRR"></a>6.16.1  使能OSPF IP FRR</h3><p>使能OSPF IP FRR生成无环的备份链路，出现故障时，OSPF可以快速将流量切换到备份路由上。</p>
<h4 id="操作步骤-36"><a href="#操作步骤-36" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>ospf</strong> [ <em>process-id</em> | <strong>router-id</strong> <em>router-id</em> | <strong>vpn-instance</strong> <em>vpn-instance-name</em> ] *，启动OSPF进程，进入OSPF视图。</p>
</li>
<li><p>执行命令<strong>frr</strong>，进入OSPF IP FRR视图。</p>
</li>
<li><p>执行命令<strong>loop-free-alternate</strong>，使能OSPF IP FRR特性，生成无环的备份链路。</p>
</li>
</ol>
<p>   缺省情况下，不使能OSPF IP FRR功能。需满足OSPF IP FRR流量保护不等式，OSPF才能生成无环的备份链路。</p>
<pre><code>说明：</code></pre>
<p>   下面的描述有如下约定：Distance_opt(X, Y)指节点X到Y之间的最短路径，S是转发流量的源节点，E是发生故障的节点，N是备份链路的节点，D是流量转发的目的节点。</p>
<ul>
<li><p>当需要保护的对象是经过特定链路的流量时，流量保护类型为链路保护。链路开销必须满足不等式Distance_opt(N, D) &lt; Distance_opt(N, S) + Distance_opt(S, D)。</p>
</li>
<li><p>当需要保护的对象是经过特定节点和链路的流量时，流量保护类型为节点链路双保护。</p>
<p>节点链路双保护需同时满足如下两个条件：</p>
<ul>
<li>链路开销必须满足Distance_opt(N, D) &lt; Distance_opt(N, S) + Distance_opt(S, D)。</li>
<li>设备的接口开销必须满足Distance_opt(N, D) &lt; Distance_opt(N, E) + Distance_opt(E, D)。</li>
</ul>
</li>
</ul>
<ol start="5">
<li>（可选）执行命令<strong>frr-priority static low</strong>，设置利用LFA（Loop-Free Alternates）算法计算备份下一跳和备份出接口。</li>
</ol>
<p>   OSPF有两种方式可以获得备份路径：</p>
<ul>
<li><p>静态备份路径：由<strong>ip frr（系统视图）</strong>命令或<strong>ip frr（VPN实例视图）</strong>命令使能IP FRR功能后，指定备份下一跳和备份出接口。</p>
</li>
<li><p>动态备份路径：由<strong>loop-free-alternate</strong>命令使能OSPF IP FRR功能后，利用LFA算法计算备份下一跳和备份出接口。</p>
<p>缺省情况下，静态备份路径的优先级高于动态备份路径的优先级，即静态备份路径会被优选。但是，由于静态备份路径的灵活性较差，当备份路径出现故障时，静态备份路径不会自动更新，而动态备份路径可以自动更新。因此，为了保证备份路径的及时更新，可以配置<strong>frr-priority static low</strong>命令指定利用LFA算法计算备份下一跳和备份出接口，使动态备份路径的优先级高于静态备份路径的优先级。</p>
</li>
</ul>
<ol start="6">
<li>（可选）执行命令<strong>frr-policy route</strong> <strong>route-policy</strong> <em>route-policy-name</em>，配置OSPF IP FRR过滤策略。</li>
</ol>
<p>   配置了OSPF IP FRR过滤策略后，只有满足过滤条件的OSPF路由的备份路由才能下发转发表。如果希望保护经过某条特定OSPF路由的流量时，可以通过设置过滤策略，使该OSPF路由满足过滤条件，则该OSPF路由的备份路由加入转发表中。当这条路由出现故障时，OSPF可以快速将流量切换到备份路由上。</p>
<h3 id="6-16-2-（可选）配置OSPF-IP-FRR与BFD绑定"><a href="#6-16-2-（可选）配置OSPF-IP-FRR与BFD绑定" class="headerlink" title="6.16.2  （可选）配置OSPF IP FRR与BFD绑定"></a>6.16.2  （可选）配置OSPF IP FRR与BFD绑定</h3><p>配置OSPF IP FRR与BFD会话绑定可以达到快速感知故障的目的，确保故障后流量切换的及时性。</p>
<h4 id="背景信息-19"><a href="#背景信息-19" class="headerlink" title="背景信息"></a>背景信息</h4><p>配置OSPF IP FRR特性时，需要底层能够快速响应链路变化，当主链路故障时迅速将流量切换到备份链路。将OSPF IP FRR与BFD会话绑定可以达到快速感知故障的目的，确保故障后流量切换的及时性。</p>
<p>OSPF IP FRR与BFD绑定可以在OSPF指定进程或指定接口上配置。在指定接口配置的BFD特性优先级高于指定进程配置的BFD特性优先级。如果打开了接口的BFD开关，则按照接口上BFD参数建立BFD会话。</p>
<h4 id="操作步骤-37"><a href="#操作步骤-37" class="headerlink" title="操作步骤"></a>操作步骤</h4><ul>
<li>在OSPF指定进程上配置OSPF IP FRR与BFD绑定。<ol>
<li>执行命令<strong>system-view</strong>，进入系统视图。</li>
<li>执行命令<strong>bfd</strong>，配置全局BFD功能。</li>
<li>执行命令<strong>quit</strong>，返回系统视图。</li>
<li>执行命令<strong>ospf</strong> [ <em>process-id</em> | <strong>router-id</strong> <em>router-id</em> | <strong>vpn-instance</strong> <em>vpn-instance-name</em> ] *，使能OSPF进程，进入OSPF视图。</li>
<li>执行命令<strong>bfd all-interfaces</strong> <strong>enable</strong>，在OSPF进程下使能BFD特性。</li>
<li>执行命令<strong>bfd all-interfaces</strong> <strong>frr-binding</strong>，配置OSPF进程下的IP FRR和BFD绑定。</li>
</ol>
</li>
<li>在OSPF指定接口上配置OSPF IP FRR与BFD绑定。<ol>
<li>执行命令<strong>system-view</strong>，进入系统视图。</li>
<li>执行命令<strong>bfd</strong>，配置全局BFD功能。</li>
<li>执行命令<strong>quit</strong>，返回系统视图。</li>
<li>执行命令<strong>interface</strong> <em>interface-type</em> <em>interface-number</em>，进入接口视图。</li>
<li>执行命令<strong>ospf bfd</strong> <strong>enable</strong>，在使能OSPF的特定接口下配置BFD特性。</li>
<li>执行命令<strong>ospf bfd</strong> <strong>frr-binding</strong>，配置接口下的IP FRR和BFD绑定。</li>
</ol>
</li>
</ul>
<h3 id="6-16-3-（可选）禁止指定接口的OSPF-IP-FRR能力"><a href="#6-16-3-（可选）禁止指定接口的OSPF-IP-FRR能力" class="headerlink" title="6.16.3  （可选）禁止指定接口的OSPF IP FRR能力"></a>6.16.3  （可选）禁止指定接口的OSPF IP FRR能力</h3><p>对于承载重要业务的节点设备，在指定接口上禁止OSPF IP FRR功能，从而使此接口相连的对端设备不成为备份链路上的节点设备，避免使能OSPF IP FRR功能后对节点设备上运行的重要业务造成影响。</p>
<h4 id="操作步骤-38"><a href="#操作步骤-38" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li>执行命令<strong>system-view</strong>，进入系统视图。</li>
<li>执行命令<strong>interface</strong> <em>interface-type interface-number</em>，进入已使能OSPF IP FRR功能的接口视图。</li>
<li>执行命令<strong>ospf frr block</strong>，在指定接口上禁止OSPF IP FRR功能。</li>
</ol>
<h3 id="6-16-4-检查配置结果"><a href="#6-16-4-检查配置结果" class="headerlink" title="6.16.4  检查配置结果"></a>6.16.4  检查配置结果</h3><p>成功配置OSPF IP FRR功能后，您可以查看到OSPF的链路信息。</p>
<h4 id="前提条件-6"><a href="#前提条件-6" class="headerlink" title="前提条件"></a>前提条件</h4><p>已经完成OSPF IP FRR的所有配置。</p>
<h4 id="操作步骤-39"><a href="#操作步骤-39" class="headerlink" title="操作步骤"></a>操作步骤</h4><ul>
<li>配置OSPF IP FRR功能后，执行<strong>display ospf</strong> [ <em>process-id</em> ] <strong>routing</strong>命令查看路由的主用链路和备份链路信息。</li>
</ul>
<p>  显示到指定OSPF设备的路由信息。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;HUAWEI&gt; display ospf routing 192.168.4.0</span><br><span class="line"></span><br><span class="line">         OSPF Process 1 with Router ID 192.168.150.11</span><br><span class="line"></span><br><span class="line"> Destination : 192.168.4.0&#x2F;24     </span><br><span class="line"> AdverRouter : 10.4.4.4                 Area      : 0.0.0.0  </span><br><span class="line"> Cost        : 2                        Type      : Transit </span><br><span class="line"> NextHop     : 192.168.2.2              Interface : Vlanif20  </span><br><span class="line"> Priority    : Low                      Age       : 00h00m10s  </span><br><span class="line"> Backup Nexthop : 192.168.1.2           Backup Interface: Vlanif10</span><br><span class="line"> Backup Type : LFA LINK</span><br></pre></td></tr></table></figure>

<p>  从显示信息可以看出，交换机上已经生成了备份的路由。路由信息包含备份下一跳信息：<strong>Backup NextHop</strong>表示备份下一跳地址，<strong>Backup Interface</strong>表示备份下一跳的出接口，<strong>Backup Type</strong>表示备份下一跳类型。</p>
<h2 id="6-17-配置OSPF网络的快速收敛"><a href="#6-17-配置OSPF网络的快速收敛" class="headerlink" title="6.17  配置OSPF网络的快速收敛"></a>6.17  配置OSPF网络的快速收敛</h2><p>通过调整定时器，可以达到网络快速收敛的目的。</p>
<h3 id="前置任务-8"><a href="#前置任务-8" class="headerlink" title="前置任务"></a>前置任务</h3><p>在配置OSPF网络的快速收敛之前，需完成以下任务：</p>
<ul>
<li>配置链路层协议。</li>
<li>配置接口的网络层地址，使各相邻节点网络层可达。</li>
<li><a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_cfg_ospf_0004">6.8 配置OSPF的基本功能</a>。</li>
</ul>
<h3 id="配置流程-6"><a href="#配置流程-6" class="headerlink" title="配置流程"></a>配置流程</h3><p>以下配置任务（不含检查配置结果），根据应用环境选择其中一项或几项进行配置。</p>
<h3 id="6-17-1-配置OSPF路由的收敛优先级"><a href="#6-17-1-配置OSPF路由的收敛优先级" class="headerlink" title="6.17.1  配置OSPF路由的收敛优先级"></a>6.17.1  配置OSPF路由的收敛优先级</h3><h4 id="背景信息-20"><a href="#背景信息-20" class="headerlink" title="背景信息"></a>背景信息</h4><p>随着网络业务的融合，数据、语音、视频等不同类型业务会在同样的网络基础设施上进行运行，但是不同业务对网络的要求是不一样的。</p>
<p>通过配置OSPF路由的收敛优先级，允许用户配置特定路由的优先级，使这些路由能够比其他的路由优先收敛。</p>
<h4 id="操作步骤-40"><a href="#操作步骤-40" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>ospf</strong> [ <em>process-id</em> ]，进入OSPF进程视图。</p>
</li>
<li><p>执行命令<strong>prefix-priority</strong> { <strong>critical</strong> | <strong>high</strong> | <strong>medium</strong> } <strong>ip-prefix</strong> <em>ip-prefix-name</em>，配置OSPF路由的收敛优先级。</p>
</li>
</ol>
<p>   配置OSPF路由的收敛优先级后，OSPF路由可以按照优先级来计算和泛洪LSA、同步LSDB，从而提高路由收敛速度。当一个LSA满足多个策略优先级时，最高优先级生效。OSPF依次按区域内路由、区域间路由、自治系统外部路由顺序进行LSA计算，该命令可以计算OSPF的收敛优先级。收敛优先级的优先级顺序为：critical&gt;high&gt;medium&gt;low。为了加速处理高优先级的LSA，泛洪过程中，需要按照优先级将相应的LSA分别存放在对应的critical、high、medium和low的队列中。</p>
<pre><code>说明：</code></pre>
<p>   该命令仅在公网上配置时有效。</p>
<h3 id="6-17-2-配置接口发送Hello报文的时间间隔"><a href="#6-17-2-配置接口发送Hello报文的时间间隔" class="headerlink" title="6.17.2  配置接口发送Hello报文的时间间隔"></a>6.17.2  配置接口发送Hello报文的时间间隔</h3><h4 id="背景信息-21"><a href="#背景信息-21" class="headerlink" title="背景信息"></a>背景信息</h4><p>Hello报文是最常用的一种报文，其作用为建立和维护邻接关系，周期性的在使能了OSPF的接口上发送。OSPF邻居之间的Hello定时器的时间间隔要保持一致，否则不能协商为邻居。</p>
<h4 id="操作步骤-41"><a href="#操作步骤-41" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>interface</strong> <em>interface-type</em> <em>interface-number</em>，进入运行OSPF协议的接口视图。</p>
</li>
<li><p>（可选）对于以太网接口，执行命令<strong>undo portswitch</strong>，配置接口切换到三层模式。</p>
</li>
</ol>
<p>   缺省情况下，以太网接口处于二层模式。</p>
<pre><code>说明：</code></pre>
<p>   仅S5720HI、S5720EI、S6720EI和S6720S-EI支持二层模式与三层模式切换。</p>
<ol start="4">
<li>执行命令<strong>ospf timer hello</strong> <em>interval</em>，配置接口发送Hello报文的时间间隔。</li>
</ol>
<p>   缺省情况下，P2P、Broadcast类型接口发送Hello报文的时间间隔的值为10秒；P2MP、NBMA类型接口发送Hello报文的时间间隔的值为30秒；且同一接口上邻居失效时间是Hello间隔时间的4倍。</p>
<h3 id="6-17-3-配置相邻邻居失效的时间"><a href="#6-17-3-配置相邻邻居失效的时间" class="headerlink" title="6.17.3  配置相邻邻居失效的时间"></a>6.17.3  配置相邻邻居失效的时间</h3><h4 id="操作步骤-42"><a href="#操作步骤-42" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>interface</strong> <em>interface-type</em> <em>interface-number</em>，进入运行OSPF协议的接口视图。</p>
</li>
<li><p>（可选）对于以太网接口，执行命令<strong>undo portswitch</strong>，配置接口切换到三层模式。</p>
</li>
</ol>
<p>   缺省情况下，以太网接口处于二层模式。</p>
<pre><code>说明：</code></pre>
<p>   仅S5720HI、S5720EI、S6720EI和S6720S-EI支持二层模式与三层模式切换。</p>
<ol start="4">
<li>执行命令<strong>ospf timer dead</strong> <em>interval</em>，设置相邻邻居失效的时间。</li>
</ol>
<p>   缺省情况下，P2P、Broadcast类型接口的OSPF邻居失效时间为40秒，P2MP、NBMA类型接口的OSPF邻居失效时间为120秒；且同一接口上失效时间是Hello间隔时间的4倍。</p>
<pre><code>说明：</code></pre>
<p>   建议配置的失效时间大于20秒。如果失效的时间小于20秒，可能会造成邻居会话的中断。</p>
<p>   修改了网络类型后，Hello与Dead定时器都将恢复缺省值。</p>
<h3 id="6-17-4-配置Smart-discover"><a href="#6-17-4-配置Smart-discover" class="headerlink" title="6.17.4  配置Smart-discover"></a>6.17.4  配置Smart-discover</h3><h4 id="背景信息-22"><a href="#背景信息-22" class="headerlink" title="背景信息"></a>背景信息</h4><p>交换机的邻居状态或者多址网络（广播型或NBMA）上的DR、BDR发生变化时，需要等到Hello定时器到时才会向邻居发送Hello报文，影响了设备间建立邻居的速度。通过配置Smart-discover，网络中邻居状态，或者DR、BDR发生变化时，设备不必等到Hello定时器到就可以立刻主动的向邻居发送Hello报文。从而提高建立邻居的速度，达到网络快速收敛的目的。</p>
<h4 id="操作步骤-43"><a href="#操作步骤-43" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>interface</strong> <em>interface-type</em> <em>interface-number</em>，进入运行OSPF的接口视图。</p>
</li>
<li><p>（可选）对于以太网接口，执行命令<strong>undo portswitch</strong>，配置接口切换到三层模式。</p>
</li>
</ol>
<p>   缺省情况下，以太网接口处于二层模式。</p>
<pre><code>说明：</code></pre>
<p>   仅S5720HI、S5720EI、S6720EI和S6720S-EI支持二层模式与三层模式切换。</p>
<ol start="4">
<li>执行命令<strong>ospf smart-discover</strong>，配置接口的Smart-discover功能。</li>
</ol>
<h3 id="6-17-5-配置更新LSA的时间间隔"><a href="#6-17-5-配置更新LSA的时间间隔" class="headerlink" title="6.17.5  配置更新LSA的时间间隔"></a>6.17.5  配置更新LSA的时间间隔</h3><h4 id="背景信息-23"><a href="#背景信息-23" class="headerlink" title="背景信息"></a>背景信息</h4><p>OSPF协议规定LSA的更新时间间隔5秒，是为了防止网络连接或者路由频繁动荡引起的过多占用网络带宽和设备资源。</p>
<p>在网络相对稳定、对路由收敛时间要求较高的组网环境中，可以指定LSA的更新时间间隔为0来取消LSA的更新时间间隔，使得拓扑或者路由的变化可以立即通过LSA发布到网络中，从而加快网络中路由的收敛速度。</p>
<h4 id="操作步骤-44"><a href="#操作步骤-44" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>ospf</strong> [ <em>process-id</em> ]，进入OSPF进程视图。</p>
</li>
<li><p>执行命令<strong>lsa-originate-interval</strong> { <strong>0</strong> | { <strong>intelligent-timer</strong> <em>max-interval</em> <em>start-interval</em> <em>hold-interval</em> | <strong>other-type</strong> <em>interval</em> } * }，配置LSA的更新时间间隔。</p>
</li>
</ol>
<ul>
<li><p><strong>intelligent-timer</strong>表示通过智能定时器设置OSPF Router LSA和Network LSA的更新间隔时间。</p>
</li>
<li><p><em>max-interval</em>为更新OSPF LSA的最长间隔时间，单位是毫秒。</p>
</li>
<li><p><em>start-interval</em>为更新OSPF LSA的初始间隔时间，单位是毫秒。</p>
</li>
<li><p><em>hold-interval</em>为更新OSPF LSA的基数间隔时间，单位是毫秒。</p>
</li>
<li><p><strong>other-type</strong> <em>interval</em>表示设置除OSPF Router LSA和Network LSA外LSA的更新间隔时间。</p>
<p>缺省情况下，使能智能定时器intelligent-timer。使能智能定时器后，更新LSA的最长间隔时间的缺省值为5000毫秒、初始间隔时间的缺省值为500毫秒、基数间隔时间的缺省值为1000毫秒（以毫秒为单位的时间间隔），更新LSA的时间间隔方式如下：</p>
</li>
</ul>
<ol>
<li>初次更新LSA的间隔时间由<em>start-interval</em>参数指定。</li>
<li>第n（n≥2）次更新LSA的间隔时间为<em>hold-interval</em>×2(n-2)。</li>
<li>当<em>hold-interval</em>×2(n-2)达到指定的最长间隔时间<em>max-interval</em>时，OSPF连续三次更新LSA的时间间隔都是最长间隔时间，之后，再次返回步骤<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_vrp_ospf_cfg_005801">3.a</a>，按照初始间隔时间<em>start-interval</em>更新LSA。</li>
</ol>
<h3 id="6-17-6-配置接收LSA的时间间隔"><a href="#6-17-6-配置接收LSA的时间间隔" class="headerlink" title="6.17.6  配置接收LSA的时间间隔"></a>6.17.6  配置接收LSA的时间间隔</h3><h4 id="背景信息-24"><a href="#背景信息-24" class="headerlink" title="背景信息"></a>背景信息</h4><p>OSPF协议规定LSA的接收时间间隔1秒，是为了防止网络连接或者路由频繁动荡引起的过多占用网络带宽和设备资源。</p>
<p>在网络相对稳定、对路由收敛时间要求较高的组网环境中，可以指定LSA的接收时间间隔为0来取消LSA的接收时间间隔，使得拓扑或者路由的变化可以立即通过LSA发布到网络中，从而加快网络中路由的收敛速度。</p>
<h4 id="操作步骤-45"><a href="#操作步骤-45" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>ospf</strong> [ <em>process-id</em> ]，进入OSPF进程视图。</p>
</li>
<li><p>执行命令<strong>lsa-arrival-interval</strong> { <em>interval</em> | <strong>intelligent-timer</strong> <em>max-interval</em> <em>start-interval</em> <em>hold-interval</em> }，配置LSA接收的时间间隔。</p>
</li>
</ol>
<ul>
<li><p><em>interval</em>为LSA被接收的时间间隔，单位是毫秒。</p>
</li>
<li><p><strong>intelligent-timer</strong>表示通过智能定时器设置OSPF Router LSA和Network LSA的接收间隔时间。</p>
</li>
<li><p><em>max-interval</em>为接收OSPF LSA的最长间隔时间，单位是毫秒。</p>
</li>
<li><p><em>start-interval</em>为接收OSPF LSA的初始间隔时间，单位是毫秒。</p>
</li>
<li><p><em>hold-interval</em>为接收OSPF LSA的基数间隔时间，单位是毫秒。</p>
<p>在网络相对稳定、对路由收敛时间要求较高的组网环境中，可以指定LSA被接收的时间间隔为0，使得拓扑或者路由的变化能够立即被感知到。</p>
<p>缺省情况下，使能智能定时器intelligent-timer。使能智能定时器后，接收LSA的最长间隔时间的缺省值为1000毫秒、初始间隔时间的缺省值为500毫秒、基数间隔时间的缺省值为500毫秒（以毫秒为单位的时间间隔）。接收LSA的最长间隔时间方式如下：</p>
</li>
</ul>
<ol>
<li>初次接收LSA的间隔时间由<em>start-interval</em>参数指定。</li>
<li>第n（n≥2）次接收LSA的间隔时间为<em>hold-interval</em>×2(n-2)。</li>
<li>当<em>hold-interval</em>×2(n-2)达到指定的最长间隔时间<em>max-interval</em>时，OSPF连续三次接收LSA的时间间隔都是最长间隔时间，之后，再次返回步骤<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_vrp_ospf_cfg_005901">3.a</a>，按照初始间隔时间<em>start-interval</em>接收LSA。</li>
</ol>
<h3 id="6-17-7-配置SPF计算的时间间隔"><a href="#6-17-7-配置SPF计算的时间间隔" class="headerlink" title="6.17.7  配置SPF计算的时间间隔"></a>6.17.7  配置SPF计算的时间间隔</h3><h4 id="背景信息-25"><a href="#背景信息-25" class="headerlink" title="背景信息"></a>背景信息</h4><p>当OSPF的链路状态数据库（LSDB）发生改变时，需要重新计算最短路径。如果网络频繁变化，由于不断的计算最短路径，会占用大量系统资源，影响设备的效率。通过配置智能定时器intelligent-timer，设置合理的SPF计算的间隔时间，可以避免占用过多的交换机内存和带宽资源。</p>
<h4 id="操作步骤-46"><a href="#操作步骤-46" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>ospf</strong> [ <em>process-id</em> ]，进入OSPF进程视图。</p>
</li>
<li><p>执行命令<strong>spf-schedule-interval</strong> { <em>interval1</em> | <strong>intelligent-timer</strong> <em>max-interval</em> <em>start-interval</em> <em>hold-interval</em> | <strong>millisecond</strong> <em>interval2</em> }，设置SPF计算间隔。</p>
</li>
</ol>
<ul>
<li><p><em>interval1</em>为OSPF的SPF计算间隔时间，单位是秒。</p>
</li>
<li><p><strong>intelligent-timer</strong>表示通过智能定时器设置OSPF SPF计算的间隔时间。</p>
</li>
<li><p><em>max-interval</em>为OSPF SPF计算的最长间隔时间，单位是毫秒。</p>
</li>
<li><p><em>start-interval</em>为OSPF SPF计算的初始间隔时间，单位是毫秒。</p>
</li>
<li><p><em>hold-interval</em>为OSPF SPF计算的基数间隔时间，单位是毫秒。</p>
</li>
<li><p><strong>millisecond</strong> <em>interval2</em>表示OSPF的SPF计算间隔时间，单位是毫秒。</p>
<p>缺省情况下，使能智能定时器intelligent-timer，SPF计算的最长间隔时间为10000毫秒、初始间隔时间为500毫秒、基数间隔时间为1000毫秒（以毫秒为单位的时间间隔）。</p>
<p>使能智能定时器后：</p>
</li>
</ul>
<ol>
<li></li>
</ol>
<pre><code>  初次计算SPF的间隔时间由*start-interval*参数指定。</code></pre>
<ol start="2">
<li><p>第n（n≥2）次计算SPF的间隔时间为<em>hold-interval</em>×2(n-2)。</p>
</li>
<li><p>当<em>hold-interval</em>×2(n-2)达到指定的最长间隔时间<em>max-interval</em>时，OSPF连续三次计算SPF的时间间隔都是最长间隔时间，之后，再次返回步骤<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_vrp_ospf_cfg_006001">3.a</a>，按照初始间隔时间<em>start-interval</em>计算SPF。</p>
</li>
</ol>
<h3 id="6-17-8-检查配置结果"><a href="#6-17-8-检查配置结果" class="headerlink" title="6.17.8  检查配置结果"></a>6.17.8  检查配置结果</h3><h4 id="前提条件-7"><a href="#前提条件-7" class="headerlink" title="前提条件"></a>前提条件</h4><p>已经完成调整优化OSPF网络的所有配置。</p>
<h4 id="操作步骤-47"><a href="#操作步骤-47" class="headerlink" title="操作步骤"></a>操作步骤</h4><ul>
<li>使用<strong>display ospf</strong> [ <em>process-id</em> ] <strong>brief</strong>命令查看OSPF的概要信息。</li>
</ul>
<h2 id="6-18-配置OSPF-GR"><a href="#6-18-配置OSPF-GR" class="headerlink" title="6.18  配置OSPF GR"></a>6.18  配置OSPF GR</h2><p>配置OSPF GR可以避免流量中断和主备板切换带来的路由震荡。</p>
<h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><p>对于OSPF协议，为了避免流量中断和主备板切换带来的路由震荡，可以使能OSPF协议的GR特性。</p>
<p>OSPF通过GR重启后，Restarter交换机和Helper交换机之间重新建立邻居关系，交换路由信息并同步数据库，更新路由表和转发表，从而实现OSPF快速收敛，保持网络拓扑稳定。</p>
<p> 说明：</p>
<p>在实际应用中，为了实现业务转发不受主板故障的影响，通常在双主板的硬件环境下配置OSPF GR才有意义。</p>
<h3 id="前置任务-9"><a href="#前置任务-9" class="headerlink" title="前置任务"></a>前置任务</h3><p>在配置OSPF GR特性之前，需完成以下任务：</p>
<ul>
<li>配置接口的网络层地址，使相邻节点之间网络层可达。</li>
<li><a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_cfg_ospf_0004">配置OSPF的基本功能</a>。</li>
</ul>
<h3 id="6-18-1-使能OSPF的opauqe-LSA特性"><a href="#6-18-1-使能OSPF的opauqe-LSA特性" class="headerlink" title="6.18.1  使能OSPF的opauqe-LSA特性"></a>6.18.1  使能OSPF的opauqe-LSA特性</h3><h4 id="操作步骤-48"><a href="#操作步骤-48" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>ospf</strong> [ <em>process-id</em> ]，进入OSPF视图。</p>
</li>
<li><p>执行命令<strong>opaque-capability enable</strong>，使能opaque-LSA特性。</p>
</li>
</ol>
<p>   因为OSPF中通过Type-9类LSA对OSPF GR支持，所以需要首先使能OSPF的opauqe-LSA特性。</p>
<ol start="4">
<li>执行命令<strong>graceful-restart</strong>，使能OSPF GR特性。</li>
</ol>
<h3 id="6-18-2-（可选）配置Restarter端GR的会话参数"><a href="#6-18-2-（可选）配置Restarter端GR的会话参数" class="headerlink" title="6.18.2  （可选）配置Restarter端GR的会话参数"></a>6.18.2  （可选）配置Restarter端GR的会话参数</h3><h4 id="操作步骤-49"><a href="#操作步骤-49" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>ospf</strong> [ <em>process-id</em> ]，进入OSPF视图。</p>
</li>
<li><p>执行命令<strong>graceful-restart</strong> [ <strong>period</strong> <em>period</em> | <strong>planned-only</strong> | <strong>partial</strong> ] *，配置Restarter端GR的会话参数。</p>
</li>
</ol>
<ul>
<li><strong>period</strong>用来配置Restarter端GR的周期。缺省情况下，重启的时间为120秒。</li>
<li><strong>planned-only</strong>用来配置Restarter只支持Planned GR。缺省情况下，Restarter支持Planned GR和Unplanned GR。</li>
<li><strong>partial</strong>用来配置Restarter支持Partial GR。缺省情况下，Restarter支持Totally GR。</li>
</ul>
<h3 id="6-18-3-（可选）配置Helper端GR的会话参数"><a href="#6-18-3-（可选）配置Helper端GR的会话参数" class="headerlink" title="6.18.3  （可选）配置Helper端GR的会话参数"></a>6.18.3  （可选）配置Helper端GR的会话参数</h3><h4 id="操作步骤-50"><a href="#操作步骤-50" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>ospf</strong> [<em>process-id</em> ]，进入OSPF视图。</p>
</li>
<li><p>执行命令<strong>graceful-restart helper-role</strong> { [ { <strong>ip-prefix</strong> <em>ip-prefix-name</em> | <strong>acl-number</strong> <em>acl-number</em> | <strong>acl-name</strong> <em>acl-name</em> } | <strong>ignore-external-lsa</strong> | <strong>planned-only</strong> ] * | <strong>never</strong> }，配置Helper端GR的会话参数。</p>
</li>
</ol>
<ul>
<li>acl和ip-prefix参数用来配置过滤策略，只有通过过滤器策略后才能进入Helper模式。</li>
<li><strong>ignore-external-lsa</strong>用来配置Helper不对自治系统外部的LSA（AS-external LSA）进行检查。缺省情况下，执行外部LSA检查。</li>
<li><strong>planned-only</strong>用来配置Helper只支持Planned GR。缺省情况下，Helper支持Planned GR和Unplanned GR。</li>
<li><strong>never</strong>用来配置交换机不支持Helper模式。</li>
</ul>
<h3 id="6-18-4-检查配置结果"><a href="#6-18-4-检查配置结果" class="headerlink" title="6.18.4  检查配置结果"></a>6.18.4  检查配置结果</h3><h4 id="前提条件-8"><a href="#前提条件-8" class="headerlink" title="前提条件"></a>前提条件</h4><p>已经完成OSPF GR的所有配置。</p>
<h4 id="操作步骤-51"><a href="#操作步骤-51" class="headerlink" title="操作步骤"></a>操作步骤</h4><ul>
<li>使用<strong>display ospf</strong> [ <em>process-id</em> ] <strong>graceful-restart</strong> [ <strong>verbose</strong> ]命令查看OSPF GR信息。</li>
</ul>
<h2 id="6-19-提高OSPF网络的稳定性"><a href="#6-19-提高OSPF网络的稳定性" class="headerlink" title="6.19  提高OSPF网络的稳定性"></a>6.19  提高OSPF网络的稳定性</h2><p>稳定的OSPF网络意味路由振荡较少、设备性能正常，表现出的网络性能较好。</p>
<h3 id="应用环境-6"><a href="#应用环境-6" class="headerlink" title="应用环境"></a>应用环境</h3><p>通过设置时间间隔参数，可以减少网络中不必要的报文数量，降低设备负荷，从而提升网络性能。</p>
<h3 id="前置任务-10"><a href="#前置任务-10" class="headerlink" title="前置任务"></a>前置任务</h3><p>在提高OSPF网络的稳定性之前，需完成以下任务：</p>
<p><a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_cfg_ospf_0004">6.8 配置OSPF的基本功能</a>。</p>
<h3 id="配置流程-7"><a href="#配置流程-7" class="headerlink" title="配置流程"></a>配置流程</h3><p>以下配置任务（不含检查配置结果），根据应用环境选择其中一项或几项进行配置。</p>
<h3 id="6-19-1-配置OSPF的协议优先级"><a href="#6-19-1-配置OSPF的协议优先级" class="headerlink" title="6.19.1  配置OSPF的协议优先级"></a>6.19.1  配置OSPF的协议优先级</h3><h4 id="背景信息-26"><a href="#背景信息-26" class="headerlink" title="背景信息"></a>背景信息</h4><p>由于交换机上可能同时运行多个动态路由协议，就存在各个路由协议之间路由信息共享和选择的问题。系统为每一种路由协议设置一个优先级。在不同协议发现同一条路由时，优先级高的路由将被优选。</p>
<h4 id="操作步骤-52"><a href="#操作步骤-52" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>ospf</strong> [ <em>process-id</em> ]，进入OSPF进程视图。</p>
</li>
<li><p>执行命令<strong>preference</strong> [ <strong>ase</strong> ] { <em>preference</em> | <strong>route-policy</strong> <em>route-policy-name</em> } *，配置OSPF协议的优先级。</p>
</li>
</ol>
<ul>
<li><p><strong>ase</strong>表示设置AS-External路由的优先级。</p>
</li>
<li><p><em>preference</em>表示OSPF协议路由的优先级。优先级的值越小，其实际的优先程度越高。</p>
</li>
<li><p><strong>route-policy</strong> <em>route-policy-name</em>表示对特定的路由通过路由策略设置优先级。</p>
<p>缺省情况下，OSPF路由的优先级为10。当指定ASE时，缺省优先级为150。</p>
</li>
</ul>
<h3 id="6-19-2-配置接口传送LSA的延迟时间"><a href="#6-19-2-配置接口传送LSA的延迟时间" class="headerlink" title="6.19.2  配置接口传送LSA的延迟时间"></a>6.19.2  配置接口传送LSA的延迟时间</h3><h4 id="操作步骤-53"><a href="#操作步骤-53" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>interface</strong> <em>interface-type</em> <em>interface-number</em>，进入运行OSPF的接口视图。</p>
</li>
<li><p>（可选）对于以太网接口，执行命令<strong>undo portswitch</strong>，配置接口切换到三层模式。</p>
</li>
</ol>
<p>   缺省情况下，以太网接口处于二层模式。</p>
<pre><code>说明：</code></pre>
<p>   仅S5720HI、S5720EI、S6720EI和S6720S-EI支持二层模式与三层模式切换。</p>
<ol start="4">
<li>执行命令<strong>ospf trans-delay</strong> <em>interval</em>，配置接口传送LSA的延迟时间。</li>
</ol>
<p>   缺省情况下，传输延迟时间为1秒。</p>
<h3 id="6-19-3-配置邻接交换机重传LSA的间隔"><a href="#6-19-3-配置邻接交换机重传LSA的间隔" class="headerlink" title="6.19.3  配置邻接交换机重传LSA的间隔"></a>6.19.3  配置邻接交换机重传LSA的间隔</h3><h4 id="背景信息-27"><a href="#背景信息-27" class="headerlink" title="背景信息"></a>背景信息</h4><p>当一台交换机向它的邻居发送一条LSA后，需要等到对方的确认报文。若在重传间隔时间内没有收到对方的确认报文，就会向邻居重传这条LSA。</p>
<h4 id="操作步骤-54"><a href="#操作步骤-54" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>interface</strong> <em>interface-type</em> <em>interface-number</em>，进入运行OSPF的接口视图。</p>
</li>
<li><p>（可选）对于以太网接口，执行命令<strong>undo portswitch</strong>，配置接口切换到三层模式。</p>
</li>
</ol>
<p>   缺省情况下，以太网接口处于二层模式。</p>
<pre><code>说明：</code></pre>
<p>   仅S5720HI、S5720EI、S6720EI和S6720S-EI支持二层模式与三层模式切换。</p>
<ol start="4">
<li>执行命令<strong>ospf timer retransmit</strong> <em>interval</em>，设置邻接交换机重传LSA的间隔。</li>
</ol>
<p>   缺省情况下，重传间隔时间为5秒。</p>
<pre><code>说明：</code></pre>
<p>   相邻交换机重传LSA时间间隔的值不要设置得太小，否则将会引起不必要的重传。通常应该大于一个报文在两台交换机之间传送一个来回的时间。</p>
<h3 id="6-19-4-配置Stub路由器"><a href="#6-19-4-配置Stub路由器" class="headerlink" title="6.19.4  配置Stub路由器"></a>6.19.4  配置Stub路由器</h3><h4 id="背景信息-28"><a href="#背景信息-28" class="headerlink" title="背景信息"></a>背景信息</h4><p>配置Stub路由器是一种特殊的路由选路，配置了stub router的路径不被优选。实现方法是将度量值设为最大（65535），尽量避免数据从此交换机转发。用于保护此交换机链路，通常使用在升级等维护操作的场景。</p>
<h4 id="操作步骤-55"><a href="#操作步骤-55" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>ospf</strong> [ <em>process-id</em> ]，进入OSPF进程视图。</p>
</li>
<li><p>执行命令<strong>stub-router</strong> [ <strong>on-startup</strong> [ <em>interval</em> ] ]，配置Stub交换机。</p>
</li>
</ol>
<p>   缺省情况下，没有交换机为Stub路由器。</p>
<p>   如果配置了Stub路由器，缺省情况下，交换机保持为Stub路由器的时间间隔是500秒。</p>
<pre><code>说明：</code></pre>
<p>   通过此命令配置的Stub路由器与Stub区域里的交换机没有必然联系。</p>
<h3 id="6-19-5-禁止OSPF接口发送和接收协议报文"><a href="#6-19-5-禁止OSPF接口发送和接收协议报文" class="headerlink" title="6.19.5  禁止OSPF接口发送和接收协议报文"></a>6.19.5  禁止OSPF接口发送和接收协议报文</h3><h4 id="背景信息-29"><a href="#背景信息-29" class="headerlink" title="背景信息"></a>背景信息</h4><p>当用户希望本地OSPF路由信息不被其他网络中的设备获得，并且本地设备不接收网络中其他设备发布的路由更新信息的时候，可以通过配置禁止OSPF接口发送和接收协议报文来实现。</p>
<p>禁止OSPF接口发送和接收协议报文后，该接口的直连路由仍可以发布出去，但接口的Hello报文将被阻塞，无法通过此接口与相邻设备建立邻居关系。这样可以增强OSPF的组网适应能力，减少系统资源的消耗。</p>
<h4 id="操作步骤-56"><a href="#操作步骤-56" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>ospf</strong> [ <em>process-id</em> ]，进入OSPF进程视图。</p>
</li>
<li><p>执行命令<strong>silent-interface</strong> { <strong>all</strong> | <em>interface-type</em> <em>interface-number</em> }，禁止OSPF接口发送和接收协议报文。</p>
</li>
</ol>
<p>   缺省情况下，允许OSPF接口发送和接收协议报文。</p>
<p>   可以在不同的OSPF进程中，禁止同一个接口发送和接收OSPF报文，但<strong>silent-interface</strong>命令只对本进程已经使能的OSPF接口起作用，对其它进程的接口不起作用。</p>
<h3 id="6-19-6-关闭OSPF异常老化触发的主备倒换功能"><a href="#6-19-6-关闭OSPF异常老化触发的主备倒换功能" class="headerlink" title="6.19.6  关闭OSPF异常老化触发的主备倒换功能"></a>6.19.6  关闭OSPF异常老化触发的主备倒换功能</h3><p>OSPF异常老化触发的主备倒换功能默认使能，如果需要关闭此功能，请配置此任务。</p>
<h4 id="背景信息-30"><a href="#背景信息-30" class="headerlink" title="背景信息"></a>背景信息</h4><p>如果设备时钟加快，老化计时器异常超时，将会导致本端设备触发异常清除对端设备的所有Router LSA，造成大规模路由震荡和业务中断。为了避免此类情况发生，设备自动使能OSPF异常老化触发的主备倒换功能，当满足以下公式时，触发主备倒换来恢复网络连通和业务流量。</p>
<p>计算公式为：(异常清除的Router LSA的数量 / Router LSA总数) * 100% ≥ 80%（这里的Router LSA指的是对端设备发到本端设备的Router LSA）。</p>
<p>如果需要关闭此功能，请执行命令<strong>ospf maxage-lsa auto-protect disable</strong>。</p>
<h4 id="操作步骤-57"><a href="#操作步骤-57" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>ospf maxage-lsa auto-protect disable</strong>，关闭OSPF异常老化触发的主备倒换功能。</p>
</li>
</ol>
<p>   缺省情况下，OSPF异常老化触发的主备倒换功能处于使能状态。</p>
<h3 id="6-19-7-检查配置结果"><a href="#6-19-7-检查配置结果" class="headerlink" title="6.19.7  检查配置结果"></a>6.19.7  检查配置结果</h3><h4 id="前提条件-9"><a href="#前提条件-9" class="headerlink" title="前提条件"></a>前提条件</h4><p>已经完成提高OSPF网络的稳定性的所有配置。</p>
<h4 id="操作步骤-58"><a href="#操作步骤-58" class="headerlink" title="操作步骤"></a>操作步骤</h4><ul>
<li>使用<strong>display ospf</strong> [ <em>process-id</em> ] <strong>brief</strong>命令查看OSPF的概要信息。</li>
<li>使用<strong>display ip routing-table</strong>命令查看IP路由表信息。</li>
</ul>
<h2 id="6-20-提高OSPF网络的安全性"><a href="#6-20-提高OSPF网络的安全性" class="headerlink" title="6.20  提高OSPF网络的安全性"></a>6.20  提高OSPF网络的安全性</h2><h3 id="应用环境-7"><a href="#应用环境-7" class="headerlink" title="应用环境"></a>应用环境</h3><p>在安全性较高的网络中，可以通过配置OSPF验证特性和GTSM机制来提高OSPF网络的安全性。</p>
<p> 说明：</p>
<p>GTSM只支持单播地址，因此在OSPF中GTSM的作用范围主要是虚连接和伪连接。</p>
<h3 id="前置任务-11"><a href="#前置任务-11" class="headerlink" title="前置任务"></a>前置任务</h3><p>在提高OSPF网络的安全性之前，需完成以下任务：</p>
<ul>
<li>配置接口的网络层地址，使各相邻节点网络层可达。</li>
<li><a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_cfg_ospf_0004">6.8 配置OSPF的基本功能</a>。</li>
</ul>
<h3 id="配置流程-8"><a href="#配置流程-8" class="headerlink" title="配置流程"></a>配置流程</h3><p>以下配置任务（不含检查配置结果），根据应用环境选择其中一项或几项进行配置。</p>
<h3 id="6-20-1-配置OSPF-GTSM功能"><a href="#6-20-1-配置OSPF-GTSM功能" class="headerlink" title="6.20.1  配置OSPF GTSM功能"></a>6.20.1  配置OSPF GTSM功能</h3><h4 id="背景信息-31"><a href="#背景信息-31" class="headerlink" title="背景信息"></a>背景信息</h4><p>配置GTSM功能，通过检测IP报文头中的TTL值是否在一个预先定义好的特定范围内来对交换机进行保护，增强系统的安全性。</p>
<p>应用GTSM功能，需要在OSPF连接的两端都使能GTSM。</p>
<p>被检测的报文的TTL值有效范围为 [ 255–<em>hops</em>+1, 255 ]。</p>
<p>GTSM只会对匹配GTSM策略的报文进行TTL检查。对于未匹配策略的报文，可以设置为通过或丢弃。如果配置GTSM缺省报文动作为丢弃，就需要在GTSM中配置所有可能的交换机连接情况，没有配置的交换机发送的报文将被丢弃，无法建立连接。因此，在保证安全性的同时会损失一些易用性。</p>
<p>对于丢弃的报文，可以通过LOG信息开关，控制是否对报文被丢弃的情况记录日志，以方便故障的定位。</p>
<h4 id="操作步骤-59"><a href="#操作步骤-59" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>ospf valid-ttl-hops</strong> <em>hops</em> [ <strong>nonstandard-multicast</strong> ] [ <strong>vpn-instance</strong> <em>vpn-instance-name</em> ]，配置OSPF GTSM功能。</p>
</li>
</ol>
<pre><code>说明：</code></pre>
<p>   <strong>ospf valid-ttl-hops</strong>命令有两个功能，一是使能OSPF GTSM特性，二是配置需要检测的TTL值。<strong>vpn-instance</strong>参数只对后一个功能有效。因此，如果仅配置私网策略或仅配置公网策略，建议将未匹配GTSM策略的报文的缺省动作设置为<strong>pass</strong>，以免其他实例的OSPF报文被错误地丢弃。</p>
<ol start="3">
<li>（可选）执行命令<strong>gtsm default-action</strong> { <strong>drop</strong> | <strong>pass</strong> }，设置未匹配GTSM策略的报文的缺省动作。</li>
</ol>
<p>   缺省情况下，未匹配GTSM策略的报文可以通过过滤。</p>
<pre><code>说明：</code></pre>
<p>   如果仅仅配置了缺省动作，但没有配置GTSM策略时，GTSM不起作用。</p>
<ol start="4">
<li>（可选）执行命令<strong>gtsm log drop-packet</strong> <strong>all</strong>，打开设备的LOG信息的开关，在设备GTSM丢弃报文时记录LOG信息。</li>
</ol>
<h3 id="6-20-2-区域验证方式"><a href="#6-20-2-区域验证方式" class="headerlink" title="6.20.2  区域验证方式"></a>6.20.2  区域验证方式</h3><h4 id="背景信息-32"><a href="#背景信息-32" class="headerlink" title="背景信息"></a>背景信息</h4><p>使用区域验证时，一个区域中所有的交换机在该区域下的验证模式和口令必须一致。例如，在Area0内所有交换机上配置验证模式为简单验证，口令为abc。</p>
<p><img src="http://support.huawei.com/enterprise/product/images/5bf7fc7c2b06498782a61a01fdd10e10" alt="img" loading="lazy"> 注意：</p>
<p>在配置区域认证模式时，如果使用<strong>plain</strong>选项，密码将以明文形式保存在配置文件中，存在安全隐患。建议使用<strong>cipher</strong>选项，将密码加密保存。</p>
<p>Simple、MD5和HMAC-MD5密文验证模式存在安全风险，推荐使用HMAC-SHA256密文验证模式。</p>
<h4 id="操作步骤-60"><a href="#操作步骤-60" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>ospf</strong> [ <em>process-id</em> ]，进入OSPF进程视图。</p>
</li>
<li><p>执行命令<strong>area</strong> <em>area-id</em>，进入OSPF区域视图。</p>
</li>
<li><p>请根据需求，配置OSPF区域的验证模式。</p>
</li>
</ol>
<ul>
<li><p>执行命令<strong>authentication-mode simple</strong> [ <strong>plain</strong> <em>plain-text</em> | [ <strong>cipher</strong> ] <em>cipher-text</em> ]，配置OSPF区域的验证模式（简单验证）。</p>
<ul>
<li><strong>plain</strong>表示明文类型的认证密码。</li>
<li><strong>cipher</strong>表示密文类型的认证密码。对于MD5/HMAC-MD5验证模式，当此参数缺省时，默认为<strong>cipher</strong>类型。</li>
</ul>
</li>
<li><p>执行命令<strong>authentication-mode</strong> { <strong>md5</strong> | <strong>hmac-md5</strong> | <strong>hmac-sha256</strong> } [ <em>key-id</em> { <strong>plain</strong> <em>plain-text</em> | [ <strong>cipher</strong> ] <em>cipher-text</em> } ]，配置OSPF区域的验证模式。</p>
<ul>
<li><strong>md5</strong>表示使用MD5密文验证模式。</li>
<li><strong>hmac-md5</strong>表示使用hmac-md5密文验证模式。</li>
<li><strong>hmac-sha256</strong>表示使用hmac-sha256密文验证模式</li>
<li><em>key-id</em>表示密文验证的验证字标识符。</li>
</ul>
</li>
<li><p>执行命令<strong>authentication-mode</strong> <strong>keychain</strong> <em>keychain-name</em>，配置OSPF区域的Keychain验证模式。</p>
</li>
</ul>
<pre><code>  说明：

 使用Keychain验证模式，需要在系统视图下配置Keychain信息。必须保证本端ActiveSendKey和对端ActiveRecvKey的**key-id**、**algorithm**、**key-string**相同，才能建立OSPF邻居。

 仅S5720EI、S5720HI、S6720S-EI和S6720EI支持**keychain** *keychain-name*参数。</code></pre>
<h3 id="6-20-3-接口验证方式"><a href="#6-20-3-接口验证方式" class="headerlink" title="6.20.3  接口验证方式"></a>6.20.3  接口验证方式</h3><h4 id="背景信息-33"><a href="#背景信息-33" class="headerlink" title="背景信息"></a>背景信息</h4><p>接口验证方式用于在相邻的交换机之间设置验证模式和口令，优先级高于区域验证方式。</p>
<p><img src="http://support.huawei.com/enterprise/product/images/5bf7fc7c2b06498782a61a01fdd10e10" alt="img" loading="lazy"> 注意：</p>
<p>在配置接口认证模式时，如果使用<strong>plain</strong>选项，密码将以明文形式保存在配置文件中，存在安全隐患。建议使用<strong>cipher</strong>选项，将密码加密保存。</p>
<p>Simple、MD5和HMAC-MD5验证模式存在安全风险，推荐使用HMAC-SHA256验证模式。</p>
<h4 id="操作步骤-61"><a href="#操作步骤-61" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>interface</strong> <em>interface-type</em> <em>interface-number</em>，进入运行OSPF的接口视图。</p>
</li>
<li><p>（可选）对于以太网接口，执行命令<strong>undo portswitch</strong>，配置接口切换到三层模式。</p>
</li>
</ol>
<p>   缺省情况下，以太网接口处于二层模式。</p>
<pre><code>说明：</code></pre>
<p>   仅S5720HI、S5720EI、S6720EI和S6720S-EI支持二层模式与三层模式切换。</p>
<ol start="4">
<li>请根据需求，配置接口验证方式。</li>
</ol>
<ul>
<li><p>执行命令<strong>ospf authentication-mode simple</strong> [ <strong>plain</strong> <em>plain-text</em> | [ <strong>cipher</strong> ] <em>cipher-text</em> ]，配置OSPF接口的验证模式（简单验证）。</p>
<ul>
<li><strong>simple</strong>表示使用简单验证模式。</li>
<li><strong>plain</strong>表示明文类型的认证密码。</li>
<li><strong>cipher</strong>表示密文类型的认证密码。对于MD5或者HMAC-MD5验证模式，当此参数缺省时，默认为<strong>cipher</strong>类型。</li>
</ul>
</li>
<li><p>执行命令<strong>ospf authentication-mode</strong> { <strong>md5</strong> | <strong>hmac-md5</strong> | <strong>hmac-sha256</strong> } [ <em>key-id</em> { <strong>plain</strong> <em>plain-text</em> | [ <strong>cipher</strong> ] <em>cipher-text</em> } ]，配置OSPF接口的验证模式。</p>
<ul>
<li><strong>md5</strong>表示使用MD5密文验证模式。</li>
<li><strong>hmac-md5</strong>表示使用hmac-md5密文验证模式。</li>
<li><strong>hmac-sha256</strong>表示使用hmac-sha256密文验证模式</li>
</ul>
</li>
<li><p>执行命令<strong>ospf authentication-mode null</strong>，不对OSPF接口进行验证。</p>
</li>
<li><p>执行命令<strong>ospf authentication-mode</strong> <strong>keychain</strong> <em>keychain-name</em>，配置OSPF区域的Keychain验证模式。</p>
</li>
</ul>
<pre><code>  说明：

 使用Keychain验证模式，需要在系统视图下配置Keychain信息。必须保证本端ActiveSendKey和对端ActiveRecvKey的**key-id**、**algorithm**、**key-string**相同，才能建立OSPF邻居。

 仅S5720EI、S5720HI、S6720S-EI和S6720EI支持**keychain** *keychain-name*参数。</code></pre>
<h3 id="6-20-4-检查配置结果"><a href="#6-20-4-检查配置结果" class="headerlink" title="6.20.4  检查配置结果"></a>6.20.4  检查配置结果</h3><h4 id="前提条件-10"><a href="#前提条件-10" class="headerlink" title="前提条件"></a>前提条件</h4><p>已经完成提高OSPF网络的安全性的所有配置。</p>
<h4 id="操作步骤-62"><a href="#操作步骤-62" class="headerlink" title="操作步骤"></a>操作步骤</h4><ul>
<li>使用<strong>display gtsm statistics</strong> { <em>slot-id</em> | <strong>all</strong> }命令查看GTSM的统计信息。</li>
<li>使用<strong>display ospf</strong> [ <em>process-id</em> ] <strong>request-queue</strong> [ <em>interface-type</em> <em>interface-number</em> ] [ <em>neighbor-id</em> ]命令查看OSPF请求列表。</li>
<li>使用<strong>display ospf</strong> [ <em>process-id</em> ] <strong>retrans-queue</strong> [ <em>interface-type</em> <em>interface-number</em> ] [ <em>neighbor-id</em> ]命令查看OSPF重传列表。</li>
<li>使用<strong>display ospf</strong> [ <em>process-id</em> ] <strong>error</strong> [ <strong>lsa</strong> ]命令查看OSPF的错误信息</li>
</ul>
<h2 id="6-21-配置OSPF邻居震荡抑制"><a href="#6-21-配置OSPF邻居震荡抑制" class="headerlink" title="6.21  配置OSPF邻居震荡抑制"></a>6.21  配置OSPF邻居震荡抑制</h2><p>配置OSPF邻居震荡抑制功能，通过延迟邻居建立或调整链路开销为最大值的方法达到抑制震荡的目的。</p>
<h3 id="应用环境-8"><a href="#应用环境-8" class="headerlink" title="应用环境"></a>应用环境</h3><p>如果承载OSPF业务的接口状态在Up和Down之间切换，就会引起邻居状态的频繁震荡。此时，OSPF会快速发送Hello报文重新建立邻居，同步数据库LSDB，触发路由计算，会造成大量报文交互，影响现有邻居的稳定性，对OSPF业务造成较大影响，同时也会影响依赖OSPF的其他业务（如：LDP、BGP）的正常运行。为了解决这个问题，OSPF实现了邻居震荡抑制功能，即在邻居频繁震荡时，启动震荡抑制，实现邻居延迟建立，或实现业务流量延迟经过频繁震荡的链路，达到抑制震荡的目的。</p>
<p> 说明：</p>
<p>以下步骤均为可选步骤，请根据实际情况选择配置。</p>
<h3 id="前置任务-12"><a href="#前置任务-12" class="headerlink" title="前置任务"></a>前置任务</h3><p>在配置OSPF邻居震荡抑制之前，需完成以下任务：</p>
<ul>
<li>配置接口的网络层地址，使相邻节点之间网络层可达。</li>
<li><a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_cfg_ospf_0004">6.8 配置OSPF的基本功能</a>。</li>
</ul>
<h4 id="操作步骤-63"><a href="#操作步骤-63" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li>执行命令<strong>system-view</strong>，进入系统视图。</li>
</ol>
<p>   缺省情况下，OSPF邻居震荡抑制功能处于全局使能状态，执行<strong>suppress-flapping peer disable</strong>命令可以去使能此功能。</p>
<ol start="2">
<li>执行命令<strong>interface</strong> <em>interface-type</em> <em>interface-number</em>，进入接口视图。</li>
</ol>
<p>   缺省情况下，OSPF邻居震荡抑制功能处于全局使能状态，即进程中所有接口的OSPF邻居震荡抑制功能处于使能状态，如果需要在某一指定接口去使能OSPF邻居震荡抑制功能，执行<strong>ospf suppress-flapping peer disable</strong>命令可以在指定接口去使能OSPF邻居震荡抑制功能。</p>
<ol start="3">
<li>执行命令<strong>ospf suppress-flapping peer hold-down</strong> <em>interval</em>，配置震荡抑制模式为Hold-down模式，并设置抑制持续时间。</li>
</ol>
<p>   OSPF邻居震荡抑制分为Hold-down和Hold-max-cost两种模式：</p>
<ul>
<li><p>Hold-down模式：针对邻居建立过程中的频繁泛洪和拓扑变化的问题，在一段时间内禁止该邻居重新建立，避免频繁的数据库同步和大量的报文交互。</p>
</li>
<li><p>Hold-max-cost模式：针对用户业务流量频繁切换的问题，在一段时间内将链路开销值设置为最大值Max-cost（65535），避免用户的业务流量经过频繁震荡的链路。</p>
<p>Hold-down模式和Hold-max-cost模式可以叠加使用，同时生效时，先进入Hold-down模式，待Hold-down模式退出后，再进入Hold-max-cost模式。</p>
<p>缺省情况下，Hold-down模式处于去使能状态，Hold-max-cost模式处于使能状态。</p>
<p>执行<strong>ospf suppress-flapping peer hold-max-cost disable</strong>命令可以取消Hold-max-cost邻居震荡抑制模式。</p>
</li>
</ul>
<ol start="4">
<li>执行命令<strong>ospf suppress-flapping peer</strong> { <strong>detecting-interval</strong> <em>detecting-interval</em> | <strong>threshold</strong> <em>threshold</em> | <strong>resume-interval</strong> <em>resume-interval</em> } *，配置OSPF邻居震荡抑制的检测参数。</li>
</ol>
<p>   OSPF接口启动一个flapping-count计数器，相邻两次邻居状态由Full切换为非Full的时间间隔小于<em>detecting-interval</em>时，设备识别为一次有效震荡事件，flapping-count计数加1。flapping-count（有效震荡事件次数）大于等于<em>threshold</em>时，进入震荡抑制阶段。相邻两次邻居状态由Full切换为非Full的时间间隔大于<em>resume-interval</em>，flapping-count清0。</p>
<pre><code>说明：</code></pre>
<p>   <em>resume-interval</em>必须大于<em>detecting-interval</em>。</p>
<p>   根据网络的实际情况，可以在指定接口设置OSPF邻居震荡抑制的检测参数。推荐使用缺省值，缺省情况下，指定接口的OSPF邻居震荡抑制的震荡检测门限为60秒，震荡抑制门限为10，震荡检测恢复门限为120秒。</p>
<ol start="5">
<li><p>执行命令<strong>quit</strong>，返回系统视图。</p>
</li>
<li><p>执行命令<strong>quit</strong>，返回用户视图。</p>
</li>
<li><p>执行命令<strong>reset ospf</strong> <em>process-id</em> <strong>suppress-flapping</strong> <strong>peer</strong> [ <em>interface-type</em> <em>interface-number</em> ] [ <strong>notify-peer</strong> ]，强制OSPF接口退出邻居震荡抑制阶段。</p>
</li>
</ol>
<pre><code>说明：</code></pre>
<p>   退出邻居震荡抑制阶段有以下几种方式：</p>
<ul>
<li>抑制定时器超时。</li>
<li>复位OSPF进程。</li>
<li>执行<strong>suppress-flapping peer disable（OSPF）</strong>命令全局去使能OSPF邻居震荡抑制功能。</li>
<li>执行<strong>reset ospf suppress-flapping peer</strong>命令强制退出震荡抑制阶段。</li>
</ul>
<h3 id="检查配置结果-1"><a href="#检查配置结果-1" class="headerlink" title="检查配置结果"></a>检查配置结果</h3><p>执行命令<strong>display ospf</strong> [ <em>process-id</em> ] <strong>interface</strong> <em>interface-type</em> <em>interface-number</em> <strong>verbose</strong>，可以查看OSPF邻居震荡抑制的状态。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;HUAWEI&gt; display ospf interface vlanif 100 verbose</span><br><span class="line">           OSPF Process 1 with Router ID 10.1.1.2</span><br><span class="line">                  Interfaces</span><br><span class="line">                  </span><br><span class="line"> Interface: 10.0.0.2 (VLANIF100)</span><br><span class="line"> Cost: 1       State: DR        Type: Broadcast    MTU: 1500</span><br><span class="line"> Priority: 1</span><br><span class="line"> Designated Router: 10.0.0.2</span><br><span class="line"> Backup Designated Router: 10.0.0.1</span><br><span class="line"> Timers: Hello 10 , Dead 40 , Poll  120 , Retransmit 5 , Transmit Delay 1</span><br><span class="line">  IO Statistics</span><br><span class="line">             Type        Input     Output</span><br><span class="line">            Hello       161367      10436</span><br><span class="line"> DB Description             18         18</span><br><span class="line"> Link-State Req              5          6</span><br><span class="line"> Link-State Update       203780       210</span><br><span class="line"> Link-State Ack          90411        276</span><br><span class="line"> ALLSPF GROUP</span><br><span class="line"> ALLDR GROUP</span><br><span class="line"> OpaqueId: 1   PrevState: BDR</span><br><span class="line"> Effective cost: 1, enabled by OSPF Protocol.</span><br><span class="line"> Suppress flapping peer: enable(flapping-count: 0, threshold: 20)</span><br></pre></td></tr></table></figure>

<p>通过显示信息中<strong>Suppress flapping peer</strong>字段，可以看出OSPF邻居震荡抑制处于enable模式，以及震荡抑制的开始时间和震荡抑制退出的倒计时时间。</p>
<h2 id="6-22-配置OSPF网管功能"><a href="#6-22-配置OSPF网管功能" class="headerlink" title="6.22  配置OSPF网管功能"></a>6.22  配置OSPF网管功能</h2><p>OSPF同时支持网管功能，可以配置OSPF MIB与某一进程绑定，以及发送Trap消息和日志功能。</p>
<h3 id="前置任务-13"><a href="#前置任务-13" class="headerlink" title="前置任务"></a>前置任务</h3><p>在配置OSPF的网管功能之前，需要完成以下任务：</p>
<ul>
<li>配置接口的网络层地址，使相邻节点网络层可达。</li>
<li><a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#dc_cfg_ospf_0004">配置OSPF的基本功能</a>。</li>
</ul>
<h3 id="配置流程-9"><a href="#配置流程-9" class="headerlink" title="配置流程"></a>配置流程</h3><p>以下配置任务（不含检查配置结果），根据应用环境选择其中一项或几项进行配置。</p>
<h3 id="6-22-1-配置OSPF-MIB绑定"><a href="#6-22-1-配置OSPF-MIB绑定" class="headerlink" title="6.22.1  配置OSPF MIB绑定"></a>6.22.1  配置OSPF MIB绑定</h3><h4 id="背景信息-34"><a href="#背景信息-34" class="headerlink" title="背景信息"></a>背景信息</h4><p>当启动了多个OSPF进程时，可以配置OSPF MIB对哪个进程进行处理，即绑定在哪个进程。</p>
<p>请在运行OSPF协议的交换机上进行以下配置。</p>
<h4 id="操作步骤-64"><a href="#操作步骤-64" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li>执行命令<strong>system-view</strong>，进入系统视图。</li>
<li>执行命令<strong>ospf mib-binding</strong> <em>process-id</em>，配置OSPF MIB绑定。</li>
</ol>
<h3 id="6-22-2-配置OSPF-TRAP功能"><a href="#6-22-2-配置OSPF-TRAP功能" class="headerlink" title="6.22.2  配置OSPF TRAP功能"></a>6.22.2  配置OSPF TRAP功能</h3><h4 id="操作步骤-65"><a href="#操作步骤-65" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li><p>执行命令<strong>system-view</strong>，进入系统视图。</p>
</li>
<li><p>执行命令<strong>snmp-agent trap enable feature-name ospf</strong> [ <strong>trap-name</strong> { <strong>ospfifauthfailure</strong> | <strong>ospfifconfigerror</strong> | <strong>ospfifrxbadpacket</strong> | <strong>ospfifstatechange</strong> | <strong>ospflsdbapproachingoverflow</strong> | <strong>ospflsdboverflow</strong> | <strong>ospfmaxagelsa</strong> | <strong>ospfnbrrestarthelperstatuschange</strong> | <strong>ospfnbrstatechange</strong> | <strong>ospfnssatranslatorstatuschange</strong> | <strong>ospforiginatelsa</strong> | <strong>ospfrestartstatuschange</strong> | <strong>ospftxretransmit</strong> | <strong>ospfvirtifauthfailure</strong> | <strong>ospfvirtifconfigerror</strong> | <strong>ospfvirtifrxbadpacket</strong> | <strong>ospfvirtifstatechange</strong> | <strong>ospfvirtiftxretransmit</strong> | <strong>ospfvirtnbrrestarthelperstatuschange</strong> | <strong>ospfvirtnbrstatechange</strong> } ]，打开OSPF模块的告警开关。</p>
</li>
</ol>
<p>   如果只打开某个或几个事件的告警开关时，请选择<strong>trap-name</strong>。</p>
<h3 id="6-22-3-配置OSPF日志信息功能"><a href="#6-22-3-配置OSPF日志信息功能" class="headerlink" title="6.22.3  配置OSPF日志信息功能"></a>6.22.3  配置OSPF日志信息功能</h3><h4 id="操作步骤-66"><a href="#操作步骤-66" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li>执行命令<strong>system-view</strong>，进入系统视图。</li>
<li>执行命令<strong>ospf</strong> [ <em>process-id</em> ]，进入OSPF进程视图。</li>
<li>执行命令<strong>enable log</strong> [ <strong>config</strong> | <strong>error</strong> | <strong>state</strong> | <strong>snmp-trap</strong> ]，使能日志信息。</li>
</ol>
<h3 id="6-22-4-检查配置结果"><a href="#6-22-4-检查配置结果" class="headerlink" title="6.22.4  检查配置结果"></a>6.22.4  检查配置结果</h3><h4 id="前提条件-11"><a href="#前提条件-11" class="headerlink" title="前提条件"></a>前提条件</h4><p>已经完成OSPF网管功能的所有配置。</p>
<h4 id="操作步骤-67"><a href="#操作步骤-67" class="headerlink" title="操作步骤"></a>操作步骤</h4><ul>
<li>使用<strong>display ospf</strong> [ <em>process-id</em> ] <strong>brief</strong>命令查看OSPF MIB绑定信息。</li>
<li>使用<strong>display snmp-agent trap feature-name ospf all</strong>命令查看OSPF模块的所有告警信息。</li>
</ul>
<h2 id="6-23-维护OSPF"><a href="#6-23-维护OSPF" class="headerlink" title="6.23  维护OSPF"></a>6.23  维护OSPF</h2><p>维护OSPF，包括清除和复位OSPF。</p>
<h3 id="6-23-1-清除OSPF"><a href="#6-23-1-清除OSPF" class="headerlink" title="6.23.1  清除OSPF"></a>6.23.1  清除OSPF</h3><h4 id="背景信息-35"><a href="#背景信息-35" class="headerlink" title="背景信息"></a>背景信息</h4><p><img src="http://support.huawei.com/enterprise/product/images/5bf7fc7c2b06498782a61a01fdd10e10" alt="img" loading="lazy"> 注意：</p>
<p>清除OSPF的信息后，以前的信息将无法恢复，务必仔细确认。</p>
<p>在确认需要清除OSPF的运行信息后，请在用户视图下执行以下命令。</p>
<h4 id="操作步骤-68"><a href="#操作步骤-68" class="headerlink" title="操作步骤"></a>操作步骤</h4><ul>
<li>执行<strong>reset ospf</strong> [ <em>process-id</em> ] <strong>counters</strong> [ <strong>neighbor</strong> [ <em>interface-type</em> <em>interface-number</em> ] [ <em>router-id</em> ] ]命令清除OSPF计数器。</li>
</ul>
<ul>
<li><strong>counters</strong>表示用来将OSPF计数器清零。</li>
<li><strong>neighbor</strong>表示指定接口上邻居的信息。</li>
</ul>
<ul>
<li><p>执行<strong>reset ospf</strong> [ <em>process-id</em> ] <strong>redistribution</strong>命令重新引入路由。</p>
</li>
<li><p>执行<strong>reset gtsm statistics</strong> <strong>all</strong>命令清除设备上的GTSM统计信息。</p>
</li>
</ul>
<h3 id="6-23-2-复位OSPF"><a href="#6-23-2-复位OSPF" class="headerlink" title="6.23.2  复位OSPF"></a>6.23.2  复位OSPF</h3><h4 id="背景信息-36"><a href="#背景信息-36" class="headerlink" title="背景信息"></a>背景信息</h4><p><img src="http://support.huawei.com/enterprise/product/images/5bf7fc7c2b06498782a61a01fdd10e10" alt="img" loading="lazy"> 注意：</p>
<p>复位OSPF连接（执行<strong>reset ospf</strong>命令）会导致交换机之间的OSPF邻接关系中断。务必仔细确认是否必须执行复位OSPF连接的操作。</p>
<p>如果需要复位OSPF连接，可在用户视图下选择执行以下命令。</p>
<h4 id="操作步骤-69"><a href="#操作步骤-69" class="headerlink" title="操作步骤"></a>操作步骤</h4><ul>
<li>在用户视图下执行<strong>reset ospf</strong> [ <em>process-id</em> ] <strong>process</strong> [ <strong>flush-waiting-timer</strong> <em>time</em> | <strong>graceful-restart</strong> ]命令重启OSPF进程。</li>
</ul>
<h2 id="6-24-配置举例"><a href="#6-24-配置举例" class="headerlink" title="6.24  配置举例"></a>6.24  配置举例</h2><p>介绍OSPF配置举例。请结合配置流程图了解配置过程。配置示例中包括组网需求、配置思路等。</p>
<h3 id="6-24-1-配置OSPF基本功能示例"><a href="#6-24-1-配置OSPF基本功能示例" class="headerlink" title="6.24.1  配置OSPF基本功能示例"></a>6.24.1  配置OSPF基本功能示例</h3><h4 id="组网需求"><a href="#组网需求" class="headerlink" title="组网需求"></a>组网需求</h4><p>如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_cfg_ospf_105901">图6-69</a>所示，网络中有三台交换机。现在需要实现三台交换机之间能够互通，且以后能依据SwitchA和SwitchB为主要的业务设备来继续扩展整个网络。</p>
<p><strong>图6-69</strong>  配置OSPF基本功能组网图<br><img src="http://support.huawei.com/enterprise/product/images/4d913fc7efbe48c0a33c55ea292d0624" alt="img" loading="lazy"></p>
<h4 id="配置思路"><a href="#配置思路" class="headerlink" title="配置思路"></a>配置思路</h4><p>采用如下的思路配置OSPF基本功能：</p>
<ol>
<li>在各交换机的VLANIF接口上配置IP地址并配置各接口所属VLAN，实现网段内的互通。</li>
<li>在各交换机上配置OSPF基本功能，并且以SwitchA为ABR将OSPF网络划分为Area0和Area1两个区域，实现后续以SwitchA和SwitchB所在区域为骨干区域来扩展整个OSPF网络。</li>
</ol>
<h4 id="操作步骤-70"><a href="#操作步骤-70" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li>配置各接口所属的VLAN</li>
</ol>
<p>   # 配置SwitchA。SwitchB和SwitchC的配置与SwitchA类似。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;HUAWEI&gt; system-view</span><br><span class="line">[HUAWEI] sysname SwitchA</span><br><span class="line">[SwitchA] vlan batch 10 20</span><br><span class="line">[SwitchA] interface gigabitethernet 0&#x2F;0&#x2F;1</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;1] port link-type trunk</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;1] port trunk allow-pass vlan 10</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;1] quit</span><br><span class="line">[SwitchA] interface gigabitethernet 0&#x2F;0&#x2F;2</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;2] port link-type trunk</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;2] port trunk allow-pass vlan 20</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;2] quit</span><br></pre></td></tr></table></figure>



<ol start="2">
<li>配置各VLANIF接口的IP地址</li>
</ol>
<p>   # 配置SwitchA。SwitchB和SwitchC的配置与SwitchA类似。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] interface vlanif 10</span><br><span class="line">[SwitchA-Vlanif10] ip address 192.168.0.1 24</span><br><span class="line">[SwitchA-Vlanif10] quit</span><br><span class="line">[SwitchA] interface vlanif 20</span><br><span class="line">[SwitchA-Vlanif20] ip address 192.168.1.1 24</span><br><span class="line">[SwitchA-Vlanif20] quit</span><br></pre></td></tr></table></figure>



<ol start="3">
<li>配置OSPF基本功能</li>
</ol>
<p>   # 配置SwitchA。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] ospf 1 router-id 10.1.1.1</span><br><span class="line">[SwitchA-ospf-1] area 0</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.0] network 192.168.0.0 0.0.0.255</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.0] quit</span><br><span class="line">[SwitchA-ospf-1] area 1</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.1] network 192.168.1.0 0.0.0.255</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.1] return</span><br></pre></td></tr></table></figure>

<p>   # 配置SwitchB。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[SwitchB] ospf 1 router-id 10.2.2.2</span><br><span class="line">[SwitchB-ospf-1] area 0</span><br><span class="line">[SwitchB-ospf-1-area-0.0.0.0] network 192.168.0.0 0.0.0.255</span><br><span class="line">[SwitchB-ospf-1-area-0.0.0.0] return</span><br></pre></td></tr></table></figure>

<p>   # 配置SwitchC。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[SwitchC] ospf 1 router-id 10.3.3.3</span><br><span class="line">[SwitchC-ospf-1] area 1</span><br><span class="line">[SwitchC-ospf-1-area-0.0.0.1] network 192.168.1.0 0.0.0.255</span><br><span class="line">[SwitchC-ospf-1-area-0.0.0.1] return</span><br></pre></td></tr></table></figure>



<ol start="4">
<li>验证配置结果</li>
</ol>
<p>   # 查看SwitchA的OSPF邻居。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;SwitchA&gt; display ospf peer</span><br><span class="line"></span><br><span class="line">          OSPF Process 1 with Router ID 10.1.1.1</span><br><span class="line">                  Neighbors</span><br><span class="line"></span><br><span class="line"> Area 0.0.0.0 interface 192.168.0.1(Vlanif10)&#39;s neighbors</span><br><span class="line">Router ID: 10.2.2.2      Address: 192.168.0.2</span><br><span class="line">   State: Full  Mode:Nbr is  Master  Priority: 1</span><br><span class="line">   DR: 192.168.0.2  BDR: 192.168.0.1   MTU: 0</span><br><span class="line">   Dead timer due in 36  sec</span><br><span class="line">   Retrans timer interval: 5</span><br><span class="line">   Neighbor is up for 00:15:04</span><br><span class="line">   Authentication Sequence: [ 0 ]</span><br><span class="line"></span><br><span class="line">                  Neighbors</span><br><span class="line"></span><br><span class="line"> Area 0.0.0.1 interface 192.168.1.1(Vlanif20)&#39;s neighbors</span><br><span class="line">Router ID: 10.3.3.3       Address: 192.168.1.2</span><br><span class="line">   State: Full  Mode:Nbr is  Master  Priority: 1</span><br><span class="line">   DR: 192.168.1.2  BDR: 192.168.1.1   MTU: 0</span><br><span class="line">   Dead timer due in 39  sec</span><br><span class="line">   Retrans timer interval: 5</span><br><span class="line">   Neighbor is up for 00:07:32</span><br><span class="line">   Authentication Sequence: [ 0 ]</span><br></pre></td></tr></table></figure>

<p>   # 查看SwitchC的OSPF路由信息。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;SwitchC&gt; display ospf routing</span><br><span class="line"></span><br><span class="line">          OSPF Process 1 with Router ID 10.3.3.3</span><br><span class="line">                   Routing Tables</span><br><span class="line"></span><br><span class="line"> Routing for Network</span><br><span class="line"> Destination      Cost  Type         NextHop         AdvRouter       Area</span><br><span class="line"> 192.168.1.0&#x2F;24    1    Transit      192.168.1.2     10.3.3.3        0.0.0.1</span><br><span class="line"> 192.168.0.0&#x2F;24    2    Inter-area   192.168.1.1     10.1.1.1        0.0.0.1</span><br><span class="line"></span><br><span class="line"> Total Nets: 2</span><br><span class="line"> Intra Area: 1  Inter Area: 1  ASE: 0  NSSA: 0</span><br></pre></td></tr></table></figure>

<p>   由以上回显可以看出，SwitchC有到192.168.0.0/24网段的路由，且此路由被标识为区域间路由。</p>
<p>   # 查看SwitchB的路由表，并使用Ping测试SwitchB和SwitchC的连通性。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;SwitchB&gt; display ospf routing</span><br><span class="line"></span><br><span class="line">          OSPF Process 1 with Router ID 10.2.2.2</span><br><span class="line">                   Routing Tables</span><br><span class="line"></span><br><span class="line"> Routing for Network</span><br><span class="line"> Destination        Cost  Type       NextHop      AdvRouter       Area</span><br><span class="line"> 192.168.0.0&#x2F;24     1     Transit    192.168.0.2  10.2.2.2        0.0.0.0</span><br><span class="line"> 192.168.1.0&#x2F;24     2     Inter-area 192.168.0.1  10.1.1.1        0.0.0.0</span><br><span class="line"></span><br><span class="line"> Total Nets: 2</span><br><span class="line"> Intra Area: 1  Inter Area: 1  ASE: 0  NSSA: 0</span><br></pre></td></tr></table></figure>

<p>   由以上回显可以看出，SwitchB有到192.168.1.0/24网段的路由，且此路由被标识为区域间路由。</p>
<p>   # 在SwitchB上使用Ping测试SwitchB和SwitchC之间的连通性。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;SwitchB&gt; ping 192.168.1.2</span><br><span class="line">  PING 192.168.1.2: 56  data bytes, press CTRL_C to break</span><br><span class="line">    Reply from 192.168.1.2: bytes&#x3D;56 Sequence&#x3D;1 ttl&#x3D;253 time&#x3D;62 ms</span><br><span class="line">    Reply from 192.168.1.2: bytes&#x3D;56 Sequence&#x3D;2 ttl&#x3D;253 time&#x3D;16 ms</span><br><span class="line">    Reply from 192.168.1.2: bytes&#x3D;56 Sequence&#x3D;3 ttl&#x3D;253 time&#x3D;62 ms</span><br><span class="line">    Reply from 192.168.1.2: bytes&#x3D;56 Sequence&#x3D;4 ttl&#x3D;253 time&#x3D;94 ms</span><br><span class="line">    Reply from 192.168.1.2: bytes&#x3D;56 Sequence&#x3D;5 ttl&#x3D;253 time&#x3D;63 ms</span><br><span class="line"></span><br><span class="line">  --- 192.168.1.2 ping statistics ---</span><br><span class="line">    5 packet(s) transmitted</span><br><span class="line">    5 packet(s) received</span><br><span class="line">    0.00% packet loss</span><br><span class="line">    round-trip min&#x2F;avg&#x2F;max &#x3D; 16&#x2F;59&#x2F;94 ms</span><br></pre></td></tr></table></figure>







<h4 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h4><ul>
<li><p>SwitchA的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">sysname SwitchA</span><br><span class="line">#</span><br><span class="line">vlan batch 10 20</span><br><span class="line">#</span><br><span class="line">interface Vlanif10</span><br><span class="line"> ip address 192.168.0.1 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface Vlanif20</span><br><span class="line"> ip address 192.168.1.1 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 10</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;2</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 20</span><br><span class="line">#</span><br><span class="line">ospf 1 router-id 10.1.1.1</span><br><span class="line"> area 0.0.0.0</span><br><span class="line">  network 192.168.0.0 0.0.0.255</span><br><span class="line"> area 0.0.0.1</span><br><span class="line">  network 192.168.1.0 0.0.0.255</span><br><span class="line">#</span><br><span class="line">return</span><br></pre></td></tr></table></figure>
</li>
<li><p>SwitchB的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">sysname SwitchB</span><br><span class="line">#</span><br><span class="line">vlan batch 10</span><br><span class="line">#</span><br><span class="line">interface Vlanif10</span><br><span class="line"> ip address 192.168.0.2 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 10</span><br><span class="line">#</span><br><span class="line">ospf 1 router-id 10.2.2.2</span><br><span class="line"> area 0.0.0.0</span><br><span class="line">  network 192.168.0.0 0.0.0.255</span><br><span class="line">#</span><br><span class="line">return</span><br></pre></td></tr></table></figure>
</li>
<li><p>SwitchC的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">sysname SwitchC</span><br><span class="line">#</span><br><span class="line">vlan batch 20</span><br><span class="line">#</span><br><span class="line">interface Vlanif20</span><br><span class="line"> ip address 192.168.1.2 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 20</span><br><span class="line">#</span><br><span class="line">ospf 1 router-id 10.3.3.3</span><br><span class="line"> area 0.0.0.1</span><br><span class="line">  network 192.168.1.0 0.0.0.255</span><br><span class="line">#</span><br><span class="line">return</span><br></pre></td></tr></table></figure>





</li>
</ul>
<h3 id="6-24-2-配置OSPF的DR选择示例"><a href="#6-24-2-配置OSPF的DR选择示例" class="headerlink" title="6.24.2  配置OSPF的DR选择示例"></a>6.24.2  配置OSPF的DR选择示例</h3><h4 id="组网需求-1"><a href="#组网需求-1" class="headerlink" title="组网需求"></a>组网需求</h4><p>如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_cfg_ospf_106601">图6-70</a>所示，部署OSPF协议的网络中有五台交换机，其中Switch作为二层交换机连接其他运行OSPF协议的四台交换机。由于之前四台设备之间缺省选举的DR不符合网络需求，现在需要让SwitchA被选举为DR来和OSPF网络其他设备交互LSA信息，而SwitchC则作为SwitchA的备份。而SwitchB由于其他业务需要，只能让它通过DR来与OSPF网络其他设备交互LSA信息。</p>
<p><strong>图6-70</strong>  配置OSPF的DR选择组网图<br><img src="http://support.huawei.com/enterprise/product/images/eab0e78c08eb4ed89b94426591d2773a" alt="img" loading="lazy"></p>
<h4 id="配置思路-1"><a href="#配置思路-1" class="headerlink" title="配置思路"></a>配置思路</h4><p>采用如下的思路配置OSPF的DR选择：</p>
<ol>
<li>在各交换机上配置OSPF的基本功能，查看四台交换机之间缺省的DR的选举情况。</li>
<li>配置SwitchA对应接口的DR优先级为100，SwitchB对应接口的DR优先级为0，SwitchC对应接口的DR优先级为2，使得SwitchA被选举为DR，SwitchC被选举为BDR，SwitchB永远无法成为DR或BDR，而SwitchD采用缺省DR优先级，维持原状不变。</li>
</ol>
<h4 id="操作步骤-71"><a href="#操作步骤-71" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li>配置各接口所属的VLAN</li>
</ol>
<p>   # 配置SwitchA。Switch、SwitchB、SwitchC和SwitchD的配置与SwitchA类似。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;HUAWEI&gt; system-view</span><br><span class="line">[HUAWEI] sysname SwitchA</span><br><span class="line">[SwitchA] vlan batch 10</span><br><span class="line">[SwitchA] interface gigabitethernet 0&#x2F;0&#x2F;1</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;1] port link-type trunk</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;1] port trunk allow-pass vlan 10</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;1] quit</span><br></pre></td></tr></table></figure>



<ol start="2">
<li>配置各VLANIF接口的IP地址</li>
</ol>
<p>   # 配置SwitchA。SwitchB、SwitchC和SwitchD的配置与SwitchA类似。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] interface vlanif 10</span><br><span class="line">[SwitchA-Vlanif10] ip address 192.168.1.1 24</span><br><span class="line">[SwitchA-Vlanif10] quit</span><br></pre></td></tr></table></figure>



<ol start="3">
<li>配置OSPF基本功能</li>
</ol>
<p>   # 配置SwitchA。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] ospf 1 router-id 10.1.1.1</span><br><span class="line">[SwitchA-ospf-1] area 0</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.0] network 192.168.1.0 0.0.0.255</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.0] quit</span><br><span class="line">[SwitchA-ospf-1] quit</span><br></pre></td></tr></table></figure>

<p>   # 配置SwitchB。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[SwitchB] ospf 1 router-id 10.2.2.2</span><br><span class="line">[SwitchB-ospf-1] area 0</span><br><span class="line">[SwitchB-ospf-1-area-0.0.0.0] network 192.168.1.0 0.0.0.255 </span><br><span class="line">[SwitchB-ospf-1-area-0.0.0.0] quit</span><br><span class="line">[SwitchB-ospf-1] quit</span><br></pre></td></tr></table></figure>

<p>   # 配置SwitchC。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[SwitchC] ospf 1 router-id 10.3.3.3</span><br><span class="line">[SwitchC-ospf-1] area 0</span><br><span class="line">[SwitchC-ospf-1-area-0.0.0.0] network 192.168.1.0 0.0.0.255 </span><br><span class="line">[SwitchC-ospf-1-area-0.0.0.0] quit</span><br><span class="line">[SwitchC-ospf-1] quit</span><br></pre></td></tr></table></figure>

<p>   # 配置SwitchD。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[SwitchD] ospf 1 router-id 10.4.4.4</span><br><span class="line">[SwitchD-ospf-1] area 0</span><br><span class="line">[SwitchD-ospf-1-area-0.0.0.0] network 192.168.1.0 0.0.0.255 </span><br><span class="line">[SwitchD-ospf-1-area-0.0.0.0] quit</span><br><span class="line">[SwitchD-ospf-1] quit</span><br><span class="line">[SwitchD] quit</span><br></pre></td></tr></table></figure>

<p>   # SwitchA上查看OSPF邻居的信息。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] display ospf peer</span><br><span class="line"></span><br><span class="line">          OSPF Process 1 with Router ID 10.1.1.1</span><br><span class="line">                  Neighbors</span><br><span class="line"></span><br><span class="line"> Area 0.0.0.0 interface 192.168.1.1(Vlanif10)&#39;s neighbors</span><br><span class="line"> Router ID: 10.2.2.2      Address: 192.168.1.2</span><br><span class="line">State: 2-Way  Mode:Nbr is  Master  Priority: 1</span><br><span class="line">DR: 192.168.1.4  BDR: 192.168.1.3  MTU: 0</span><br><span class="line">   Dead timer due in 32  sec</span><br><span class="line">   Retrans timer interval: 5</span><br><span class="line">   Neighbor is up for 00:04:21</span><br><span class="line">   Authentication Sequence: [ 0 ]</span><br><span class="line"></span><br><span class="line"> Router ID: 10.3.3.3      Address: 192.168.1.3</span><br><span class="line">State: Full  Mode:Nbr is  Master  Priority: 1</span><br><span class="line">DR: 192.168.1.4  BDR: 192.168.1.3  MTU: 0</span><br><span class="line">   Dead timer due in 37  sec</span><br><span class="line">   Retrans timer interval: 5</span><br><span class="line">   Neighbor is up for 00:04:06</span><br><span class="line">   Authentication Sequence: [ 0 ]</span><br><span class="line"></span><br><span class="line"> Router ID: 10.4.4.4      Address: 192.168.1.4</span><br><span class="line">State: Full  Mode:Nbr is  Master  Priority: 1</span><br><span class="line">DR: 192.168.1.4  BDR: 192.168.1.3  MTU: 0</span><br><span class="line">   Dead timer due in 37  sec</span><br><span class="line">   Retrans timer interval: 5</span><br><span class="line">   Neighbor is up for 00:03:53</span><br><span class="line">   Authentication Sequence: [ 0 ]</span><br></pre></td></tr></table></figure>

<p>   从以上回显中可以看到在缺省情况下SwitchD为DR，SwitchC为BDR。这是因为当DR优先级相同时，Router-ID高的被选举为DR。</p>
<ol start="4">
<li>配置交换机接口上的DR优先级</li>
</ol>
<p>   # 配置SwitchA。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] interface vlanif 10</span><br><span class="line">[SwitchA-Vlanif10] ospf dr-priority 100</span><br><span class="line">[SwitchA-Vlanif10] quit</span><br><span class="line">[SwitchA] quit</span><br></pre></td></tr></table></figure>

<p>   # 配置SwitchB。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[SwitchB] interface vlanif 10</span><br><span class="line">[SwitchB-Vlanif10] ospf dr-priority 0</span><br><span class="line">[SwitchB-Vlanif10] quit</span><br><span class="line">[SwitchB] quit</span><br></pre></td></tr></table></figure>

<p>   # 配置SwitchC。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[SwitchC] interface vlanif 10</span><br><span class="line">[SwitchC-Vlanif10] ospf dr-priority 2</span><br><span class="line">[SwitchC-Vlanif10] quit</span><br><span class="line">[SwitchC] quit</span><br></pre></td></tr></table></figure>

<p>   # 在SwitchD上查看OSPF邻居的信息。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;SwitchD&gt; display ospf peer</span><br><span class="line"></span><br><span class="line">          OSPF Process 1 with Router ID 10.4.4.4</span><br><span class="line">                  Neighbors</span><br><span class="line"></span><br><span class="line"> Area 0.0.0.0 interface 192.168.1.4(Vlanif10)&#39;s neighbors</span><br><span class="line"> Router ID: 10.1.1.1      Address: 192.168.1.1</span><br><span class="line">   State: Full  Mode:Nbr is  Slave  Priority: 100</span><br><span class="line">DR: 192.168.1.4  BDR: 192.168.1.3  MTU: 0</span><br><span class="line">   Dead timer due in 31  sec</span><br><span class="line">   Retrans timer interval: 5</span><br><span class="line">   Neighbor is up for 00:11:17</span><br><span class="line">   Authentication Sequence: [ 0 ]</span><br><span class="line"></span><br><span class="line"> Router ID: 10.2.2.2      Address: 192.168.1.2</span><br><span class="line">   State: Full  Mode:Nbr is  Slave  Priority: 0</span><br><span class="line">DR: 192.168.1.4  BDR: 192.168.1.3  MTU: 0</span><br><span class="line">   Dead timer due in 35  sec</span><br><span class="line">   Retrans timer interval: 5</span><br><span class="line">   Neighbor is up for 00:11:19</span><br><span class="line">   Authentication Sequence: [ 0 ]</span><br><span class="line"></span><br><span class="line"> Router ID: 10.3.3.3      Address: 192.168.1.3</span><br><span class="line">   State: Full  Mode:Nbr is  Slave  Priority: 2</span><br><span class="line">DR: 192.168.1.4  BDR: 192.168.1.3  MTU: 0</span><br><span class="line">   Dead timer due in 33  sec</span><br><span class="line">   Retrans timer interval: 5</span><br><span class="line">   Neighbor is up for 00:11:15</span><br><span class="line">   Authentication Sequence: [ 0 ]</span><br></pre></td></tr></table></figure>

<p>   通过以上回显信息发现四台交换机之间DR的选举情况并没有改变。这是因为如果DR、BDR已经选择完毕，当一台新设备加入后，即使它的DR优先级值最大，也不会立即成为该网段中的DR，只有重启OSPF进程之后才会重新选举DR和BDR。</p>
<ol start="5">
<li>重启OSPF进程</li>
</ol>
<p>   # 在各交换机的用户视图下，同时执行命令<strong>reset ospf 1 process</strong>，以重启OSPF进程。同时重启OSPF进程是为了让四台交换机都参与DR和BDR的选举过程。</p>
<p>   # 重启SwitchA</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;SwitchA&gt; reset ospf 1 process</span><br></pre></td></tr></table></figure>

<p>   # 重启SwitchB</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;SwitchB&gt; reset ospf 1 process</span><br></pre></td></tr></table></figure>

<p>   # 重启SwitchC</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;SwitchC&gt; reset ospf 1 process</span><br></pre></td></tr></table></figure>

<p>   # 重启SwitchD</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;SwitchD&gt; reset ospf 1 process</span><br></pre></td></tr></table></figure>



<ol start="6">
<li>验证配置结果</li>
</ol>
<p>   # 在SwitchD上查看OSPF邻居信息。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;SwitchD&gt; display ospf peer</span><br><span class="line"></span><br><span class="line">          OSPF Process 1 with Router ID 10.4.4.4</span><br><span class="line">                  Neighbors</span><br><span class="line"></span><br><span class="line"> Area 0.0.0.0 interface 192.168.1.4(Vlanif10)&#39;s neighbors</span><br><span class="line"> Router ID: 10.1.1.1      Address: 192.168.1.1</span><br><span class="line">State: Full  Mode:Nbr is  Slave  Priority: 100</span><br><span class="line">DR: 192.168.1.1  BDR: 192.168.1.3  MTU: 0</span><br><span class="line">   Dead timer due in 35  sec</span><br><span class="line">   Retrans timer interval: 5</span><br><span class="line">   Neighbor is up for 00:07:19</span><br><span class="line">   Authentication Sequence: [ 0 ]</span><br><span class="line"></span><br><span class="line"> Router ID: 10.2.2.2      Address: 192.168.1.2</span><br><span class="line">State: 2-Way  Mode:Nbr is  Master  Priority: 0</span><br><span class="line">DR: 192.168.1.1  BDR: 192.168.1.3  MTU: 0</span><br><span class="line">   Dead timer due in 35  sec</span><br><span class="line">   Retrans timer interval: 5</span><br><span class="line">   Neighbor is up for 00:07:19</span><br><span class="line">   Authentication Sequence: [ 0 ]</span><br><span class="line"></span><br><span class="line"> Router ID: 10.3.3.3      Address: 192.168.1.3</span><br><span class="line">State: Full  Mode:Nbr is  Slave  Priority: 2</span><br><span class="line">DR: 192.168.1.1  BDR: 192.168.1.3  MTU: 0</span><br><span class="line">   Dead timer due in 37  sec</span><br><span class="line">   Retrans timer interval: 5</span><br><span class="line">   Neighbor is up for 00:07:17</span><br><span class="line">   Authentication Sequence: [ 0 ]</span><br></pre></td></tr></table></figure>

   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">   </span><br></pre></td></tr></table></figure>

<p>   从以上回显中可以看到SwitchA被选举为DR，SwitchC为BDR。而SwitchD与SwitchB之间的邻居状态为<strong>2-Way</strong>，这说明两者既不是DR，也不是BDR，即它们之间不需要交换LSA信息。</p>
<h4 id="配置文件-1"><a href="#配置文件-1" class="headerlink" title="配置文件"></a>配置文件</h4><ul>
<li><p>Switch的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">sysname Switch</span><br><span class="line">#</span><br><span class="line">vlan batch 10</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 10</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;2</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 10</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;3</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 10</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;4</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 10</span><br><span class="line">#</span><br><span class="line">return</span><br></pre></td></tr></table></figure>
</li>
<li><p>SwitchA的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">sysname SwitchA</span><br><span class="line">#</span><br><span class="line">vlan batch 10</span><br><span class="line">#</span><br><span class="line">interface Vlanif10</span><br><span class="line"> ip address 192.168.1.1 255.255.255.0</span><br><span class="line"> ospf dr-priority 100</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 10</span><br><span class="line">#</span><br><span class="line">ospf 1 router-id 10.1.1.1</span><br><span class="line"> area 0.0.0.0</span><br><span class="line">  network 192.168.1.0 0.0.0.255</span><br><span class="line">#</span><br><span class="line">return</span><br></pre></td></tr></table></figure>
</li>
<li><p>SwitchB的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">sysname SwitchB</span><br><span class="line">#</span><br><span class="line">vlan batch 10</span><br><span class="line">#</span><br><span class="line">interface Vlanif10</span><br><span class="line"> ip address 192.168.1.2 255.255.255.0</span><br><span class="line"> ospf dr-priority 0</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 10</span><br><span class="line">#</span><br><span class="line">ospf 1 router-id 10.2.2.2</span><br><span class="line"> area 0.0.0.0</span><br><span class="line">  network 192.168.1.0 0.0.0.255</span><br><span class="line">#</span><br><span class="line">return</span><br></pre></td></tr></table></figure>
</li>
<li><p>SwitchC的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">sysname SwitchC</span><br><span class="line">#</span><br><span class="line">vlan batch 10</span><br><span class="line">#</span><br><span class="line">interface Vlanif10</span><br><span class="line"> ip address 192.168.1.3 255.255.255.0</span><br><span class="line"> ospf dr-priority 2</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 10</span><br><span class="line">#</span><br><span class="line">ospf 1 router-id 10.3.3.3</span><br><span class="line"> area 0.0.0.0</span><br><span class="line">  network 192.168.1.0 0.0.0.255</span><br><span class="line">#</span><br><span class="line">return</span><br></pre></td></tr></table></figure>
</li>
<li><p>SwitchD的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">sysname SwitchD</span><br><span class="line">#</span><br><span class="line">vlan batch 10</span><br><span class="line">#</span><br><span class="line">interface Vlanif10</span><br><span class="line"> ip address 192.168.1.4 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 10</span><br><span class="line">#</span><br><span class="line">ospf 1 router-id 10.4.4.4</span><br><span class="line"> area 0.0.0.0</span><br><span class="line">  network 192.168.1.0 0.0.0.255</span><br><span class="line">#</span><br><span class="line">return</span><br></pre></td></tr></table></figure>





</li>
</ul>
<h3 id="6-24-3-配置OSPF的Stub区域示例"><a href="#6-24-3-配置OSPF的Stub区域示例" class="headerlink" title="6.24.3  配置OSPF的Stub区域示例"></a>6.24.3  配置OSPF的Stub区域示例</h3><h4 id="组网需求-2"><a href="#组网需求-2" class="headerlink" title="组网需求"></a>组网需求</h4><p>如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_cfg_ospf_107001">图6-71</a>所示，三台交换机之间运行OSPF协议，整个OSPF网络被划分为Area0和Area1两个区域，其中SwitchB作为ASBR与OSPF外部网络实现互通。现要求在不影响通信的情况下减少SwitchC上OSPF路由表的规模。</p>
<p><strong>图6-71</strong>  配置OSPF Stub区域组网图<br><img src="http://support.huawei.com/enterprise/product/images/0c89df9499ee4183ac48875c3fc52780" alt="img" loading="lazy"></p>
<h4 id="配置思路-2"><a href="#配置思路-2" class="headerlink" title="配置思路"></a>配置思路</h4><p>采用如下的思路配置OSPF Stub区域：</p>
<ol>
<li>在各交换机上配置OSPF基本功能，实现OSPF网络的基本互通。</li>
<li>在SwitchB上配置静态路由，并引入到OSPF路由表中，实现OSPF网络到外部网络路由可达。</li>
<li>配置Area1为Stub区域，初步减少SwitchC上OSPF路由表的规模。</li>
<li>在Area1的ABR（SwitchA）上配置禁止向Stub区域通告Type3 LSA，即将Area1配置为Totally Stub区域，达到最大限度减少SwitchC上OSPF路由表规模的目的。</li>
</ol>
<h4 id="操作步骤-72"><a href="#操作步骤-72" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li>配置各接口所属的VLAN</li>
</ol>
<p>   # 配置SwitchA。SwitchB和SwitchC的配置与SwitchA类似。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;HUAWEI&gt; system-view</span><br><span class="line">[HUAWEI] sysname SwitchA</span><br><span class="line">[SwitchA] vlan batch 10 20</span><br><span class="line">[SwitchA] interface gigabitethernet 0&#x2F;0&#x2F;1</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;1] port link-type trunk</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;1] port trunk allow-pass vlan 10</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;1] quit</span><br><span class="line">[SwitchA] interface gigabitethernet 0&#x2F;0&#x2F;2</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;2] port link-type trunk</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;2] port trunk allow-pass vlan 20</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;2] quit</span><br></pre></td></tr></table></figure>



<ol start="2">
<li>配置各VLANIF接口的IP地址</li>
</ol>
<p>   # 配置SwitchA。SwitchB和SwitchC的配置与SwitchA类似。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] interface vlanif 10</span><br><span class="line">[SwitchA-Vlanif10] ip address 192.168.0.1 24</span><br><span class="line">[SwitchA-Vlanif10] quit</span><br><span class="line">[SwitchA] interface vlanif 20</span><br><span class="line">[SwitchA-Vlanif20] ip address 192.168.1.1 24</span><br><span class="line">[SwitchA-Vlanif20] quit</span><br></pre></td></tr></table></figure>



<ol start="3">
<li>配置OSPF基本功能</li>
</ol>
<p>   # 配置SwitchA。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] ospf 1 router-id 10.1.1.1</span><br><span class="line">[SwitchA-ospf-1] area 0</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.0] network 192.168.0.0 0.0.0.255</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.0] quit</span><br><span class="line">[SwitchA-ospf-1] area 1</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.1] network 192.168.1.0 0.0.0.255</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.1] quit</span><br><span class="line">[SwitchA-ospf-1] quit</span><br></pre></td></tr></table></figure>

<p>   # 配置SwitchB。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[SwitchB] ospf 1 router-id 10.2.2.2</span><br><span class="line">[SwitchB-ospf-1] area 0</span><br><span class="line">[SwitchB-ospf-1-area-0.0.0.0] network 192.168.0.0 0.0.0.255</span><br><span class="line">[SwitchB-ospf-1-area-0.0.0.0] quit</span><br><span class="line">[SwitchB-ospf-1] quit</span><br></pre></td></tr></table></figure>

<p>   # 配置SwitchC。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[SwitchC] ospf 1 router-id 10.3.3.3</span><br><span class="line">[SwitchC-ospf-1] area 1</span><br><span class="line">[SwitchC-ospf-1-area-0.0.0.1] network 192.168.1.0 0.0.0.255</span><br><span class="line">[SwitchC-ospf-1-area-0.0.0.1] quit</span><br><span class="line">[SwitchC-ospf-1] quit</span><br></pre></td></tr></table></figure>



<ol start="4">
<li>配置SwitchB引入静态路由</li>
</ol>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[SwitchB] ip route-static 10.0.0.0 8 null 0</span><br><span class="line">[SwitchB] ospf 1</span><br><span class="line">[SwitchB-ospf-1] import-route static type 1</span><br><span class="line">[SwitchB-ospf-1] quit</span><br></pre></td></tr></table></figure>

<p>   # 查看SwitchC的OSPF路由表信息，可以看到OSPF路由表中存在AS外部的路由。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[SwitchC] display ospf routing</span><br><span class="line"></span><br><span class="line">     OSPF Process 1 with Router ID 10.3.3.3</span><br><span class="line">                   Routing Tables</span><br><span class="line"></span><br><span class="line"> Routing for Network</span><br><span class="line"> Destination        Cost  Type         NextHop         AdvRouter       Area</span><br><span class="line"> 192.168.1.0&#x2F;24     1     Transit      192.168.1.2     10.3.3.3        0.0.0.1</span><br><span class="line"> 192.168.0.0&#x2F;24     2     Inter-area   192.168.1.1     10.1.1.1        0.0.0.1</span><br><span class="line"></span><br><span class="line"> Routing for ASEs</span><br><span class="line"> Destination    Cost      Type       Tag         NextHop         AdvRouter</span><br><span class="line"> 10.0.0.0&#x2F;8    3         Type1      1           192.168.1.1     10.2.2.2</span><br><span class="line"></span><br><span class="line"> Total Nets: 3</span><br><span class="line"> Intra Area: 1  Inter Area: 1  ASE: 1  NSSA: 0</span><br></pre></td></tr></table></figure>



<ol start="5">
<li>配置Area1为Stub区域</li>
</ol>
<p>   # 配置SwitchA。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] ospf 1</span><br><span class="line">[SwitchA-ospf-1] area 1</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.1] stub</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.1] quit</span><br><span class="line">[SwitchA-ospf-1] quit</span><br></pre></td></tr></table></figure>

<p>   # 配置SwitchC。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[SwitchC] ospf 1</span><br><span class="line">[SwitchC-ospf-1] area 1</span><br><span class="line">[SwitchC-ospf-1-area-0.0.0.1] stub</span><br><span class="line">[SwitchC-ospf-1-area-0.0.0.1] quit</span><br><span class="line">[SwitchC-ospf-1] quit</span><br></pre></td></tr></table></figure>

<p>   # 查看SwitchC的OSPF路由表信息，发现此时AS外部的路由已经消失，但是多了一条通往区域外部的缺省路由。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[SwitchC] display ospf routing</span><br><span class="line"></span><br><span class="line">          OSPF Process 1 with Router ID 10.3.3.3</span><br><span class="line">                   Routing Tables</span><br><span class="line"></span><br><span class="line"> Routing for Network</span><br><span class="line"> Destination        Cost  Type       NextHop         AdvRouter       Area</span><br><span class="line"> 192.168.1.0&#x2F;24     1     Transit    192.168.1.2     10.3.3.3         0.0.0.1</span><br><span class="line"> 0.0.0.0&#x2F;0          2     Inter-area 192.168.1.1     10.1.1.1         0.0.0.1</span><br><span class="line"> 192.168.0.0&#x2F;24     2     Inter-area 192.168.1.1     10.1.1.1         0.0.0.1</span><br><span class="line"></span><br><span class="line"> Total Nets: 3</span><br><span class="line"> Intra Area: 1  Inter Area: 2  ASE: 0  NSSA: 0</span><br></pre></td></tr></table></figure>



<ol start="6">
<li>配置Area1为Totally Stub区域</li>
</ol>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] ospf 1</span><br><span class="line">[SwitchA-ospf-1] area 1</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.1] stub no-summary</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.1] quit</span><br><span class="line">[SwitchA-ospf-1] quit</span><br></pre></td></tr></table></figure>



<ol start="7">
<li>验证配置结果</li>
</ol>
<p>   # 查看SwitchC的OSPF路由表，发现目的地址为192.168.0.0/24的路由也消失了，仅保留了区域内的OSPF路由以及一条通往区域外部缺省路由。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[SwitchC] display ospf routing</span><br><span class="line"></span><br><span class="line">          OSPF Process 1 with Router ID 10.3.3.3</span><br><span class="line">                   Routing Tables</span><br><span class="line"></span><br><span class="line"> Routing for Network</span><br><span class="line"> Destination        Cost  Type       NextHop         AdvRouter       Area</span><br><span class="line"> 192.168.1.0&#x2F;24     1     Transit    192.168.1.2     10.3.3.3         0.0.0.1</span><br><span class="line"> 0.0.0.0&#x2F;0          2     Inter-area 192.168.1.1     10.1.1.1         0.0.0.1</span><br><span class="line"></span><br><span class="line"> Total Nets: 2</span><br><span class="line"> Intra Area: 1  Inter Area: 1  ASE: 0  NSSA: 0</span><br></pre></td></tr></table></figure>







<h4 id="配置文件-2"><a href="#配置文件-2" class="headerlink" title="配置文件"></a>配置文件</h4><ul>
<li><p>SwitchA的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">sysname SwitchA</span><br><span class="line">#</span><br><span class="line">vlan batch 10 20</span><br><span class="line">#</span><br><span class="line">interface Vlanif10</span><br><span class="line"> ip address 192.168.0.1 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface Vlanif20</span><br><span class="line"> ip address 192.168.1.1 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 10</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;2</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 20</span><br><span class="line">#</span><br><span class="line">ospf 1 router-id 10.1.1.1</span><br><span class="line"> area 0.0.0.0</span><br><span class="line">  network 192.168.0.0 0.0.0.255</span><br><span class="line"> area 0.0.0.1</span><br><span class="line">  network 192.168.1.0 0.0.0.255</span><br><span class="line">  stub no-summary</span><br><span class="line">#</span><br><span class="line">return</span><br></pre></td></tr></table></figure>
</li>
<li><p>SwitchB的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">sysname SwitchB</span><br><span class="line">#</span><br><span class="line">vlan batch 10</span><br><span class="line">#</span><br><span class="line">interface Vlanif10</span><br><span class="line"> ip address 192.168.0.2 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 10</span><br><span class="line">#</span><br><span class="line">ospf 1 router-id 10.2.2.2</span><br><span class="line"> import-route static type 1</span><br><span class="line"> area 0.0.0.0</span><br><span class="line">  network 192.168.0.0 0.0.0.255</span><br><span class="line">#</span><br><span class="line">ip route-static 10.0.0.0 255.0.0.0 NULL0</span><br><span class="line">#</span><br><span class="line">return</span><br></pre></td></tr></table></figure>
</li>
<li><p>SwitchC的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">sysname SwitchC</span><br><span class="line">#</span><br><span class="line">vlan batch 20</span><br><span class="line">#</span><br><span class="line">interface Vlanif20</span><br><span class="line"> ip address 192.168.1.2 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 20</span><br><span class="line">#</span><br><span class="line">ospf 1 router-id 10.3.3.3</span><br><span class="line"> area 0.0.0.1</span><br><span class="line">  network 192.168.1.0 0.0.0.255</span><br><span class="line">  stub</span><br><span class="line">#</span><br><span class="line">return</span><br></pre></td></tr></table></figure>





</li>
</ul>
<h3 id="6-24-4-配置OSPF的NSSA区域示例"><a href="#6-24-4-配置OSPF的NSSA区域示例" class="headerlink" title="6.24.4  配置OSPF的NSSA区域示例"></a>6.24.4  配置OSPF的NSSA区域示例</h3><h4 id="组网需求-3"><a href="#组网需求-3" class="headerlink" title="组网需求"></a>组网需求</h4><p>如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_cfg_ospf_107401">图6-72</a>所示，四台交换机都运行OSPF，且整个OSPF网络被划分为Area0和Area1两个区域。现要求Area1内的设备不接收其他OSPF区域引入的外部路由信息，而Area1内的交换机则通过区域内的设备引入外部路由来与外部网络进行通信。同时，由于SwitchB承载的业务较多，所以需要指定SwitchA作为转换路由器将Type7 LSA转换为Type5 LSA发送到其他OSPF区域。</p>
<p> 说明：</p>
<p>请确保该场景下互联接口的STP处于未使能状态。因为在使能STP的环形网络中，如果用交换机的VLANIF接口构建三层网络，会导致某个端口被阻塞，从而导致三层业务不能正常运行。</p>
<p><strong>图6-72</strong>  配置OSPF NSSA区域组网图<br><img src="http://support.huawei.com/enterprise/product/images/384fb40cc92046608ad92fe15f6d7b03" alt="img" loading="lazy"></p>
<h4 id="配置思路-3"><a href="#配置思路-3" class="headerlink" title="配置思路"></a>配置思路</h4><p>采用如下的思路配置OSPF的NSSA区域：</p>
<ol>
<li>在各交换机上配置OSPF基本功能，实现OSPF网络的基本互通。</li>
<li>配置Area1为NSSA区域，并在SwitchD上配置静态路由，并引入到OSPF路由表中，实现Area1内的交换机仅能通过SwitchD来与外部网络进行通信。</li>
<li>配置SwitchA为转换路由器，实现指定SwitchA将Type7 LSA转换为Type5 LSA发送到其他OSPF区域。</li>
</ol>
<h4 id="操作步骤-73"><a href="#操作步骤-73" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li>配置各接口所属的VLAN</li>
</ol>
<p>   # 配置SwitchA。SwitchB、SwitchC和SwitchD的配置与SwitchA类似。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;HUAWEI&gt; system-view</span><br><span class="line">[HUAWEI] sysname SwitchA</span><br><span class="line">[SwitchA] vlan batch 10 30</span><br><span class="line">[SwitchA] interface gigabitethernet 0&#x2F;0&#x2F;1</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;1] port link-type trunk</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;1] port trunk allow-pass vlan 30</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;1] quit</span><br><span class="line">[SwitchA] interface gigabitethernet 0&#x2F;0&#x2F;2</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;2] port link-type trunk</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;2] port trunk allow-pass vlan 10</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;2] quit</span><br></pre></td></tr></table></figure>



<ol start="2">
<li>配置各VLANIF接口的IP地址</li>
</ol>
<p>   # 配置SwitchA。SwitchB、SwitchC和SwitchD的配置与SwitchA类似。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] interface vlanif 10</span><br><span class="line">[SwitchA-Vlanif10] ip address 192.168.1.1 24</span><br><span class="line">[SwitchA-Vlanif10] quit</span><br><span class="line">[SwitchA] interface vlanif 30</span><br><span class="line">[SwitchA-Vlanif30] ip address 192.168.3.1 24</span><br><span class="line">[SwitchA-Vlanif30] quit</span><br></pre></td></tr></table></figure>



<ol start="3">
<li>配置OSPF基本功能</li>
</ol>
<p>   # 配置SwitchA。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] ospf 1 router-id 10.1.1.1</span><br><span class="line">[SwitchA-ospf-1] area 0</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.0] network 192.168.1.0 0.0.0.255</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.0] quit</span><br><span class="line">[SwitchA-ospf-1] area 1</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.1] network 192.168.3.0 0.0.0.255</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.1] quit</span><br><span class="line">[SwitchA-ospf-1] quit</span><br></pre></td></tr></table></figure>

<p>   # 配置SwitchB。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[SwitchB] ospf 1 router-id 10.2.2.2</span><br><span class="line">[SwitchB-ospf-1] area 0</span><br><span class="line">[SwitchB-ospf-1-area-0.0.0.0] network 192.168.2.0 0.0.0.255</span><br><span class="line">[SwitchB-ospf-1-area-0.0.0.0] quit</span><br><span class="line">[SwitchB-ospf-1] area 1</span><br><span class="line">[SwitchB-ospf-1-area-0.0.0.1] network 192.168.4.0 0.0.0.255</span><br><span class="line">[SwitchB-ospf-1-area-0.0.0.1] quit</span><br><span class="line">[SwitchB-ospf-1] quit</span><br></pre></td></tr></table></figure>

<p>   # 配置SwitchC。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[SwitchC] ospf 1 router-id 10.3.3.3</span><br><span class="line">[SwitchC-ospf-1] area 0</span><br><span class="line">[SwitchC-ospf-1-area-0.0.0.0] network 192.168.1.0 0.0.0.255</span><br><span class="line">[SwitchC-ospf-1-area-0.0.0.0] network 192.168.2.0 0.0.0.255</span><br><span class="line">[SwitchC-ospf-1-area-0.0.0.0] quit</span><br><span class="line">[SwitchC-ospf-1] quit</span><br></pre></td></tr></table></figure>

<p>   # 配置SwitchD。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[SwitchD] ospf 1 router-id 10.4.4.4</span><br><span class="line">[SwitchD-ospf-1] area 1</span><br><span class="line">[SwitchD-ospf-1-area-0.0.0.1] network 192.168.3.0 0.0.0.255</span><br><span class="line">[SwitchD-ospf-1-area-0.0.0.1] network 192.168.4.0 0.0.0.255</span><br><span class="line">[SwitchD-ospf-1-area-0.0.0.1] quit</span><br><span class="line">[SwitchD-ospf-1] quit</span><br></pre></td></tr></table></figure>



<ol start="4">
<li>配置Area1区域为NSSA区域</li>
</ol>
<p>   # 配置SwitchA。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] ospf 1</span><br><span class="line">[SwitchA-ospf-1] area 1</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.1] nssa</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.1] quit</span><br><span class="line">[SwitchA-ospf-1] quit</span><br></pre></td></tr></table></figure>

<p>   # 配置SwitchB。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[SwitchB] ospf 1</span><br><span class="line">[SwitchB-ospf-1] area 1</span><br><span class="line">[SwitchB-ospf-1-area-0.0.0.1] nssa</span><br><span class="line">[SwitchB-ospf-1-area-0.0.0.1] quit</span><br><span class="line">[SwitchB-ospf-1] quit</span><br></pre></td></tr></table></figure>

<p>   # 配置SwitchD。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[SwitchD] ospf 1</span><br><span class="line">[SwitchD-ospf-1] area 1</span><br><span class="line">[SwitchD-ospf-1-area-0.0.0.1] nssa</span><br><span class="line">[SwitchD-ospf-1-area-0.0.0.1] quit</span><br><span class="line">[SwitchD-ospf-1] quit</span><br></pre></td></tr></table></figure>



<ol start="5">
<li>配置SwitchD引入静态路由</li>
</ol>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[SwitchD] ip route-static 172.16.0.0 16 null 0</span><br><span class="line">[SwitchD] ospf 1</span><br><span class="line">[SwitchD-ospf-1] import-route static</span><br><span class="line">[SwitchD-ospf-1] quit</span><br></pre></td></tr></table></figure>

<p>   # 查看SwitchC的OSPF路由表。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[SwitchC] display ospf routing</span><br><span class="line"></span><br><span class="line">          OSPF Process 1 with Router ID 10.3.3.3</span><br><span class="line">                   Routing Tables</span><br><span class="line"></span><br><span class="line"> Routing for Network</span><br><span class="line"> Destination        Cost  Type       NextHop         AdvRouter       Area</span><br><span class="line"> 192.168.1.0&#x2F;24     1     Transit    192.168.1.2     10.3.3.3       0.0.0.0</span><br><span class="line"> 192.168.2.0&#x2F;24     1     Transit    192.168.2.2     10.3.3.3       0.0.0.0</span><br><span class="line"> 192.168.3.0&#x2F;24     2     Inter-area 192.168.1.1     10.1.1.1       0.0.0.0</span><br><span class="line"> 192.168.4.0&#x2F;24     2     Inter-area 192.168.2.1     10.2.2.2       0.0.0.0</span><br><span class="line"></span><br><span class="line"> Routing for ASEs</span><br><span class="line"> Destination        Cost      Type       Tag    NextHop         AdvRouter</span><br><span class="line"> 172.16.0.0&#x2F;16       1         Type2       1     192.168.1.1     10.2.2.2</span><br><span class="line"></span><br><span class="line"> Total Nets: 5</span><br><span class="line"> Intra Area: 2  Inter Area: 2  ASE: 1  NSSA: 0</span><br></pre></td></tr></table></figure>

<p>   从以上回显信息可以看出NSSA区域引入的AS外部路由是通过SwitchB向其他区域发布的，即SwitchB将Type7 LSA转换成了Type5 LSA。这是因为OSPF会选举Router ID较大的ABR作为转换路由器。</p>
<ol start="6">
<li>配置SwitchA为转换路由器</li>
</ol>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] ospf 1</span><br><span class="line">[SwitchA-ospf-1] area 1</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.1] nssa translator-always</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.1] quit</span><br><span class="line">[SwitchA-ospf-1] quit</span><br></pre></td></tr></table></figure>



<ol start="7">
<li>验证配置结果</li>
</ol>
<p>   # 等待40秒后，查看SwitchC的OSPF路由表。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[SwitchC] display ospf routing</span><br><span class="line"></span><br><span class="line">          OSPF Process 1 with Router ID 10.3.3.3</span><br><span class="line">                   Routing Tables</span><br><span class="line"></span><br><span class="line"> Routing for Network</span><br><span class="line"> Destination        Cost  Type       NextHop         AdvRouter       Area</span><br><span class="line"> 192.168.1.0&#x2F;24     1     Transit    192.168.1.2     10.3.3.3       0.0.0.0</span><br><span class="line"> 192.168.2.0&#x2F;24     1     Transit    192.168.2.2     10.3.3.3       0.0.0.0</span><br><span class="line"> 192.168.3.0&#x2F;24     2     Inter-area 192.168.1.1     10.1.1.1       0.0.0.0</span><br><span class="line"> 192.168.4.0&#x2F;24     2     Inter-area 192.168.2.1     10.2.2.2       0.0.0.0</span><br><span class="line"></span><br><span class="line"> Routing for ASEs</span><br><span class="line"> Destination        Cost      Type       Tag    NextHop         AdvRouter</span><br><span class="line"> 172.16.0.0&#x2F;16       1         Type2       1     192.168.1.1     10.1.1.1</span><br><span class="line"></span><br><span class="line"> Total Nets: 5</span><br><span class="line"> Intra Area: 2  Inter Area: 2  ASE: 1  NSSA: 0</span><br></pre></td></tr></table></figure>

<p>   从以上回显信息可以看出NSSA区域引入的AS外部路由是通过SwitchA向其他区域发布的，即SwitchA成了转换路由器。</p>
<pre><code>说明：</code></pre>
<p>   缺省情况下，新指定的转换路由器会和以前的转换路由器共同承担40s转换路由器的角色，过了40s后，只有新指定的转换路由器会继续完成转换路由器的工作。</p>
<h4 id="配置文件-3"><a href="#配置文件-3" class="headerlink" title="配置文件"></a>配置文件</h4><ul>
<li><p>SwitchA的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">sysname SwitchA</span><br><span class="line">#</span><br><span class="line">vlan batch 10 30</span><br><span class="line">#</span><br><span class="line">interface Vlanif10</span><br><span class="line"> ip address 192.168.1.1 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface Vlanif30</span><br><span class="line"> ip address 192.168.3.1 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 30</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;2</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 10</span><br><span class="line">#</span><br><span class="line">ospf 1 router-id 10.1.1.1</span><br><span class="line"> area 0.0.0.0</span><br><span class="line">  network 192.168.1.0 0.0.0.255</span><br><span class="line"> area 0.0.0.1</span><br><span class="line">  network 192.168.3.0 0.0.0.255</span><br><span class="line">  nssa translator-always</span><br><span class="line">#</span><br><span class="line">return</span><br></pre></td></tr></table></figure>
</li>
<li><p>SwitchB的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">sysname SwitchB</span><br><span class="line">#</span><br><span class="line">vlan batch 20 40</span><br><span class="line">#</span><br><span class="line">interface Vlanif20</span><br><span class="line"> ip address 192.168.2.1 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface Vlanif40</span><br><span class="line"> ip address 192.168.4.2 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 40</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;2</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 20</span><br><span class="line">#</span><br><span class="line">ospf 1 router-id 10.2.2.2</span><br><span class="line"> area 0.0.0.0</span><br><span class="line">  network 192.168.2.0 0.0.0.255</span><br><span class="line"> area 0.0.0.1</span><br><span class="line">  network 192.168.4.0 0.0.0.255</span><br><span class="line">  nssa</span><br><span class="line">#</span><br><span class="line">return</span><br></pre></td></tr></table></figure>
</li>
<li><p>SwitchC的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">sysname SwitchC</span><br><span class="line">#</span><br><span class="line">vlan batch 10 20</span><br><span class="line">#</span><br><span class="line">interface Vlanif10</span><br><span class="line"> ip address 192.168.1.2 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface Vlanif20</span><br><span class="line"> ip address 192.168.2.2 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 10</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;2</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 20</span><br><span class="line">#</span><br><span class="line">ospf 1 router-id 10.3.3.3</span><br><span class="line"> area 0.0.0.0</span><br><span class="line">  network 192.168.1.0 0.0.0.255</span><br><span class="line">  network 192.168.2.0 0.0.0.255</span><br><span class="line">#</span><br><span class="line">return</span><br></pre></td></tr></table></figure>
</li>
<li><p>SwitchD的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">sysname SwitchD</span><br><span class="line">#</span><br><span class="line">vlan batch 30 40</span><br><span class="line">#</span><br><span class="line">interface Vlanif30</span><br><span class="line"> ip address 192.168.3.2 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface Vlanif40</span><br><span class="line"> ip address 192.168.4.1 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 30</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;2</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 40</span><br><span class="line">#</span><br><span class="line">ospf 1 router-id 10.4.4.4</span><br><span class="line"> import-route static</span><br><span class="line"> area 0.0.0.1</span><br><span class="line">  network 192.168.3.0 0.0.0.255</span><br><span class="line">  network 192.168.4.0 0.0.0.255</span><br><span class="line">  nssa</span><br><span class="line">#</span><br><span class="line">ip route-static 172.16.0.0 255.255.0.0 NULL0</span><br><span class="line">#</span><br><span class="line">return</span><br></pre></td></tr></table></figure>





</li>
</ul>
<h3 id="6-24-5-配置OSPF负载分担示例"><a href="#6-24-5-配置OSPF负载分担示例" class="headerlink" title="6.24.5  配置OSPF负载分担示例"></a>6.24.5  配置OSPF负载分担示例</h3><h4 id="组网需求-4"><a href="#组网需求-4" class="headerlink" title="组网需求"></a>组网需求</h4><p>如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_cfg_ospf_108101">图6-73</a>所示，OSPF网络中有四台交换机，同属于区域0。要求配置负载分担，使得SwitchA流量，可以分别通过SwitchB和SwitchC送到SwitchD。</p>
<p> 说明：</p>
<p>请确保该场景下互联接口的STP处于未使能状态。因为在使能STP的环形网络中，如果用交换机的VLANIF接口构建三层网络，会导致某个端口被阻塞，从而导致三层业务不能正常运行。</p>
<p><strong>图6-73</strong>  配置OSPF负载分担组网图<br><img src="http://support.huawei.com/enterprise/product/images/92162df4db1843f7831569f36e16d00b" alt="img" loading="lazy"></p>
<h4 id="配置思路-4"><a href="#配置思路-4" class="headerlink" title="配置思路"></a>配置思路</h4><p>采用如下的思路配置OSPF的负载分担：</p>
<ol>
<li>在各交换机上配置OSPF基本功能，实现OSPF网络的基本互通。</li>
<li>在SwitchA配置负载分担，实现负载均衡的目的。</li>
</ol>
<h4 id="操作步骤-74"><a href="#操作步骤-74" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li>配置各接口所属VLAN</li>
</ol>
<p>   # 配置SwitchA。SwitchB、SwitchC和SwitchD的配置与SwitchA类似。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;HUAWEI&gt; system-view</span><br><span class="line">[HUAWEI] sysname SwitchA</span><br><span class="line">[SwitchA] vlan batch 10 20 50</span><br><span class="line">[SwitchA] interface gigabitethernet 0&#x2F;0&#x2F;1</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;1] port link-type trunk</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;1] port trunk allow-pass vlan 10</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;1] quit</span><br><span class="line">[SwitchA] interface gigabitethernet 0&#x2F;0&#x2F;2</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;2] port link-type trunk</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;2] port trunk allow-pass vlan 20</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;2] quit</span><br><span class="line">[SwitchA] interface gigabitethernet 0&#x2F;0&#x2F;3</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;3] port link-type trunk</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;3] port trunk allow-pass vlan 50</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;3] quit</span><br></pre></td></tr></table></figure>



<ol start="2">
<li>配置各VLANIF接口的IP地址</li>
</ol>
<p>   # 配置SwitchA。SwitchB、SwitchC和SwitchD的配置与SwitchA类似。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] interface vlanif 10</span><br><span class="line">[SwitchA-Vlanif10] ip address 10.1.1.1 24</span><br><span class="line">[SwitchA-Vlanif10] quit</span><br><span class="line">[SwitchA] interface vlanif 20</span><br><span class="line">[SwitchA-Vlanif20] ip address 10.1.2.1 24</span><br><span class="line">[SwitchA-Vlanif20] quit</span><br><span class="line">[SwitchA] interface vlanif 50</span><br><span class="line">[SwitchA-Vlanif50] ip address 172.16.1.1 24</span><br><span class="line">[SwitchA-Vlanif50] quit</span><br></pre></td></tr></table></figure>



<ol start="3">
<li>配置OSPF基本功能</li>
</ol>
<p>   # 配置SwitchA。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] ospf 1 router-id 10.10.10.1</span><br><span class="line">[SwitchA-ospf-1] area 0</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.0] network 172.16.1.0 0.0.0.255</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.0] network 10.1.1.0 0.0.0.255</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.0] network 10.1.2.0 0.0.0.255</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.0] quit</span><br><span class="line">[SwitchA-ospf-1] quit</span><br></pre></td></tr></table></figure>

<p>   # 配置SwitchB。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[SwitchB] ospf 1 router-id 10.10.10.2</span><br><span class="line">[SwitchB-ospf-1] area 0</span><br><span class="line">[SwitchB-ospf-1-area-0.0.0.0] network 10.1.1.0 0.0.0.255</span><br><span class="line">[SwitchB-ospf-1-area-0.0.0.0] network 192.168.0.0 0.0.0.255</span><br><span class="line">[SwitchB-ospf-1-area-0.0.0.0] quit</span><br><span class="line">[SwitchB-ospf-1] quit</span><br></pre></td></tr></table></figure>

<p>   # 配置SwitchC。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[SwitchC] ospf 1 router-id 10.10.10.3</span><br><span class="line">[SwitchC-ospf-1] area 0</span><br><span class="line">[SwitchC-ospf-1-area-0.0.0.0] network 10.1.2.0 0.0.0.255</span><br><span class="line">[SwitchC-ospf-1-area-0.0.0.0] network 192.168.1.0 0.0.0.255</span><br><span class="line">[SwitchC-ospf-1-area-0.0.0.0] quit</span><br><span class="line">[SwitchC-ospf-1] quit</span><br></pre></td></tr></table></figure>

<p>   # 配置SwitchD。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[SwitchD] ospf 1 router-id 10.10.10.4</span><br><span class="line">[SwitchD-ospf-1] area 0</span><br><span class="line">[SwitchD-ospf-1-area-0.0.0.0] network 192.168.0.0 0.0.0.255</span><br><span class="line">[SwitchD-ospf-1-area-0.0.0.0] network 192.168.1.0 0.0.0.255</span><br><span class="line">[SwitchD-ospf-1-area-0.0.0.0] network 172.17.1.0 0.0.0.255</span><br><span class="line">[SwitchD-ospf-1-area-0.0.0.0] quit</span><br><span class="line">[SwitchD-ospf-1] quit</span><br></pre></td></tr></table></figure>

<p>   # 查看SwitchA的路由表。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] display ip routing-table</span><br><span class="line">Route Flags: R - relay, D - download to fib</span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line">Routing Tables: Public</span><br><span class="line">         Destinations : 11       Routes : 12</span><br><span class="line"> </span><br><span class="line">Destination&#x2F;Mask    Proto   Pre  Cost      Flags NextHop         Interface </span><br><span class="line"> </span><br><span class="line">       10.1.1.0&#x2F;24  Direct  0    0           D   10.1.1.1        Vlanif10</span><br><span class="line">       10.1.1.1&#x2F;32  Direct  0    0           D   127.0.0.1       Vlanif10</span><br><span class="line">       10.1.2.0&#x2F;24  Direct  0    0           D   10.1.2.1        Vlanif20</span><br><span class="line">       10.1.2.1&#x2F;32  Direct  0    0           D   127.0.0.1       Vlanif20</span><br><span class="line">      127.0.0.0&#x2F;8   Direct  0    0           D   127.0.0.1       InLoopBack0</span><br><span class="line">      127.0.0.1&#x2F;32  Direct  0    0           D   127.0.0.1       InLoopBack0</span><br><span class="line">     172.16.1.0&#x2F;24  Direct  0    0           D   172.16.1.1      Vlanif50</span><br><span class="line">     172.16.1.1&#x2F;32  Direct  0    0           D   127.0.0.1       Vlanif50</span><br><span class="line">     172.17.1.0&#x2F;24  OSPF    10   3           D   10.1.1.2        Vlanif10</span><br><span class="line">                    OSPF    10   3           D   10.1.2.2        Vlanif20</span><br><span class="line">    192.168.0.0&#x2F;24  OSPF    10   2           D   10.1.1.2        Vlanif10</span><br><span class="line">    192.168.1.0&#x2F;24  OSPF    10   2           D   10.1.2.2        Vlanif20</span><br></pre></td></tr></table></figure>

<p>   从路由表可以看出，由于最大等价路由条数的缺省值为8，因此SwitchA的两个下一跳10.1.1.2（SwitchB）和10.1.2.2（SwitchC）均成为有效路由。</p>
<ol start="4">
<li>在SwitchA上配置等价路由优先级</li>
</ol>
<p>   如果不希望SwitchB和SwitchC形成负载分担，可以配置等价路由优先级，指定下一跳。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] ospf 1</span><br><span class="line">[SwitchA-ospf-1] nexthop 10.1.2.2 weight 1</span><br><span class="line">[SwitchA-ospf-1] quit</span><br></pre></td></tr></table></figure>

<p>   # 查看SwitchA的路由表</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] display ip routing-table</span><br><span class="line">Route Flags: R - relay, D - download to fib</span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line">Routing Tables: Public</span><br><span class="line">         Destinations : 11       Routes : 11</span><br><span class="line"> </span><br><span class="line">Destination&#x2F;Mask    Proto   Pre  Cost      Flags NextHop         Interface </span><br><span class="line"></span><br><span class="line">       10.1.1.0&#x2F;24  Direct  0    0           D   10.1.1.1        Vlanif10</span><br><span class="line">       10.1.1.1&#x2F;32  Direct  0    0           D   127.0.0.1       Vlanif10</span><br><span class="line">       10.1.2.0&#x2F;24  Direct  0    0           D   10.1.2.1        Vlanif20</span><br><span class="line">       10.1.2.1&#x2F;32  Direct  0    0           D   127.0.0.1       Vlanif20</span><br><span class="line">      127.0.0.0&#x2F;8   Direct  0    0           D   127.0.0.1       InLoopBack0</span><br><span class="line">      127.0.0.1&#x2F;32  Direct  0    0           D   127.0.0.1       InLoopBack0</span><br><span class="line">     172.16.1.0&#x2F;24  Direct  0    0           D   172.16.1.1      Vlanif50</span><br><span class="line">     172.16.1.1&#x2F;32  Direct  0    0           D   127.0.0.1       Vlanif50</span><br><span class="line">     172.17.1.0&#x2F;24  OSPF    10   3           D   10.1.2.2        Vlanif20</span><br><span class="line">    192.168.0.0&#x2F;24  OSPF    10   2           D   10.1.1.2        Vlanif10</span><br><span class="line">    192.168.1.0&#x2F;24  OSPF    10   2           D   10.1.2.2        Vlanif20</span><br></pre></td></tr></table></figure>

<p>   从路由表中可以看出，当配置等价路由的优先级后，由于下一跳为10.1.2.2（SwitchC）的优先级（权值为1）高于下一跳为10.1.1.2（SwitchB）的优先级，所以OSPF优先选择下一跳为10.1.2.2为唯一最优路由。</p>
<h4 id="配置文件-4"><a href="#配置文件-4" class="headerlink" title="配置文件"></a>配置文件</h4><ul>
<li><p>SwitchA的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">sysname SwitchA</span><br><span class="line">#</span><br><span class="line">vlan batch 10 20 50</span><br><span class="line">#</span><br><span class="line">interface Vlanif10</span><br><span class="line"> ip address 10.1.1.1 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface Vlanif20</span><br><span class="line"> ip address 10.1.2.1 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface Vlanif50</span><br><span class="line"> ip address 172.16.1.1 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 10</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;2</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 20</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;3</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 50</span><br><span class="line">#</span><br><span class="line">ospf 1 router-id 10.10.10.1</span><br><span class="line"> nexthop 10.1.2.2 weight 1</span><br><span class="line"> area 0.0.0.0</span><br><span class="line">  network 10.1.1.0 0.0.0.255</span><br><span class="line">  network 10.1.2.0 0.0.0.255</span><br><span class="line">  network 172.16.1.0 0.0.0.255</span><br><span class="line">#</span><br><span class="line">return</span><br></pre></td></tr></table></figure>
</li>
<li><p>SwitchB的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">sysname SwitchB</span><br><span class="line">#</span><br><span class="line">vlan batch 10 30</span><br><span class="line">#</span><br><span class="line">interface Vlanif10</span><br><span class="line"> ip address 10.1.1.2 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface Vlanif30</span><br><span class="line"> ip address 192.168.0.1 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 10</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;2</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 30</span><br><span class="line">#</span><br><span class="line">ospf 1 router-id 10.10.10.2</span><br><span class="line"> area 0.0.0.0</span><br><span class="line">  network 10.1.1.0 0.0.0.255</span><br><span class="line">  network 192.168.0.0 0.0.0.255</span><br><span class="line">#</span><br><span class="line">return</span><br></pre></td></tr></table></figure>
</li>
<li><p>SwitchC的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">sysname SwitchC</span><br><span class="line">#</span><br><span class="line">vlan batch 20 40</span><br><span class="line">#</span><br><span class="line">interface Vlanif20</span><br><span class="line"> ip address 10.1.2.2 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface Vlanif40</span><br><span class="line"> ip address 192.168.1.1 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 20</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;2</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 40</span><br><span class="line">#</span><br><span class="line">ospf 1 router-id 10.10.10.3</span><br><span class="line"> area 0.0.0.0</span><br><span class="line">  network 10.1.2.0 0.0.0.255</span><br><span class="line">  network 192.168.1.0 0.0.0.255</span><br><span class="line">#</span><br><span class="line">return </span><br></pre></td></tr></table></figure>
</li>
<li><p>SwitchD的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">sysname SwitchD</span><br><span class="line">#</span><br><span class="line">vlan batch 30 40 60</span><br><span class="line">#</span><br><span class="line">interface Vlanif30</span><br><span class="line"> ip address 192.168.0.2 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface Vlanif40</span><br><span class="line"> ip address 192.168.1.2 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface Vlanif60</span><br><span class="line"> ip address 172.17.1.1 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 30</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;2</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 40</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;3</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 60</span><br><span class="line">#</span><br><span class="line">ospf 1 router-id 10.10.10.4</span><br><span class="line"> area 0.0.0.0</span><br><span class="line">  network 172.17.1.0 0.0.0.255</span><br><span class="line">  network 192.168.0.0 0.0.0.255</span><br><span class="line">  network 192.168.1.0 0.0.0.255</span><br><span class="line">#</span><br><span class="line">return</span><br></pre></td></tr></table></figure>





</li>
</ul>
<h3 id="6-24-6-配置OSPF-BGP联动特性示例"><a href="#6-24-6-配置OSPF-BGP联动特性示例" class="headerlink" title="6.24.6  配置OSPF-BGP联动特性示例"></a>6.24.6  配置OSPF-BGP联动特性示例</h3><h4 id="组网需求-5"><a href="#组网需求-5" class="headerlink" title="组网需求"></a>组网需求</h4><p>如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_cfg_ospf_108301">图6-74</a>所示，SwitchD和SwitchE之间建立EBGP连接。在AS10内的交换机之间建立IBGP连接，并且使用OSPF作为IGP协议。要求在SwitchB上使能OSPF-BGP联动功能，使得当SwitchB重启后，从SwitchA到AS20的流量不发生中断。</p>
<p> 说明：</p>
<p>请确保该场景下互联接口的STP处于未使能状态。因为在使能STP的环形网络中，如果用交换机的VLANIF接口构建三层网络，会导致某个端口被阻塞，从而导致三层业务不能正常运行。</p>
<p><strong>图6-74</strong>  配置OSPF-BGP联动组网图<br><img src="http://support.huawei.com/enterprise/product/images/94d35e91310e44d5af19e6d0ccad3845" alt="img" loading="lazy"></p>
<h4 id="配置思路-5"><a href="#配置思路-5" class="headerlink" title="配置思路"></a>配置思路</h4><p>采用如下的思路配置OSPF-BGP联动功能。</p>
<ol>
<li>在各交换机的VLANIF接口上配置IP地址并配置各接口所属VLAN，实现网段内的互通。</li>
<li>在SwitchA、SwitchB、SwitchC和SwitchD（除去10.2.1.1/30）上配置OSPF基本功能和IBGP连接，实现AS10内设备互通。</li>
<li>在SwitchD和SwitchE之间配置EBGP连接并引入直连路由和OSPF路由，实现AS10与AS20之间互通。</li>
<li>在SwitchC上配置OSPF协议的开销值为2，实现SwitchA只选择SwitchB作为到10.2.1.0网段的中间路由器，SwitchC成为SwitchB的备份路由器。</li>
<li>在SwitchB上配置OSPF-BGP联动功能，实现BGP当SwitchB重启后，从SwitchA到AS20的流量不发生中断。</li>
</ol>
<h4 id="操作步骤-75"><a href="#操作步骤-75" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li>配置各接口所属VLAN</li>
</ol>
<p>   # 配置SwitchA。SwitchB、SwitchC、SwitchD和SwitchE的配置与SwitchA类似。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;HUAWEI&gt; system-view</span><br><span class="line">[HUAWEI] sysname SwitchA</span><br><span class="line">[SwitchA] vlan batch 10 20</span><br><span class="line">[SwitchA] interface gigabitethernet 0&#x2F;0&#x2F;1</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;1] port link-type trunk</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;1] port trunk allow-pass vlan 10</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;1] quit</span><br><span class="line">[SwitchA] interface gigabitethernet 0&#x2F;0&#x2F;2</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;2] port link-type trunk</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;2] port trunk allow-pass vlan 20</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;2] quit</span><br></pre></td></tr></table></figure>



<ol start="2">
<li>配置各VLANIF接口和LoopBack接口的IP地址</li>
</ol>
<p>   # 配置SwitchA。SwitchB、SwitchC、SwitchD和SwitchE的配置与SwitchA类似。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] interface vlanif 10</span><br><span class="line">[SwitchA-Vlanif10] ip address 10.1.1.1 30</span><br><span class="line">[SwitchA-Vlanif10] quit</span><br><span class="line">[SwitchA] interface vlanif 20</span><br><span class="line">[SwitchA-Vlanif20] ip address 10.1.2.1 30</span><br><span class="line">[SwitchA-Vlanif20] quit</span><br><span class="line">[SwitchA] interface loopback 0</span><br><span class="line">[SwitchA-LoopBack0] ip address 10.10.10.1 32</span><br><span class="line">[SwitchA-LoopBack0] quit</span><br></pre></td></tr></table></figure>



<ol start="3">
<li>配置OSPF的基本功能</li>
</ol>
<p>   # 配置SwitchA。SwitchB、SwitchC和SwitchD的配置与SwitchA类似。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] router id 10.10.10.1</span><br><span class="line">[SwitchA] ospf 1</span><br><span class="line">[SwitchA-ospf-1] area 0</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.0] network 10.10.10.1 0.0.0.0</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.0] network 10.1.1.0 0.0.0.3</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.0] network 10.1.2.0 0.0.0.3</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.0] quit</span><br><span class="line">[SwitchA-ospf-1] quit</span><br></pre></td></tr></table></figure>



<ol start="4">
<li>配置IBGP全连接</li>
</ol>
<p>   # 配置SwitchA。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] bgp 10</span><br><span class="line">[SwitchA-bgp] peer 10.10.10.2 as-number 10</span><br><span class="line">[SwitchA-bgp] peer 10.10.10.2 connect-interface LoopBack 0</span><br><span class="line">[SwitchA-bgp] peer 10.10.10.3 as-number 10</span><br><span class="line">[SwitchA-bgp] peer 10.10.10.3 connect-interface LoopBack 0</span><br><span class="line">[SwitchA-bgp] peer 10.10.10.4 as-number 10</span><br><span class="line">[SwitchA-bgp] peer 10.10.10.4 connect-interface LoopBack 0</span><br><span class="line">[SwitchA-bgp] quit</span><br></pre></td></tr></table></figure>

<p>   # 配置SwitchB。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[SwitchB] bgp 10</span><br><span class="line">[SwitchB-bgp] peer 10.10.10.1 as-number 10</span><br><span class="line">[SwitchB-bgp] peer 10.10.10.1 connect-interface LoopBack 0</span><br><span class="line">[SwitchB-bgp] peer 10.10.10.3 as-number 10</span><br><span class="line">[SwitchB-bgp] peer 10.10.10.3 connect-interface LoopBack 0</span><br><span class="line">[SwitchB-bgp] peer 10.10.10.4 as-number 10</span><br><span class="line">[SwitchB-bgp] peer 10.10.10.4 connect-interface LoopBack 0</span><br><span class="line">[SwitchB-bgp] quit</span><br></pre></td></tr></table></figure>

<p>   # 配置SwitchC。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[SwitchC] bgp 10</span><br><span class="line">[SwitchC-bgp] peer 10.10.10.1 as-number 10</span><br><span class="line">[SwitchC-bgp] peer 10.10.10.1 connect-interface LoopBack 0</span><br><span class="line">[SwitchC-bgp] peer 10.10.10.2 as-number 10</span><br><span class="line">[SwitchC-bgp] peer 10.10.10.2 connect-interface LoopBack 0</span><br><span class="line">[SwitchC-bgp] peer 10.10.10.4 as-number 10</span><br><span class="line">[SwitchC-bgp] peer 10.10.10.4 connect-interface LoopBack 0</span><br><span class="line">[SwitchC-bgp] quit</span><br></pre></td></tr></table></figure>

<p>   # 配置SwitchD。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[SwitchD] bgp 10</span><br><span class="line">[SwitchD-bgp] peer 10.10.10.1 as-number 10</span><br><span class="line">[SwitchD-bgp] peer 10.10.10.1 connect-interface LoopBack 0</span><br><span class="line">[SwitchD-bgp] peer 10.10.10.2 as-number 10</span><br><span class="line">[SwitchD-bgp] peer 10.10.10.2 connect-interface LoopBack 0</span><br><span class="line">[SwitchD-bgp] peer 10.10.10.3 as-number 10</span><br><span class="line">[SwitchD-bgp] peer 10.10.10.3 connect-interface LoopBack 0</span><br><span class="line">[SwitchD-bgp] quit</span><br></pre></td></tr></table></figure>



<ol start="5">
<li>配置EBGP连接</li>
</ol>
<p>   # 配置SwitchD。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[SwitchD] bgp 10</span><br><span class="line">[SwitchD-bgp] peer 10.2.1.2 as-number 20</span><br><span class="line">[SwitchD-bgp] import-route direct</span><br><span class="line">[SwitchD-bgp] import-route ospf 1</span><br><span class="line">[SwitchD-bgp] quit</span><br></pre></td></tr></table></figure>

<p>   # 配置SwitchE。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[SwitchE] bgp 20</span><br><span class="line">[SwitchE-bgp] router-id 10.10.10.5</span><br><span class="line">[SwitchE-bgp] peer 10.2.1.1 as-number 10</span><br><span class="line">[SwitchE-bgp] ipv4-family unicast</span><br><span class="line">[SwitchE-bgp-af-ipv4] network 10.3.1.0 30</span><br><span class="line">[SwitchE-bgp-af-ipv4] quit</span><br><span class="line">[SwitchE-bgp] quit</span><br></pre></td></tr></table></figure>



<ol start="6">
<li>配置SwitchC上OSPF协议的开销值</li>
</ol>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[SwitchC] interface vlanif 20</span><br><span class="line">[SwitchC-Vlanif20] ospf cost 2</span><br><span class="line">[SwitchC-Vlanif20] quit</span><br><span class="line">[SwitchC] interface vlanif 30</span><br><span class="line">[SwitchC-Vlanif30] ospf cost 2</span><br><span class="line">[SwitchC-Vlanif30] quit</span><br></pre></td></tr></table></figure>

<p>   # 查看SwitchA的路由表。从路由表中可以看出，通过BGP协议可以学习到目标网段10.3.1.0的路由，出接口是Vlanif10。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] display ip routing-table</span><br><span class="line">Route Flags: R - relay, D - download to fib </span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line">Routing Tables: Public </span><br><span class="line">         Destinations : 14       Routes : 15 </span><br><span class="line"></span><br><span class="line">Destination&#x2F;Mask    Proto   Pre  Cost      Flags NextHop         Interface </span><br><span class="line"></span><br><span class="line">       10.1.1.0&#x2F;30  Direct  0    0           D   10.1.1.1        Vlanif10      </span><br><span class="line">       10.1.1.1&#x2F;32  Direct  0    0           D   127.0.0.1       Vlanif10      </span><br><span class="line">       10.1.2.0&#x2F;30  Direct  0    0           D   10.1.2.1        Vlanif20      </span><br><span class="line">       10.1.2.1&#x2F;32  Direct  0    0           D   127.0.0.1       Vlanif20      </span><br><span class="line">       10.1.3.0&#x2F;30  OSPF    10   2           D   10.1.1.2        Vlanif10      </span><br><span class="line">       10.1.4.0&#x2F;30  OSPF    10   3           D   10.1.2.2        Vlanif20      </span><br><span class="line">                    OSPF    10   3           D   10.1.1.2        Vlanif10      </span><br><span class="line">       10.2.1.0&#x2F;30  IBGP    255  0          RD   10.10.10.4      Vlanif10      </span><br><span class="line">       10.3.1.0&#x2F;30  IBGP    255  0          RD   10.2.1.2        Vlanif10      </span><br><span class="line">     10.10.10.1&#x2F;32  Direct  0    0           D   127.0.0.1       LoopBack0     </span><br><span class="line">     10.10.10.2&#x2F;32  OSPF    10   1           D   10.1.1.2        Vlanif10      </span><br><span class="line">     10.10.10.3&#x2F;32  OSPF    10   1           D   10.1.2.2        Vlanif20      </span><br><span class="line">     10.10.10.4&#x2F;32  OSPF    10   2           D   10.1.1.2        Vlanif10      </span><br><span class="line">      127.0.0.0&#x2F;8   Direct  0    0           D   127.0.0.1       InLoopBack0   </span><br><span class="line">      127.0.0.1&#x2F;32  Direct  0    0           D   127.0.0.1       InLoopBack0   </span><br></pre></td></tr></table></figure>

<p>   # 查看SwitchB的路由表。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[SwitchB] display ip routing-table</span><br><span class="line">Route Flags: R - relay, D - download to fib </span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line">Routing Tables: Public </span><br><span class="line">         Destinations : 14       Routes : 15 </span><br><span class="line"></span><br><span class="line">Destination&#x2F;Mask    Proto   Pre  Cost      Flags NextHop         Interface </span><br><span class="line"></span><br><span class="line">       10.1.1.0&#x2F;30  Direct  0    0           D   10.1.1.2        Vlanif10      </span><br><span class="line">       10.1.1.2&#x2F;32  Direct  0    0           D   127.0.0.1       Vlanif10      </span><br><span class="line">       10.1.2.0&#x2F;30  OSPF    10   2           D   10.1.1.1        Vlanif10      </span><br><span class="line">       10.1.3.0&#x2F;30  Direct  0    0           D   10.1.3.1        Vlanif40      </span><br><span class="line">       10.1.3.1&#x2F;32  Direct  0    0           D   127.0.0.1       Vlanif40      </span><br><span class="line">       10.1.4.0&#x2F;30  OSPF    10   2           D   10.1.3.2        Vlanif40      </span><br><span class="line">       10.2.1.0&#x2F;30  IBGP    255  0          RD   10.10.10.4      Vlanif40      </span><br><span class="line">       10.3.1.0&#x2F;30  IBGP    255  0          RD   10.2.1.2        Vlanif40      </span><br><span class="line">     10.10.10.1&#x2F;32  OSPF    10   1           D   10.1.1.1        Vlanif10      </span><br><span class="line">     10.10.10.2&#x2F;32  Direct  0    0           D   127.0.0.1       LoopBack0     </span><br><span class="line">     10.10.10.3&#x2F;32  OSPF    10   2           D   10.1.1.1        Vlanif10      </span><br><span class="line">                    OSPF    10   2           D   10.1.3.2        Vlanif40      </span><br><span class="line">     10.10.10.4&#x2F;32  OSPF    10   1           D   10.1.3.2        Vlanif40      </span><br><span class="line">      127.0.0.0&#x2F;8   Direct  0    0           D   127.0.0.1       InLoopBack0   </span><br><span class="line">      127.0.0.1&#x2F;32  Direct  0    0           D   127.0.0.1       InLoopBack0   </span><br></pre></td></tr></table></figure>

<p>   从路由表中可以看出，SwitchB通过BGP协议可以学习到目标网段10.3.1.0的路由，出接口是Vlanif40。通过OSPF协议可以学习到目标网段10.1.2.0和10.1.4.0的路由，路由开销都是2。</p>
<ol start="7">
<li>在SwitchB上配置OSPF-BGP联动功能</li>
</ol>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[SwitchB] ospf</span><br><span class="line">[SwitchB-ospf-1] stub-router on-startup</span><br><span class="line">[SwitchB-ospf-1] return</span><br></pre></td></tr></table></figure>



<ol start="8">
<li>查看配置结果</li>
</ol>
<p>   # 保存配置。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;SwitchB&gt; save</span><br></pre></td></tr></table></figure>

<p>   系统会提示将当前配置保存至设备，是否继续，输入<strong>y</strong>即可。</p>
<p>   # 重启SwitchB</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;SwitchB&gt; reboot</span><br></pre></td></tr></table></figure>

<p>   系统会提示即将重新启动，是否继续，输入<strong>y</strong>即可。</p>
<p>   # 查看SwitchA的路由表。从路由表中可以看出，通过BGP协议可以学习到目标网段10.3.1.0的路由，出接口变为Vlanif20。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] display ip routing-table</span><br><span class="line">Route Flags: R - relay, D - download to fib </span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line">Routing Tables: Public </span><br><span class="line">         Destinations : 10       Routes : 10 </span><br><span class="line"></span><br><span class="line">Destination&#x2F;Mask    Proto   Pre  Cost      Flags NextHop         Interface </span><br><span class="line"></span><br><span class="line">       10.1.2.0&#x2F;30  Direct  0    0           D   10.1.2.1        Vlanif20      </span><br><span class="line">       10.1.2.1&#x2F;32  Direct  0    0           D   127.0.0.1       Vlanif20      </span><br><span class="line">       10.1.4.0&#x2F;30  OSPF    10   3           D   10.1.2.2        Vlanif20      </span><br><span class="line">       10.2.1.0&#x2F;30  IBGP    255  0          RD   10.10.10.4      Vlanif20      </span><br><span class="line">       10.3.1.0&#x2F;30  IBGP    255  0          RD   10.2.1.2        Vlanif20      </span><br><span class="line">     10.10.10.1&#x2F;32  Direct  0    0           D   127.0.0.1       LoopBack0     </span><br><span class="line">     10.10.10.3&#x2F;32  OSPF    10   1           D   10.1.2.2        Vlanif20      </span><br><span class="line">     10.10.10.4&#x2F;32  OSPF    10   3           D   10.1.2.2        Vlanif20      </span><br><span class="line">      127.0.0.0&#x2F;8   Direct  0    0           D   127.0.0.1       InLoopBack0   </span><br><span class="line">      127.0.0.1&#x2F;32  Direct  0    0           D   127.0.0.1       InLoopBack0   </span><br></pre></td></tr></table></figure>

<p>   # 查看SwitchB的路由表。从路由表中可以看出，由于IGP收敛速度比BGP快，所以路由表中暂时只有OSPF路由，并且开销值都已变为较大的数（≥65535）。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;SwitchB&gt; display ip routing-table</span><br><span class="line">Route Flags: R - relay, D - download to fib </span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line">Routing Tables: Public </span><br><span class="line">         Destinations : 12       Routes : 13 </span><br><span class="line"></span><br><span class="line">Destination&#x2F;Mask    Proto   Pre  Cost      Flags NextHop         Interface        </span><br><span class="line"></span><br><span class="line">       10.1.1.0&#x2F;30  Direct  0    0           D   10.1.1.2        Vlanif10      </span><br><span class="line">       10.1.1.2&#x2F;32  Direct  0    0           D   127.0.0.1       Vlanif10      </span><br><span class="line">       10.1.2.0&#x2F;30  OSPF    10   65536       D   10.1.1.1        Vlanif10      </span><br><span class="line">       10.1.3.0&#x2F;30  Direct  0    0           D   10.1.3.1        Vlanif40      </span><br><span class="line">       10.1.3.1&#x2F;32  Direct  0    0           D   127.0.0.1       Vlanif40      </span><br><span class="line">       10.1.4.0&#x2F;30  OSPF    10   65536       D   10.1.3.2        Vlanif40      </span><br><span class="line">     10.10.10.1&#x2F;32  OSPF    10   65535       D   10.1.1.1        Vlanif10      </span><br><span class="line">     10.10.10.2&#x2F;32  Direct  0    0           D   127.0.0.1       LoopBack0     </span><br><span class="line">     10.10.10.3&#x2F;32  OSPF    10   65536       D   10.1.1.1        Vlanif10      </span><br><span class="line">                    OSPF    10   65536       D   10.1.3.2        Vlanif40      </span><br><span class="line">     10.10.10.4&#x2F;32  OSPF    10   65535       D   10.1.3.2        Vlanif40      </span><br><span class="line">      127.0.0.0&#x2F;8   Direct  0    0           D   127.0.0.1       InLoopBack0   </span><br><span class="line">      127.0.0.1&#x2F;32  Direct  0    0           D   127.0.0.1       InLoopBack0   </span><br></pre></td></tr></table></figure>

<p>   # 在网络稳定后，再次查看SwitchB的路由表。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;SwitchB&gt; display ip routing-table</span><br><span class="line">Route Flags: R - relay, D - download to fib</span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line">Routing Tables: Public </span><br><span class="line">         Destinations : 14       Routes : 15 </span><br><span class="line"></span><br><span class="line">Destination&#x2F;Mask    Proto   Pre  Cost      Flags NextHop         Interface        </span><br><span class="line"></span><br><span class="line">       10.1.1.0&#x2F;30  Direct  0    0           D   10.1.1.2        Vlanif10      </span><br><span class="line">       10.1.1.2&#x2F;32  Direct  0    0           D   127.0.0.1       Vlanif10      </span><br><span class="line">       10.1.2.0&#x2F;30  OSPF    10   2           D   10.1.1.1        Vlanif10      </span><br><span class="line">       10.1.3.0&#x2F;30  Direct  0    0           D   10.1.3.1        Vlanif40      </span><br><span class="line">       10.1.3.1&#x2F;32  Direct  0    0           D   127.0.0.1       Vlanif40      </span><br><span class="line">       10.1.4.0&#x2F;30  OSPF    10   2           D   10.1.3.2        Vlanif40      </span><br><span class="line">       10.2.1.0&#x2F;30  IBGP    255  0          RD   10.10.10.4      Vlanif40      </span><br><span class="line">       10.3.1.0&#x2F;30  IBGP    255  0          RD   10.2.1.2        Vlanif40      </span><br><span class="line">     10.10.10.1&#x2F;32  OSPF    10   1           D   10.1.1.1        Vlanif10      </span><br><span class="line">     10.10.10.2&#x2F;32  Direct  0    0           D   127.0.0.1       LoopBack0     </span><br><span class="line">     10.10.10.3&#x2F;32  OSPF    10   2           D   10.1.1.1        Vlanif10      </span><br><span class="line">                    OSPF    10   2           D   10.1.3.2        Vlanif40      </span><br><span class="line">     10.10.10.4&#x2F;32  OSPF    10   1           D   10.1.3.2        Vlanif40      </span><br><span class="line">      127.0.0.0&#x2F;8   Direct  0    0           D   127.0.0.1       InLoopBack0   </span><br><span class="line">      127.0.0.1&#x2F;32  Direct  0    0           D   127.0.0.1       InLoopBack0   </span><br></pre></td></tr></table></figure>

<p>   从路由表中可以看出，当SwitchB上的BGP完全收敛后，路由信息又恢复到重启前的内容。</p>
<h4 id="配置文件-5"><a href="#配置文件-5" class="headerlink" title="配置文件"></a>配置文件</h4><ul>
<li><p>SwitchA的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">sysname SwitchA</span><br><span class="line">#</span><br><span class="line">router id 10.10.10.1</span><br><span class="line">#</span><br><span class="line">vlan batch 10 20</span><br><span class="line">#</span><br><span class="line">interface Vlanif10</span><br><span class="line"> ip address 10.1.1.1 255.255.255.252</span><br><span class="line">#</span><br><span class="line">interface Vlanif20</span><br><span class="line"> ip address 10.1.2.1 255.255.255.252</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 10</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;2</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 20</span><br><span class="line">#</span><br><span class="line">interface LoopBack0</span><br><span class="line"> ip address 10.10.10.1 255.255.255.255</span><br><span class="line">#</span><br><span class="line">bgp 10</span><br><span class="line"> peer 10.10.10.2 as-number 10</span><br><span class="line"> peer 10.10.10.2 connect-interface LoopBack0</span><br><span class="line"> peer 10.10.10.3 as-number 10</span><br><span class="line"> peer 10.10.10.3 connect-interface LoopBack0</span><br><span class="line"> peer 10.10.10.4 as-number 10</span><br><span class="line"> peer 10.10.10.4 connect-interface LoopBack0</span><br><span class="line"> #</span><br><span class="line"> ipv4-family unicast</span><br><span class="line">  undo synchronization</span><br><span class="line">  peer 10.10.10.2 enable</span><br><span class="line">  peer 10.10.10.3 enable</span><br><span class="line">  peer 10.10.10.4 enable</span><br><span class="line">#</span><br><span class="line">ospf 1</span><br><span class="line"> area 0.0.0.0</span><br><span class="line">  network 10.1.1.0 0.0.0.3</span><br><span class="line">  network 10.1.2.0 0.0.0.3</span><br><span class="line">  network 10.10.10.1 0.0.0.0</span><br><span class="line">#</span><br><span class="line">return</span><br></pre></td></tr></table></figure>
</li>
<li><p>SwitchB的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">sysname SwitchB</span><br><span class="line">#</span><br><span class="line">router id 10.10.10.2</span><br><span class="line">#</span><br><span class="line">vlan batch 10 40</span><br><span class="line">#</span><br><span class="line">interface Vlanif10</span><br><span class="line"> ip address 10.1.1.2 255.255.255.252</span><br><span class="line">#</span><br><span class="line">interface Vlanif40</span><br><span class="line"> ip address 10.1.3.1 255.255.255.252</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 10</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;2</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 40</span><br><span class="line">#</span><br><span class="line">interface LoopBack0</span><br><span class="line"> ip address 10.10.10.2 255.255.255.255</span><br><span class="line">#</span><br><span class="line">bgp 10</span><br><span class="line"> peer 10.10.10.1 as-number 10</span><br><span class="line"> peer 10.10.10.1 connect-interface LoopBack0</span><br><span class="line"> peer 10.10.10.3 as-number 10</span><br><span class="line"> peer 10.10.10.3 connect-interface LoopBack0</span><br><span class="line"> peer 10.10.10.4 as-number 10</span><br><span class="line"> peer 10.10.10.4 connect-interface LoopBack0</span><br><span class="line"> #</span><br><span class="line"> ipv4-family unicast</span><br><span class="line">  undo synchronization</span><br><span class="line">  peer 10.10.10.1 enable</span><br><span class="line">  peer 10.10.10.3 enable</span><br><span class="line">  peer 10.10.10.4 enable</span><br><span class="line">#</span><br><span class="line">ospf 1</span><br><span class="line"> stub-router on-startup</span><br><span class="line"> area 0.0.0.0</span><br><span class="line">  network 10.1.1.0 0.0.0.3</span><br><span class="line">  network 10.1.3.0 0.0.0.3</span><br><span class="line">  network 10.10.10.2 0.0.0.0</span><br><span class="line">#</span><br><span class="line">return</span><br></pre></td></tr></table></figure>
</li>
<li><p>SwitchC的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">sysname SwitchC</span><br><span class="line">#</span><br><span class="line">router id 10.10.10.3</span><br><span class="line">#</span><br><span class="line">vlan batch 20 30</span><br><span class="line">#</span><br><span class="line">interface Vlanif20</span><br><span class="line"> ip address 10.1.2.2 255.255.255.252</span><br><span class="line"> ospf cost 2</span><br><span class="line">#</span><br><span class="line">interface Vlanif30</span><br><span class="line"> ip address 10.1.4.1 255.255.255.252</span><br><span class="line"> ospf cost 2</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 30</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;2</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 20</span><br><span class="line">#</span><br><span class="line">interface LoopBack0</span><br><span class="line"> ip address 10.10.10.3 255.255.255.255</span><br><span class="line">#</span><br><span class="line">bgp 10</span><br><span class="line"> peer 10.10.10.1 as-number 10</span><br><span class="line"> peer 10.10.10.1 connect-interface LoopBack0</span><br><span class="line"> peer 10.10.10.2 as-number 10</span><br><span class="line"> peer 10.10.10.2 connect-interface LoopBack0</span><br><span class="line"> peer 10.10.10.4 as-number 10</span><br><span class="line"> peer 10.10.10.4 connect-interface LoopBack0</span><br><span class="line"> #</span><br><span class="line"> ipv4-family unicast</span><br><span class="line">  undo synchronization</span><br><span class="line">  peer 10.10.10.1 enable</span><br><span class="line">  peer 10.10.10.2 enable</span><br><span class="line">  peer 10.10.10.4 enable</span><br><span class="line">#</span><br><span class="line">ospf 1</span><br><span class="line"> area 0.0.0.0</span><br><span class="line">  network 10.1.2.0 0.0.0.3</span><br><span class="line">  network 10.1.4.0 0.0.0.3</span><br><span class="line">  network 10.10.10.3 0.0.0.0</span><br><span class="line">#</span><br><span class="line">return</span><br></pre></td></tr></table></figure>
</li>
<li><p>SwitchD的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">sysname SwitchD</span><br><span class="line">#</span><br><span class="line">router id 10.10.10.4</span><br><span class="line">#</span><br><span class="line">vlan batch 30 40 50</span><br><span class="line">#</span><br><span class="line">interface Vlanif30</span><br><span class="line"> ip address 10.1.4.2 255.255.255.252</span><br><span class="line">#</span><br><span class="line">interface Vlanif40</span><br><span class="line"> ip address 10.1.3.2 255.255.255.252</span><br><span class="line">#</span><br><span class="line">interface Vlanif50</span><br><span class="line"> ip address 10.2.1.1 255.255.255.252</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 30</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;2</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 40</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;3</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 50</span><br><span class="line">#</span><br><span class="line">interface LoopBack0</span><br><span class="line"> ip address 10.10.10.4 255.255.255.255</span><br><span class="line">#</span><br><span class="line">bgp 10</span><br><span class="line"> peer 10.10.10.1 as-number 10</span><br><span class="line"> peer 10.10.10.1 connect-interface LoopBack0</span><br><span class="line"> peer 10.10.10.2 as-number 10</span><br><span class="line"> peer 10.10.10.2 connect-interface LoopBack0</span><br><span class="line"> peer 10.10.10.3 as-number 10</span><br><span class="line"> peer 10.10.10.3 connect-interface LoopBack0</span><br><span class="line"> peer 10.2.1.2 as-number 20</span><br><span class="line"> #</span><br><span class="line"> ipv4-family unicast</span><br><span class="line">  undo synchronization</span><br><span class="line">  import-route direct</span><br><span class="line">  import-route ospf 1</span><br><span class="line">  peer 10.10.10.1 enable</span><br><span class="line">  peer 10.10.10.2 enable</span><br><span class="line">  peer 10.10.10.3 enable</span><br><span class="line">  peer 10.2.1.2 enable</span><br><span class="line">#</span><br><span class="line">ospf 1</span><br><span class="line"> area 0.0.0.0</span><br><span class="line">  network 10.1.3.0 0.0.0.3</span><br><span class="line">  network 10.1.4.0 0.0.0.3</span><br><span class="line">  network 10.10.10.4 0.0.0.0</span><br><span class="line">#</span><br><span class="line">return</span><br></pre></td></tr></table></figure>
</li>
<li><p>SwitchE的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">sysname SwitchE</span><br><span class="line">#</span><br><span class="line">vlan batch 50 60</span><br><span class="line">#</span><br><span class="line">interface Vlanif50</span><br><span class="line"> ip address 10.2.1.2 255.255.255.252</span><br><span class="line">#</span><br><span class="line">interface Vlanif60</span><br><span class="line"> ip address 10.3.1.1 255.255.255.252</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 50</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;2</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 60</span><br><span class="line">#</span><br><span class="line">interface LoopBack0</span><br><span class="line"> ip address 10.10.10.5 255.255.255.255</span><br><span class="line">#</span><br><span class="line">bgp 20</span><br><span class="line"> router-id 10.10.10.5</span><br><span class="line"> peer 10.2.1.1 as-number 10</span><br><span class="line"> #</span><br><span class="line"> ipv4-family unicast</span><br><span class="line">  undo synchronization</span><br><span class="line">  network 10.3.1.0 255.255.255.252</span><br><span class="line">  peer 10.2.1.1 enable</span><br><span class="line">#</span><br><span class="line">return</span><br></pre></td></tr></table></figure>





</li>
</ul>
<h3 id="6-24-7-配置OSPF-GR特性示例"><a href="#6-24-7-配置OSPF-GR特性示例" class="headerlink" title="6.24.7  配置OSPF GR特性示例"></a>6.24.7  配置OSPF GR特性示例</h3><h4 id="组网需求-6"><a href="#组网需求-6" class="headerlink" title="组网需求"></a>组网需求</h4><p>如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_cfg_ospf_108401">图6-75</a>所示，三台设备之间运行OSPF协议，整个OSPF网络被划分为Area0和Area1两个区域。现要求在SwitchC上运行的OSPF协议重启过程中不影响数据的正常转发。</p>
<p><strong>图6-75</strong>  OSPF GR的配置举例<br><img src="http://support.huawei.com/enterprise/product/images/b6708e9072ab4319ac3ad1663d47682f" alt="img" loading="lazy"></p>
<h4 id="配置思路-6"><a href="#配置思路-6" class="headerlink" title="配置思路"></a>配置思路</h4><p>采用如下的思路配置OSPF GR：</p>
<ol>
<li>在各交换机上配置OSPF基本功能，实现OSPF网络的基本互通。</li>
<li>在SwitchA和SwitchC上使能Opaque LSA功能，实现OSPF通过Type9 LSA支持OSPF GR。</li>
<li>在SwitchA和SwitchC上配置GR功能，实现当OSPF协议重启时保证数据正常转发。</li>
</ol>
<h4 id="操作步骤-76"><a href="#操作步骤-76" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li>配置各接口所属的VLAN</li>
</ol>
<p>   # 配置SwitchA。SwitchB和SwitchC的配置与SwitchA类似。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;HUAWEI&gt; system-view</span><br><span class="line">[HUAWEI] sysname SwitchA</span><br><span class="line">[SwitchA] vlan batch 10 20</span><br><span class="line">[SwitchA] interface gigabitethernet 0&#x2F;0&#x2F;1</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;1] port link-type trunk</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;1] port trunk allow-pass vlan 10</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;1] quit</span><br><span class="line">[SwitchA] interface gigabitethernet 0&#x2F;0&#x2F;2</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;2] port link-type trunk</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;2] port trunk allow-pass vlan 20</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;2] quit</span><br></pre></td></tr></table></figure>



<ol start="2">
<li>配置各VLANIF接口的IP地址</li>
</ol>
<p>   # 配置SwitchA。SwitchB和SwitchC的配置与SwitchA类似。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] interface vlanif 10</span><br><span class="line">[SwitchA-Vlanif10] ip address 192.168.0.1 24</span><br><span class="line">[SwitchA-Vlanif10] quit</span><br><span class="line">[SwitchA] interface vlanif 20</span><br><span class="line">[SwitchA-Vlanif20] ip address 192.168.1.1 24</span><br><span class="line">[SwitchA-Vlanif20] quit</span><br></pre></td></tr></table></figure>



<ol start="3">
<li>配置OSPF基本功能</li>
</ol>
<p>   # 配置SwitchA。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] ospf 1 router-id 10.1.1.1</span><br><span class="line">[SwitchA-ospf-1] area 0</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.0] network 192.168.0.0 0.0.0.255</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.0] quit</span><br><span class="line">[SwitchA-ospf-1] area 1</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.1] network 192.168.1.0 0.0.0.255</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.1] quit</span><br><span class="line">[SwitchA-ospf-1] quit</span><br></pre></td></tr></table></figure>

<p>   # 配置SwitchB。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[SwitchB] ospf 1 router-id 10.2.2.2</span><br><span class="line">[SwitchB-ospf-1] area 0</span><br><span class="line">[SwitchB-ospf-1-area-0.0.0.0] network 192.168.0.0 0.0.0.255</span><br><span class="line">[SwitchB-ospf-1-area-0.0.0.0] quit</span><br><span class="line">[SwitchB-ospf-1] quit</span><br></pre></td></tr></table></figure>

<p>   # 配置SwitchC。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[SwitchC] ospf 1 router-id 10.3.3.3</span><br><span class="line">[SwitchC-ospf-1] area 1</span><br><span class="line">[SwitchC-ospf-1-area-0.0.0.1] network 192.168.1.0 0.0.0.255</span><br><span class="line">[SwitchC-ospf-1-area-0.0.0.1] quit</span><br><span class="line">[SwitchC-ospf-1] quit</span><br></pre></td></tr></table></figure>



<ol start="4">
<li>使能Opaque-LSA功能</li>
</ol>
<p>   # 配置SwitchA。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] ospf 1</span><br><span class="line">[SwitchA-ospf-1] opaque-capability enable</span><br><span class="line">[SwitchA-ospf-1] quit</span><br></pre></td></tr></table></figure>

<p>   # 配置SwitchC。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[SwitchC] ospf 1</span><br><span class="line">[SwitchC-ospf-1] opaque-capability enable</span><br><span class="line">[SwitchC-ospf-1] quit</span><br></pre></td></tr></table></figure>



<ol start="5">
<li>配置OSPF GR特性</li>
</ol>
<p>   # 配置SwitchA。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] ospf 1</span><br><span class="line">[SwitchA-ospf-1] graceful-restart</span><br><span class="line">[SwitchA-ospf-1] return</span><br></pre></td></tr></table></figure>

<p>   # 配置SwitchC。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[SwitchC] ospf 1</span><br><span class="line">[SwitchC-ospf-1] graceful-restart</span><br><span class="line">[SwitchC-ospf-1] return</span><br></pre></td></tr></table></figure>



<ol start="6">
<li>验证配置结果</li>
</ol>
<p>   # 查看SwitchC的GR状态。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;SwitchC&gt; display ospf graceful-restart</span><br><span class="line"> </span><br><span class="line">          OSPF Process 1 with Router ID 10.3.3.3</span><br><span class="line"> Graceful-restart capability     : enabled</span><br><span class="line"> Graceful-restart support        : planned and un-planned, totally</span><br><span class="line"> Helper-policy support           : planned and un-planned, strict lsa check</span><br><span class="line"> Current GR state                : normal</span><br><span class="line"> Graceful-restart period         : 120 seconds</span><br><span class="line"> </span><br><span class="line"> Number of neighbors under helper:</span><br><span class="line">  Normal neighbors    : 0</span><br><span class="line">  Virtual neighbors   : 0</span><br><span class="line">  Sham-link neighbors : 0</span><br><span class="line">  Total neighbors     : 0</span><br><span class="line"> </span><br><span class="line"> Number of restarting neighbors : 0</span><br><span class="line"> </span><br><span class="line"> Last exit reason:</span><br><span class="line">  On graceful restart : none</span><br><span class="line">  On Helper           : none</span><br></pre></td></tr></table></figure>

<p>   # 在SwitchA查看邻居状态。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;SwitchA&gt; display ospf peer</span><br><span class="line"></span><br><span class="line">     OSPF Process 1 with Router ID 10.1.1.1</span><br><span class="line">         Neighbors </span><br><span class="line"></span><br><span class="line"> Area 0.0.0.0 interface 192.168.0.1(Vlanif10)&#39;s neighbors</span><br><span class="line"> Router ID: 10.2.2.2          Address: 192.168.0.2      GR State: Normal     </span><br><span class="line">   State: Full  Mode:Nbr is  Master  Priority: 1</span><br><span class="line">   DR: 192.168.0.2  BDR: 192.168.0.1  MTU: 0    </span><br><span class="line">   Dead timer due in 40  sec </span><br><span class="line">   Retrans timer interval: 5 </span><br><span class="line">   Neighbor is up for 00:04:28     </span><br><span class="line">   Authentication Sequence: [ 0 ] </span><br><span class="line"></span><br><span class="line">         Neighbors </span><br><span class="line"></span><br><span class="line"> Area 0.0.0.1 interface 192.168.1.1(Vlanif20)&#39;s neighbors</span><br><span class="line"> Router ID: 10.3.3.3          Address: 192.168.1.2      GR State: Normal   </span><br><span class="line">   State: Full  Mode:Nbr is  Master  Priority: 1</span><br><span class="line">   DR: 192.168.1.1  BDR: 192.168.1.2  MTU: 0    </span><br><span class="line">   Dead timer due in 36  sec </span><br><span class="line">   Retrans timer interval: 5 </span><br><span class="line">   Neighbor is up for 00:00:00     </span><br><span class="line">   Authentication Sequence: [ 0 ]</span><br></pre></td></tr></table></figure>

<p>   可以看到，SwitchA的OSPF邻居处于<strong>Full</strong>状态，GR的状态是<strong>Normal</strong>。</p>
<p>   # 平滑重启SwitchC的OSPF进程。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;SwitchC&gt; reset ospf process graceful-restart</span><br></pre></td></tr></table></figure>

<p>   # 在SwitchA查看邻居状态。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;SwitchA&gt; display ospf peer</span><br><span class="line"></span><br><span class="line">     OSPF Process 1 with Router ID 10.1.1.1</span><br><span class="line">         Neighbors </span><br><span class="line"></span><br><span class="line"> Area 0.0.0.0 interface 192.168.0.1(Vlanif10)&#39;s neighbors</span><br><span class="line"> Router ID: 10.2.2.2          Address: 192.168.0.2      GR State: Normal     </span><br><span class="line">   State: Full  Mode:Nbr is  Master  Priority: 1</span><br><span class="line">   DR: 192.168.0.2  BDR: 192.168.0.1  MTU: 0    </span><br><span class="line">   Dead timer due in 40  sec </span><br><span class="line">   Retrans timer interval: 5 </span><br><span class="line">   Neighbor is up for 00:04:28     </span><br><span class="line">   Authentication Sequence: [ 0 ] </span><br><span class="line"></span><br><span class="line">         Neighbors </span><br><span class="line"></span><br><span class="line"> Area 0.0.0.1 interface 192.168.1.1(Vlanif20)&#39;s neighbors</span><br><span class="line"> Router ID: 10.3.3.3          Address: 192.168.1.2      GR State: Normal   </span><br><span class="line">   State: Full  Mode:Nbr is  Slave  Priority: 1</span><br><span class="line">   DR: 192.168.1.1  BDR: 192.168.1.2  MTU: 0    </span><br><span class="line">   Dead timer due in 36  sec </span><br><span class="line">   Retrans timer interval: 5 </span><br><span class="line">   Neighbor is up for 00:00:00     </span><br><span class="line">   Authentication Sequence: [ 0 ]</span><br></pre></td></tr></table></figure>

<p>   可以看到，SwitchA与SwitchC邻居关系继续保持为<strong>Full</strong>状态，不受SwitchC的OSPF进程平滑重启的影响。</p>
<h4 id="配置文件-6"><a href="#配置文件-6" class="headerlink" title="配置文件"></a>配置文件</h4><ul>
<li><p>SwitchA的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">sysname SwitchA</span><br><span class="line">#</span><br><span class="line">vlan batch 10 20</span><br><span class="line">#</span><br><span class="line">interface Vlanif10</span><br><span class="line"> ip address 192.168.0.1 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface Vlanif20</span><br><span class="line"> ip address 192.168.1.1 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 10</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;2</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 20</span><br><span class="line">#</span><br><span class="line">ospf 1 router-id 10.1.1.1</span><br><span class="line"> opaque-capability enable</span><br><span class="line"> graceful-restart</span><br><span class="line"> area 0.0.0.0</span><br><span class="line">  network 192.168.0.0 0.0.0.255</span><br><span class="line"> area 0.0.0.1</span><br><span class="line">  network 192.168.1.0 0.0.0.255</span><br><span class="line">#</span><br><span class="line">return</span><br></pre></td></tr></table></figure>
</li>
<li><p>SwitchB的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">sysname SwitchB</span><br><span class="line">#</span><br><span class="line">vlan batch 10</span><br><span class="line">#</span><br><span class="line">interface Vlanif10</span><br><span class="line"> ip address 192.168.0.2 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 10</span><br><span class="line">#</span><br><span class="line">ospf 1 router-id 10.2.2.2</span><br><span class="line"> area 0.0.0.0</span><br><span class="line">  network 192.168.0.0 0.0.0.255</span><br><span class="line">#</span><br><span class="line">return</span><br></pre></td></tr></table></figure>
</li>
<li><p>SwitchC的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">sysname SwitchC</span><br><span class="line">#</span><br><span class="line">vlan batch 20</span><br><span class="line">#</span><br><span class="line">interface Vlanif20</span><br><span class="line"> ip address 192.168.1.2 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 20</span><br><span class="line">#</span><br><span class="line">ospf 1 router-id 10.3.3.3</span><br><span class="line"> opaque-capability enable</span><br><span class="line"> graceful-restart</span><br><span class="line"> area 0.0.0.1</span><br><span class="line">  network 192.168.1.0 0.0.0.255</span><br><span class="line">#</span><br><span class="line">return</span><br></pre></td></tr></table></figure>





</li>
</ul>
<h3 id="6-24-8-配置OSPF与BFD联动示例"><a href="#6-24-8-配置OSPF与BFD联动示例" class="headerlink" title="6.24.8  配置OSPF与BFD联动示例"></a>6.24.8  配置OSPF与BFD联动示例</h3><h4 id="组网需求-7"><a href="#组网需求-7" class="headerlink" title="组网需求"></a>组网需求</h4><p>如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_cfg_ospf_108701">图6-76</a>所示，SwitchA、SwitchB和SwitchC之间运行OSPF，SwitchA和SwitchB之间的交换机仅作透传功能。现在需要SwitchA和SwitchB能快速感应它们之间的链路状态，当链路SwitchA-SwitchB发生故障时，业务能快速切换到备份链路SwitchA-SwitchC-SwitchB上。</p>
<p> 说明：</p>
<p>请确保该场景下互联接口的STP处于未使能状态。因为在使能STP的环形网络中，如果用交换机的VLANIF接口构建三层网络，会导致某个端口被阻塞，从而导致三层业务不能正常运行。</p>
<p><strong>图6-76</strong>  配置OSPF与BFD联动组网图<br><img src="http://support.huawei.com/enterprise/product/images/266dca518f594cb6a368cbc16c8a385b" alt="img" loading="lazy"></p>
<h4 id="配置思路-7"><a href="#配置思路-7" class="headerlink" title="配置思路"></a>配置思路</h4><p>采用如下思路配置OSPF与BFD联动：</p>
<ol>
<li>在各交换机上配置OSPF基本功能，实现整个OSPF网络的互通。</li>
<li>在各交换机上配置OSPF与BFD联动功能，实现当SwitchA和SwitchB之间的链路出现故障时快速的切换到备份链路。</li>
</ol>
<h4 id="操作步骤-77"><a href="#操作步骤-77" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li>配置各接口所属的VLAN</li>
</ol>
<p>   # 配置SwitchA。SwitchB和SwitchC的配置与SwitchA类似。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;HUAWEI&gt; system-view</span><br><span class="line">[HUAWEI] sysname SwitchA</span><br><span class="line">[SwitchA] vlan batch 10 30</span><br><span class="line">[SwitchA] interface gigabitethernet 0&#x2F;0&#x2F;1</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;1] port link-type trunk</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;1] port trunk allow-pass vlan 10</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;1] quit</span><br><span class="line">[SwitchA] interface gigabitethernet 0&#x2F;0&#x2F;2</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;2] port link-type trunk</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;2] port trunk allow-pass vlan 30</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;2] quit</span><br></pre></td></tr></table></figure>



<ol start="2">
<li>配置各VLANIF接口的IP地址</li>
</ol>
<p>   # 配置SwitchA。SwitchB和SwitchC的配置与SwitchA类似。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] interface vlanif 10</span><br><span class="line">[SwitchA-Vlanif10] ip address 10.1.1.1 24</span><br><span class="line">[SwitchA-Vlanif10] quit</span><br><span class="line">[SwitchA] interface vlanif 30</span><br><span class="line">[SwitchA-Vlanif30] ip address 10.3.3.1 24</span><br><span class="line">[SwitchA-Vlanif30] quit</span><br></pre></td></tr></table></figure>



<ol start="3">
<li>配置OSPF基本功能</li>
</ol>
<p>   # 配置SwitchA。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] ospf 1 router-id 10.10.10.1</span><br><span class="line">[SwitchA-ospf-1] area 0</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.0] network 10.1.1.0 0.0.0.255</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.0] network 10.3.3.0 0.0.0.255</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.0] quit</span><br><span class="line">[SwitchA-ospf-1] quit</span><br></pre></td></tr></table></figure>

<p>   # 配置SwitchB。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[SwitchB] ospf 1 router-id 10.10.10.2</span><br><span class="line">[SwitchB-ospf-1] area 0</span><br><span class="line">[SwitchB-ospf-1-area-0.0.0.0] network 10.2.2.0 0.0.0.255</span><br><span class="line">[SwitchB-ospf-1-area-0.0.0.0] network 10.3.3.0 0.0.0.255</span><br><span class="line">[SwitchB-ospf-1-area-0.0.0.0] network 172.16.1.0 0.0.0.255</span><br><span class="line">[SwitchB-ospf-1-area-0.0.0.0] quit</span><br><span class="line">[SwitchB-ospf-1] quit</span><br></pre></td></tr></table></figure>

<p>   # 配置SwitchC。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[SwitchC] ospf 1 router-id 10.10.10.3</span><br><span class="line">[SwitchC-ospf-1] area 0</span><br><span class="line">[SwitchC-ospf-1-area-0.0.0.0] network 10.1.1.0 0.0.0.255</span><br><span class="line">[SwitchC-ospf-1-area-0.0.0.0] network 10.2.2.0 0.0.0.255</span><br><span class="line">[SwitchC-ospf-1-area-0.0.0.0] quit</span><br><span class="line">[SwitchC-ospf-1] quit</span><br></pre></td></tr></table></figure>

<p>   # 配置完成后，执行命令<strong>display ospf peer</strong>，可以看到SwitchA，SwitchB和SwitchC之间互相建立了邻接关系。以SwitchA的显示结果为例。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] display ospf peer</span><br><span class="line"></span><br><span class="line">          OSPF Process 1 with Router ID 10.10.10.1</span><br><span class="line">                  Neighbors</span><br><span class="line"></span><br><span class="line"> Area 0.0.0.0 interface 10.1.1.1(Vlanif10)&#39;s neighbors</span><br><span class="line"> Router ID: 10.10.10.3       Address: 10.1.1.2          </span><br><span class="line">   State: Full  Mode:Nbr is  Master  Priority: 1</span><br><span class="line">   DR: 10.1.1.2  BDR: 10.1.1.1  MTU: 0</span><br><span class="line">   Dead timer due in 38  sec</span><br><span class="line">   Retrans timer interval: 5</span><br><span class="line">   Neighbor is up for 00:00:15</span><br><span class="line">   Authentication Sequence: [ 0 ]</span><br><span class="line"></span><br><span class="line">                  Neighbors</span><br><span class="line"></span><br><span class="line"> Area 0.0.0.0 interface 10.3.3.1(Vlanif30)&#39;s neighbors</span><br><span class="line"> Router ID: 10.10.10.2       Address: 10.3.3.2</span><br><span class="line">   State: Full  Mode:Nbr is   Master  Priority: 1</span><br><span class="line">   DR: 10.3.3.2  BDR: 10.3.3.1  MTU: 0</span><br><span class="line">   Dead timer due in 25  sec</span><br><span class="line">   Retrans timer interval: 5</span><br><span class="line">   Neighbor is up for 00:00:59</span><br><span class="line">   Authentication Sequence: [ 0 ]</span><br></pre></td></tr></table></figure>

<p>   # 查看SwitchA的OSPF路由表的信息，可以看到去往SwitchB和SwitchC的路由表项。而去往目的网段172.16.1.0/24的路由下一跳地址为10.3.3.2，说明流量在链路SwitchA→SwitchB上传输。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] display ospf routing</span><br><span class="line"></span><br><span class="line">          OSPF Process 1 with Router ID 10.10.10.1</span><br><span class="line">                   Routing Tables</span><br><span class="line"></span><br><span class="line"> Routing for Network</span><br><span class="line"> Destination        Cost  Type       NextHop         AdvRouter       Area</span><br><span class="line"> 10.1.1.0&#x2F;24        1     Transit    10.1.1.1        10.10.10.1      0.0.0.0</span><br><span class="line"> 10.2.2.0&#x2F;24        2     Transit    10.1.1.2        10.10.10.3      0.0.0.0</span><br><span class="line"> 10.2.2.0&#x2F;24        2     Transit    10.3.3.2        10.10.10.3      0.0.0.0</span><br><span class="line"> 10.3.3.0&#x2F;24        1     Transit    10.3.3.1        10.10.10.1      0.0.0.0</span><br><span class="line"> 172.16.1.0&#x2F;24      2     Stub       10.3.3.2        10.10.10.2      0.0.0.0</span><br><span class="line"></span><br><span class="line"> Total Nets: 5</span><br><span class="line"> Intra Area: 5  Inter Area: 0  ASE: 0  NSSA: 0</span><br></pre></td></tr></table></figure>



<ol start="4">
<li>配置OSPF与BFD联动</li>
</ol>
<p>   # 在SwitchA上配置OSPF与BFD联动功能。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] bfd</span><br><span class="line">[SwitchA-bfd] quit</span><br><span class="line">[SwitchA] ospf 1</span><br><span class="line">[SwitchA-ospf-1] bfd all-interfaces enable</span><br><span class="line">[SwitchA-ospf-1] quit</span><br></pre></td></tr></table></figure>

<p>   # 在SwitchB上配置OSPF与BFD联动功能。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[SwitchB] bfd</span><br><span class="line">[SwitchB-bfd] quit</span><br><span class="line">[SwitchB] ospf 1</span><br><span class="line">[SwitchB-ospf-1] bfd all-interfaces enable</span><br><span class="line">[SwitchB-ospf-1] quit</span><br></pre></td></tr></table></figure>

<p>   # 在SwitchC上配置OSPF与BFD联动功能。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[SwitchC] bfd</span><br><span class="line">[SwitchC-bfd] quit</span><br><span class="line">[SwitchC] ospf 1</span><br><span class="line">[SwitchC-ospf-1] bfd all-interfaces enable</span><br><span class="line">[SwitchC-ospf-1] quit</span><br></pre></td></tr></table></figure>

<p>   # 配置完成后，在SwitchA或SwitchB、SwitchC上执行<strong>display ospf bfd session all</strong>命令，可以看到BFD会话的状态为<strong>Up</strong>。以SwitchA的显示为例。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] display ospf bfd session all</span><br><span class="line"></span><br><span class="line">          OSPF Process 1 with Router ID 10.10.10.1</span><br><span class="line">  Area 0.0.0.0 interface 10.1.1.1(Vlanif10)&#39;s BFD Sessions</span><br><span class="line"></span><br><span class="line"> NeighborId:10.10.10.3       AreaId:0.0.0.0          Interface:Vlanif10</span><br><span class="line"> BFDState:up                 rx    :1000             tx       :1000</span><br><span class="line"> Multiplier:3                BFD Local Dis:8195      LocalIpAdd:10.1.1.1</span><br><span class="line"> RemoteIpAdd:10.1.1.2        Diagnostic Info:No diagnostic information</span><br><span class="line"></span><br><span class="line">  Area 0.0.0.0 interface 10.3.3.1(Vlanif30)&#39;s BFD Sessions</span><br><span class="line"></span><br><span class="line"> NeighborId:10.10.10.2       AreaId:0.0.0.0          Interface:Vlanif30</span><br><span class="line"> BFDState:up                 rx    :1000             tx       :1000</span><br><span class="line"> Multiplier:3                BFD Local Dis:8194      LocalIpAdd:10.3.3.1</span><br><span class="line"> RemoteIpAdd:10.3.3.2         Diagnostic Info:No diagnostic information</span><br></pre></td></tr></table></figure>



<ol start="5">
<li>检查配置结果</li>
</ol>
<p>   # 对SwitchB的GE0/0/1接口执行<strong>shutdown</strong>命令，模拟链路故障。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[SwitchB] interface gigabitethernet 0&#x2F;0&#x2F;1</span><br><span class="line">[SwitchB-GigabitEthernet0&#x2F;0&#x2F;1] shutdown</span><br></pre></td></tr></table></figure>

<p>   # 在SwitchA上查看OSPF路由表。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] display ospf routing</span><br><span class="line"></span><br><span class="line">          OSPF Process 1 with Router ID 10.10.10.1</span><br><span class="line">                   Routing Tables</span><br><span class="line"></span><br><span class="line"> Routing for Network</span><br><span class="line"> Destination        Cost  Type       NextHop         AdvRouter       Area</span><br><span class="line"> 10.1.1.0&#x2F;24        1     Transit    10.1.1.1        10.10.10.1      0.0.0.0</span><br><span class="line"> 10.2.2.0&#x2F;24        2     Transit    10.1.1.2        10.10.10.3      0.0.0.0</span><br><span class="line"> 10.3.3.0&#x2F;24        1     Stub       10.3.3.1        10.10.10.1      0.0.0.0</span><br><span class="line"> 172.16.1.0&#x2F;24      3     Stub       10.1.1.2        10.10.10.2      0.0.0.0</span><br><span class="line"></span><br><span class="line"> Total Nets: 4</span><br><span class="line"> Intra Area: 4  Inter Area: 0  ASE: 0  NSSA: 0</span><br></pre></td></tr></table></figure>

<p>   可以看出在链路SwitchA-SwitchB出现故障后，备份链路SwitchA-SwitchC-SwitchB开始生效，即去往目的网段172.16.1.0/24的路由下一跳地址变成了10.1.1.2。</p>
<h4 id="配置文件-7"><a href="#配置文件-7" class="headerlink" title="配置文件"></a>配置文件</h4><ul>
<li><p>SwitchA的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">sysname SwitchA</span><br><span class="line">#</span><br><span class="line">vlan batch 10 30</span><br><span class="line">#</span><br><span class="line">bfd</span><br><span class="line">#</span><br><span class="line">interface Vlanif10</span><br><span class="line"> ip address 10.1.1.1 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface Vlanif30</span><br><span class="line"> ip address 10.3.3.1 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 10</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;2</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 30</span><br><span class="line">#</span><br><span class="line">ospf 1 router-id 10.10.10.1</span><br><span class="line"> bfd all-interfaces enable</span><br><span class="line"> area 0.0.0.0</span><br><span class="line">  network 10.1.1.0 0.0.0.255</span><br><span class="line">  network 10.3.3.0 0.0.0.255</span><br><span class="line">#</span><br><span class="line">return</span><br></pre></td></tr></table></figure>
</li>
<li><p>SwitchB的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">sysname SwitchB</span><br><span class="line">#</span><br><span class="line">vlan batch 20 30 40</span><br><span class="line">#</span><br><span class="line">bfd</span><br><span class="line">#</span><br><span class="line">interface Vlanif20</span><br><span class="line"> ip address 10.2.2.2 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface Vlanif30</span><br><span class="line"> ip address 10.3.3.2 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface Vlanif40</span><br><span class="line"> ip address 172.16.1.1 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 30</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;2</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 20</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;3</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 40</span><br><span class="line">#</span><br><span class="line">ospf 1 router-id 10.10.10.2</span><br><span class="line"> bfd all-interfaces enable</span><br><span class="line"> area 0.0.0.0</span><br><span class="line">  network 10.2.2.0 0.0.0.255</span><br><span class="line">  network 10.3.3.0 0.0.0.255</span><br><span class="line">  network 172.16.1.0 0.0.0.255</span><br><span class="line">#</span><br><span class="line">return</span><br></pre></td></tr></table></figure>
</li>
<li><p>SwitchC的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">sysname SwitchC</span><br><span class="line">#</span><br><span class="line">vlan batch 10 20</span><br><span class="line">#</span><br><span class="line">bfd</span><br><span class="line">#</span><br><span class="line">interface Vlanif10</span><br><span class="line"> ip address 10.1.1.2 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface Vlanif20</span><br><span class="line"> ip address 10.2.2.1 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 10</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;2</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 20</span><br><span class="line">#</span><br><span class="line">ospf 1 router-id 10.10.10.3</span><br><span class="line"> bfd all-interfaces enable</span><br><span class="line"> area 0.0.0.0</span><br><span class="line">  network 10.1.1.0 0.0.0.255</span><br><span class="line">  network 10.2.2.0 0.0.0.255</span><br><span class="line">#</span><br><span class="line">return</span><br></pre></td></tr></table></figure>





</li>
</ul>
<h3 id="6-24-9-配置OSPF-IP-FRR示例"><a href="#6-24-9-配置OSPF-IP-FRR示例" class="headerlink" title="6.24.9  配置OSPF IP FRR示例"></a>6.24.9  配置OSPF IP FRR示例</h3><h4 id="组网需求-8"><a href="#组网需求-8" class="headerlink" title="组网需求"></a>组网需求</h4><p>如<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&partNo=10092#fig_dc_cfg_ospf_109901">图6-77</a>所示，四台交换机属于同一个OSPF区域，用户希望对SwitchA转发的流量进行可靠性保护，具体需求如下：</p>
<ul>
<li>正常情况下，SwitchA的流量通过主用链路SwitchA-SwitchC转发。</li>
<li>当主用链路SwitchA-SwitchC发生故障的时候，流量快速切换至备用链路SwitchA-SwitchB，而不用等待路由收敛，从而达到流量不中断的目的。</li>
</ul>
<p> 说明：</p>
<p>请确保该场景下互联接口的STP处于未使能状态。因为在使能STP的环形网络中，如果用交换机的VLANIF接口构建三层网络，会导致某个端口被阻塞，从而导致三层业务不能正常运行。</p>
<p><strong>图6-77</strong>  配置OSPF IP FRR组网图<br><img src="http://support.huawei.com/enterprise/product/images/547bad259f194675918a5fb8fe5b24a0" alt="img" loading="lazy"></p>
<h4 id="配置思路-8"><a href="#配置思路-8" class="headerlink" title="配置思路"></a>配置思路</h4><p>采用如下思路配置OSPF IP FRR：</p>
<ol>
<li>在各交换机上配置OSPF基本功能。</li>
<li>在SwitchA上配置OSPF IP FRR功能，实现对SwitchA转发的流量进行可靠性保护的目的。</li>
</ol>
<h4 id="操作步骤-78"><a href="#操作步骤-78" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li>配置各接口所属的VLAN</li>
</ol>
<p>   # 配置SwitchA。SwitchB、SwitchC和SwitchD的配置与SwitchA类似。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;HUAWEI&gt; system-view</span><br><span class="line">[HUAWEI] sysname SwitchA</span><br><span class="line">[SwitchA] vlan batch 10 20</span><br><span class="line">[SwitchA] interface GigabitEthernet 0&#x2F;0&#x2F;1</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;1] port link-type trunk</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;1] port trunk allow-pass vlan 10</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;1] quit</span><br><span class="line">[SwitchA] interface GigabitEthernet 0&#x2F;0&#x2F;2</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;2] port link-type trunk</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;2] port trunk allow-pass vlan 20</span><br><span class="line">[SwitchA-GigabitEthernet0&#x2F;0&#x2F;2] quit</span><br></pre></td></tr></table></figure>



<ol start="2">
<li>配置各VLANIF接口的IP地址</li>
</ol>
<p>   # 配置SwitchA。SwitchB、SwitchC和SwitchD的配置与SwitchA类似。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] interface vlanif 10</span><br><span class="line">[SwitchA-Vlanif10] ip address 192.168.1.1 24</span><br><span class="line">[SwitchA-Vlanif10] quit</span><br><span class="line">[SwitchA] interface vlanif 20</span><br><span class="line">[SwitchA-Vlanif20] ip address 192.168.2.1 24</span><br><span class="line">[SwitchA-Vlanif20] quit</span><br></pre></td></tr></table></figure>



<ol start="3">
<li>配置OSPF基本功能</li>
</ol>
<p>   # 配置SwitchA。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] ospf 1 router-id 10.1.1.1</span><br><span class="line">[SwitchA-ospf-1] area 0</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.0] network 192.168.1.0 0.0.0.255</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.0] network 192.168.2.0 0.0.0.255</span><br><span class="line">[SwitchA-ospf-1-area-0.0.0.0] quit</span><br><span class="line">[SwitchA-ospf-1] quit</span><br></pre></td></tr></table></figure>

<p>   # 配置SwitchB。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[SwitchB] ospf 1 router-id 10.2.2.2</span><br><span class="line">[SwitchB-ospf-1] area 0</span><br><span class="line">[SwitchB-ospf-1-area-0.0.0.0] network 192.168.1.0 0.0.0.255</span><br><span class="line">[SwitchB-ospf-1-area-0.0.0.0] network 192.168.3.0 0.0.0.255</span><br><span class="line">[SwitchB-ospf-1-area-0.0.0.0] return</span><br></pre></td></tr></table></figure>

<p>   # 配置SwitchC。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[SwitchC] ospf 1 router-id 10.3.3.3</span><br><span class="line">[SwitchC-ospf-1] area 0</span><br><span class="line">[SwitchC-ospf-1-area-0.0.0.0] network 192.168.2.0 0.0.0.255</span><br><span class="line">[SwitchC-ospf-1-area-0.0.0.0] network 192.168.3.0 0.0.0.255</span><br><span class="line">[SwitchC-ospf-1-area-0.0.0.0] network 192.168.4.0 0.0.0.255</span><br><span class="line">[SwitchC-ospf-1-area-0.0.0.0] return</span><br></pre></td></tr></table></figure>

<p>   # 配置SwitchD。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[SwitchD] ospf 1 router-id 10.4.4.4</span><br><span class="line">[SwitchD-ospf-1] area 0</span><br><span class="line">[SwitchD-ospf-1-area-0.0.0.0] network 192.168.4.0 0.0.0.255</span><br><span class="line">[SwitchD-ospf-1-area-0.0.0.0] return</span><br></pre></td></tr></table></figure>



<ol start="4">
<li>在SwitchA上使能OSPF IP FRR。</li>
</ol>
<p>   # 在SwitchA上使能OSPF IP FRR。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[SwitchA] ospf</span><br><span class="line">[SwitchA-ospf-1] frr</span><br><span class="line">[SwitchA-ospf-1-frr] loop-free-alternate</span><br><span class="line">[SwitchA-ospf-1-frr] return</span><br></pre></td></tr></table></figure>



<ol start="5">
<li>检查配置结果</li>
</ol>
<p>   # 查看SwitchA到SwitchD的路由信息。由于使能了OSPF IP FRR，OSPF生成了一条备份路由。</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;SwitchA&gt; display ospf routing 192.168.4.0</span><br><span class="line"></span><br><span class="line">         OSPF Process 1 with Router ID 10.1.1.1</span><br><span class="line"></span><br><span class="line"> Destination : 192.168.4.0&#x2F;24     </span><br><span class="line"> AdverRouter : 10.4.4.4                 Area      : 0.0.0.0  </span><br><span class="line"> Cost        : 2                        Type      : Transit </span><br><span class="line"> NextHop     : 192.168.2.2              Interface : Vlanif20  </span><br><span class="line"> Priority    : Low                      Age       : 00h00m10s  </span><br><span class="line"> Backup Nexthop : 192.168.1.2           Backup Interface: Vlanif10</span><br><span class="line"> Backup Type : LFA LINK</span><br></pre></td></tr></table></figure>

<p>   从显示信息可以看出，SwitchA上已经生成了备份的路由。</p>
<h4 id="配置文件-8"><a href="#配置文件-8" class="headerlink" title="配置文件"></a>配置文件</h4><ul>
<li><p>SwitchA的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">sysname SwitchA</span><br><span class="line">#</span><br><span class="line">vlan batch 10 20</span><br><span class="line">#</span><br><span class="line">interface Vlanif10</span><br><span class="line"> ip address 192.168.1.1 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface Vlanif20</span><br><span class="line"> ip address 192.168.2.1 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 10</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;2</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 20</span><br><span class="line">#</span><br><span class="line">ospf 1 router-id 10.1.1.1</span><br><span class="line"> frr</span><br><span class="line">  loop-free-alternate</span><br><span class="line"> area 0.0.0.0</span><br><span class="line">  network 192.168.1.0 0.0.0.255</span><br><span class="line">  network 192.168.2.0 0.0.0.255</span><br><span class="line">#</span><br><span class="line">return</span><br></pre></td></tr></table></figure>
</li>
<li><p>SwitchB的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">sysname SwitchB</span><br><span class="line">#</span><br><span class="line">vlan batch 10 30</span><br><span class="line">#</span><br><span class="line">interface Vlanif10</span><br><span class="line"> ip address 192.168.1.2 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface Vlanif30</span><br><span class="line"> ip address 192.168.3.1 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 10</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;2</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 30</span><br><span class="line">#</span><br><span class="line">ospf 1 router-id 10.2.2.2</span><br><span class="line"> area 0.0.0.0</span><br><span class="line">  network 192.168.1.0 0.0.0.255</span><br><span class="line">  network 192.168.3.0 0.0.0.255</span><br><span class="line">#</span><br><span class="line">return</span><br></pre></td></tr></table></figure>
</li>
<li><p>SwitchC的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">sysname SwitchC</span><br><span class="line">#</span><br><span class="line">vlan batch 20 30 40</span><br><span class="line">#</span><br><span class="line">interface Vlanif20</span><br><span class="line"> ip address 192.168.2.2 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface Vlanif30</span><br><span class="line"> ip address 192.168.3.2 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface Vlanif40</span><br><span class="line"> ip address 192.168.4.1 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 20</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;2</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 40</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;3</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 30</span><br><span class="line">#</span><br><span class="line">ospf 1 router-id 10.3.3.3</span><br><span class="line"> area 0.0.0.0</span><br><span class="line">  network 192.168.2.0 0.0.0.255</span><br><span class="line">  network 192.168.3.0 0.0.0.255</span><br><span class="line">  network 192.168.4.0 0.0.0.255</span><br><span class="line">#</span><br><span class="line">return</span><br></pre></td></tr></table></figure>
</li>
<li><p>SwitchD的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">sysname SwitchD</span><br><span class="line">#</span><br><span class="line">vlan batch 40</span><br><span class="line">#</span><br><span class="line">interface Vlanif40</span><br><span class="line"> ip address 192.168.4.2 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;1</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 40</span><br><span class="line">#</span><br><span class="line">ospf 1 router-id 10.4.4.4</span><br><span class="line"> area 0.0.0.0</span><br><span class="line">  network 192.168.4.0 0.0.0.255</span><br><span class="line">#</span><br><span class="line">return</span><br></pre></td></tr></table></figure>





</li>
</ul>
<h2 id="6-25-常见配置错误"><a href="#6-25-常见配置错误" class="headerlink" title="6.25  常见配置错误"></a>6.25  常见配置错误</h2><p>介绍常见配置错误的案例，避免在配置阶段引入故障。</p>
<h3 id="6-25-1-OSPF邻居建立不成功"><a href="#6-25-1-OSPF邻居建立不成功" class="headerlink" title="6.25.1  OSPF邻居建立不成功"></a>6.25.1  OSPF邻居建立不成功</h3><h4 id="故障现象"><a href="#故障现象" class="headerlink" title="故障现象"></a>故障现象</h4><p>OSPF邻居建立不成功。</p>
<h4 id="操作步骤-79"><a href="#操作步骤-79" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li>检查邻居两端的接口物理和协议状态是否UP，状态是否稳定，接口是否有丢包，两边互ping大包是否能通。</li>
</ol>
<p>   若物理接口不Up或是不稳定（有振荡现象），请排查物理链路和链路层协议，确保物理和协议状态都是Up，并且接口无错误计数。</p>
<p>   可以通过ping测试，长ping测试是否存在丢包现象，ping大包（1500字节以上）测试是否存在大包不通的现象。若存在，请检查数据包传送路径上各设备接口的MTU值设置是否合理。</p>
<ol start="2">
<li>检查链路两端OSPF进程的Router ID是否一致。</li>
</ol>
<p>   分别在链路两端的设备上执行命令<strong>display ospf</strong> [ <em>process-id</em> ] <strong>brief</strong>，查看OSPF进程的Router ID。</p>
<p>   Router ID要保证全网唯一，否则会导致邻居不能正常建立、路由信息不正确的问题。建议在设备上单独为每个OSPF进程配置全网唯一的Router ID。</p>
<p>   如果链路两端OSPF进程的Router ID一致，请在系统视图下执行命令<strong>ospf</strong> [ <em>process-id</em> ] <strong>router-id</strong> <em>router-id</em>，修改OSPF进程的Router ID以保证不冲突。</p>
<p>   修改OSPF进程的Router ID之后，必须在用户视图下执行命令<strong>reset ospf</strong> [ <em>process-id</em> ] <strong>process</strong>后，新配置的Router ID才会生效。</p>
<ol start="3">
<li>检查链路两端OSPF区域ID是否一致。</li>
</ol>
<p>   分别在链路两端的设备上执行命令<strong>display ospf</strong> [ <em>process-id</em> ] <strong>brief</strong>，查看OSPF的区域ID。</p>
<p>   如果链路两端的OSPF区域ID不一致，请在OSPF视图下执行命令<strong>area</strong> <em>area-id</em>，修改OSPF区域ID以保证一致。</p>
<ol start="4">
<li>检查链接两端OSPF接口的网络类型是否一致。</li>
</ol>
<p>   分别在链路两端的设备上执行命令<strong>display ospf</strong> [ <em>process-id</em> ] <strong>interface</strong>，查看OSPF接口的接口类型。</p>
<p>   一般情况下，链路两端的OSPF接口的网络类型必须一致，否则双方不能正常建立起OSPF邻居关系。</p>
<p>   如果OSPF接口的网络类型不一致，请在运行OSPF协议的接口视图下执行命令<strong>ospf network-type</strong> { <strong>broadcast</strong> | <strong>nbma</strong> | <strong>p2mp</strong> | <strong>p2p</strong> }，修改OSPF接口的网络类型以保证一致。</p>
<pre><code>说明：</code></pre>
<p>   如果链路两端OSPF接口的网络类型都是NBMA，则必须在OSPF视图下执行命令<strong>peer</strong> <em>ip-address</em> [ <strong>dr-priority</strong> <em>priority</em> ]，配置NBMA网络的OSPF邻居。</p>
<ol start="5">
<li>检查链路两端OSPF接口的IP地址的掩码是否一致。</li>
</ol>
<p>   分别在链路两端的设备上执行命令<strong>display current-configuration</strong> <strong>interface</strong> <em>interface-type</em> <em>interface-number</em>，查看OSPF接口的IP地址。</p>
<p>   一般情况下，链路两端的OSPF接口的IP地址的掩码必须一致，否则双方不能正常建立OSPF邻居关系。但在P2MP网络中，可以通过在运行OSPF协议的接口视图下配置命令<strong>ospf p2mp-mask-ignore</strong>来使设备忽略对网络掩码的检查，从而正常建立OSPF邻居关系。</p>
<p>   如果OSPF接口的IP地址的掩码不一致，请在运行OSPF协议的接口视图下执行命令<strong>ip address</strong> <em>ip-address</em> { <em>mask</em> | <em>mask-length</em> }，修改OSPF接口的IP地址以保证掩码一致。</p>
<ol start="6">
<li>检查链路两端OSPF接口的IP地址所在网段是否包含在区域内配置的<strong>network</strong>内。</li>
</ol>
<p>   分别在链路两端的设备上执行命令<strong>display current-configuration</strong> <strong>interface</strong> <em>interface-type</em> <em>interface-number</em>，查看OSPF接口的IP地址；执行命令<strong>display current-configuration</strong> <strong>configuration</strong> <strong>ospf</strong>，查看OSPF进程的配置。</p>
<p>   满足下面两个条件，OSPF协议才能在接口上运行：</p>
<ul>
<li><p>接口的IP地址掩码长度≥<strong>network</strong>命令中的掩码长度。OSPF使用反掩码，例如0.0.0.255表示掩码长度24位。</p>
</li>
<li><p>接口的主IP地址必须在<strong>network</strong>命令指定的网段范围之内。</p>
<p>如果检查发现接口IP地址与配置的<strong>network</strong>不满足上述条件，请在运行OSPF协议的接口视图下执行命令<strong>ip address</strong> <em>ip-address</em> { <em>mask</em> | <em>mask-length</em> }，修改接口的IP地址；或者在OSPF进程对应的区域视图下执行命令<strong>network</strong>，修改配置的网段，保证满足上述条件。</p>
</li>
</ul>
<ol start="7">
<li>检查链路两端OSPF接口的DR优先级是否非零。</li>
</ol>
<p>   分别在链路两端的设备上执行命令<strong>display ospf</strong> [ <em>process-id</em> ] <strong>interface</strong>，查看OSPF接口的DR优先级。</p>
<p>   对于广播和NBMA类型网络，链路中至少要有一个OSPF接口的DR优先级不为0，这样才能正常选举出DR。否则两边的邻居状态只能达到<strong>2-Way</strong>。</p>
<p>   如果链路两端OSPF接口的DR优先级都为0，请在运行OSPF协议的接口视图下执行命令<strong>ospf dr-priority</strong> <em>priority</em>，修改OSPF接口的DR优先级以保证至少有一个接口的DR优先级不为0。</p>
<h3 id="6-25-2-OSPF不能发现其他区域的路由"><a href="#6-25-2-OSPF不能发现其他区域的路由" class="headerlink" title="6.25.2  OSPF不能发现其他区域的路由"></a>6.25.2  OSPF不能发现其他区域的路由</h3><h4 id="故障现象-1"><a href="#故障现象-1" class="headerlink" title="故障现象"></a>故障现象</h4><p>在链路正常的情况下，OSPF不能发现其他区域的路由。</p>
<h4 id="操作步骤-80"><a href="#操作步骤-80" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol>
<li>检查设备所在区域是否与骨干区域相连。</li>
</ol>
<p>   在设备所在区域的ABR上执行命令<strong>display ospf</strong> [ <em>process-id</em> ] <strong>brief</strong>，查看ABR的区域配置信息。</p>
<p>   OSPF规定所有非骨干区域必须与骨干区域保持连通。</p>
<p>   如果ABR上没有配置骨干区域的信息，请在OSPF视图下执行命令<strong>area</strong> <em>area-id</em>，修改OSPF区域信息以保证ABR上至少有一个接口运行在骨干区域。</p>
<pre><code>说明：</code></pre>
<p>   如果因实际组网限制，无法满足所有非骨干区域与骨干区域保持连通的要求，可以通过配置虚连接来满足需求。</p>
<ol start="2">
<li>检查设备所在区域是否为Totally Stub区域。</li>
</ol>
<p>   在设备上执行命令<strong>display current-configuration</strong> <strong>configuration</strong> <strong>ospf</strong> [ <em>process-id</em> ]，查看OSPF进程的配置信息。</p>
<p>   配置非骨干区域为Stub区域时，如果在ABR上配置时加上了参数<strong>no-summary</strong> （即OSPF区域视图下执行<strong>stub</strong> <strong>no-summary</strong>命令），则将该区域配置成了Totally Stub区域。</p>
<p>   Totally Stub区域，不允许发布自治系统外部路由和区域间的路由，只允许发布区域内路由。</p>
<p>   如果设备所在区域被配置为Totally Stub区域，请在确认需要修改的情况下，根据需求选择如下配置：</p>
<ul>
<li>如果要将该Totally Stub区域恢复为普通区域，则需要在该区域的所有设备的OSPF区域视图下执行命令<strong>undo stub</strong>。</li>
<li>如果仅仅是需要将Totally Stub区域改成Stub区域，则需要在该区域的ABR的OSPF区域视图下先执行命令<strong>undo stub</strong>，然后再执行命令<strong>stub</strong>。</li>
</ul>
<ol start="3">
<li>检查设备所在区域是否为Totally NSSA区域。</li>
</ol>
<p>   在设备上执行命令<strong>display current-configuration</strong> <strong>configuration</strong> <strong>ospf</strong> [ <em>process-id</em> ]，查看OSPF进程的配置信息。</p>
<p>   配置非骨干区域为NSSA区域时，如果在ABR上配置时加上了参数<strong>no-summary</strong> （即在OSPF区域视图下执行<strong>nssa</strong> <strong>no-summary</strong>命令），则将该区域配置成了Totally NSSA区域。</p>
<p>   Totally NSSA区域不允许发布自治系统外部路由和区域间的路由，只允许发布区域内路由。</p>
<p>   如果设备所在区域被配置为Totally NSSA区域，请在确认需要修改的情况下，根据需求选择如下配置：</p>
<ul>
<li>如果要将该Totally NSSA区域恢复为普通区域，则需要在该区域的所有设备的OSPF区域视图下执行命令<strong>undo nssa</strong>。</li>
<li>如果仅仅是需要将Totally NSSA区域改成NSSA区域，则需要在该区域的ABR的OSPF区域视图下先执行命令<strong>undo nssa</strong>，然后再执行命令<strong>nssa</strong>。</li>
</ul>
<h2 id="6-26-参考信息"><a href="#6-26-参考信息" class="headerlink" title="6.26  参考信息"></a>6.26  参考信息</h2><p>介绍OSPF的参考标准和协议。</p>
<p>本特性的参考资料清单如下：</p>
<table>
<thead>
<tr>
<th>文档</th>
<th>描述</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>RFC1587</td>
<td>This document describes a new optional type of OSPF area, somewhat humorously referred to as a “not-so-stubby” area (or NSSA). NSSAs are similar to the existing OSPF stub area configuration option but have the additional capability of importing AS external routes in a limited fashion.</td>
<td>-</td>
</tr>
<tr>
<td>RFC1765</td>
<td>Proper operation of the OSPF protocol requires that all OSPF routers maintain an identical copy of the OSPF link-state database. However, when the size of the link-state database becomes very large, some routers may be unable to keep the entire database due to resource shortages; we term this “database overflow”.</td>
<td>该RFC为Experimental，非Standard。</td>
</tr>
<tr>
<td>RFC2328</td>
<td>This memo documents version 2 of the OSPF protocol. OSPF is a link-state routing protocol.</td>
<td>-</td>
</tr>
<tr>
<td>RFC2370</td>
<td>This memo defines enhancements to the OSPF protocol to support a new class of link-state advertisements (LSA) called Opaque LSAs. Opaque LSAs provide a generalized mechanism to allow for the future extensibility of OSPF.</td>
<td>-</td>
</tr>
<tr>
<td>RFC3137</td>
<td>This memo describes a backward-compatible technique that may be used by OSPF (Open Shortest Path First) implementations to advertise unavailability to forward transit traffic or to lower the preference level for the paths through such a router.</td>
<td>该RFC为Informational，非Standard。</td>
</tr>
<tr>
<td>RFC3623</td>
<td>This memo documents an enhancement to the OSPF routing protocol, whereby an OSPF router can stay on the forwarding path even as its OSPF software is restarted.</td>
<td>-</td>
</tr>
<tr>
<td>RFC3630</td>
<td>This document describes extensions to the OSPF protocol version 2 to support intra-area Traffic Engineering (TE), using Opaque Link State Advertisements.</td>
<td>-</td>
</tr>
<tr>
<td>RFC3682</td>
<td>The use of a packet’s Time to Live (TTL) (IPv4) or Hop Limit (IPv6) to protect a protocol stack from CPU-utilization based attacks has been proposed in many settings.</td>
<td>该RFC为Experimental，非Standard。</td>
</tr>
<tr>
<td>RFC3906</td>
<td>This document describes how conventional hop-by-hop link-state routing protocols interact with new Traffic Engineering capabilities to create Interior Gateway Protocol (IGP) shortcuts.</td>
<td>-</td>
</tr>
<tr>
<td>RFC4576</td>
<td>This document specifies the necessary procedure, using one of the options bits in the LSA (Link State Advertisements) to indicate that an LSA has already been forwarded by a PE and should be ignored by any other PEs that see it.</td>
<td>-</td>
</tr>
<tr>
<td>RFC4577</td>
<td>This document extends that specification by allowing the routing protocol on the PE/CE interface to be the Open Shortest Path First (OSPF) protocol.</td>
<td>-</td>
</tr>
<tr>
<td>RFC4750</td>
<td>This memo defines a portion of the Management Information Base (MIB) for use with network management protocols in TCP/IP-based internets. In particular, it defines objects for managing version 2 of the Open Shortest Path First Routing Protocol. Version 2 of the OSPF protocol is specific to the IPv4 address family.</td>
<td>-</td>
</tr>
</tbody></table>
<p>原文链接：<a target="_blank" rel="noopener" href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&amp;partNo=10092#fig_dc_feature_ospf_111501">http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000162056&amp;partNo=10092#fig_dc_feature_ospf_111501</a> </p>
</div><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="打赏" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">如果帮助到了您，欢迎请我喝杯冰阔落~</div><div id="qr" style="display:none;"><div style="display:inline-block"><a href="/img/Alipay.png"><img loading="lazy" src="/img/Alipay.png" alt="支付宝" title="支付宝"></a><div><span style="color:#00A3EE"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-alipay-line"></use></svg></span></div></div><div style="display:inline-block"><a href="/img/WeChatPay.png"><img loading="lazy" src="/img/WeChatPay.png" alt="微信支付" title="微信支付"></a><div><span style="color:#2DC100"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-pay-line"></use></svg></span></div></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>澈崽子</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="https://zeozzz.github.com/2019/05/28/54/" title="OSPF配置---华为">https://zeozzz.github.com/2019/05/28/54/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> 许可协议。</li></ul></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2019/05/29/55/" rel="prev" title="什么是敏捷网络 敏捷网络就是SDN吗"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">什么是敏捷网络 敏捷网络就是SDN吗</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2019/05/24/53/" rel="next" title="DCI平面"><span class="post-nav-text">DCI平面</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div></main><footer class="sidebar-translate" id="footer"><div class="beian"><a rel="noopener" href="http://www.beian.miit.gov.cn" target="_blank">冀ICP备15029595号-1</a></div><div class="copyright"><span>&copy; 2015 – 2020 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> 澈崽子</span></div><div class="powered"><span>由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v5.0.0</span><span class="footer-separator">|</span><span>主题 - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v0.9.5</span></div><div class="live_time"><span>本博客已萌萌哒地运行</span><span id="display_live_time"></span><span class="moe-text">(●'◡'●)</span><script>function blog_live_time() {
  window.setTimeout(blog_live_time, 1000);
  const start = new Date('2015-09-01T00:00:00');
  const now = new Date();
  const timeDiff = (now.getTime() - start.getTime());
  const msPerMinute = 60 * 1000;
  const msPerHour = 60 * msPerMinute;
  const msPerDay = 24 * msPerHour;
  const passDay = Math.floor(timeDiff / msPerDay);
  const passHour = Math.floor((timeDiff % msPerDay) / 60 / 60 / 1000);
  const passMinute = Math.floor((timeDiff % msPerHour) / 60 / 1000);
  const passSecond = Math.floor((timeDiff % msPerMinute) / 1000);
  display_live_time.innerHTML = " " + passDay + " 天 " + passHour + " 小时 " + passMinute + " 分 " + passSecond + " 秒";
}
blog_live_time();
</script></div><div id="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv" title="总访客量"><span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-user-line"></use></svg></span><span id="busuanzi_value_site_uv"></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv" title="总访问量"><span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-eye-line"></use></svg></span><span id="busuanzi_value_site_pv"></span></span></div></footer><a class="hty-icon-button" id="goUp" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="搜索"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search-line"></use></svg></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="/js/search/local-search.js" defer></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-close-line"></use></svg></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="搜索..." value=""></div><div id="local-search-result"></div></div><script>let date = new Date();
let today = (date.getMonth() + 1) + "-" + date.getDate()
if ("4-4,9-18".indexOf(today) !== -1) {
  document.documentElement.style.filter = "grayscale(1)";
}</script></div><script defer src="/js/utils.js"></script><script defer src="/js/hexo-theme-yun.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"jsonPath":"live2d-widget-model-hijiki"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false,"tagMode":false});</script></body></html>