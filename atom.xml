<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>澈崽子 | 家有网工初长成</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://zeozzz.github.com/"/>
  <updated>2020-08-07T13:31:57.992Z</updated>
  <id>https://zeozzz.github.com/</id>
  
  <author>
    <name>澈崽子</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>新征程</title>
    <link href="https://zeozzz.github.com/2020/08/07/77/"/>
    <id>https://zeozzz.github.com/2020/08/07/77/</id>
    <published>2020-08-07T13:27:19.000Z</published>
    <updated>2020-08-07T13:31:57.992Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>新征程马上起航！</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>TCP的几个状态 (SYN, FIN, ACK, PSH, RST, URG)</title>
    <link href="https://zeozzz.github.com/2019/09/09/76/"/>
    <id>https://zeozzz.github.com/2019/09/09/76/</id>
    <published>2019-09-09T07:46:18.000Z</published>
    <updated>2020-01-21T02:11:42.281Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>在TCP层，有个FLAGS字段，这个字段有以下几个标识：SYN, FIN, ACK, PSH, RST, URG.</p><p>其中，对于我们日常的分析有用的就是前面的五个字段。</p><p>它们的含义是：</p><p>SYN表示建立连接，</p><p>FIN表示关闭连接，</p><p>ACK表示响应，</p><p>PSH表示有 DATA数据传输，</p><p>RST表示连接重置。</p><p>其中，ACK是可能与SYN，FIN等同时使用的，比如SYN和ACK可能同时为1，它表示的就是建立连接之后的响应，</p><p>如果只是单个的一个SYN，它表示的只是建立连接。</p><p>TCP的几次握手就是通过这样的ACK表现出来的。</p><p>但SYN与FIN是不会同时为1的，因为前者表示的是建立连接，而后者表示的是断开连接。</p><p>RST一般是在FIN之后才会出现为1的情况，表示的是连接重置。</p><a id="more"></a><p>一般地，当出现FIN包或RST包时，我们便认为客户端与服务器端断开了连接；而当出现SYN和SYN＋ACK包时，我们认为客户端与服务器建立了一个连接。</p><p>PSH为1的情况，一般只出现在 DATA内容不为0的包中，也就是说PSH为1表示的是有真正的TCP数据包内容被传递。</p><p>TCP的连接建立和连接关闭，都是通过请求－响应的模式完成的。</p><p>概念补充-TCP三次握手：</p><p>TCP(Transmission Control Protocol)传输控制协议</p><p>TCP是主机对主机层的传输控制协议，提供可靠的连接服务，采用三次握手确认建立一个连接：</p><p>位码即tcp标志位，有6种标示：SYN(synchronous建立联机) ACK(acknowledgement 确认) PSH(push传送) FIN(finish结束) RST(reset重置) URG(urgent紧急)Sequence number(顺序号码) Acknowledge number(确认号码)</p><p>第一次握手：主机A发送位码为syn＝1，随机产生seq number=1234567的数据包到服务器，主机B由SYN=1知道，A要求建立联机；</p><p>第二次握手：主机B收到请求后要确认联机信息，向A发送ack number=(主机A的seq+1)，syn=1，ack=1，随机产生seq=7654321的包；</p><p>第三次握手：主机A收到后检查ack number是否正确，即第一次发送的seq number+1，以及位码ack是否为1，若正确，主机A会再发送ack number=(主机B的seq+1)，ack=1，主机B收到后确认seq值与ack=1则连接建立成功。</p><p>完成三次握手，主机A与主机B开始传送数据。</p><p>在TCP/IP协议中，TCP协议提供可靠的连接服务，采用三次握手建立一个连接。<br>第一次握手：建立连接时，客户端发送syn包(syn=j)到服务器，并进入SYN_SEND状态，等待服务器确认；<br>第二次握手：服务器收到syn包，必须确认客户的SYN（ack=j+1），同时自己也发送一个SYN包（syn=k），即SYN+ACK包，此时服务器进入SYN_RECV状态；<br>第三次握手：客户端收到服务器的SYN＋ACK包，向服务器发送确认包ACK(ack=k+1)，此包发送完毕，客户端和服务器进入ESTABLISHED状态，完成三次握手。完成三次握手，客户端与服务器开始传送数据.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在TCP层，有个FLAGS字段，这个字段有以下几个标识：SYN, FIN, ACK, PSH, RST, URG.&lt;/p&gt;
&lt;p&gt;其中，对于我们日常的分析有用的就是前面的五个字段。&lt;/p&gt;
&lt;p&gt;它们的含义是：&lt;/p&gt;
&lt;p&gt;SYN表示建立连接，&lt;/p&gt;
&lt;p&gt;FIN表示关闭连接，&lt;/p&gt;
&lt;p&gt;ACK表示响应，&lt;/p&gt;
&lt;p&gt;PSH表示有 DATA数据传输，&lt;/p&gt;
&lt;p&gt;RST表示连接重置。&lt;/p&gt;
&lt;p&gt;其中，ACK是可能与SYN，FIN等同时使用的，比如SYN和ACK可能同时为1，它表示的就是建立连接之后的响应，&lt;/p&gt;
&lt;p&gt;如果只是单个的一个SYN，它表示的只是建立连接。&lt;/p&gt;
&lt;p&gt;TCP的几次握手就是通过这样的ACK表现出来的。&lt;/p&gt;
&lt;p&gt;但SYN与FIN是不会同时为1的，因为前者表示的是建立连接，而后者表示的是断开连接。&lt;/p&gt;
&lt;p&gt;RST一般是在FIN之后才会出现为1的情况，表示的是连接重置。&lt;/p&gt;
    
    </summary>
    
    
      <category term="wireshark" scheme="https://zeozzz.github.com/categories/wireshark/"/>
    
    
      <category term="wireshark" scheme="https://zeozzz.github.com/tags/wireshark/"/>
    
  </entry>
  
  <entry>
    <title>wireshark分析网站打开过程</title>
    <link href="https://zeozzz.github.com/2019/08/28/75/"/>
    <id>https://zeozzz.github.com/2019/08/28/75/</id>
    <published>2019-08-28T07:22:53.000Z</published>
    <updated>2020-01-21T09:30:14.811Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>最近在看数字证书，https相关的知识，发现之前也是模棱两可的了解，一点都不深入，这篇文章从DNS解析开始，分析打开https的网站从开始到结束的过程。</p><p><img src="https://image01.zhang-zhe.cn/20190904105254.png"></p><p>在从地址栏敲入域名之后，首先进行DNS的域名解析，抓包如下：</p><p><img src="https://image01.zhang-zhe.cn/20190904105458.png"></p><p>1、DNS请求&amp;DNS解析阶段</p><p>​    1.1、本机向DNS服务器发起DNS解析请求，使用UDP协议，报文结构如下：</p><p>​    <img src="https://image01.zhang-zhe.cn/20190904105608.png"></p><p>​    1.2、服务器向客户端发送请求的结果，同样使用UDP协议，报文结构如下：</p><p><img src="https://image01.zhang-zhe.cn/20190904105909.png"></p><p>​    <a id="more"></a></p><p>​    1.3、answers结果如下：</p><p>​    由于网站托管在又拍云上，部署了CDN，所以先回返回一个cname的解析结果到我绑定的域名。</p><p><img src="C:\Users\zhangzhe23\AppData\Roaming\Typora\typora-user-images\1567566039341.png" alt="1567566039341"></p><p>至此，DNS解析的阶段已经完成，只有两个包，客户端得到了服务端的IP地址，61.179.240.145</p><p>接下来就是客户端与服务端的交换。</p><p>3、开始进行TCP三次握手，抓包如下：</p><p><img src="https://image01.zhang-zhe.cn/20190904110407.png"></p><p>图中可以看到，TCP三次握手已经完成，连接建立，在此大概说一下TCP三次握手的流程，可以参考下文链接。</p><p>原文链接：<a href="https://juejin.im/post/5b29d2c4e51d4558b80b1d8c">https://juejin.im/post/5b29d2c4e51d4558b80b1d8c</a> </p><p>4、建立过后，开始进行数据的传输</p><p>因为网站使用了https加密，在wireshark中使用追踪TLS流的功能进行过滤，所以可以看到如下报文：</p><p><img src="https://image01.zhang-zhe.cn/20190904140335.png"></p><p>我们关注图中TLSV1.2的报文即可，报文记录了SSL握手从开始到结束的全过程，这也是笔者最近学习的，下面只是个人的理解，如有纰漏还请指出。</p><p><img src="https://image01.zhang-zhe.cn/20190904112100.png"></p><p>​        4.1、客户端发起client hello请求。</p><p>​        <img src="https://image01.zhang-zhe.cn/20190904112246.png"></p><p>​        其中包括了，浏览器给出协议的版本号为TLS 1.2，一个客户端生成的random随机数</p><p>​        <img src="https://image01.zhang-zhe.cn/20190904112708.png"></p><p>​        支持下列加密算法。</p><p>​        <img src="https://image01.zhang-zhe.cn/20190904112642.png"></p><p>​        其他相关参数。</p><p>​        <img src="https://image01.zhang-zhe.cn/20190904140238.png"></p><p>​        签名算法，服务器名称等等。</p><p>​        </p><p>​        汇总来说，这一步进行了下列操作。</p><p>​        TLS的版本</p><p>​        随机数：这个是用来生成最后加密密钥的影响因子之一，包含两部分：时间戳（4-Bytes）和随机数（28-Bytes）</p><p>​        session-id：用来表明一次会话，第一次建立没有。如果以前建立过，可以直接带过去。后面的扩展内容会详细讲到。</p><p>​        加密算法套装列表：客户端支持的加密-签名算法的列表，让服务器去选择。</p><p>​        压缩算法：似乎一般都不用扩展字段：比如密码交换算法的参数、请求主机的名字等等</p><p>​    4.2、服务端响应Server hello给客户端。</p><p>​    <img src="https://image01.zhang-zhe.cn/20190904140420.png"></p><p>​    其中包含的信息和client hello有异曲同工之妙。</p><p>​    4.3、服务端server hello完成。</p><p>​    <img src="https://image01.zhang-zhe.cn/20190904141337.png"></p><p>​    这个报文中包含了两方面的信息，一个是</p><p>​    </p><p>​    写一半太忙，不想写了，这篇文章写得比我好。</p><p>​    <a href="https://www.jianshu.com/p/a3a25c6627ee">https://www.jianshu.com/p/a3a25c6627ee</a></p><p><img src="https://image01.zhang-zhe.cn/20190904144256.png"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近在看数字证书，https相关的知识，发现之前也是模棱两可的了解，一点都不深入，这篇文章从DNS解析开始，分析打开https的网站从开始到结束的过程。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://image01.zhang-zhe.cn/20190904105254.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;在从地址栏敲入域名之后，首先进行DNS的域名解析，抓包如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://image01.zhang-zhe.cn/20190904105458.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;1、DNS请求&amp;amp;DNS解析阶段&lt;/p&gt;
&lt;p&gt;​    1.1、本机向DNS服务器发起DNS解析请求，使用UDP协议，报文结构如下：&lt;/p&gt;
&lt;p&gt;​    &lt;img src=&quot;https://image01.zhang-zhe.cn/20190904105608.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;​    1.2、服务器向客户端发送请求的结果，同样使用UDP协议，报文结构如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://image01.zhang-zhe.cn/20190904105909.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;​
    
    </summary>
    
    
      <category term="wireshark" scheme="https://zeozzz.github.com/categories/wireshark/"/>
    
    
      <category term="wireshark" scheme="https://zeozzz.github.com/tags/wireshark/"/>
    
  </entry>
  
  <entry>
    <title>无线AP上线中需要的option</title>
    <link href="https://zeozzz.github.com/2019/08/27/74/"/>
    <id>https://zeozzz.github.com/2019/08/27/74/</id>
    <published>2019-08-27T08:50:15.000Z</published>
    <updated>2020-01-21T09:30:44.453Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p> 　　华三AP支持的Option 43属性：</p><p>　　在L3 Switch上启用DHCP Server，正确配置Option43，例如AP属于VLAN100，是192.168.100.0/24网段，AC的IP地址为192.168.10.100/24，只支持16进制，DHCP Server配置如下：</p><p>　　[AC] dhcp server ip-pool vlan100</p><p>　　[AC-dhcp-pool-vlan100] network 192.168.100.0 mask 255.255.255.0</p><p>　　[AC-dhcp-pool-vlan100] gateway-list 192.168.100.254</p><p>　　[AC-dhcp-pool-vlan100] option 43 hex 80070000 01 C0A80A64</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">　　#80：选项类型，固定为80，1个字节。</span><br><span class="line"></span><br><span class="line">　　#07：选项长度，表示其后内容的长度(十六进制数的个数，这里表示后面有7个十六进制数，0B表示后面有11个十六进制数)，一个字节。</span><br><span class="line"></span><br><span class="line">　　#0000：Server type，固定配为0000两个字节。</span><br><span class="line"></span><br><span class="line">　　#01：后面IP地址的个数，一个字节。</span><br><span class="line"></span><br><span class="line">　　# C0A80A64： AC的IP地址192.168.10.100的十六进制表示。</span><br><span class="line"></span><br><span class="line">　　注意：dhcp server option 43的选项中最多支持下发14个ip地址，且为了满足这个最大的规格，option43的选项配置参照以下方式(每段最大4个字节，最小1个字节，大小写都可以)：</span><br><span class="line"></span><br><span class="line">　　option 43 hex 803f0000 0e c0a80a60 c0a80a61 c0a80a62 c0a80a63 c0a80a64 c0a80a65 c0a80a66 c0a80a67 c0a80a68 c0a80a69 c0a80a70 c0a80a71 c0a80a72 c0a80a73</span><br></pre></td></tr></table></figure><p>　　华为AP支持的Option 43属性：</p><p>　　AC的IP地址为192.168.10.100/24,既支持16进制又支持10进制</p><p>　　[Dhcp-hw] ip pool ap</p><p>　　[Dhcp-hw-ip-pool-huawei]network 192.168.100.0 255.255.255.0</p><p>　　[Dhcp-hw-ip-pool-huawei]gateaway-list 192.168.100.254</p><p>　　[Dhcp-hw-ip-pool-huawei]option 43 sub-option 3 hex 3139322e3136382e31302e313030 or option 43 sub-option 3 ascii 192.168.10.100</p><p>　　Sub-option 3为option 43的子类型，后面跟的16进制包含小数点一起，16进制数31对应字符“1”的ASCII值，32对应“2”的ASCII值，以此类推，2e代表“.”的值，2c代表“,”的值。</p><p>　　如果有两个AC地址的话，中间要用逗号隔开(asicc码：2c)，比如AC的IP地址为192.168.10.100和192.168.1.100.option 43属性如下：</p><p>　　[Dhcp-hw-ip-pool-huawei]option 43 sub-option 3 hex 3139322e3136382e31302e3130302c</p><p>　　3139322e3136382e312e313030 or option 43 sub-option 3 ascii 192.168.10.100，192.168.1.100</p><p>​    <a id="more"></a></p><p>　　思科AP支持的Option 43属性：</p><p>　　AC的IP地址为192.168.10.100/24,只支持16进制。</p><p>　　Dhcp-sw(config)#ip dhcp pool AP</p><p>　　Dhcp-sw(dhcp-config)#network 192.168.100.0 /24</p><p>　　Dhcp-sw(dhcp-config)#default-route 102.168.100.254</p><p>　　Dhcp-sw(dhcp-config)#option 43 hex f1040c0a80a64</p><p>　　Hex是固定的，标识为16进制，f1是固定type,04代表地址长度，一个地址4位，如果两个地址则为08，c0a80a64标识192.168.10.100</p><p>　　如果华为的交换机和思科的交换机不支持我们AP支持的option 43格式，那么我们AP就没办法识别，从而完成不了注册。</p><p>　　现场华为交换机下发的为自己AP支持的option 43的属性，而我们AP不识别，导致我们AP没有获取到AC的IP地址，出现注册不上的情况。</p><p><strong>在做WLAN工程时AP需要使用option 43方式注册到AC,下面讲解一下简单案例</strong><br><strong>注册一个192.168.1.2的AP此时option 43 hex应填数据为：80 07 00 00 01 c0 a8 01  02</strong><br><strong>下面解释一下这个结果是如何得出：</strong><br><strong>80 ：固定端口，不能改变</strong><br><strong>07：表示其后内容长度（16进制表示），这个后位是7位，16进制时还是7</strong><br><strong>0000：固定配置</strong><br><strong>01：表示只有一个IP</strong><br><strong>C0 A8 01 02：192.168.1.2的十六进制表示</strong></p><p><img src="https://s3.51cto.com/wyfs02/M01/33/E4/wKiom1OqlzrD8wuYAAFSflpEGcA131.jpg" alt="option 43.jpg"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt; 　　华三AP支持的Option 43属性：&lt;/p&gt;
&lt;p&gt;　　在L3 Switch上启用DHCP Server，正确配置Option43，例如AP属于VLAN100，是192.168.100.0/24网段，AC的IP地址为192.168.10.100/24，只支持16进制，DHCP Server配置如下：&lt;/p&gt;
&lt;p&gt;　　[AC] dhcp server ip-pool vlan100&lt;/p&gt;
&lt;p&gt;　　[AC-dhcp-pool-vlan100] network 192.168.100.0 mask 255.255.255.0&lt;/p&gt;
&lt;p&gt;　　[AC-dhcp-pool-vlan100] gateway-list 192.168.100.254&lt;/p&gt;
&lt;p&gt;　　[AC-dhcp-pool-vlan100] option 43 hex 80070000 01 C0A80A64&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;　　#80：选项类型，固定为80，1个字节。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;　　#07：选项长度，表示其后内容的长度(十六进制数的个数，这里表示后面有7个十六进制数，0B表示后面有11个十六进制数)，一个字节。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;　　#0000：Server type，固定配为0000两个字节。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;　　#01：后面IP地址的个数，一个字节。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;　　# C0A80A64： AC的IP地址192.168.10.100的十六进制表示。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;　　注意：dhcp server option 43的选项中最多支持下发14个ip地址，且为了满足这个最大的规格，option43的选项配置参照以下方式(每段最大4个字节，最小1个字节，大小写都可以)：&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;　　option 43 hex 803f0000 0e c0a80a60 c0a80a61 c0a80a62 c0a80a63 c0a80a64 c0a80a65 c0a80a66 c0a80a67 c0a80a68 c0a80a69 c0a80a70 c0a80a71 c0a80a72 c0a80a73&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;　　华为AP支持的Option 43属性：&lt;/p&gt;
&lt;p&gt;　　AC的IP地址为192.168.10.100/24,既支持16进制又支持10进制&lt;/p&gt;
&lt;p&gt;　　[Dhcp-hw] ip pool ap&lt;/p&gt;
&lt;p&gt;　　[Dhcp-hw-ip-pool-huawei]network 192.168.100.0 255.255.255.0&lt;/p&gt;
&lt;p&gt;　　[Dhcp-hw-ip-pool-huawei]gateaway-list 192.168.100.254&lt;/p&gt;
&lt;p&gt;　　[Dhcp-hw-ip-pool-huawei]option 43 sub-option 3 hex 3139322e3136382e31302e313030 or option 43 sub-option 3 ascii 192.168.10.100&lt;/p&gt;
&lt;p&gt;　　Sub-option 3为option 43的子类型，后面跟的16进制包含小数点一起，16进制数31对应字符“1”的ASCII值，32对应“2”的ASCII值，以此类推，2e代表“.”的值，2c代表“,”的值。&lt;/p&gt;
&lt;p&gt;　　如果有两个AC地址的话，中间要用逗号隔开(asicc码：2c)，比如AC的IP地址为192.168.10.100和192.168.1.100.option 43属性如下：&lt;/p&gt;
&lt;p&gt;　　[Dhcp-hw-ip-pool-huawei]option 43 sub-option 3 hex 3139322e3136382e31302e3130302c&lt;/p&gt;
&lt;p&gt;　　3139322e3136382e312e313030 or option 43 sub-option 3 ascii 192.168.10.100，192.168.1.100&lt;/p&gt;
&lt;p&gt;​
    
    </summary>
    
    
      <category term="无线" scheme="https://zeozzz.github.com/categories/%E6%97%A0%E7%BA%BF/"/>
    
    
      <category term="无线" scheme="https://zeozzz.github.com/tags/%E6%97%A0%E7%BA%BF/"/>
    
  </entry>
  
  <entry>
    <title>理解wireshark中的length字段含义</title>
    <link href="https://zeozzz.github.com/2019/08/22/73/"/>
    <id>https://zeozzz.github.com/2019/08/22/73/</id>
    <published>2019-08-22T02:25:04.000Z</published>
    <updated>2020-01-21T09:34:19.066Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>原文链接：<a href="https://www.louxiaohui.com/2018/06/29/understanding-the-length-field-in-wireshark/">https://www.louxiaohui.com/2018/06/29/understanding-the-length-field-in-wireshark/</a></p><p>主要介绍wireshark中的length计算方法，主要涉及MTU、MSS、常见协议头大小。</p><h2 id="length含义"><a href="#length含义" class="headerlink" title="length含义"></a>length含义</h2><p>Wireshark is showing you the length of the Ethernet frame that is handed to it, which may or may not include the FCS.</p><p>wireshark显示的长度为以太网帧的长度，不包括FCS(Frame check sequence)[帧校验序列]</p><h2 id="常见协议头大小"><a href="#常见协议头大小" class="headerlink" title="常见协议头大小"></a>常见协议头大小</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Ethernet header: 14 bytes # 数据链路层帧头大小，一般为14bytes,其为源MAC(6bytes&#x2F;48bits)+目的MAC(6bytes&#x2F;48bits)+类型&#x2F;长度(2bytes)</span><br><span class="line">IP header (standard): 20 bytes # IP头部大小</span><br><span class="line">ICMP header: 8 bytes     # ICMP头部大小</span><br><span class="line">ICMP payload: 32 bytes   # ICMP缓冲区大小，可以通过ping的-l选项指定大小，默认为32。</span><br><span class="line">FCS 4 bytes of Ethernet checksum # 帧尾CRC校验</span><br></pre></td></tr></table></figure><h2 id="length计算"><a href="#length计算" class="headerlink" title="length计算"></a>length计算</h2><p>MTU=MSS+IP header(20 bytes)+tcp header(20 bytes)</p><p>length=MTU+Ethernet header(14bytes)</p><p>其中MSS为Maximum Segment Size，即最大报文段长度，其受MTU大小影响，这里的MTU指的是三层的，二层的MTU固定为1500，不能修改。</p><p>MTU为Maximum Transmission Unit,即最大传输单元，需要注意MTU如果太小会影响收到数据包的速度，表现为下载过慢。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">三层收到大数据包时，要将数据包分片后再往下层传输，这就是IP分片原理。既然IP分片可以改变一个IP数据包的大小 ，那么IP分片怎么设置呢？</span><br><span class="line">这也是网上人们所谓的修改MTU值达到最佳网速的方法，而这里所说的修改“MTU”大小其实是IP分片的大小。</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2018/06/29/5b351f365f656.png" alt="2.png"><img src="https://i.loli.net/2018/06/29/5b351195a1754.png" alt="1.png"></p><p>从截图中可以看到MSS为1460，MTU计算后为1500，1460 + 20(IP header) + 20(tcp header) = 1500</p><h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><ul><li>问题</li></ul><p>同一局域网中，同样的操作系统，同样的URL链接，同样的端口，使用ESXI虚拟出来的两台虚机，分别绑定host，使用wget测试下载速度，一个下载200K/s，一个10M/s。</p><table><thead><tr><th align="center">url</th><th align="center">IP</th><th align="center">下载速度</th><th align="center">截图</th></tr></thead><tbody><tr><td align="center"><a href="http://192.168.28.210:8989/mac_3.4.196_1530084415522.zip">http://192.168.28.210:8989/mac_3.4.196_1530084415522.zip</a></td><td align="center">192.168.28.210</td><td align="center">10M/s</td><td align="center"><img src="https://i.loli.net/2018/06/29/5b352a1874907.png" alt="1.png"></td></tr><tr><td align="center"><a href="http://192.168.28.41:8989/mac_3.4.196_1530084415522.zip">http://192.168.28.41:8989/mac_3.4.196_1530084415522.zip</a></td><td align="center">192.168.28.41</td><td align="center">200K/s</td><td align="center"><img src="https://i.loli.net/2018/06/29/5b352a188d348.png" alt="2.png"></td></tr></tbody></table><ul><li>解决</li></ul><a id="more"></a><p>抓包后发现：</p><p>28.41的Length为1294，MSS为1240,推断其MTU为1280</p><p>28.210的Length为1514，MSS为1460，推断其MTU为1500</p><p>猜测其网卡设置不同，进入宿主机看网卡设置，28.41的网卡类型不是E1000，28.210的E1000，将28.41的网卡类型改为E1000后测试，恢复。</p><p><img src="https://i.loli.net/2018/06/29/5b352a189d02c.png" alt="3.png"> <img src="https://i.loli.net/2018/06/29/5b352a18a2889.png" alt="4.png"><img src="https://i.loli.net/2018/06/29/5b352a18a4726.png" alt="5.png"></p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://osqa-ask.wireshark.org/questions/44865/length-field">length field</a></p><p><a href="http://www.hackingarticles.in/understanding-guide-icmp-protocol-wireshark/">Understanding Guide to ICMP Protocol with Wireshark</a></p><p><a href="https://blog.csdn.net/chiyuwei1766/article/details/50762894">ireshark实战之：MTU、MSS及计算方法</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;原文链接：&lt;a href=&quot;https://www.louxiaohui.com/2018/06/29/understanding-the-length-field-in-wireshark/&quot;&gt;https://www.louxiaohui.com/2018/06/29/understanding-the-length-field-in-wireshark/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;主要介绍wireshark中的length计算方法，主要涉及MTU、MSS、常见协议头大小。&lt;/p&gt;
&lt;h2 id=&quot;length含义&quot;&gt;&lt;a href=&quot;#length含义&quot; class=&quot;headerlink&quot; title=&quot;length含义&quot;&gt;&lt;/a&gt;length含义&lt;/h2&gt;&lt;p&gt;Wireshark is showing you the length of the Ethernet frame that is handed to it, which may or may not include the FCS.&lt;/p&gt;
&lt;p&gt;wireshark显示的长度为以太网帧的长度，不包括FCS(Frame check sequence)[帧校验序列]&lt;/p&gt;
&lt;h2 id=&quot;常见协议头大小&quot;&gt;&lt;a href=&quot;#常见协议头大小&quot; class=&quot;headerlink&quot; title=&quot;常见协议头大小&quot;&gt;&lt;/a&gt;常见协议头大小&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Ethernet header: 14 bytes # 数据链路层帧头大小，一般为14bytes,其为源MAC(6bytes&amp;#x2F;48bits)+目的MAC(6bytes&amp;#x2F;48bits)+类型&amp;#x2F;长度(2bytes)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;IP header (standard): 20 bytes # IP头部大小&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ICMP header: 8 bytes     # ICMP头部大小&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ICMP payload: 32 bytes   # ICMP缓冲区大小，可以通过ping的-l选项指定大小，默认为32。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;FCS 4 bytes of Ethernet checksum # 帧尾CRC校验&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;length计算&quot;&gt;&lt;a href=&quot;#length计算&quot; class=&quot;headerlink&quot; title=&quot;length计算&quot;&gt;&lt;/a&gt;length计算&lt;/h2&gt;&lt;p&gt;MTU=MSS+IP header(20 bytes)+tcp header(20 bytes)&lt;/p&gt;
&lt;p&gt;length=MTU+Ethernet header(14bytes)&lt;/p&gt;
&lt;p&gt;其中MSS为Maximum Segment Size，即最大报文段长度，其受MTU大小影响，这里的MTU指的是三层的，二层的MTU固定为1500，不能修改。&lt;/p&gt;
&lt;p&gt;MTU为Maximum Transmission Unit,即最大传输单元，需要注意MTU如果太小会影响收到数据包的速度，表现为下载过慢。&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;三层收到大数据包时，要将数据包分片后再往下层传输，这就是IP分片原理。既然IP分片可以改变一个IP数据包的大小 ，那么IP分片怎么设置呢？&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;这也是网上人们所谓的修改MTU值达到最佳网速的方法，而这里所说的修改“MTU”大小其实是IP分片的大小。&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&quot;https://i.loli.net/2018/06/29/5b351f365f656.png&quot; alt=&quot;2.png&quot;&gt;&lt;img src=&quot;https://i.loli.net/2018/06/29/5b351195a1754.png&quot; alt=&quot;1.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;从截图中可以看到MSS为1460，MTU计算后为1500，1460 + 20(IP header) + 20(tcp header) = 1500&lt;/p&gt;
&lt;h2 id=&quot;遇到的问题&quot;&gt;&lt;a href=&quot;#遇到的问题&quot; class=&quot;headerlink&quot; title=&quot;遇到的问题&quot;&gt;&lt;/a&gt;遇到的问题&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;问题&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;同一局域网中，同样的操作系统，同样的URL链接，同样的端口，使用ESXI虚拟出来的两台虚机，分别绑定host，使用wget测试下载速度，一个下载200K/s，一个10M/s。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;center&quot;&gt;url&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;IP&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;下载速度&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;截图&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;&lt;a href=&quot;http://192.168.28.210:8989/mac_3.4.196_1530084415522.zip&quot;&gt;http://192.168.28.210:8989/mac_3.4.196_1530084415522.zip&lt;/a&gt;&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;192.168.28.210&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;10M/s&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;img src=&quot;https://i.loli.net/2018/06/29/5b352a1874907.png&quot; alt=&quot;1.png&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;&lt;a href=&quot;http://192.168.28.41:8989/mac_3.4.196_1530084415522.zip&quot;&gt;http://192.168.28.41:8989/mac_3.4.196_1530084415522.zip&lt;/a&gt;&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;192.168.28.41&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;200K/s&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;&lt;img src=&quot;https://i.loli.net/2018/06/29/5b352a188d348.png&quot; alt=&quot;2.png&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;解决&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="wireshark" scheme="https://zeozzz.github.com/categories/wireshark/"/>
    
    
      <category term="wireshark" scheme="https://zeozzz.github.com/tags/wireshark/"/>
    
  </entry>
  
  <entry>
    <title>路由协议的优先级，以及管理距离AD和metric的区别</title>
    <link href="https://zeozzz.github.com/2019/08/14/72/"/>
    <id>https://zeozzz.github.com/2019/08/14/72/</id>
    <published>2019-08-14T11:29:23.000Z</published>
    <updated>2020-01-21T09:34:35.635Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>路由协议的优先级（Preference，即<strong>管理距离**</strong>Administrative Distance**）一般为一个0到255之间的数字，数字越大则优先级越低。表一是通常情况下各路由协议的优先级规定：</p><p>表一：一般路由协议优先级</p><table><thead><tr><th>路由协议</th><th>优先级</th></tr></thead><tbody><tr><td>DIRECT</td><td>0</td></tr><tr><td>OSPF</td><td>10</td></tr><tr><td>IS-IS Level 1</td><td>15</td></tr><tr><td>IS-IS Level 2</td><td>18</td></tr><tr><td>NSFnet主干的SPF</td><td>19</td></tr><tr><td>缺省网关和EGP缺省</td><td>20</td></tr><tr><td>重定向路由</td><td>30</td></tr><tr><td>由route socket得到的路由</td><td>40</td></tr><tr><td>由网关加入的路由</td><td>50</td></tr><tr><td>路由器发现的路由</td><td>55</td></tr><tr><td>静态路由</td><td>60</td></tr><tr><td>CISCO IGRP</td><td>80</td></tr><tr><td>DCN HELLO</td><td>90</td></tr><tr><td>Berkeley RIP</td><td>100</td></tr><tr><td>点对点接口聚集的路由</td><td>110</td></tr><tr><td>Down状态的接口路由</td><td>120</td></tr><tr><td>聚集的缺省路由</td><td>130</td></tr><tr><td>OSPF的扩展路由</td><td>140</td></tr><tr><td>BGP</td><td>170</td></tr><tr><td>EGP</td><td>200</td></tr></tbody></table><p>各产品厂商可能对路由协议的优先级有不同的规定，表二、表三分别列出了华为、思科路由器路由优先级列表：</p><p>表二：华为路由器路由优先级</p><table><thead><tr><th>路由协议</th><th>优先级</th></tr></thead><tbody><tr><td>DIRECT</td><td>0</td></tr><tr><td>OSPF</td><td>10</td></tr><tr><td>STATIC</td><td>60</td></tr><tr><td>IGRP</td><td>80</td></tr><tr><td>RIP</td><td>110</td></tr><tr><td>OSPFASE</td><td>150</td></tr><tr><td>BGP</td><td>170</td></tr></tbody></table><p>表三：思科路由器路由协议优先级</p><table><thead><tr><th>路由协议</th><th>优先级</th></tr></thead><tbody><tr><td>DIRECT</td><td>0</td></tr><tr><td>STATIC</td><td>1</td></tr><tr><td>EIGRP Summary</td><td>5</td></tr><tr><td>EBGP</td><td>20</td></tr><tr><td>内部EIGRP</td><td>90</td></tr><tr><td>IGRP</td><td>100</td></tr><tr><td>OSPF</td><td>110</td></tr><tr><td>IS-IS</td><td>115</td></tr><tr><td>RIP</td><td>120</td></tr><tr><td>EGP</td><td>140</td></tr><tr><td>外部EIGRP</td><td>170</td></tr><tr><td>IBGP</td><td>200</td></tr><tr><td>未知</td><td>255</td></tr></tbody></table><p>路由的优先级的概念是优先级高的新路由协议可替代优先级低的同信宿路由，反之，则不然。</p> <a id="more"></a><p>需要区别的是路由开销（metric）和路由优先级（preference）这两个概念。metric是针对同一种路由协议而言，对不同的路由协议，由于代表的含义不同，比较不同协议的metric是无意义的，所以要在两条不同协议的同信宿路由中作出选择，只能比较路由协议的优先级。相反，preference是针对不同路由协议而言，同协议的路由的preference优先级是一般情况下一样的，这时metric是在两条同信宿路由中作出选择的标准。</p><p><strong>总结：路由优先级在不同协议时候，比较preference**</strong>的大小，而在路由协议相同时候由于preference**<strong>相同，则再比较metric**</strong>的大小，进而确定最终选择的路由。**</p><p><strong>一般在ip route**</strong>命令中静态路由中的参数“Distance metric for this route**<strong>“都是指metric**</strong>参数，而Administrative Distance**<strong>在使用不同路由协议间比较时候，都使用默认值，如上表。一般Administrative Distance**</strong>值不单独写出来，除非要更改其默认值。**</p><p>PS：对于小规模的网络，使用静态路由方式很合适，以下为cisco的静态路由配置命令：</p><p>Static Routing</p><p>　　静态路由:手动填加路由线路到路由表中,优点是:<br>1.没有额外的router的CPU负担<br>2.节约带宽<br>3.增加安全性</p><p>　　缺点是:<br>1.网络管理员必须了解网络的整个拓扑结构<br>2.如果网络拓扑发生变化,管理员要在所有的routers上手动修改路由表<br>3.不适合在大型网络中<br>　　静态路由的配置命令:ip route [dest-network] [mask] [next-hop address或exit interface][administrative distance] [permanent]<br>ip route:创建静态路由<br>dest-network:决定放入路由表的路由表<br>mask:掩码<br>next-hop address:下1跳的router地址<br>exit interface:如果你愿意的话可以拿这个来替换next-hop address,但是这个是用于点对点(point-to-point)连接上,比如广域网(WAN)连接,这个命令不会工作在LAN上<br>administrative distance:默认情况下,静态路由的管理距离是1,如果你用exit interface代替next-hop address,那么管理距离是0 <strong>（不同协议是**</strong>AD**<strong>，但是对于相同路由协议时候，是指**</strong>metric**<strong>）</strong>permanent:如果接口被shutdown了或者router不能和下1跳router通信,这条路由线路将自动从路由表中被删除.使用这个参数保证即使出现上述情况,这条路线仍然保持在路由表中。</p><p><strong>路由表中的管理距离（**</strong>Administrative Distance**<strong>）和度量值（**</strong>Metric**<strong>）</strong></p><p>R1#show ip route<br>…省略<br><strong>R    10.2.0.0[120/1] via 10.1.1.2,00:00:21,Serial0/0</strong><br>C    10.3.0.0 is directly connected,Serial0/1<br>#####################################################################<br>在输出中，首先显示路由条目各种类型的简写，如“C”为直连网络，“S”为静态路由。<br>以上面粗体的路由为例：<br>“R”————————-表示这条路由是“RIP”协议学习得到的；<br>“10.2.0.0”—————–是目的网络；<br>“[120/1]”——————-是管理距离（Administrative Distance,AD）/ 度量值（Metric）；<br>“via 10.1.1.2”————-是指到达目的网络的下一跳路由器IP地址；<br>“00:00:21”—————–是指路由器最近一次得知路由到现在的时间；<br>“Serial 0/0”—————-是指到达下一跳应从哪个端口出去。</p><p>技术要点：<br><strong>管理距离（**</strong>AD**<strong>，**</strong>Administrative Distance**<strong>）：</strong><br>       用来表示路由器可能从多种途径获得同一路由，例如，一个路由器要获得“10.2.0.0/24”网络的路由，可以来自RIP，也可以是静态路由。不同途径获得的路由可能采取不同的路径到达目的网络，为了区分不同路由协议的可信度，用管理距离加以表示。<br>       管理距离越小，说明路由的可信度越高；静态路由的管理距离为1，说明手工输入的路由优先级高于其他的路由。</p><table><thead><tr><th>路由协议</th><th>优先级</th></tr></thead><tbody><tr><td>DIRECT</td><td>0</td></tr><tr><td>STATIC</td><td>1</td></tr><tr><td>EIGRP Summary</td><td>5</td></tr><tr><td>EBGP</td><td>20</td></tr><tr><td>内部EIGRP</td><td>90</td></tr><tr><td>IGRP</td><td>100</td></tr><tr><td>OSPF</td><td>110</td></tr><tr><td>IS-IS</td><td>115</td></tr><tr><td>RIP</td><td>120</td></tr><tr><td>EGP</td><td>140</td></tr><tr><td>外部EIGRP</td><td>170</td></tr><tr><td>IBGP</td><td>200</td></tr><tr><td>未知</td><td>255</td></tr></tbody></table><p> <strong>度量值（**</strong>Metric**<strong>）：</strong><br>       某一个路由协议（相同路由协议）判别到达目的的网络的最佳的方法。当一路由器有多条路径到达某一目的网络时，路由协议必须判断其中哪一条是最佳的并把它放到路由表中，路由协议会给每一条路径计算出一个数，这个数就是度量值，通常这个值是没有单位的。<br>       度量值越小，这条路径越佳。然而不同的路由协议定义度量值的方法不是一样的，所以不同的路由协议选择出的最佳距离可能也是不一样的。</p><p>重分发进rip或eigrp的其他协议若不指定metric的话，默认为无穷大。</p><p>重分发进ospf的其他协议若不指定metric的话，除了BGP为1外，默认为20.</p><p>重分发进BGP的其他协议的metric值为其本身的metric值不变<br>-————————————————————————————————————————–</p><p> <strong>度量值（**</strong>Metric**<strong>）指明了路径的优先权，而管理距离（**</strong>AD**<strong>）指明了发现路由方式的优先权**</strong>。**</p><p>同一种路由协议比较<a href="http://wenwen.soso.com/z/Search.e?sp=S%E5%BA%A6%E9%87%8F%E5%80%BC&ch=w.search.yjjlink&cid=w.search.yjjlink">度量值</a>，而不同路由协议比较<a href="http://wenwen.soso.com/z/Search.e?sp=S%E7%AE%A1%E7%90%86%E8%B7%9D%E7%A6%BB&ch=w.search.yjjlink&cid=w.search.yjjlink">管理距离</a>，OSPF还有E1 2之分 cost也不同</p><p>外部协议路由重分布进OSPF 默认是E2  默认是20 bgp除外 E1的话要把经过cost都计算在内 。</p><p><strong>同种协议管理距离一样**</strong>，所以比较**<strong>metric</strong> <strong>，不同协议比较管理距离**</strong>越小越优先** <strong>。</strong></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;路由协议的优先级（Preference，即&lt;strong&gt;管理距离**&lt;/strong&gt;Administrative Distance**）一般为一个0到255之间的数字，数字越大则优先级越低。表一是通常情况下各路由协议的优先级规定：&lt;/p&gt;
&lt;p&gt;表一：一般路由协议优先级&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;路由协议&lt;/th&gt;
&lt;th&gt;优先级&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;DIRECT&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;OSPF&lt;/td&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;IS-IS Level 1&lt;/td&gt;
&lt;td&gt;15&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;IS-IS Level 2&lt;/td&gt;
&lt;td&gt;18&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;NSFnet主干的SPF&lt;/td&gt;
&lt;td&gt;19&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;缺省网关和EGP缺省&lt;/td&gt;
&lt;td&gt;20&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;重定向路由&lt;/td&gt;
&lt;td&gt;30&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;由route socket得到的路由&lt;/td&gt;
&lt;td&gt;40&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;由网关加入的路由&lt;/td&gt;
&lt;td&gt;50&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;路由器发现的路由&lt;/td&gt;
&lt;td&gt;55&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;静态路由&lt;/td&gt;
&lt;td&gt;60&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CISCO IGRP&lt;/td&gt;
&lt;td&gt;80&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;DCN HELLO&lt;/td&gt;
&lt;td&gt;90&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Berkeley RIP&lt;/td&gt;
&lt;td&gt;100&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;点对点接口聚集的路由&lt;/td&gt;
&lt;td&gt;110&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Down状态的接口路由&lt;/td&gt;
&lt;td&gt;120&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;聚集的缺省路由&lt;/td&gt;
&lt;td&gt;130&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;OSPF的扩展路由&lt;/td&gt;
&lt;td&gt;140&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;BGP&lt;/td&gt;
&lt;td&gt;170&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;EGP&lt;/td&gt;
&lt;td&gt;200&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;p&gt;各产品厂商可能对路由协议的优先级有不同的规定，表二、表三分别列出了华为、思科路由器路由优先级列表：&lt;/p&gt;
&lt;p&gt;表二：华为路由器路由优先级&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;路由协议&lt;/th&gt;
&lt;th&gt;优先级&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;DIRECT&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;OSPF&lt;/td&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;STATIC&lt;/td&gt;
&lt;td&gt;60&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;IGRP&lt;/td&gt;
&lt;td&gt;80&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;RIP&lt;/td&gt;
&lt;td&gt;110&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;OSPFASE&lt;/td&gt;
&lt;td&gt;150&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;BGP&lt;/td&gt;
&lt;td&gt;170&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;p&gt;表三：思科路由器路由协议优先级&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;路由协议&lt;/th&gt;
&lt;th&gt;优先级&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;DIRECT&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;STATIC&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;EIGRP Summary&lt;/td&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;EBGP&lt;/td&gt;
&lt;td&gt;20&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;内部EIGRP&lt;/td&gt;
&lt;td&gt;90&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;IGRP&lt;/td&gt;
&lt;td&gt;100&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;OSPF&lt;/td&gt;
&lt;td&gt;110&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;IS-IS&lt;/td&gt;
&lt;td&gt;115&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;RIP&lt;/td&gt;
&lt;td&gt;120&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;EGP&lt;/td&gt;
&lt;td&gt;140&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;外部EIGRP&lt;/td&gt;
&lt;td&gt;170&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;IBGP&lt;/td&gt;
&lt;td&gt;200&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;未知&lt;/td&gt;
&lt;td&gt;255&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;p&gt;路由的优先级的概念是优先级高的新路由协议可替代优先级低的同信宿路由，反之，则不然。&lt;/p&gt;
    
    </summary>
    
    
      <category term="路由" scheme="https://zeozzz.github.com/categories/%E8%B7%AF%E7%94%B1/"/>
    
    
      <category term="路由" scheme="https://zeozzz.github.com/tags/%E8%B7%AF%E7%94%B1/"/>
    
  </entry>
  
  <entry>
    <title>无题</title>
    <link href="https://zeozzz.github.com/2019/08/09/71/"/>
    <id>https://zeozzz.github.com/2019/08/09/71/</id>
    <published>2019-08-09T09:00:03.000Z</published>
    <updated>2019-08-09T11:05:27.141Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>好久没来哔哔了。。。唉，静心静心。。。</p><p>nodejs挂了 重新装了一下可以用了。最近进步还是很慢。。。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla
      
    
    </summary>
    
    
      <category term="自嘲" scheme="https://zeozzz.github.com/categories/%E8%87%AA%E5%98%B2/"/>
    
    
      <category term="自嘲" scheme="https://zeozzz.github.com/tags/%E8%87%AA%E5%98%B2/"/>
    
  </entry>
  
  <entry>
    <title>再谈双向NAT</title>
    <link href="https://zeozzz.github.com/2019/07/18/70/"/>
    <id>https://zeozzz.github.com/2019/07/18/70/</id>
    <published>2019-07-18T02:48:11.000Z</published>
    <updated>2020-01-21T09:34:49.216Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="出现背景"><a href="#出现背景" class="headerlink" title="出现背景:"></a>出现背景:</h3><p><a href="https://www.tuchuang001.com/image/K83AW"><img src="https://www.tuchuang001.com/images/2017/06/09/0a5b4b39c301b479.png" alt="0a5b4b39c301b479.png"></a><br>在防火墙上部署了NATserver后，外网用户可以访问内部服务器。一般内部服务器都会通过一个域名进行解析。但如果内网用户也想通过此域名访问服务器就会出现问题。</p><h3 id="原因分析："><a href="#原因分析：" class="headerlink" title="原因分析："></a>原因分析：</h3><ol><li>内网用户要想访问internet,需要在防火墙上做个源NAT，将内网用户的网段转换为公网ip</li><li>假设pc通过公网ip 200.1.1.100 访问服务器，在出防火墙时防火墙做可源NAT会将PC的原地址转换为200.1.1.100将数据包交出去。</li><li>防火墙上配置了NATserver，将公网ip 200.1.1.100映射为服务器的私网地址192.168.1.100。数据包会交给服务器。</li><li>去时的数据包走向没有问题，分析回来的，回来时就会出现问题。</li><li>由于服务器和PC处于同一网段（防火墙以放行PC所在区域和服务器所在区域的数据），回包时服务器发送ARP报文找到了PC的MAC地址，三层封装时源IP地址为：192.168.1.100，目的IP地址为192.168.1.1。源目MAC地址分别为服务器的MAC地址和PC的MAC地址。数据包直接走二层过去。</li><li>PC和服务进行通信需要建立TCP的三次握手,第一次握手时的目的IP地址为200.1.1.100，但此时却收到了192.168.1.100的回包。怎么办，凌乱了，握手不成功。TCP连接无法建立。</li></ol><a id="more"></a><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h3><blockquote><p>上述问题产生的根本原因是PC访问服务器的数据包来回路径不一致，要解决这个问题只要使服务器访问PC的数据包经过防火墙即可。</p></blockquote><p>防火墙的内网接口地址为192.168.1.254，在防火墙上在做一个策略将PC访问服务器的源地址也做一个转换，将192.168.1.1转换为192.168.1.254。</p><p><strong>转换过后在分析：</strong></p><ol><li>过去的数据包走向和上述相同，不在分析。只不过在服务器看来访问自己的地址变成了192.168.1.254</li><li>回来时，服务器会把数据包交给192.168.1.254，此时由于防火墙上做了NAT srver,会将服务器的地址转换为200.1.1.100，将目的地址192.168.1.254转换为192.168.1.1。此时就与之前的TCP三次握手对应上了，PC一看与我握手的是200.1.1.100，成功握手。</li><li>数据包来回路径一致，成功解救问题。</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;出现背景&quot;&gt;&lt;a href=&quot;#出现背景&quot; class=&quot;headerlink&quot; title=&quot;出现背景:&quot;&gt;&lt;/a&gt;出现背景:&lt;/h3&gt;&lt;p&gt;&lt;a href=&quot;https://www.tuchuang001.com/image/K83AW&quot;&gt;&lt;img src=&quot;https://www.tuchuang001.com/images/2017/06/09/0a5b4b39c301b479.png&quot; alt=&quot;0a5b4b39c301b479.png&quot;&gt;&lt;/a&gt;&lt;br&gt;在防火墙上部署了NATserver后，外网用户可以访问内部服务器。一般内部服务器都会通过一个域名进行解析。但如果内网用户也想通过此域名访问服务器就会出现问题。&lt;/p&gt;
&lt;h3 id=&quot;原因分析：&quot;&gt;&lt;a href=&quot;#原因分析：&quot; class=&quot;headerlink&quot; title=&quot;原因分析：&quot;&gt;&lt;/a&gt;原因分析：&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;内网用户要想访问internet,需要在防火墙上做个源NAT，将内网用户的网段转换为公网ip&lt;/li&gt;
&lt;li&gt;假设pc通过公网ip 200.1.1.100 访问服务器，在出防火墙时防火墙做可源NAT会将PC的原地址转换为200.1.1.100将数据包交出去。&lt;/li&gt;
&lt;li&gt;防火墙上配置了NATserver，将公网ip 200.1.1.100映射为服务器的私网地址192.168.1.100。数据包会交给服务器。&lt;/li&gt;
&lt;li&gt;去时的数据包走向没有问题，分析回来的，回来时就会出现问题。&lt;/li&gt;
&lt;li&gt;由于服务器和PC处于同一网段（防火墙以放行PC所在区域和服务器所在区域的数据），回包时服务器发送ARP报文找到了PC的MAC地址，三层封装时源IP地址为：192.168.1.100，目的IP地址为192.168.1.1。源目MAC地址分别为服务器的MAC地址和PC的MAC地址。数据包直接走二层过去。&lt;/li&gt;
&lt;li&gt;PC和服务进行通信需要建立TCP的三次握手,第一次握手时的目的IP地址为200.1.1.100，但此时却收到了192.168.1.100的回包。怎么办，凌乱了，握手不成功。TCP连接无法建立。&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
    
      <category term="华为" scheme="https://zeozzz.github.com/categories/%E5%8D%8E%E4%B8%BA/"/>
    
    
      <category term="NAT" scheme="https://zeozzz.github.com/tags/NAT/"/>
    
  </entry>
  
  <entry>
    <title>IPv6 auto config 原理详解之-----前缀公告</title>
    <link href="https://zeozzz.github.com/2019/07/17/68/"/>
    <id>https://zeozzz.github.com/2019/07/17/68/</id>
    <published>2019-07-17T12:03:22.000Z</published>
    <updated>2020-01-21T09:35:00.928Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>人们常说，IPv6的一大特性就是移动性。</p><p>那么对于IP终端来说，如何去理解他的移动性呢？</p><p>其实就是IPv6的无状态自动配置。</p><p>前段时间有幸一个同事给我演示了一下这个功能，但是更多的疑问产生了。</p><p>IPv4中，比如说电脑，在网卡中设置自动获取IP地址和DNS.那么就可以自动从DHCP服务器上面获得IP地址和DNS还有网关了。</p><p>下面是IPv4的设置界面：</p><p><strong><img src="https://s1.51cto.com/attachment/201108/12/351531_1313151463aDzX.jpg" alt="clip_p_w_picpath002"></strong></p><p>那么按照这个逻辑，IPv6就应该是没有这些选项，最终达到即插即用的目的嘛？答案是否，下面的截图IPv6也有：</p><p><strong><img src="https://s1.51cto.com/attachment/201108/12/351531_1313151470ZoVk.jpg" alt="clip_p_w_picpath004"></strong></p><p>那么为什么还需要自动配置？</p><p>意义在哪里？</p><p>如何实现呢？</p><p>带着这些问题，我们慢慢来看看IPv6这个自动配置auto config到底是个什么原理。</p><a id="more"></a><p><strong>RFC2462上面写到，无状态自动配置是IPv6最有吸引力和最有用的新特性之一。他允许本地链路上得节点根据路由器在本地链路上公告信息自己配置单播IPv6地址。</strong></p><p><strong>PS:路由器可是不能用无状态自动配置来实现，无状态自动配置仅仅适用于IP终端.这点一定要记得。</strong></p><p><strong>所以换句话说，路由器上面是不能实现这个功能的，这个是RFC上面定义的。没有原因。可能主要的目的是统一规划，方便管理的目的。</strong></p><p><strong><img src="https://s1.51cto.com/attachment/201108/12/351531_1313151478ff9T.jpg" alt="clip_p_w_picpath006"></strong></p><p>这个就是从auto config延伸出来的几个子工作机制。</p><p><strong>第一个知识点是前缀公告。</strong></p><p>前缀公告是无状态自动配置中的初始机制。前缀公告机制使用路由器公告信息ICMPv6 type=134和所有节点的多播地址FF02::1，路由器公告机制在本地链路上周期性的发送到所有节点的多播地址。</p><p><strong><img src="https://s1.51cto.com/attachment/201108/12/351531_1313151483WIIy.jpg" alt="clip_p_w_picpath008"></strong></p><p>在CISCO路由器上面公告IPv6前缀.</p><p>只要在接口上面配置了一个本地站点或者全球可聚合单播IPv6地址还有掩码，实际上就启用了cisco路由器上面的IPv6前缀公告。</p><p><strong>IPv6前缀公告原理：</strong></p><p>路由器周期性的发送ICMPv6 type=134的路由器前缀公告，用她得本地链路地址link-local FE80::250:3EFF:FEE4:4C00作为源，所有节点的多播地址FF02::1作为目的。</p><p>路由器公告消息公告的前缀是FEC0:0:0:1::/64,生存周期首选无穷大.</p><p>当本地链路多播地址FF02::1的节点A和B得到路由器公告消息，可以自己配置他们的IPv6地址.</p><p><strong><img src="https://s1.51cto.com/attachment/201108/12/351531_13131514908wzt.jpg" alt="clip_p_w_picpath010"></strong></p><p>这里我犯了一个错误，感觉这个是IPv6 前缀通告是配置了地址以后就自己有的一个机制。</p><p>实验结果并不是这样,我在R1和R2之间抓包，没有抓到ICMPv6 type = 134的报文，然后我又在网上查阅相关资。</p><p>为什么会这样，因为我忽略了一点很重要的，自动配置这个功能是仅仅限于路由器对PC终端之间的行为，路由器都不能支持这个auto config，所以为什么路由器要发前缀通告给邻居直连路由器呢？</p><p>后来我用路由器直连PC,得到了我想要的结果，PC自动获取到了IP地址，并且前缀和2012::/64是一样的.</p><p>:) 到这个时候我的心才稳下来。呵呵。下面是详细的实验结果：</p><p><strong><img src="https://s1.51cto.com/attachment/201108/12/351531_1313151497GaSV.jpg" alt="clip_p_w_picpath012"></strong></p><p>在R1上面，用命令<strong>show ipv6 interface giga 1/0 prefix</strong>:</p><p>可以看到，R1有一个AD,是自己的前缀2012::/64:</p><p><strong><img src="https://s1.51cto.com/attachment/201108/12/351531_1313151506o0CW.jpg" alt="clip_p_w_picpath014"></strong></p><p>呵呵，特意把giga 1/0的配置也show出来，2012::/64就是接口1/0的前缀。</p><p>在cisco上面，默认情况下有效生存期是30天.首选生存期是7天(604800s).</p><p>然后我做了一个实验，用迈普的路由器连接一个PC.</p><p>然后在PC机上面使能IPv6的功能(xp需要安装相关IPv6协议，默认是没有的，win7默认就加载了IPv6的协议栈了)</p><p>图谱图：</p><p>MAIPU router————PC</p><p>后来在PC上面成功获取到了IP地址，前缀为2012::/64,可以ping通路由器接口FE0 : 2012::1</p><p>我在路由器上面FE0配置的地址是：2012::1/64.</p><p>最后在PC机上获得的地址是:</p><p><strong><img src="https://s1.51cto.com/attachment/201108/12/351531_1313151513Glqz.jpg" alt="clip_p_w_picpath016"></strong></p><p><strong><img src="https://s1.51cto.com/attachment/201108/12/351531_1313151517KyLU.jpg" alt="clip_p_w_picpath018"></strong></p><p>在PC机接电脑以前，我就一直用wireshark进行抓包。抓到了ICMPv6 type=134的报文，下面是报文的具体格式：</p><p><strong><img src="https://s1.51cto.com/attachment/201108/12/351531_1313151529SyCj.jpg" alt="clip_p_w_picpath020"></strong></p><p>当然也可以用一个命令来修改前缀公告：</p><p>ipv6 nd prefix.</p><p><strong><img src="https://s1.51cto.com/attachment/201108/12/351531_1313151534uw3q.jpg" alt="clip_p_w_picpath022"></strong></p><p>还有一个小功能就是在接口上面禁止路由器公告。</p><p>在cisco 2011年1月的IOS上面，这个命令有点不一样：</p><p><strong><img src="https://s1.51cto.com/attachment/201108/12/351531_1313151538h3DK.jpg" alt="clip_p_w_picpath024"></strong></p><p>命令是: <strong>ipv6 nd ra suppress</strong>.</p><p>而以前老得IOS上面，命令却是：</p><p><strong><img src="https://s1.51cto.com/attachment/201108/12/351531_1313151542jE75.jpg" alt="clip_p_w_picpath026"></strong></p><p>其实无所谓，我们关注的是原理，命令行只是实现原理的一个手段罢了。</p><p>其实这里关于auto config还有几个参数，下面把几个参数都融合进行了一个接口中。</p><p><strong><img src="https://s1.51cto.com/attachment/201108/12/351531_13131515494vCl.jpg" alt="clip_p_w_picpath028"></strong></p><p>关于DAD和前缀重新编址，将在后续的文档中做实验进行验证。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;人们常说，IPv6的一大特性就是移动性。&lt;/p&gt;
&lt;p&gt;那么对于IP终端来说，如何去理解他的移动性呢？&lt;/p&gt;
&lt;p&gt;其实就是IPv6的无状态自动配置。&lt;/p&gt;
&lt;p&gt;前段时间有幸一个同事给我演示了一下这个功能，但是更多的疑问产生了。&lt;/p&gt;
&lt;p&gt;IPv4中，比如说电脑，在网卡中设置自动获取IP地址和DNS.那么就可以自动从DHCP服务器上面获得IP地址和DNS还有网关了。&lt;/p&gt;
&lt;p&gt;下面是IPv4的设置界面：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;img src=&quot;https://s1.51cto.com/attachment/201108/12/351531_1313151463aDzX.jpg&quot; alt=&quot;clip_p_w_picpath002&quot;&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;那么按照这个逻辑，IPv6就应该是没有这些选项，最终达到即插即用的目的嘛？答案是否，下面的截图IPv6也有：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;img src=&quot;https://s1.51cto.com/attachment/201108/12/351531_1313151470ZoVk.jpg&quot; alt=&quot;clip_p_w_picpath004&quot;&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;那么为什么还需要自动配置？&lt;/p&gt;
&lt;p&gt;意义在哪里？&lt;/p&gt;
&lt;p&gt;如何实现呢？&lt;/p&gt;
&lt;p&gt;带着这些问题，我们慢慢来看看IPv6这个自动配置auto config到底是个什么原理。&lt;/p&gt;
    
    </summary>
    
    
      <category term="IPv6" scheme="https://zeozzz.github.com/categories/IPv6/"/>
    
    
      <category term="IPv6" scheme="https://zeozzz.github.com/tags/IPv6/"/>
    
  </entry>
  
  <entry>
    <title>企业园区网络建设技术方案（华为）</title>
    <link href="https://zeozzz.github.com/2019/07/16/67/"/>
    <id>https://zeozzz.github.com/2019/07/16/67/</id>
    <published>2019-07-16T01:35:08.000Z</published>
    <updated>2020-01-21T09:35:10.450Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>原文链接：<a href="https://zhuanlan.zhihu.com/p/53512258">https://zhuanlan.zhihu.com/p/53512258</a></p><h2 id="1-项目概述"><a href="#1-项目概述" class="headerlink" title="1 项目概述"></a>1 项目概述</h2><p>根据实际情况增加项目介绍</p><h2 id="1-1-项目背景"><a href="#1-1-项目背景" class="headerlink" title="1.1 项目背景"></a>1.1 项目背景</h2><h2 id="1-2-项目目标"><a href="#1-2-项目目标" class="headerlink" title="1.2 项目目标"></a>1.2 项目目标</h2><h2 id="2-园区总体系统规划设计"><a href="#2-园区总体系统规划设计" class="headerlink" title="2 园区总体系统规划设计"></a>2 园区总体系统规划设计</h2><h2 id="2-1-需求分析"><a href="#2-1-需求分析" class="headerlink" title="2.1 需求分析"></a>2.1 需求分析</h2><p>随着企业信息化建设不断深入，企业的生产业务系统、经营管理系统、办公自动化系统均得到大力发展，对于企业园区网的建设要求越来越高。传统园区网建设初期往往面临如下问题：</p><p><strong>(一)</strong> <strong>网络架构较为混乱，不便于扩容和维护管理：</strong>园区网在建设初期，设备和光纤/电缆随意布放，缺乏统一的网络分层规划管理，网络拓扑相对混乱，不便于对网络性能瓶颈进行正确评估和有效扩容，给日常网络管理也带来很大难度。</p><p><strong>(二)</strong> <strong>网络可靠性规划不合理，影响企业生产和经营管理、造成投资浪费：</strong>由于缺乏有效的园区网规划，对于网络可靠性考虑不够，网络中既存在单点故障导致网络可靠性低、影响企业生产和经营管理行为，同时也存在网络过度冗余、造成投资浪费的现象。</p><p><strong>(三)</strong> <strong>网络信息安全存在隐患：</strong>网络安全性是园区网建设的重中之重，传统园区网安全漏洞较多，无法应对内外部用户日益猖獗的网络攻击行为（例如：对园区网设备进行攻击、消耗网络带宽、窃取企业核心电子资产信息），对于内部和外部用户缺乏有效的身份认证手段、用户可随意接入网络，网络层面的安全保证和防御措施也不到位，造成园区网的脆弱和易攻击。</p><p><strong>(四)</strong> <strong>无法满足日益增长的网络业务需求：</strong>随着企业的业务发展，出现了基于园区网基础设施的丰富增值业务需求，例如：网络接入形式要求多样化，支持WLAN无线接入，满足移动办公、大区域无线缆覆盖等特殊要求；对于企业用户访问外网进行计费，计费策略可灵活设置（时长计费、流量计费、按目的地址计费）；企业多出口链路场景下的负载均衡、灵活选路需求。传统园区网建设缺乏有效满足这些增值业务需求的统一解决方案考虑，支持这些业务存在园区网络分散建设、重复投资的问题。</p><p><strong>(五)</strong> <strong>缺乏简单有效的网络管理系统，企业IT网络运维部门面临很大压力：</strong>当前，企业网IT运维部门面临很大的网络运维压力，来自于园区网内外部的安全事件频发、网络可靠性低引起的网络业务中断现象，网络故障诊断、分析定位过程对于IT运维人员的技术能力和经验水平要求较高，缺乏简单有效/低成本的图形化网管工具、进行实时网络拓扑显示、状态监控和各种故障事件预警/告警展示。另外，IT运维部门也需要实施统计园区网各路径的流量信息，便于对网络带宽进行管理和规划，给后续网络扩容提供参考。</p><h2 id="2-2-设计原则"><a href="#2-2-设计原则" class="headerlink" title="2.2 设计原则"></a>2.2 设计原则</h2><p><strong>(一)</strong> <strong>安全性：</strong>安全性是企业园区网建设中的关键，它包括物理空间的安全控制及网络的安全控制。需要有完整的安全策略控制体系来实现企业园区网的安全控制。</p><p><strong>(二)</strong> <strong>可靠性、可用性：</strong>高可靠性是园区网提供使用的关键，其可靠性设计包括：关键设备冗余、链路/网络冗余和重要业务模块冗余。</p><p>关键设备均采用电信级全冗余设计，可实现单板热拔插、冗余的控制模块设计、冗余电源设计。采用冗余网络设计，每个层次均采用双机方式，层次与层次之间采用全冗余连接。提供多种冗余技术，采用高效、负载均衡的双机备份。</p><p>可采用交换机的集群或者堆叠技术，在不降低网络可靠性的前提下，减化网络架构。</p><p><strong>(三)</strong> <strong>可扩展性：</strong>园区网方案设计中，采用分层的网络设计；每个层次的设计所采用的设备本身都应具足够高的端口密度，为后续园区网扩展奠定基础。</p><p>在园区出口层、核心层、汇聚层的设备都采用模块化设计，可根据园区网的发展进行灵活扩展。</p><p>功能的可扩展性是园区网随着发展提供增值业务的基础。实现防火墙、负载均衡、WLAN接入、认证计费等功能，为园区网增值业务的扩展提供基础。</p><p><strong>(四)</strong> <strong>可维护、可管理性：</strong>网络可管理性是园区网成功运维的基础。应提供低成本、简单有效的园区网统一网管系统，对园区网所有网络设备进行管理，包括网络拓扑显示、网络状态监控、故障事件实时预警和告警、网络流量统计。</p><a id="more"></a><h2 id="3-园区网络架构规划设计"><a href="#3-园区网络架构规划设计" class="headerlink" title="3 园区网络架构规划设计"></a>3 园区网络架构规划设计</h2><h2 id="3-1-园区网络总体网络架构规划设计"><a href="#3-1-园区网络总体网络架构规划设计" class="headerlink" title="3.1 园区网络总体网络架构规划设计"></a>3.1 园区网络总体网络架构规划设计</h2><h2 id="3-1-1-典型园区网网络架构"><a href="#3-1-1-典型园区网网络架构" class="headerlink" title="3.1.1 典型园区网网络架构"></a>3.1.1 典型园区网网络架构</h2><p><img src="https://pic1.zhimg.com/80/v2-d1590ffcea82b0fe3068edc687ac18dc_hd.jpg" alt="img">图 3‑1 典型园区网网络架构</p><p>典型园区网方案采用层次化、模块化的设计思路，按照接入层、汇聚层、核心层和出口层进行网络设备设计部署，在汇聚层交换机，通过模块化（业务单板）方式提供WLAN AC控制器、防火墙、负载均衡器等增值业务功能，满足企业日益增长的业务需求。</p><p>典型园区网的重要特征是不存在网络单点故障，交换机设备和链路都存在冗余备份，接入交换机与核心交换机通过双规或环网相连接，汇聚交换机双规接入核心交换机，交换机之间采用TRUNK链路保证链路级可靠性。</p><h2 id="3-1-2-经济型园区网网络架构"><a href="#3-1-2-经济型园区网网络架构" class="headerlink" title="3.1.2 经济型园区网网络架构"></a>3.1.2 经济型园区网网络架构</h2><p><img src="https://pic3.zhimg.com/80/v2-ffa4d15431ded70c16cff9f15017968a_hd.jpg" alt="img">图 3‑2 经济型园区网网络架构</p><p>考虑到节省园区网网络建设投资成本，允许网络存在单点故障，不再部署冗余交换机设备，交换机之间互联采用TRUNK链路，保证链路级可靠性，但是园区网交换机设备故障，会导致网络故障和业务中断。</p><p>经济型的园区网汇聚层交换机仍然可通过模块化（业务单板）方式提供WLAN AC控制器、防火墙、负载均衡器等增值业务功能。</p><h2 id="3-1-3-虚拟交换园区网网络架构"><a href="#3-1-3-虚拟交换园区网网络架构" class="headerlink" title="3.1.3 虚拟交换园区网网络架构"></a>3.1.3 虚拟交换园区网网络架构</h2><p>图 3‑3 虚拟交换园区网网络架构</p><p><img src="https://pic1.zhimg.com/80/v2-744e089d67b0cf05a87b327b1af520f0_hd.jpg" alt="img">图 3‑3 虚拟交换园区网网络架构</p><p>园区网仍然按照分层结构建设，园区交换机分为接入层交换机、汇聚层交换机和核心层交换机。为了增加园区网可靠性、降低园区网组网复杂度，园区网未来向虚拟化、扁平化方向发展，同层次交换机可以多台虚拟成一台，接入交换机通过堆叠（Stack）特性，将多台接入交换机虚拟成一台接入交换机，汇聚/核心交换机通过CSS（Cluster Switch ）将两台交换机虚拟成一台交换机。</p><p>园区网接入层/汇聚层/核心层交换机虚拟化后，可以减少网络节点、简化网络拓扑，二层网络不需要部署RSTP/MSTP/RRPP/Smart Link等复杂的环网协议和可靠性保护协议，实现无二层环路网络构建，提高二层网络可靠性和链路故障收敛性能，三层网络虚拟化的多台设备间路由表统一计算、路由收敛速度快，</p><p>通过交换机虚拟化设计，交换机互联的两条链路就可以作为Trunk链路进行管理，对于虚拟交换机而言，实现跨设备的链路聚合（TRUNK），大大增强链路可靠性，另外可实现链路的流量负载均衡，构建无二层环路网络，网络可靠性（链路故障自收敛性能）和带宽利用率都得到提高。</p><p><img src="https://pic4.zhimg.com/80/v2-92948290e3947c9f34c68a3eeb56d803_hd.jpg" alt="img">图 3‑4 交换机集群（堆叠）方案</p><h2 id="3-2-园区网络分层网络规划设计"><a href="#3-2-园区网络分层网络规划设计" class="headerlink" title="3.2 园区网络分层网络规划设计"></a>3.2 园区网络分层网络规划设计</h2><p>园区网的网络层次采用业界成熟的三层架构：接入、汇聚和核心，最后企业园区通过出口层网络设备（路由器或交换机）连接到外网通过。</p><p>这种分层的网络架构，可以保证根据的业务需求，分别对不同层次进行扩容。</p><h2 id="3-2-1-接入层"><a href="#3-2-1-接入层" class="headerlink" title="3.2.1 接入层"></a>3.2.1 接入层</h2><p>接入层交换机一般部署在楼道的网络机柜中，接入园区网用户（PC机或服务器），提供二层交换机功能，也支持三层接入功能（接入交换机为三层交换机）。</p><p>由于接入层交换机直接接园区网用户，根据用户接入信息点数目和类型（GE/FE），对接入交换机的GE/FE接口密度有较高的要求。另外接入交换机部署在楼道网络机柜，数量大，对于成本、功耗和易管理维护等特性要求较高。</p><p>高用户密度的园区接入场景推荐使用S5300/S9300作为接入交换机，低用户密度的场景推荐使用S2300/S3300作为接入交换机。</p><h2 id="3-2-2-汇聚层"><a href="#3-2-2-汇聚层" class="headerlink" title="3.2.2 汇聚层"></a>3.2.2 汇聚层</h2><p>园区汇聚层交换机一般部署在楼宇独立的网络汇聚机柜中，汇聚园区接入交换机的流量，一般提供三层交换机功能，汇聚层交换机作为园区网的网关，终结园区网用户的二层流量，进行三层转发。</p><p>根据需要，可以在汇聚交换机上集成增值业务板卡（如防火墙，负载均衡器、WLAN AC控制器）或者旁挂独立的增值业务设备，为园区网用户提供增值业务。</p><p>汇聚交换机需要提供高密度的GE接口，汇聚接入交换机的流量，通过10GE接口接到核心交换机，推荐使用S9300系列交换机作为园区汇聚层交换机。</p><h2 id="3-2-3-核心层"><a href="#3-2-3-核心层" class="headerlink" title="3.2.3 核心层"></a>3.2.3 核心层</h2><p>园区核心层交换机部署在园区核心机房中，汇聚各楼宇/区域之间的用户流量，提供三层交换机功能，连接园区外部网络到内部用户的“纵向流量”和不同汇聚区域用户之间的“横向流量”要求高密10GE、高转发性能。</p><p>推荐使用S9300作为园区核心层交换机。</p><h2 id="3-2-4-出口层"><a href="#3-2-4-出口层" class="headerlink" title="3.2.4 出口层"></a>3.2.4 出口层</h2><p>园区出口路由器，连接Internet/WAN广域网和园区内部局域网。推荐华为AR和SRG系列路由器作为企业出口路由器。</p><p>对于中小型企业园区网，核心层和出口层可进行合并，通过核心交换机（S9300）的WAN接口板的广域网接口（POS等）直接与外网相连。 3.3 二三层网络分界点设计</p><p><strong>二三层网络分界点（用户网关）设置在汇聚交换机</strong></p><p>汇聚交换机作为用户的网关设备，接入交换机与汇聚交换机之间是二层网络，通过STP/RSTP/MSTP/RRPP保证网络可靠性和防止二层网络环路产生，汇聚交换机与核心交换机之间是三层网络，运行OSPF等路由协议，通过等价路由、IP FRR保证三层网络可靠性、加快路由收敛时间。</p><p>【优点】</p><ol><li><p>接入交换机是二层交换机，成本低，并且可保护客户现有低端二层交换机的投资；</p></li><li><p>高可靠性，二层网络故障收敛速度快；</p></li></ol><p>【缺点】</p><ol><li><p>接入交换机和汇聚交换机之间存在二层环路风险，需要配置保证；</p></li><li><p>接入交换机与汇聚交换机之间链路利用率低，需要启用二层协议负载均担多实例以提高链路利用率。</p></li></ol><p>本方案的缺点可以通过接入交换机堆叠/汇聚交换机集群（交换机虚拟化）方案来解决。园区汇聚交换机作为二三层网络分界点（用户网关设备）是经典的园区网架构，推荐使用。</p><p><strong>二三层网络分界点（用户网关）设置在接入交换机</strong></p><p>接入交换机作为用户的二三层分界点（网关设备），即三层到边缘的园区网架构，接入交换机到汇聚交换机、汇聚交换机到核心交换机之间都是三层网络，运行OSPF等路由协议，整个企业园区是全路由型网络。</p><p>【优点】</p><ol><li><p>网络易扩展：园区网架构对物理网络拓扑依赖度低，可以任意网络拓扑形式扩展；</p></li><li><p>网络易维护：全网为三层网络、无二层环路网络风险，无需配置生成树协议、RRPP和VRRP，降低网络配置和维护工作量。</p></li></ol><p>【缺点】</p><ol><li><p>交换机成本相对较高：相对与二层接入交换机，成本较高；</p></li><li><p>接入层为三层网络，网络故障路由收敛速度相对较慢。</p></li></ol><h2 id="4-园区网络高可靠性规划设计"><a href="#4-园区网络高可靠性规划设计" class="headerlink" title="4 园区网络高可靠性规划设计"></a>4 园区网络高可靠性规划设计</h2><h2 id="4-1-园区网络高可靠性规划设计"><a href="#4-1-园区网络高可靠性规划设计" class="headerlink" title="4.1 园区网络高可靠性规划设计"></a>4.1 园区网络高可靠性规划设计</h2><p>园区网高可靠性设计总体方案如下图所示：</p><p><img src="https://pic3.zhimg.com/80/v2-df3c4a7cd992bd1267be40be41f73bea_hd.jpg" alt="img">图 4‑1 园区网高可靠性设计方案总览</p><p>针对二层接入（接入交换机是二层交换机、汇聚交换机作为用户网关）典型园区网架构，从接入层、汇聚层、核心层来分层考虑网络可靠性设计。</p><p>接入层网络是二层网络，接入交换机与汇聚交换机之间通过Smart Link/STP/RSTP/MSTP/RRPP保证网络可靠性，同时解决二层网络环路问题；汇聚层交换机之间通过VRRP（BFD for VRRP）协议确定用户的主备网关，交换机互联通过TRUNK链路，保证链路级可靠性，汇聚交换机与接入交换机之间可通过DLDP协议检测光纤单向故障（单通故障）。</p><p>园区网接入/汇聚/核心交换机通过虚拟化技术进行集群（或堆叠），将两台/多台交换机虚拟化成一台交换机，降低网络拓扑复杂度的同时，提高网络可靠性，是未来高可靠性园区网的发展趋势。</p><p>典型园区网可靠性组网设计方案有：口子型组网、三角型组网、U子型组网。 </p><p><strong>可靠性组网方案1：口子型组网</strong></p><p><img src="https://pic3.zhimg.com/80/v2-018f448a3251ad1f49542e718dfbb802_hd.jpg" alt="img">图 4‑2 口子型组网</p><p>接入交换机与汇聚交换机之间是二层网络，汇聚交换机作为用户网关设备，两台汇聚交换机之间通过二层TRUNK链路互连，多台接入交换机与两台汇聚交换机之间组成口子型二层环网，并且通过部署STP/RSTP/MSTP/RRPP等协议进行二层环网阻断、环网故障检测和保护倒换功能。两台汇聚交换机运行VRRP（BFD+VRRP）协议确定主备用户网关，VRRP报文直接在汇聚交换机直连的TRUNK链路上收发。注意：两台汇聚交换机链路需要保证绝对可靠，必须采用TRUNK链路、包含两条以上物理链路，因为汇聚交换机间链路DOWN，两台汇聚交换机VRRP状态都为主（VRRP双主情况产生），此时接入二层环网阻塞在汇聚交换机之间的直连链路上，这样接入用户同时感知两个处于VRRP主用状态的网关设备（汇聚交换机），出现问题。</p><p>口子型组网方案的优点是，园区网各个楼层接入交换机可以串在一起，与汇聚交换机组成二层环网，汇聚交换机统一为各楼层接入交换机下的用户分配IP地址，实现园区不同楼层的用户可以共用同一个IP地址网段； 该组网方案的缺点是接入层网络需要部署较为复杂的二层环网协议、网络配置和维护较为复杂。</p><p>口子型组网方案是园区网非常经典的可靠性设计方案，适合各种规模的园区网应用场景。</p><p><strong>可靠性组网方案2：三角型组网</strong></p><p><img src="https://pic1.zhimg.com/80/v2-17997fcaaceda05f154de148900df07c_hd.jpg" alt="img">图 4‑3 三角型组网</p><p>汇聚交换机作为用户网关设备，两台汇聚交换机之间通过二层链路互连，每台接入交换机上行有两条链路接入到两台汇聚交换机，接入交换机上行两条链路的主备关系由运行的Smart Link协议确定。两台汇聚交换机运行VRRP（BFD+VRRP）协议确定主备用户网关，VRRP报文直接在汇聚交换机直连链路上收发。注意：两台汇聚交换机链路需要保证绝对可靠，必须采用TRUNK链路。口子型组网场景下，多个楼层之间可以共用VRRP组，不受汇聚交换机VRRP组数量限制，可实现不同楼层间的园区用户可以共享一个IP地址网段。</p><p>三角型组网方案的优点是：二层接入网不存在环路，不需要配置相对复杂的环网保护协议（STP/RSTP/MSTP/RRPP）；Smart Link故障检测和保护倒换速度快（200～400ms）；支持园区网园区不同楼层的用户可以共用同一个IP地址网段。</p><p>三角型组网方案的缺点是每台接入交换机上行需要部署主备两条链路，增加布线成本，对汇聚交换机的端口密度有较高要求。</p><p><strong>可靠性组网方案3：U字型组网</strong></p><p><img src="https://pic3.zhimg.com/80/v2-f103961d2a1c7fb70c8dd312f6913976_hd.jpg" alt="img">图 4‑4 U字型组网</p><p>园区网汇聚交换机之间通过纯三层链路互连，无直连二层链路。汇聚交换机作为园区用户网关，与接入交换机组成二层网络，汇聚交换机的主备通过VRRP（BFD for VRRP）协议协商，VRRP协议通过接入交换机转发，每组接入交换机与两台汇聚交换机组成的一个物理U型网络需要启用一组VRRP，汇聚交换机通过多个物理端口会接入多个二层U型网络，这样汇聚交换机间需要运行多个VRRP组（每个二层U型接入网络运行一个VRRP组），一般一个U型二层接入网覆盖的是同一个楼层的接入交换机。由于不同VRRP组的网关IP网段不能相同，因此每个U型接入网下的所有园区用户需要独占一个IP网段，不同U型接入网的用户（不同楼层的园区用户）之间不能共享一个IP网段，这是此方案应用的最大缺点。</p><p>U子型方案的优点：二层接入网不存在环路，不需要配置相对复杂的环网保护协议（STP/RSTP/MSTP/RRPP）。</p><p><strong>可靠性设计目标方案（发展趋势）：园区网交换机虚拟化</strong></p><p><img src="https://pic1.zhimg.com/80/v2-0cc406480699395a23b35c186680bfa8_hd.jpg" alt="img">图 4‑5 可靠性设计目标方案组网</p><p>园区网可靠性方案设计的目标方案或发展趋势是各层次园区网交换机都进行虚拟化，通过集群/堆叠技术将两台或多台交换机虚拟成一台交换机。可以提高单节点设备可靠性，一台交换机故障，另外一台交换机自动接管故障设备上的所有业务，可以做到业务无损切换。设备虚拟化通过跨设备的TRUNK链路，提升链路级可靠性，并且流量可以均匀分布在TRUNK成员链路上，提高链路带宽利用率，条或多条链路故障后,流量自动切换到其他正常的链路。</p><p>该方案另外一个优点网络配置和维护简单，园区二层接入网，不需要配置复杂的二层环网和保护倒换协议，二层链路故障直接感知快速切换，三层网络中多个设备间共享路由表，网络故障路由收敛速度快。网络管理和维护难度大大降低，此方案适应面广，扩展性强，是未来园区网的发展趋势。</p><h2 id="4-2-园区网络设备高可靠性规划设计"><a href="#4-2-园区网络设备高可靠性规划设计" class="headerlink" title="4.2 园区网络设备高可靠性规划设计"></a>4.2 园区网络设备高可靠性规划设计</h2><h2 id="4-2-1-重要部件冗余"><a href="#4-2-1-重要部件冗余" class="headerlink" title="4.2.1 重要部件冗余"></a>4.2.1 重要部件冗余</h2><p>设备本身要具有电信级5个9的可靠性，需要网络设备支持:</p><p>主控1:1备份</p><p>交换网1+1/1:1两种方式</p><p>DC电源1+1备份；AC电源1+1/2+2备份</p><p>模块化的风扇设计，高端配置支持单风扇失效</p><p>无源背板，高可靠性</p><p>独立的设备监控单元，和主控解耦</p><p>所有模块热插拔</p><p>完善的各种告警功能</p><p>设备管理1:1备份</p><h2 id="4-2-2-设备自身安全"><a href="#4-2-2-设备自身安全" class="headerlink" title="4.2.2 设备自身安全"></a>4.2.2 设备自身安全</h2><p>如下图所示,随着黑客工具的泛滥和使用的方便,使的网络攻击的成本越来越来,但危害越来越大.</p><p><img src="https://pic2.zhimg.com/80/v2-4888f5bb80b393f464eb7d731d65a1ad_hd.jpg" alt="img">图 4‑6 黑客工具的危害性</p><p>这就要求具有强大灵活的自身防护功能,以不变应万变的方法,才能抵挡日益泛滥的网络攻击。</p><p>华为公司全系列园区网交换机（S9300/S5300/S3300/S2300）提供攻击防范功能，能够检测出多种类型的网络攻击，并能采取相应的措施保护设备自身及其所连接的内部网络免受恶意攻击，保证内部网络及设备的正常运行。</p><p>华为全系列交换机支持的攻击防范功能包括防DDOS攻击、IP欺骗攻击、Land攻击、Ping of Death攻击、Teardrop攻击、ICMP Flood攻击、SYN FLOOD攻击等。</p><p>另外，以太网交换机的MAC地址表作为二层报文转发的核心，在受到攻击的时候，直接导致交换机无法正常工作。发生MAC地址攻击的时候，攻击者通过不停的发送MAC地址来刷新，填充交换机的MAC地址表，由于MAC地址表的规格有限，导致正常流量由于没有正确的转发表项而无法正常转发。ARP攻击与此类似，通过攻击报文来更改MAC与IP地址的绑定，从而重新定向流量。</p><p>华为全系列交换机可以通过MAC地址与端口的绑定以及限制端口/VLAN/VSI下MAC地址的最大学习个数可防止MAC扫描，并通过VLAN、IP、MAC之间的任意绑定可防范ARP攻击（SAI/DAI功能）。</p><p>华为全系列交换机支持黑洞MAC功能，园区交换机收到报文时比较报文目的MAC地址，若与黑洞MAC表项相同则丢弃该报文。当用户察觉到某MAC地址的报文具有一定攻击性，则可以在园区交换机上配置黑洞MAC，从而将具有该MAC地址的报文过滤掉，避免遭受攻击。</p><h2 id="4-3-园区网络交换机虚拟化规划设计"><a href="#4-3-园区网络交换机虚拟化规划设计" class="headerlink" title="4.3 园区网络交换机虚拟化规划设计"></a>4.3 园区网络交换机虚拟化规划设计</h2><h2 id="4-3-1-汇聚交换机的集群CSS-Cluster-Switch-Switching"><a href="#4-3-1-汇聚交换机的集群CSS-Cluster-Switch-Switching" class="headerlink" title="4.3.1 汇聚交换机的集群CSS(Cluster Switch Switching)"></a>4.3.1 汇聚交换机的集群CSS(Cluster Switch Switching)</h2><p>所谓集群，就是把物理的多台服务器连接在一起，对外表现为一台逻辑的服务器，提供服务。</p><p>因为企业园区网为了增加可靠性，都是双节点备份，特别适合集群技术。如下图所示：</p><p><img src="https://pic4.zhimg.com/80/v2-1350c0781e69a3f6d037f6d39d1b2037_hd.jpg" alt="img">图 4‑7 集群组网的优势</p><p>采用集群技术，对企业园区网络，有四大优势：</p><ol><li>减化管理和配置</li></ol><p>首先，集群后需要管理的设备节点减少一半以上。</p><p>其次，组网变得简洁，不需要配置复杂的协议，包括STP/SmartLink/VRRP等。</p><ol start="2"><li>快速的故障收敛</li></ol><p>故障收敛时间可以控制在&lt; 1ms, 大大降低了网络链路/节点的故障，对业务的影响。</p><ol start="3"><li>带宽利用率高</li></ol><p>采用链路Trunk的方式，带宽利用率可以达到100％。</p><ol start="4"><li>扩容方便</li></ol><p>保护用户投资。随着业务的增加，当用户进行网络升级时，采用集群的方式，只需要增加新设备既可，不需要更改网络配置的情况下，平滑扩容，很好的保护了用户投资。</p><p>目前，业界有两种堆叠的方式，一种是采用业务接口堆叠，一种是采用专用的堆叠线；</p><p><img src="https://pic2.zhimg.com/80/v2-78493c57b0a8348b7d93149242b19fb9_hd.jpg" alt="img">图 4‑8 两种集群方式比较</p><p>华为的S93系列交换机采用堆叠线的方式，通过在主板板上插入堆叠卡，连接多台设备。如下图所示，这种方式有如下的优势：</p><p><img src="https://pic2.zhimg.com/80/v2-d1a5d87863061b5546c7abadfe5a8fb5_hd.jpg" alt="img">图 4‑9 华为CSS集群技术</p><p>采用交换机网集群的方式，相比接口板集群，有如下的优势：</p><p><strong>堆叠带宽高</strong></p><p>交换机网集群一般采用专用的接口线，堆叠带宽高。</p><p>S93系列的堆叠带宽高达128G(单向)；并且可平滑升级到200G(单向)； 相对于业界的80G（单向）的互联带宽，具有明显的优势。</p><p><strong>不占用业务槽位</strong></p><p>S93系列采用在主控板预留的灵活插卡槽位，插入堆叠卡互联的方式，不占用接口槽位。相对于接口堆叠的方式，节省了1～2个接口槽位。</p><p><strong>可靠性高</strong></p><p>S93系列采用堆叠线连接，实际上是对交换网的延伸。从上图可以看出，接口板堆叠方式需要经过两个堆叠接口板转发，处理复杂度增加；另外，接口板的硬件可靠性也比交换网低。</p><p>总体来看，交换网堆叠在软件和硬件方面，可靠性都高于接口堆叠的方式。</p><h2 id="4-3-2-接入交换机的堆叠iStack"><a href="#4-3-2-接入交换机的堆叠iStack" class="headerlink" title="4.3.2 接入交换机的堆叠iStack"></a>4.3.2 接入交换机的堆叠iStack</h2><p>iStack堆叠就是将多台设备通过堆叠口连接起来形成一台虚拟的逻辑设备。一个园区网用户上行的2个网络接口，对于堆叠后的设备，可以看作Trunk接口。</p><p>多台设备堆叠成一台设备后，从功能和管理方面，都可以作为一台设备来看待。</p><p>华为的iStack堆叠技术有如下的优势： </p><p>ü <strong>简化管理</strong></p><p>堆叠设备的角色分为Master和Slave；通过对Master 设备的配置达到管理整个iStack 堆叠以及堆叠内所有成员设备的效果，而不用物理连接到每台成员设备上分别对它们进行配置和管理。</p><p><strong>简化网络运行</strong></p><p>iStack 形成的虚拟设备中运行的各种控制协议也是作为单一设备统一运行的，例如路由协议会作为单一设备统一计算。这样省去了设备间大量协议报文的交互，简化了网络运行，缩短了网络动荡时的收敛时间。</p><p><strong>强大的网络扩展能力</strong></p><p>通过增加成员设备，可以轻松自如的扩展堆叠系统的端口数、带宽和处理能力。</p><p><strong>高可靠性</strong></p><p>堆叠的高可靠性体现在多个方面，比如：成员设备之间堆叠物理端口支持聚合功能，堆叠系统和上、下层设备之间的物理连接也支持聚合功能，这样通过多链路备份提高了堆叠系统的可靠性；堆叠系统由多台成员设备组成，Master 设备负责堆叠的运行、管理和维护，Slave 设备在作为备份的同时也可以处理业务，一旦Master 设备故障，系统会迅速自动选举新的Master，以保证通过堆叠的业务不中断，从而实现了设备级的1:N 备份。</p><p><strong>高性能</strong></p><p>由于iStack 设备是由多个支持iStack 特性的单机设备堆叠而成的，iStack设备的交换容量和端口数量就是iStack 内部所有单机设备交换容量和端口数量的总和。因此，iStack 技术能够通过多个单机设备的堆叠，轻易的将设备的交换能力、用户端口的密度扩大数倍，从而大幅度提高了设备的性能。</p><h2 id="5-园区网络安全方案规划设计"><a href="#5-园区网络安全方案规划设计" class="headerlink" title="5 园区网络安全方案规划设计"></a>5 园区网络安全方案规划设计</h2><h2 id="5-1-园区网安全方案总体规划设计"><a href="#5-1-园区网安全方案总体规划设计" class="headerlink" title="5.1 园区网安全方案总体规划设计"></a>5.1 园区网安全方案总体规划设计</h2><p><img src="https://pic2.zhimg.com/80/v2-9b29f3528db581a98619c2bdeb98f9f5_hd.jpg" alt="img">图 5‑1 园区网安全方案总体设计</p><p>从园区接入、网络监管/监控、边界防御、园区出口传输安全等多纬度、多层次进行安全设计和安全防御，对内部员工进行身份认证和网络访问权限控制，对企业内部进行安全区域划分、隔离和权限控制，对企业外部用户访问进行安全控制、数据加密，防止恶意攻击。园区网全方位的</p><p>安全设计方案保证内部、外部用户访问园区网资源的安全性。</p><h2 id="5-2-园区接入安全规划设计"><a href="#5-2-园区接入安全规划设计" class="headerlink" title="5.2 园区接入安全规划设计"></a>5.2 园区接入安全规划设计</h2><p><img src="https://pic2.zhimg.com/80/v2-527ba6b04b5c60ed944efa2e520d2529_hd.jpg" alt="img">图 5‑2 网络准入控制NAC</p><p>企业网交换机与华为赛门铁克的NAC方案配套，实现对接入用户的身份认证、终端健康检查，并实现基于用户角色的差异化权限控制。NAC解决方案包含三个关键组件：通信代理、网络访问控制设备（园区交换机）和认证策略服务器组：</p><p>通信代理也就是安全客户端，是安装在用户终端系统上的软件，是对用户终端进行身份认证、安全状态评估检查以及安全策略实施的主体，其主要功能包括：</p><p>支持802.1x、Portal、MAC等多种认证方式，可以与园区网交换机实现接入、汇聚层的端点准入控制。</p><p>检查用户终端的安全状态，包括操作系统版本、系统补丁等信息；同时提供与防病毒客户端联动的接口，实现与第三方防病毒客户端的联动，检查用户终端的防病毒软件版本、病毒库版本、以及病毒查杀信息，这些信息将被传递到安全策略服务器，执行端点准入的判断与控制。</p><p>安全策略实施，接收安全策略服务器下发的安全策略并强制用户终端执行，包括设置安全策略（是否监控邮件、注册表）、系统修复通知与实施（自动或手工升级补丁和病毒库）等功能。不按要求实施安全策略的用户终端将被限制在隔离区。</p><p>实时监控系统安全状态，包括是否更改安全设置、是否发现新病毒等，并将安全事件定时上报到安全策略服务器，用于事后进行安全审计。</p><p>网络访问控制设备是企业网络中安全策略的实施点，起到强制用户准入认证、隔离不合格终端、为合法用户提供网络服务的作用。园区网的网络访问控制设备推荐为华为交换机，可分别实现不同认证方式（如802.1x、MAC认证和Portal等）的端点准入控制,具备以下功能：</p><p>强制网络接入终端进行身份认证和安全状态评估。</p><p>隔离不符合安全策略的用户终端，园区交换机接收到安全策略服务器下发的隔离指令后，可以通过 VLAN 或 ACL 方式限制用户的访问权限；同样，收到解除用户隔离的指令后也可以在线解除对用户终端的隔离。</p><p>提供基于身份的网络服务，园区交换机可以根据安全策略服务器下发的策略，为用户提供个性化的网络服务，如提供不同的 QoS、ACL、VLAN 等。</p><p>根据用户接入安全控制范围需要，作为NAC网络访问控制设备的交换机可以部署在园区接入层、汇聚层，设置可部署在核心层、仅控制用户访问园区外部网络的权限。</p><p>策略服务器也就是管理服务器，NAC方案的核心是整合与联动，其中的安全策略服务器是NAC方案中的管理与控制中心，兼具用户管理、安全策略管理、安全状态检查评估、安全联动控制以及安全事件审计等功能。</p><p><strong>802.1x接入认证</strong></p><p><img src="https://pic1.zhimg.com/80/v2-c5086aa8281c1dbbb44ee4846fa86d50_hd.jpg" alt="img"></p><p>图 5‑3 802.1x接入认证流程</p><p><strong>802.1x认证过程如下：</strong></p><ol><li><p>用户在802.1x客户端输入用户名、密码，发起802.1x认证请求至园区交换机； 2) 交换机作为Radius客户端将用户名、密码发送到认证服务器进行Radius认证；</p></li><li><p>认证服务器将携带VLAN或二三层ACL的Radius属性下发至园区交换机，根据用户认证结果控制其网络访问权限；</p></li><li><p>用户获取IP地址，NAC客户端软件与策略服务器联动，按照预先定制的安全检查策略，对用户终端健康状态进行检查，检查不通过Radius COA下发VLAN或ACL，限制用户网络访问权限；</p></li><li><p>用户通过802.1x身份认证和终端健康检查后，获取业务网络访问权限。</p></li></ol><p><strong>用户MAC认证</strong></p><p><img src="https://pic4.zhimg.com/80/v2-e949721a660854fbf1d774dbd273b8cb_hd.jpg" alt="img"></p><p>图 5‑4 MAC认证流程</p><p><strong>用户MAC认证过程如下：</strong></p><ol><li><p>用户终端上电（无802.1x认证客户端），用户发起ARP或DHCP请求等报文；</p></li><li><p>园区交换机收到用户终端的数据报文，触发Radius认证请求至认证服务器，根据MAC地址生成用户名和密码；</p></li><li><p>认证服务器将携带VLAN或二三层ACL的Radius属性下发至园区交换机，根据用户认证结果控制其网络访问权限；</p></li><li><p>用户获取IP地址，NAC客户端软件与策略服务器联动，按照预先定制的安全检查策略，对用户终端健康状态进行检查，检查不通过Radius COA下发VLAN或ACL，限制用户网络访问权限；</p></li><li><p>用户通过802.1x身份认证和终端健康检查后，获取业务网络访问权限。</p></li></ol><p><strong>802.1X MAC旁路认证</strong></p><p><img src="https://pic3.zhimg.com/80/v2-11e14d7a5a1afc3f7fe9fa4b30ee4176_hd.jpg" alt="img"></p><p>图 5‑5 802.1x MAC旁路认证流程</p><p><strong>802.1x MAC旁路认证过程如下：</strong></p><ol><li><p>用户终端上电，用户发起ARP或DHCP请求等报文；</p></li><li><p>园区交换机先向用户终端发起EAP探测报文，如果用户终端已经安装802.1x认证客户端，则触发用户802.1x接入认证过程，否则进行MAC认证过程；</p></li><li><p>认证服务器将携带VLAN或二三层ACL的Radius属性下发至园区交换机，根据用户认证结果控制其网络访问权限；</p></li><li><p>用户获取IP地址，NAC客户端软件与策略服务器联动，按照预先定制的安全检查策略，对用户终端健康状态进行检查，检查不通过Radius COA下发VLAN或ACL，限制用户网络访问权限；</p></li><li><p>用户通过802.1x身份认证和终端健康检查后，获取业务网络访问权限。</p></li></ol><p><strong>WEB Portal认证</strong></p><p><img src="https://pic3.zhimg.com/80/v2-5661bc9f8207e04faa4de1987d91aae6_hd.jpg" alt="img"></p><p>图 5‑6 WEB Portal认证流程</p><p><strong>WEB Portal认证过程如下：</strong></p><ol><li><p>用户终端打开WEB页面，发起HTTP请求至园区交换机；</p></li><li><p>园区交换机进行HTTP重定向，将用户的打开的WEB页面重定向至Portal服务器；</p></li><li><p>用户访问WEB Portal页面，输入用户名和密码进行认证；</p></li><li><p>Portal服务器通过Portal 2.0协议将用户输入的用户名和密码信息发送给交换机，交换机到认证服务器进行Radius认证；</p></li><li><p>认证服务器将携带VLAN或二三层ACL的Radius属性下发至园区交换机，根据用户认证结果控制其网络访问权限；</p></li><li><p>NAC客户端软件与策略服务器联动，按照预先定制的安全检查策略，对用户终端健康状态进行检查，检查不通过Radius COA下发VLAN或ACL，限制用户网络访问权限； 7) 用户通过802.1x身份认证和终端健康检查后，获取业务网络访问权限。</p></li></ol><h2 id="5-3-园区网络监管-监控-规划设计"><a href="#5-3-园区网络监管-监控-规划设计" class="headerlink" title="5.3 园区网络监管/监控 规划设计"></a>5.3 园区网络监管/监控 规划设计</h2><h2 id="5-3-1-防IP-MAC地址盗用和ARP中间人攻击"><a href="#5-3-1-防IP-MAC地址盗用和ARP中间人攻击" class="headerlink" title="5.3.1 防IP/MAC地址盗用和ARP中间人攻击"></a>5.3.1 防IP/MAC地址盗用和ARP中间人攻击</h2><p><strong>防IP/MAC地址盗用</strong></p><p>DHCP Snooping技术是DHCP安全特性，通过建立和维护DHCP Snooping绑定表过滤不可信任的DHCP信息，这些信息是指来自不信任区域的DHCP信息。DHCP Snooping绑定表包含不信任区域的用户MAC地址、IP地址、租用期、VLAN-ID 接口等信息，DHCP Snooping绑定表可以基于DHCP过程动态生成，也可以通过静态配置生成，此时需预先准备用户的IP 地址、MAC地址、用户所属VLAN ID、用户所属接口等信息。</p><p>园区交换机开启DHCP-Snooping后，会对DHCP报文进行侦听，并可以从接收到的DHCP Request或DHCP Ack报文中提取并记录IP地址和MAC地址信息。另外，DHCP-Snooping允许将某个物理端口设置为信任端口或不信任端口。信任端口可以正常接收并转发DHCP Offer报文，而不信任端口会将接收到的DHCP Offer报文丢弃。这样，可以完成交换机对假冒DHCP Server的屏蔽作用，确保客户端从合法的DHCP Server获取IP地址。</p><p><strong>防ARP中间人攻击</strong></p><p><img src="https://pic1.zhimg.com/80/v2-7fb633ba9f33f9cba422880adfda6280_hd.jpg" alt="img"></p><p>图 5‑7 ARP中间人攻击防御</p><p>Dynamic ARP Inspection (DAI)在交换机上基于DHCP Snooping技术提供用户网关IP地址和MAC地址、VLAN和接入端口的绑定， 并动态建立绑定关系。对于用户终端没有使用DHCP动态获取IP地址的场景，可采用静态添加用户网关相关信息的静态绑定表。此时园区交换机检测过滤ARP请求响应报文中的源MAC、源IP是否可以匹配上述绑定表，不能匹配则认为是仿冒网关回应的ARP响应报文，予以丢弃，从而可以有效实现防御ARP中间人/网关ARP仿冒欺骗攻击行为。</p><h2 id="5-3-2-防IP-MAC地址扫描攻击"><a href="#5-3-2-防IP-MAC地址扫描攻击" class="headerlink" title="5.3.2 防IP/MAC地址扫描攻击"></a>5.3.2 防IP/MAC地址扫描攻击</h2><p><strong>防IP扫描攻击</strong></p><p>地址扫描攻击是攻击者向攻击目标网络发送大量的目的地址不断变化的IP报文。当攻击者扫描网络设备的直连网段时，触发ARP miss，使网络设备给该网段下的每个地址发送ARP报文，地址不存在的话，还需要发送目的主机不可达报文。如果直连网段较大，攻击流量足够大时，会消耗网络设备较多的CPU和内存资源，可引起网络中断。</p><p>园区交换机支持IP地址扫描攻击的防护能力，收到目的IP是直连网段的报文时，如果该目的地址的路由不存在，会发送一个ARP请求报文，并针对目的地址下一条丢弃表项（弃后续所有目的地址为该直连网段的ARP报文），以防止后续报文持续冲击CPU。如果有ARP应答，则立即删除相应的丢弃表项，并添加正常的路由表项；否则，经过一段时间后丢弃表项自动老化。这样，既防止直连网段扫描攻击对交换机造成影响，又保证正常业务流程的畅通。</p><p>在上述基础上，交换机还支持基于接口设置ARP miss的速率。当接口上触发的ARP miss超过设置的阈值时，接口上的ARP miss不再处理，直接丢弃。</p><p>如果用户使用相同的源IP进行地址扫描攻击，交换机还可以基于源IP做ARP miss统计。如果ARP miss的速率超过设定的阈值，则下发ACL将带有此源IP的报文进行丢弃，过一段时间后再允许通过。</p><p><strong>防MAC地址扫描攻击</strong></p><p>以太网交换机的MAC地址转发表作为二层报文转发的核心，在受到攻击的时候，直接导致交换机无法正常工作。发生MAC地址攻击的时候，攻击者向攻击目标网络发送大量的源MAC地址不断变化以太报文，园区交换机收到以太报文会基于报文的源MAC学习填充二层MAC转发表项，由于MAC地址转发表的规格有限，会因为MAC扫描攻击而很快填充满，无法再学习生成新的MAC转发表，已学习的MAC表条目需通过老化方式删除，这样途径园区交换机大量的单播报文会因为按照目的MAC找不到转发表项而不得不进行广播发送，导致园区网络中产生大量的二层广播报文，消耗网络带宽、引发网络业务中断异常。</p><p>交换机二层MAC转发表是全局共享资源，单板内各端口/VLAN共享一份MAC转发表，华为园区交换机支持基于端口/VLAN的MAC学习数目限制，同时支持MAC表学习速率限制，有效防御MAC地址扫描攻击行为。MAC学习数目达到端口/VLAN上设置的阈值时，会进行丢弃/转发/告警等动作（动作策略可定制、可叠加）。另外通过园区交换机的MAC地址与端口绑定来限制跨端口的MAC扫描攻击。</p><h2 id="5-3-3-广播-组播报文抑制"><a href="#5-3-3-广播-组播报文抑制" class="headerlink" title="5.3.3 广播/组播报文抑制"></a>5.3.3 广播/组播报文抑制</h2><p>攻击者不停地向园区网发送大量恶意的广播报文，恶意广播报文占据了大量的带宽，传统的广播风暴抑制无法识别用户VLAN，将导致正常的广播流量一并被交换机丢弃。园区网交换机需要识别恶意广播流量的VLAN ID，通过基于VLAN的广播风暴抑制丢弃恶意广播报文而不影响正常广播报文流量转发。可基于端口或VLAN限制广播报文流量百分比或速率阈值。</p><p>同时园区网交换机支持组播报文抑制，可基于端口限制组播报文流量百分比或速率阈值。</p><h2 id="5-4-园区网边界防御-规划设计"><a href="#5-4-园区网边界防御-规划设计" class="headerlink" title="5.4 园区网边界防御 规划设计"></a>5.4 园区网边界防御 规划设计</h2><h2 id="5-4-1-防火墙部署规划设计"><a href="#5-4-1-防火墙部署规划设计" class="headerlink" title="5.4.1 防火墙部署规划设计"></a>5.4.1 防火墙部署规划设计</h2><p><img src="https://pic4.zhimg.com/80/v2-5d55ac60b912355a4b4eaa4ab66a055f_hd.jpg" alt="img"></p><p>图 5‑8 园区网防火墙功能部署</p><p>企业园区网边界防御分为两个部分：园区出口边界防御、园区内部边界防御。</p><p>园区出口连接Internet和企业WAN网的接入，企业外部网络尤其Internet网络，是各种攻击行为、病毒传播、安全事件引入的风险点，通过在企业出口部署高性能防火墙设备、或者在核心交换机内置防火墙模块，可以很好的缓解风险的传播，阻挡来自Internet/企业外部网络攻击行为的发生。企业园区出口位置部署的独立防火墙设备（或核心交换机内置的防火墙模块），需要满足高性能、高可靠、高安全的要求，是企业园区网的第一道安全屏障。</p><p>园区内部边界防御是将企业内部划分为多个区域，分为信任区域和非信任区域，分别实施不同的安全策略，包括部署区域间隔离、受限访问、防止来自区域内部的DOS攻击等安却措施。建议通过汇聚交换机上集成防火墙模块（单板）来实现园区内部的边界防御功能。</p><p>园区网中防火墙功能无论是独立设备部署还是集成在核心/汇聚交换机内部，都必须支持灵活的业务流控制策略配置，能把特定的流量引到防火墙进行处理，其他流量进行旁路。</p><p>防火墙本身需要保证高可靠性，需要考虑防火墙的冗余设计，支持Active/Active HA 设计方式，即交换机内集成的多块防火墙板卡支持负载分担和主备模式，不同交换机内的防火墙支持Active/Active模式，同时能够处理流量。</p><h2 id="5-4-2-防火墙功能规划设计"><a href="#5-4-2-防火墙功能规划设计" class="headerlink" title="5.4.2 防火墙功能规划设计"></a>5.4.2 防火墙功能规划设计</h2><p>网络隔离：能够对网络区域进行分割，对不同区域之间的数据流进行控制，通过对数据包的源地址、目的地址、源端口、目的端口、网络协议等参数的检查，实现对数据流的精细控制，把可能的安全风险控制在相对独立的区域内；</p><p>包过滤：支持基于ACL的基本包过滤，支持基于FTP、HTTP等应用层协议包过滤（ASPF）；</p><p>攻击防范：对常见的ICMP重定向/不可达、TCP SYN/ARP FLOOD、Land、Smurf、TearDrop、网络端口扫描、畸形报文、拒绝服务（DoS/DDoS）等攻击行为，能够提供有效的检测和防范措施。</p><p>NAT/PAT：支持园区外部公网地址到内部私网地址的代理转换，支持应用层网关ALG功能。</p><h2 id="5-4-3-防火墙性能选择"><a href="#5-4-3-防火墙性能选择" class="headerlink" title="5.4.3 防火墙性能选择"></a>5.4.3 防火墙性能选择</h2><p>园区网防火墙的选择首先是安全防护能力，对于每秒新建连接数，并发连接数和吞吐量，ACL匹配速度，DDOS识别均要进行重点考察。</p><p>防火墙的性能主要取决于以下参数：</p><p>转发性能：从吞吐量方面考虑,决定设备的防护性能</p><p>并发连接数： 从数据流数目方面考虑,决定设备的防护性能</p><p>每秒新建连接数：决定单位时间的防护能力</p><p>ACL匹配速度：决定规则匹配的可靠和性能</p><p>华为S93系列集成的防火墙单板在性能方面有突出的表现：</p><p>转发性能：每单板支持10Gbps (256Bytes)的吞吐量</p><p>并发连接数：每单板达到400万的并发连接</p><p>每秒新建连接数：每单板达到10万/，,同级别产品通常不足3万</p><p>ACL匹配速度：采用智能匹配算法，万条匹配速度和单条速度一致，即ACL匹配动作不影响防火墙整体转发性能</p><p>华为S93系列交换机集成的防火墙模块，每单板支持8Gbps的转发能力，400万的并发连</p><p>接，每秒钟15万的新建流速度；并且支持1K的虚拟化多实例。</p><h2 id="5-4-4-虚拟防火墙规划设计"><a href="#5-4-4-虚拟防火墙规划设计" class="headerlink" title="5.4.4 虚拟防火墙规划设计"></a>5.4.4 虚拟防火墙规划设计</h2><p>企业内部不同的部门具备不同的安全属性，部门内部需要进行独自的安全区域划分、并应用不同的安全策略。如下图所示，可以通过防火墙支持虚拟化实现上述需求，一个物理防火墙对资源进行划分和隔离，分配给企业内不同的部门使用，虚拟防火墙直接互相独立，就好像独立物理的防火墙一样，进行独立配置和控制。</p><p><img src="https://pic2.zhimg.com/80/v2-50302d7131326557fd277713b91f6df9_hd.jpg" alt="img"></p><p>图 5‑9 虚拟防火墙设计</p><p>总结一下，虚拟防火墙具备如下特征：</p><p>同物理防火墙一样独立管理、独立设置、每个虚拟防火墙专用的系统日志和攻击日志，以及每个虚拟防火墙的各种内部组件——例如独立路由表、转换数据库、ACL等 </p><p>可通过VLAN划分园区网用户（PC机/服务器）属于那个虚拟防火墙 </p><p>一台物理防火墙虚拟成多个逻辑防火墙，节省投资和维护成本 </p><p>适合于大型企业园区各分支部门对防火墙相对独立使用和维护的场景</p><h2 id="5-4-5-NAT规划设计"><a href="#5-4-5-NAT规划设计" class="headerlink" title="5.4.5 NAT规划设计"></a>5.4.5 NAT规划设计</h2><p>考虑到园区内网安全和企业公网地址缺乏等原因，会有一些企业选择通过采用私网IP地址来建设园区网，可以隐藏企业园区内部网络拓扑，需要在企业出口通过NAT设备进行IP地址转换。为了进行安全防护，NAT功能一般部署在防火墙设备上。NAT的应用一般主要有如下的应用场景：</p><p><strong>1) PAT方式</strong></p><p>它通过使用“IP地址＋端口号”的形式进行转换，使多个私网用户可共用一个公网IP地址访问外网，是地址转换实现的主要形式。</p><p><strong>2) NAT Server方式</strong></p><p>一般情况下，Internet/WAN上的用户，无法直接访问NAT后的私网地址服务器的； 但实际应用中，需要给公网用户提供一个访问私网服务器(如DNS服务器)的机会。 NAT Server方式就可以解决这个问题——通过静态配置“公网IP地址＋端口号”与“私网IP地址＋端口号”间的映射关系，NAT设备可以将公网地址“反向”转换成私网地址。</p><p>在部署NAT时，需要考虑应用级ALG， 因为通常情况下，NAT只改变IP报文头部地址信息，而不对报文载荷进行分析，这对于普通的应用层协议（如Telnet）来说，并不会影响其业务的开展；然而有一些应用层协议，其报文载荷中可能也携带有数据通道的地址或端口信息，若这些信息不能被有效转换，就可能导致问题。所以，NAT需要采用ALG机制处理多种应用层协议。</p><p>华为S9300交换机内置防火墙模块上的NAT功能， 支持上述企业园区网NAT需求，包括： </p><p>1对1的IP地址转换</p><p>PAT方式的多对多的IP地址转换：每板地址池：1K，地址池中地址个数：255 </p><p>NAT Server功能,支持每板1K个Server</p><p>ALG功能包括DNS、FTP、TFTP、ICMP、RTSP、SIP、QQ、MSN 等 </p><p>NAT多实例</p><h2 id="5-5-园区网出口安全规划设计"><a href="#5-5-园区网出口安全规划设计" class="headerlink" title="5.5 园区网出口安全规划设计"></a>5.5 园区网出口安全规划设计</h2><p>随着现代社会网络经济的发展，企业日益发展扩大，办事处、分支机构以及商业合作伙伴逐步增多，如何将这些小型的办公网络和企业总部网络进行经济灵活而有效的互联，并且与整个企业网络安全方案有机融合，提高企业信息化程度，优化商业运作效率，成为企业IT网络设计亟待解决的问题；大量普及的SOHO网络、小型办公网络、智能家居网络也越来越注重接入的便捷性和网络安全性。</p><p><img src="https://pic3.zhimg.com/80/v2-277788db4419b1426820ffb7179f834e_hd.jpg" alt="img"></p><p>图 5‑10 园区网出口安全设计</p><p>企业园区网出口设备是企业内部网络与外部网络的连接点，其安全保证能力非常重要，企业在信息化的过程中面临核心技术、商业机密泄密等信息安全问题，VPN技术是企业传输数据非常理想的选择，因为VPN技术正式是为了解决在不安全的Internet上安全传输机密信息，保证信息的完整性、可用性以及保密性，包括IPSec VPN和SSL VPN。企业办事处、分支机构以及商业合作伙伴如果采用主机VPN客户端接入企业总部网络，那么分之机构网络中的每个主机需要单独拨号接入，VPN接入不可控造成内部网络安全隐患，同时也大量消耗企业总部VPN网关隧道资源；如果采用单独的VPN网关与企业总部网关建立VPN隧道，又面临投资过大的问题。需要有效解决企业分支机构VPN接入灵活性、安全性和经济性之间的矛盾。</p><p>园区出口设备形态推荐：</p><p><strong>接入路由器</strong></p><p>针对企业办事处、分支机构、商业合作伙伴以及SOHO办公、智能家居等园区网络要求，采用华为SRG列业务路由网关（SRG1210/1220/2210/2220等多款产品）或AR系列接入路由器（AR18/28/46、AR19/29/49）作为园区网出口设备，集路由、交换、无线与数据安全于一体，能够提供灵活的宽带接入、WLAN解决方案、3G无线上网、NAT/PAT地址转换、攻击防范、状态检测等特性，全面满足客户自由安全联网需求。</p><p><strong>交换机</strong></p><p>针对部分小型园区网，可采用华为S9300交换机作为园区出口设备，考虑到降低设备投资成本，园区出口设备和核心交换机可以合一，通过S9300的WAN接口板提供POS/GE/10GE等广域网接口与企业外部网络互联，同时S9300作为园区核心交换机，下连各个汇聚交换机，S9300通过增值业务单板提供IPsec VPN和SSL VPN，满足企业分支机构安全互联以及企业员工或外部访客远程访问园区网的需求。</p><h2 id="6-园区网络网管系统方案规划设计"><a href="#6-园区网络网管系统方案规划设计" class="headerlink" title="6 园区网络网管系统方案规划设计"></a>6 园区网络网管系统方案规划设计</h2><h2 id="6-1-网管系统概述"><a href="#6-1-网管系统概述" class="headerlink" title="6.1 网管系统概述"></a>6.1 网管系统概述</h2><p>网管系统 提供了“无缝式IT运维管理”功能，其系统架构清晰，采用模块化的设计理念，各功能模块既可独立运行、松散耦合；亦可整体功能无缝衔接覆盖整个业务系统，灵活的自由组合真正实现个性化的IT无忧运维。</p><p>网管系统主要由网络管理、流量管理、认证计费等几个产品组成。</p><p><strong>网络管理：</strong>实现了对交换机、路由器、防火墙等设备的全方位管理，提供了丰富的拓扑、配置、资产、故障、性能、事件、流量、报表等网络管理功能。</p><p><strong>流量管理：</strong>提供网络流量监测、流量门限、协议分析、Web上网行为审计等功能。结合NetFlow网络流量分析器实现更为细化、便捷的全网流量分析功能。</p><p><strong>认证计费：</strong>提供灵活多样的计费策略，支持多种认证方式，满足组性化的用户管理，实现多样化的控制策略。</p><p>通过网管系统模块可以实现对IT资源的全面、可视化、统一管理。</p><p><img src="https://pic2.zhimg.com/80/v2-ca94d77f5504c02fb071a3249dc97879_hd.jpg" alt="img"></p><p>图 6‑1 企业网网管系统组件</p><h2 id="6-2-系统优势介绍"><a href="#6-2-系统优势介绍" class="headerlink" title="6.2 系统优势介绍"></a>6.2 系统优势介绍</h2><p><strong>多角度管理:</strong></p><p>面向基础设施：提供全面的IT资源管理，实现对网络、主机、存储设备、安全设备、数据库、中间件及应用软件等IT资源的全面监控和管理；同时对网络和业务应用等IT资源的性能进行监控，定期性能报表和趋势报表，为IT系统性能优化提供科学依据。</p><p>面向维护管理人员：将人、技术与流程进行有效地融合，实现日常运维工作的自动化、信息化和标准化，实时展现当前企业IT系统的运行状态及趋势，帮助管理人员快速定位问题，修复故障，保障业务系统的稳定性，知识库能降低IT运维管理对个人的依赖。</p><p>面向领导决策者：可及时汇总系统运行状态信息，帮助领导全面了解IT系统状况和趋势，为其提供科学依据。同时可借助自动生成的多种工作记录，实现对运维人员的绩效考核，提高团队技术水平，建立以客户为中心的运维模式，提供低成本、高质量的IT服务，提高客户满意度</p><p>立体化分级管理：可根据不同用户的组织结构、地理分布及业务关系，实施跨地域、层次化的统一管理模式，使责权管理更加明确，拓扑图更加清晰，提高系统的工作效率；</p><p><strong>主动预警：</strong></p><p>对网络关键设备设置相关阈值，当达到范围时，自动产生告警，并执行事先设置动作。</p><p>内置解释器，告警信息可按指定方式进行解释，更加明白易懂。</p><p>支持声音、邮件和手机短信等多种告警方式，确保信息通知到相应负责人；</p><p><strong>资产生命周期管理：</strong></p><p>从运维的角度对IT资产进行管理，包括相关配置、使用年限、维修记录等。</p><p>全程跟踪记录IT设备的使用周期，包括入库、领用、使用负荷和报废等。</p><p>减少设备流失，提高设备利用率，以最少的资金投入带来最大的回报；</p><p><strong>易于使用：</strong>操作简单方便，拓扑图支持全屏显示、局部放大镜、延时拖动、鹰眼、拖动图标无极缩放等丰富的操作功能，并支持任意层次的拓扑结构划分；</p><p><strong>易于部署：</strong>无需在被监测信息系统、服务器上安装任何代理软件，只需将系统安装在一台管理机上，即可自动进行监测和管理，同时对现有系统性能影响甚微，不会改变现有系统的应用配置，便于安装实施、维护使用。</p><p><strong>易于定制：</strong>提供了灵活的Web方式的客户化定制、发布工具，可对软件界面呈现及风格、数据库表、对象属性和方法进行灵活配置和定制，以满足用户特定的业务需求；提供了丰富的扩展和开发接口，可以快捷的集成各种管理工具，可以快速将各类IT资源纳入到系统管理范围内，加入到IT服务管理的流程中；此外，可视化的客户定制工具可以支持用户灵活定义和调整流程，以支持组织架构和流程的变化和发展。</p><h2 id="6-2-1-网络管理优势功能"><a href="#6-2-1-网络管理优势功能" class="headerlink" title="6.2.1 网络管理优势功能"></a>6.2.1 网络管理优势功能</h2><p><strong>业界领先的全自动拓扑发现技术</strong></p><p>自动搜索网络、发现网络节点，包括：网络设备、服务器、打印机、PC主机及VLAN等，并基于网络的二层连接关系构建物理拓扑。</p><p><strong>故障智能预测与分析</strong></p><p>通过实时的网络运行监测，Apex U2810可智能分析和预测潜在故障，并根据告警程度的不同发送警报。</p><p><strong>智能阈值技术</strong></p><p>能为每一个IT资源监控项给出科学的差异化阈值设置指导，并可随着时间段和业务量的变化进行动态调整。</p><p><strong>网络拓扑快速全面</strong></p><p>可快速全面的呈现网络拓扑结构，自动发现网络及其承载的服务，并支持多种协议。</p><p><strong>支持分布式管理</strong></p><p>支持多用户，多角色，IT运维人员，决策人员，不同角色有不同权限，不同区域级别也有不同权限。</p><p><strong>多维度监控</strong></p><p>支持从路由、设备、终端、流量、故障等方面多角度、细颗粒度地监控、管理整个IT网络。</p><h2 id="6-2-2-网络流量分析器优势功能"><a href="#6-2-2-网络流量分析器优势功能" class="headerlink" title="6.2.2 网络流量分析器优势功能"></a>6.2.2 网络流量分析器优势功能</h2><p><strong>简化的带宽监控</strong></p><p>NetFLow Analyzer能分析园区网交换机和出口路由器等设备中导出的Netstream数据。它支持标准的的操作硬件，支持Windows和Linux环境，易于部署易于操作，且无需广泛培训。</p><p><strong>深入的流量分析</strong></p><p>无需使用硬件探针或其他设备，NetFlow Analyzer能简单有效地执行流量分析。除了设置路由/交换设备导出NetFlow数据到NetFlow Analyzer，不需要其它的配置。</p><p><strong>全面显示流量信息</strong></p><p>NetFlow Analyzer通过NetFlow数据能呈现占用带宽最多的应用、主机和会话。要了解高峰时间的使用和历史趋势，该信息就显得非常重要。此外，从长期来看这些信息还可用于带宽容量规划和巩固安全策略。</p><p><strong>高效的带宽利用</strong></p><p>在多数企业中，对带宽不加管理将导致在高峰时间不重要的应用具有高于重要应用的优先级。NetFlow Analyzer中的带宽报表准确地显示了哪些应用在高峰时间使用带宽，并深入分析使用这些应用的主机。这将有助于控制带宽使用并加强企业安全策略。</p><p><strong>灵活的设备管理</strong></p><p>NetFlow Analyzer可以将NetFLow输出设备分组到不同的组别，以便进行针对性监控，以及向用户授予访问权限。利用NetFlow Analyzer中的设备分组，就可以专门管理某组导出NetFlow数据的设备，您可以将操作员指派到不同的组，监控带宽利用情况，以及查看针对每个设备组的流量模式。</p><p><strong>降低运维成本</strong></p><p>NetFlow Analyzer通过简化管理任务以降低成本。比起分析数据包需要许多时间分析结果并得到结论，故障诊断只需要相当少的时间。带宽报表以及深入分析选项使得流量分析更加快速有效，从而高效地使用企业的重要资源。</p><p><strong>高效的报表，易于趋势分析</strong></p><p>NetFlow Analyzer提供了丰富的带宽报表，便于分析流量的相关信息。通过查看不同时段的流量模式，NetFlow Analyzer显著简化了趋势分析过程。NetFlow Analyzer具有30多种不同的图表和报表，并带有能深入分析特定明细的选项，便于用户直接访问重要的信息。用户可以在线查看不同时段的图表，并将其输出为PDF格式。</p><p><strong>完全基于Web</strong></p><p>NetFlow Analyzer完全基于web，因此只需一个web浏览器就可以从网络中的任何位置跨WAN链接轻松查看流量报表。</p><h2 id="6-2-3-认证计费优势功能"><a href="#6-2-3-认证计费优势功能" class="headerlink" title="6.2.3 认证计费优势功能"></a>6.2.3 认证计费优势功能</h2><p><strong>成熟先进的宽带综合业务管理平台</strong></p><p>集成实时计费、业务管理和客户管理，提供各种应用的运行和管理、计费平台</p><p><strong>先进宽带运营理念的载体</strong></p><p><strong>基于用户的全方位管理控制手段</strong></p><p><strong>支持多种接入认证方式：</strong></p><p>802.1x、</p><p>WEB、</p><p>PPPoE、</p><p>RADIUS认证</p><p><strong>多层次计费策略：</strong></p><p>针对储值卡、充值卡有效期设置；</p><p>支持交费送免费用量设置；</p><p>提供信用额功能，允许用户超支部分用量；</p><p>支持预付费、后付费方式；</p><p>支持月结、即用即结、先付后用、包日等结算方式；</p><p>支持期限用户，即按每月固定月租，开通日开始计费，服务结束日自动停机，可以续交费，计费开始日自动按续费日开始计算；</p><p>支持月结延迟停机，在线催费；</p><p>支持开机停机预受理；</p><p><strong>灵活的控制策略：</strong></p><p>用户每日上网时段控制；</p><p>目标地址控制过滤策略；</p><p>目标端口控制策略；</p><p>源地址控制策略；</p><p>每日或每月上网时间和流量上限控制策略；</p><p>完整的登录记录、访问记录；</p><p>完整的设备运行日志</p><h2 id="6-3-网管系统部署"><a href="#6-3-网管系统部署" class="headerlink" title="6.3 网管系统部署"></a>6.3 网管系统部署</h2><h2 id="6-3-1-集中式网管系统部署"><a href="#6-3-1-集中式网管系统部署" class="headerlink" title="6.3.1 集中式网管系统部署"></a>6.3.1 集中式网管系统部署</h2><p><img src="https://pic3.zhimg.com/80/v2-7483e7441c549e4ce0899cf884f36d9a_hd.jpg" alt="img"></p><p>图 6‑2 集中式网管系统部署</p><p><strong>硬件推荐配置：</strong></p><p><strong>软件推荐配置：</strong></p><p>操作系统</p><p>数据库</p><p>Web服务器</p><h2 id="6-3-2-分布式网管系统部署"><a href="#6-3-2-分布式网管系统部署" class="headerlink" title="6.3.2 分布式网管系统部署"></a>6.3.2 分布式网管系统部署</h2><p>系统可以通过将网管服务和数据库分离，降低数据库系统和网管服务器在高负荷状态下的相互影响。目前可将网管服务器和南向接口服务器分离。一方面可以降低南向接口承受的通信压力对网管服务器造成的影响。另外，对于大规模的网络，通过部署多个南向接口服务器，可以提高通信效率，降低单点失效造成的全网无法管理的风险。</p><p>网络管理系统均部署在一台中心服务器（以下简称Apex中心服务器）上，并通过PlusWell HA Cluster做集群。数据库服务器单独部署一台服务器，流量分析单独部署一台服务器，网络管理的二级系统部署在一台二级服务器上，分布在各个分支机构，可已经根据网络规模的不断增长灵活扩容。</p><p><img src="https://pic2.zhimg.com/80/v2-f7ead39000ee1c32e6f755ca9bde88ad_hd.jpg" alt="img"></p><p>图 6‑3分布式网管系统部署</p><p><strong>硬件推荐配置：</strong></p><p><strong>软件推荐配置：</strong></p><h2 id="7-园区网络设备介绍"><a href="#7-园区网络设备介绍" class="headerlink" title="7 园区网络设备介绍"></a>7 园区网络设备介绍</h2><h2 id="7-1-园区汇聚-核心交换机"><a href="#7-1-园区汇聚-核心交换机" class="headerlink" title="7.1 园区汇聚/核心交换机"></a>7.1 园区汇聚/核心交换机</h2><p>Quidway® S9300系列运营级园区汇聚交换机是由华为公司自主开发的新一代高性能核心路由交换机产品，提供大容量、高密度、模块化的二到四层线速转发性能，具有强大组播功能，完善的QoS保障、有效的安全管理机制和电信级的高可靠设计，满足高端用户对多业务、高可靠、大容量、模块化的需求，降低运营商的建网成本和维护成本，可广泛应用于构建各种类型型园区网核心层和汇聚层交换机，对于接入交换机性能和接口密度要求高的某些大型园区网，也可使用S9303/S9306系列交换机作为接入交换机使用。</p><p><strong>产品特点</strong></p><p><strong>先进体系结构，高性能，配置灵活</strong></p><p>S9300系列交换机采用先进的全分布式体系结构设计，采用业界最新的硬件转发引擎技术，所有端口支持的业务能够线速转发，业务包括IPv4/MPLS/二层转发等。支持ACL线速转发。</p><p>S9300系列交换机实现组播线速转发，硬件完成两级复制：交换网板复制到接口板和转发引擎复制到接口。</p><p>S9300支持2Tbps交换容量，支持多种高密度板卡，满足核心、汇聚层设备大容量、高端口密度的要求，可以满足用户日益增长的带宽需求，能够极大的保护和节约用户投资。</p><p><strong>设备的性能规格参数：</strong></p><p><strong>安全机制</strong></p><p><strong>可靠性</strong></p><p>链路汇聚：S9300系列交换机最大支持128个汇聚组，每个汇聚组内支持最多8个成员端口，支持跨单板端口间的汇聚。</p><p>支持DLDP（Device Link Detection Protocol，设备连接检测协议）：可以监控光纤或铜质双绞线的链路状态。如果发现单向链路存在，DLDP会根据用户配置，自动关闭或通知用户手工关闭相关端口，以防止网络问题的发生。</p><p>支持RRPP及多实例：相比其他以太环网技术，RRPP具有以下优势――拓扑收敛速度快，低于50ms。收敛时间与环网上节点数无关，可应用于网络直径较大的网络。</p><p>支持标准STP/RSTP/MSTP二层环网保护协议</p><p>支持SmartLink及多实例</p><p>支持BFD for 单播路由/VRRP/FRR/PIM</p><h2 id="7-2-园区接入交换机"><a href="#7-2-园区接入交换机" class="headerlink" title="7.2 园区接入交换机"></a>7.2 园区接入交换机</h2><h2 id="7-2-1-Quidway-S5300系列交换机"><a href="#7-2-1-Quidway-S5300系列交换机" class="headerlink" title="7.2.1 Quidway S5300系列交换机"></a>7.2.1 Quidway S5300系列交换机</h2><p>Quidway S5300系列运营级园区交换机是华为公司为满足大带宽及多业务承载需求而推出的新一代全千兆运营级三层以太网交换机。S5300基于新一代高性能硬件和华为公司统一的VRP(Versatile Routing Platform)软件平台，支持万兆上行，提供高密度下行千兆端口，支持多种运营级可靠性技术，具备良好的扩展性和多业务接入/汇聚能力，可充分满足园区网络接入层交换机的应用需求。S5300为盒式产品设备，机箱高度1U，提供普通型(SI)和增强型(EI)产品版本，包括型号：S5328C-EI、S5328C-EI-24S、S5352C-EI、S5324TP-SI、S5324TP-PWR-SI、S5348TP-SI、S5348TP-PWR-SI、S5328C-PWR-EI、S5352C-PWR-EI、S5328C-SI、S5352C-SI、S5328C-PWR-SI、S5352C-PWR-SI。</p><p><strong>产品特点：</strong></p><p><strong>大带宽、高性能</strong></p><p>S5300最大可提供48个GE接口，以及4个GE接口或者2个10GE接口，充分满足对高密度千兆和万兆上行设备的需求。S5300硬件支持二/三层数据包线速转发能力。 </p><p><strong>强大的组播功能</strong></p><p>S5300支持组播组，支持可控组播、IGMP Snooping/Proxy/Filter/Fast leave等特性。S5300支持线速的跨VLAN组播复制，支持捆绑端口的组播负载分担，支持基于VLAN的组播呼叫接纳控制功能(组播CAC)，支持IPv6组播，支持MLD V1/V2 snooping, 充分满足IPTV等组播业务的运营要求。</p><p><strong>运营级高可靠性</strong></p><p>S5300不仅支持STP/RSTP/MSTP生成树协议，还支持树形(Smartlink/Monitorlink)和环形(RRPP)拓扑等增强型运营级以太网链路冗余保护技术，实现毫秒级的链路保护倒换，保证高可靠性业务要求的网络质量。</p><p>S5300支持Smartlink和RRPP的多实例功能，可实现链路负载分担，进一步提高链路带宽利用率。S5300支持BFD快速链路检测，可以为OSPF、ISIS、VRRP、PIM等路由协议提供毫秒级的连通性检测机制，提高网络拓扑收敛速度。</p><p>S5300同时提供Eth-OAM功能，802.1ag提供端到端可靠性检测，802.3ah提供最后一公里故障检测和链路性能管理。此外，S3300支持BPDU tunnel功能，为用户利用运营商提供的专线构建自己的二层网络提供可能。</p><p><strong>卓越的安全特性</strong></p><p>S5300支持MCE功能，实现不同VPN用户在同一台设备上的路由隔离，有效解决用户的数据安全问题，同时降低用户设备投资成本。S5300提供多种用户安全保护功能，支持大ACL表项，支持IP/MAC/端口的组合绑定，支持黑洞MAC地址、端口隔离、MAC地址学习数目限制、、端口安全、Sticky MAC、MFF、动态ARP检测、IP SOURCE GUARD等安全技术，支持Radius、Tacacs、802.1x、NAC、SSH等认证技术，为网络穿上坚实的保护衣。</p><p><strong>iStack功能</strong></p><p>S5300全系列产品支持堆叠功能，提供高速堆叠模块，支持双向48Gbps的堆叠带宽，在保证了堆叠设备高性能的同时，简化了管理和网络运行，降低了成本，提供强大的网络扩展能力，保障了网络的可靠性。</p><p><strong>支持IPv6功能</strong></p><p>S5300支持IPv6协议，支持双栈，实现了多种IPv6协议，支持IPv4向IPv6的多种过渡技术，实现了IPv6的多种路由协议，为下一代网络提供了保证。</p><h2 id="7-2-2-Quidway-S3300系列交换机"><a href="#7-2-2-Quidway-S3300系列交换机" class="headerlink" title="7.2.2 Quidway S3300系列交换机"></a>7.2.2 Quidway S3300系列交换机</h2><p>Quidway S3300系列运营级园区交换机是华为公司为满足以太网多业务承载需要而推出的新一代园区接入三层交换机。S3300基于新一代高性能硬件和华为公司统一的VRP(Versatile Routing Platform)软件平台，提供增强型灵活QinQ功能，具备限速的跨VLAN组播复制能力，支持环形拓扑和树形拓扑等运营级组网技术，具备以太网OAM功能，提供高性能低成本的堆叠功能，是企业网的楼宇、小区接入等多种场合的最佳选择。</p><p>S3300为盒式产品设备，机箱高度1U，从特性上划分为标准型(SI)和增强型(EI)两个产品版本，标准型支持二层和基本的三层功能，增强型支持复杂的路由协议和丰富的业务特性，包含型号：S3328TP-SI、S3352P-SI、S3328TP-EI、S3328TP-EI-24S、S3325-EI、S3325-EI-24S、S3325-EI-48S、S3328TP-PWR-EI、S3352P-PWR-EI。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;原文链接：&lt;a href=&quot;https://zhuanlan.zhihu.com/p/53512258&quot;&gt;https://zhuanlan.zhihu.com/p/53512258&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;1-项目概述&quot;&gt;&lt;a href=&quot;#1-项目概述&quot; class=&quot;headerlink&quot; title=&quot;1 项目概述&quot;&gt;&lt;/a&gt;1 项目概述&lt;/h2&gt;&lt;p&gt;根据实际情况增加项目介绍&lt;/p&gt;
&lt;h2 id=&quot;1-1-项目背景&quot;&gt;&lt;a href=&quot;#1-1-项目背景&quot; class=&quot;headerlink&quot; title=&quot;1.1 项目背景&quot;&gt;&lt;/a&gt;1.1 项目背景&lt;/h2&gt;&lt;h2 id=&quot;1-2-项目目标&quot;&gt;&lt;a href=&quot;#1-2-项目目标&quot; class=&quot;headerlink&quot; title=&quot;1.2 项目目标&quot;&gt;&lt;/a&gt;1.2 项目目标&lt;/h2&gt;&lt;h2 id=&quot;2-园区总体系统规划设计&quot;&gt;&lt;a href=&quot;#2-园区总体系统规划设计&quot; class=&quot;headerlink&quot; title=&quot;2 园区总体系统规划设计&quot;&gt;&lt;/a&gt;2 园区总体系统规划设计&lt;/h2&gt;&lt;h2 id=&quot;2-1-需求分析&quot;&gt;&lt;a href=&quot;#2-1-需求分析&quot; class=&quot;headerlink&quot; title=&quot;2.1 需求分析&quot;&gt;&lt;/a&gt;2.1 需求分析&lt;/h2&gt;&lt;p&gt;随着企业信息化建设不断深入，企业的生产业务系统、经营管理系统、办公自动化系统均得到大力发展，对于企业园区网的建设要求越来越高。传统园区网建设初期往往面临如下问题：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(一)&lt;/strong&gt; &lt;strong&gt;网络架构较为混乱，不便于扩容和维护管理：&lt;/strong&gt;园区网在建设初期，设备和光纤/电缆随意布放，缺乏统一的网络分层规划管理，网络拓扑相对混乱，不便于对网络性能瓶颈进行正确评估和有效扩容，给日常网络管理也带来很大难度。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(二)&lt;/strong&gt; &lt;strong&gt;网络可靠性规划不合理，影响企业生产和经营管理、造成投资浪费：&lt;/strong&gt;由于缺乏有效的园区网规划，对于网络可靠性考虑不够，网络中既存在单点故障导致网络可靠性低、影响企业生产和经营管理行为，同时也存在网络过度冗余、造成投资浪费的现象。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(三)&lt;/strong&gt; &lt;strong&gt;网络信息安全存在隐患：&lt;/strong&gt;网络安全性是园区网建设的重中之重，传统园区网安全漏洞较多，无法应对内外部用户日益猖獗的网络攻击行为（例如：对园区网设备进行攻击、消耗网络带宽、窃取企业核心电子资产信息），对于内部和外部用户缺乏有效的身份认证手段、用户可随意接入网络，网络层面的安全保证和防御措施也不到位，造成园区网的脆弱和易攻击。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(四)&lt;/strong&gt; &lt;strong&gt;无法满足日益增长的网络业务需求：&lt;/strong&gt;随着企业的业务发展，出现了基于园区网基础设施的丰富增值业务需求，例如：网络接入形式要求多样化，支持WLAN无线接入，满足移动办公、大区域无线缆覆盖等特殊要求；对于企业用户访问外网进行计费，计费策略可灵活设置（时长计费、流量计费、按目的地址计费）；企业多出口链路场景下的负载均衡、灵活选路需求。传统园区网建设缺乏有效满足这些增值业务需求的统一解决方案考虑，支持这些业务存在园区网络分散建设、重复投资的问题。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(五)&lt;/strong&gt; &lt;strong&gt;缺乏简单有效的网络管理系统，企业IT网络运维部门面临很大压力：&lt;/strong&gt;当前，企业网IT运维部门面临很大的网络运维压力，来自于园区网内外部的安全事件频发、网络可靠性低引起的网络业务中断现象，网络故障诊断、分析定位过程对于IT运维人员的技术能力和经验水平要求较高，缺乏简单有效/低成本的图形化网管工具、进行实时网络拓扑显示、状态监控和各种故障事件预警/告警展示。另外，IT运维部门也需要实施统计园区网各路径的流量信息，便于对网络带宽进行管理和规划，给后续网络扩容提供参考。&lt;/p&gt;
&lt;h2 id=&quot;2-2-设计原则&quot;&gt;&lt;a href=&quot;#2-2-设计原则&quot; class=&quot;headerlink&quot; title=&quot;2.2 设计原则&quot;&gt;&lt;/a&gt;2.2 设计原则&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;(一)&lt;/strong&gt; &lt;strong&gt;安全性：&lt;/strong&gt;安全性是企业园区网建设中的关键，它包括物理空间的安全控制及网络的安全控制。需要有完整的安全策略控制体系来实现企业园区网的安全控制。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(二)&lt;/strong&gt; &lt;strong&gt;可靠性、可用性：&lt;/strong&gt;高可靠性是园区网提供使用的关键，其可靠性设计包括：关键设备冗余、链路/网络冗余和重要业务模块冗余。&lt;/p&gt;
&lt;p&gt;关键设备均采用电信级全冗余设计，可实现单板热拔插、冗余的控制模块设计、冗余电源设计。采用冗余网络设计，每个层次均采用双机方式，层次与层次之间采用全冗余连接。提供多种冗余技术，采用高效、负载均衡的双机备份。&lt;/p&gt;
&lt;p&gt;可采用交换机的集群或者堆叠技术，在不降低网络可靠性的前提下，减化网络架构。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(三)&lt;/strong&gt; &lt;strong&gt;可扩展性：&lt;/strong&gt;园区网方案设计中，采用分层的网络设计；每个层次的设计所采用的设备本身都应具足够高的端口密度，为后续园区网扩展奠定基础。&lt;/p&gt;
&lt;p&gt;在园区出口层、核心层、汇聚层的设备都采用模块化设计，可根据园区网的发展进行灵活扩展。&lt;/p&gt;
&lt;p&gt;功能的可扩展性是园区网随着发展提供增值业务的基础。实现防火墙、负载均衡、WLAN接入、认证计费等功能，为园区网增值业务的扩展提供基础。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(四)&lt;/strong&gt; &lt;strong&gt;可维护、可管理性：&lt;/strong&gt;网络可管理性是园区网成功运维的基础。应提供低成本、简单有效的园区网统一网管系统，对园区网所有网络设备进行管理，包括网络拓扑显示、网络状态监控、故障事件实时预警和告警、网络流量统计。&lt;/p&gt;
    
    </summary>
    
    
      <category term="华为" scheme="https://zeozzz.github.com/categories/%E5%8D%8E%E4%B8%BA/"/>
    
    
      <category term="华为" scheme="https://zeozzz.github.com/tags/%E5%8D%8E%E4%B8%BA/"/>
    
  </entry>
  
  <entry>
    <title>中小型园区/分支出口综合配置举例</title>
    <link href="https://zeozzz.github.com/2019/07/15/66/"/>
    <id>https://zeozzz.github.com/2019/07/15/66/</id>
    <published>2019-07-15T06:59:36.000Z</published>
    <updated>2020-01-21T09:36:53.261Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>原文链接：<a href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000098180&amp;partNo=10012#dc_cfg_campus_002">http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000098180&amp;partNo=10012#dc_cfg_campus_002</a></p><h1 id="1-中小型园区-分支出口综合配置举例"><a href="#1-中小型园区-分支出口综合配置举例" class="headerlink" title="1  中小型园区/分支出口综合配置举例"></a><strong>1</strong>  中小型园区/分支出口综合配置举例</h1><h2 id="园区网出口简介"><a href="#园区网出口简介" class="headerlink" title="园区网出口简介"></a>园区网出口简介</h2><p>园区网出口一般位于企业网内部网络与外部网络的连接处，是内部网络与外部网络之间数据流的唯一出入口。对于中小型企业来说，考虑到企业网络建设的初期投资与长期运维成本，一般希望将多种业务部署在同一设备上。企业网络用户一般同时需要访问Internet和私网VPN，而对于中小型企业来说考虑到建设及维护成本问题，一般租用运营商Internet网络组建私网VPN。对于部分可靠性要求较高的园区网络，一般考虑部署两台出口路由器做冗余备份实现设备级可靠性，同时应用链路聚合、VRRP、主备路由等技术保证园区出口的可靠性。华为AR系列路由器配合华为S系列交换机是中小型园区网出口设备的理想解决方案。</p><ul><li>园区出口设备需要具备NAT Outbound及NAT Server的功能，实现私网地址和公网地址之间的转换，以满足用户访问Internet或者Internet用户访问内网服务器的需求。</li><li>园区出口设备需要具备通过Internet构建私网VPN的功能，以满足企业用户各个机构之间私网VPN互通的需求</li><li>园区出口设备需要具备数据加密传输的功能，以保证数据的完整性和机密性，保障用户业务传输的安全</li><li>中小型园区出口需要具备可靠性、安全性、低成本、易维护等特点。</li></ul><h2 id="配置注意事项"><a href="#配置注意事项" class="headerlink" title="配置注意事项"></a>配置注意事项</h2><ul><li>本配置案例适用于中小型企业园区/分支出口解决方案。</li><li>本配置案例仅涉及企业网络出口相关配置，涉及企业内网的相关配置请参见华为S系列园区交换机快速配置中的“中小园区组网场景”。</li></ul><h2 id="组网需求"><a href="#组网需求" class="headerlink" title="组网需求"></a>组网需求</h2><p>某企业总部和分支分别位于不同的城市，地域跨度较远，总部存在A、B两个不同的部门，分支只有一个部门。现在需要建设跨地域的企业园区网络，需要实现的需求如下：</p><ul><li>总部和分支都需要实现用户访问Internet的需求。总部划分为A、B两个部门，其中A部门的用户可以访问Internet，但是B部门的用户不能访问Internet；分支所有用户都可以访问Internet。</li><li>总部有Web服务器，对外提供WWW服务，外网用户可以访问内网服务器。</li><li>总部和分支之间需要通过Internet进行私网VPN互通，通信内容需要有安全保护。</li><li>总部园区出口可靠性要求较高，需要考虑链路级的可靠性和设备级的可靠性。</li><li>分支可以适当降低可靠性要求。</li></ul><a id="more"></a><h2 id="方案介绍"><a href="#方案介绍" class="headerlink" title="方案介绍"></a>方案介绍</h2><p>根据用户需求，可以给出如<a href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000098180&partNo=10012#fig_dc_cfg_campus_002_01">图1-1</a>所示的综合配置解决方案，该方案具备层次化、模块化、冗余性、安全性的特点，适用于中小型企业/分支的园区网络部署。</p><p><strong>图1-1</strong>  中小型园区/分支出口综合配置组网图<br><img src="http://support.huawei.com/enterprise/product/images/4d904db9c09842ba9ca70b11b5eb11c9" alt="img"></p><ul><li>在网络的接入层部署华为S2700&amp;S3700交换机（ACC1、ACC2、SwitchA），在网络的核心部署华为S5700交换机（CORE），在园区出口部署华为AR3200路由器（RouterA、RouterB、RouterC）。</li><li>总部采用双AR出口冗余备份方式，保证设备级的可靠性。分支部署一台AR路由器做出口。</li><li>总部核心交换机采用两台S5700交换机做堆叠，保证设备级的可靠性。</li><li>总部接入交换机与核心交换机之间以及核心交换机与出口路由器之间采用Eth-Trunk方式组网，保证链路级的可靠性。</li><li>总部每个部门业务划分到一个VLAN中，部门间的业务在核心交换机CORE上通过VLANIF三层互通。</li><li>总部核心交换机作为用户及服务器网关，部署DHCP Server为用户分配IP地址。</li><li>分支用户的网关直接部署在出口路由器上。</li><li>总部两个出口路由器之间部署VRRP，保证可靠性。</li><li>总部和分支之间通过Internet构建IPSec VPN进行私网互通，同时保证数据传输的安全性。</li><li>总部两台出口路由器和核心交换机之间部署OSPF，用于发布用户路由，便于后期扩容及维护。</li></ul><h2 id="配置思路"><a href="#配置思路" class="headerlink" title="配置思路"></a>配置思路</h2><p>采用如下思路部署中小型园区/分支出口综合配置举例：</p><ol><li><p>部署总部及分支园区内网</p><p>总部：部署堆叠、链路聚合，配置各VLAN及IP地址、部署DHCP Server，实现园区内网互通。部门内部通过接入层交换机进行二层互通，部门间通过核心交换机CORE上的VLANIF进行三层互通。</p><p>分支：配置接入层交换机及出口路由器的各接口VLAN及IP地址，部署DHCP Server，实现分支园区内网互通。</p></li><li><p>部署VRRP</p><p>为了保证总部核心交换机与两个出口路由器之间的可靠性，在两个出口路由器之间部署VRRP，VRRP的心跳报文经过核心交换机进行交互。RouterA为Master设备，RouterB为Backup设备。</p><p>为了防止总部RouterA上行链路故障的时候业务断流，将VRRP状态与RouterA的上行口进行联动，保证上行链路故障时VRRP进行快速倒换。</p></li><li><p>部署路由</p><p>为了引导各设备的上行流量，在总部核心交换机上配置一条缺省路由，下一跳指向VRRP的虚地址，在总部及分支的出口路由器上各配置一条缺省路由，下一跳指向运营商网络设备的对接地址（公网网关）。</p><p>为了引导总部两个出口路由器的回程流量，在两个出口路由器和核心交换机之间部署OSPF，核心交换机上将所有用户网段发布到OSPF里面，通告给两个出口路由器。</p><p>为了引导外网用户访问Web服务器的流量，需要在总部的运营商路由器上配置两条目的地址为服务器公网地址的静态路由，下一跳分别指向两个出口路由器的上行口IP地址。并且为了保证路由和VRRP同步切换，设置下一跳为RouterA的这条路由优先，当这条路由失效的时候下一跳指向RouterB的路由生效。</p></li><li><p>部署NAT Outbound</p><p>为了使内网用户访问Internet，在两台出口路由器的上行口配置NAT，实现私网地址和公网地址之间的转换。通过ACL匹配A部门的源IP地址，从而实现A部门的用户可以访问Internet，而B部门的用户不能访问Internet。</p></li><li><p>NAT Server</p><p>为了实现外网用户访问内网Web服务器，在两个出口路由器的上行口上配置NAT Server，实现服务器公网地址和私网地址之间的映射。</p></li><li><p>部署IPSec VPN</p><p>为了实现总部和分支之间进行私网VPN互通，在总部出口路由器和分支出口路由器之间部署IPSec VPN，通过Internet构建IPSec VPN，实现总部和分支之间的安全通信。</p></li></ol><p> 说明：</p><p>部署总部及分支园区内网所涉及的配置不在本例中给出，请参见华为S系列园区交换机快速配置中的“中小园区组网场景”。</p><h2 id="数据规划"><a href="#数据规划" class="headerlink" title="数据规划"></a>数据规划</h2><p>详细的数据规划如<a href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000098180&partNo=10012#table_01">表1-1</a>、<a href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000098180&partNo=10012#table_02">表1-2</a>、<a href="http://support.huawei.com/enterprise/docinforeader!loadDocument1.action?contentId=DOC1000098180&partNo=10012#table_03">表1-3</a>所示。</p><p><strong>表1-1</strong>  链路聚合接口规划</p><table><thead><tr><th>设备</th><th>聚合接口</th><th>物理接口</th></tr></thead><tbody><tr><td>RouterA</td><td>Eth-trunk1</td><td>GE2/0/0GE2/0/1</td></tr><tr><td>RouterB</td><td>Eth-trunk1</td><td>GE2/0/0GE2/0/1</td></tr><tr><td>CORE</td><td>Eth-trunk1</td><td>GE0/0/1GE1/0/1</td></tr><tr><td>Eth-trunk2</td><td>GE0/0/2GE1/0/2</td><td></td></tr><tr><td>Eth-trunk3</td><td>GE0/0/3GE1/0/3</td><td></td></tr><tr><td>Eth-trunk4</td><td>GE0/0/4GE1/0/4</td><td></td></tr><tr><td>ACC1</td><td>Eth-trunk1</td><td>GE0/0/1GE0/0/2</td></tr><tr><td>ACC2</td><td>Eth-trunk1</td><td>GE0/0/1GE0/0/2</td></tr></tbody></table><p> 说明：</p><p>所有链路聚合采用LACP模式。</p><p><strong>表1-2</strong>  VLAN规划</p><table><thead><tr><th>设备</th><th>数据项</th><th>备注</th></tr></thead><tbody><tr><td>RouterA</td><td>Eth-trunk1.100：配置Dot1q终结子接口，终结VLAN100</td><td>用于和总部核心交换机CORE对接</td></tr><tr><td>RouterB</td><td>Eth-trunk1.100：配置Dot1q终结子接口，终结VLAN100</td><td>用于和总部核心交换机CORE对接</td></tr><tr><td>CORE</td><td>Eth-trunk1：Trunk类型，透传VLAN10</td><td>用于和总部部门A对接</td></tr><tr><td>Eth-trunk2：Trunk类型，透传VLAN20</td><td>用于和总部部门B对接</td><td></td></tr><tr><td>GE0/0/5：Access类型，缺省VLAN为VLAN30</td><td>用于连接总部Web服务器</td><td></td></tr><tr><td>Eth-trunk3：Trunk类型，透传VLAN100</td><td>用于和总部出口路由器RouterA对接</td><td></td></tr><tr><td>Eth-trunk4：Trunk类型，透传VLAN100</td><td>用于和总部出口路由器RouterB对接</td><td></td></tr><tr><td>ACC1</td><td>Eth-trunk1：Trunk类型，透传VLAN10</td><td>用于和总部CORE对接</td></tr><tr><td>Ethernet0/0/2：Access类型，缺省VLAN为VLAN10</td><td>用于连接总部A部门的PC1</td><td></td></tr><tr><td>ACC2</td><td>Eth-trunk1：Trunk类型，透传VLAN20</td><td>用于和总部CORE对接</td></tr><tr><td>Ethernet0/0/2：Access类型，缺省VLAN为VLAN20</td><td>用于连接总部B部门的PC3</td><td></td></tr><tr><td>RouterC</td><td>GE2/0/0.200：配置Dot1q终结子接口，终结VLAN200</td><td>用于连接分支接入交换机SwitchA</td></tr><tr><td>SwitchA</td><td>GE0/0/1：Trunk类型，透传VLAN200</td><td>用于连接分支出口路由器RouterC</td></tr><tr><td>Ethernet0/0/2：Access类型，缺省VLAN为VLAN200</td><td>用于连接分支PC5</td><td></td></tr></tbody></table><p><strong>表1-3</strong>  IP地址规划</p><table><thead><tr><th>设备</th><th>数据项</th><th>备注</th></tr></thead><tbody><tr><td>RouterA</td><td>GE1/0/0：202.10.1.2/24Eth-trunk1.100：10.10.100.2/24</td><td>GE1/0/0用于和运营商网络对接Eth-trunk1.100用于和总部核心交换机CORE对接</td></tr><tr><td>RouterB</td><td>GE1/0/0：202.10.2.2/24Eth-trunk1.100：10.10.100.3/24</td><td>-</td></tr><tr><td>CORE</td><td>VLANIF10：10.10.10.1/24VLANIF20：10.10.20.1/24VLANIF30：10.10.30.1/24VLANIF100：10.10.100.4/24</td><td>VLANIF10作为A部门的用户网关VLANIF20作为B部门的用户网关VLANIF30作为Web服务器的网关VLANIF100用于和出口路由器互联</td></tr><tr><td>Web服务器</td><td>IP地址：10.10.30.2/24默认网关：10.10.30.1</td><td>通过NAT Server 映射后的公网IP地址：202.10.100.3</td></tr><tr><td>PC1</td><td>IP地址：10.10.10.2/24默认网关：10.10.10.1</td><td>假设通过DHCP获取到的IP地址就是10.10.10.2/24</td></tr><tr><td>PC3</td><td>IP地址：10.10.20.2/24默认网关：10.10.20.1</td><td>假设通过DHCP获取到的IP地址就是10.10.20.2/24</td></tr><tr><td>RouterD</td><td>接口B，编号：GigabitEthernet1/0/0，IP地址：202.10.1.1/24接口C，编号：GigabitEthernet2/0/0，IP地址：202.10.2.1/24</td><td>该设备为运营商网络的设备，此处接口编号为假设，请以实际设备为准</td></tr><tr><td>RouterE</td><td>接口A，编号：GigabitEthernet1/0/0，IP地址：203.10.1.1/24</td><td>该设备为运营商网络的设备，此处接口编号为假设，请以实际设备为准</td></tr><tr><td>RouterC</td><td>GE1/0/0：203.10.1.2/24GE2/0/0.200：10.10.200.1/24</td><td>-</td></tr><tr><td>PC5</td><td>IP地址：10.10.200.2/24默认网关：10.10.200.1</td><td>假设通过DHCP获取到的IP地址就是10.10.200.2/24</td></tr></tbody></table><h4 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h4><ol><li>配置总部核心交换机CORE和两个出口路由器之间互联的Eth-Trunk</li></ol><p>   # 配置核心交换机CORE。</p>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;HUAWEI&gt; system-view</span><br><span class="line">[HUAWEI] sysname CORE</span><br><span class="line">[CORE] interface eth-trunk 3</span><br><span class="line">[CORE-Eth-Trunk3] mode lacp</span><br><span class="line">[CORE-Eth-Trunk3] quit</span><br><span class="line">[CORE] interface eth-trunk 4</span><br><span class="line">[CORE-Eth-Trunk4] mode lacp</span><br><span class="line">[CORE-Eth-Trunk4] quit</span><br><span class="line">[CORE] interface gigabitethernet 0&#x2F;0&#x2F;3</span><br><span class="line">[CORE-GigabitEthernet0&#x2F;0&#x2F;3] eth-trunk 3</span><br><span class="line">[CORE-GigabitEthernet0&#x2F;0&#x2F;3] quit</span><br><span class="line">[CORE] interface gigabitethernet 1&#x2F;0&#x2F;3</span><br><span class="line">[CORE-GigabitEthernet1&#x2F;0&#x2F;3] eth-trunk 3</span><br><span class="line">[CORE-GigabitEthernet1&#x2F;0&#x2F;3] quit</span><br><span class="line">[CORE] interface gigabitethernet 0&#x2F;0&#x2F;4</span><br><span class="line">[CORE-GigabitEthernet0&#x2F;0&#x2F;4] eth-trunk 4</span><br><span class="line">[CORE-GigabitEthernet0&#x2F;0&#x2F;4] quit</span><br><span class="line">[CORE] interface gigabitethernet 1&#x2F;0&#x2F;4</span><br><span class="line">[CORE-GigabitEthernet1&#x2F;0&#x2F;4] eth-trunk 4</span><br><span class="line">[CORE-GigabitEthernet1&#x2F;0&#x2F;4] quit</span><br></pre></td></tr></table></figure><p>   # 配置总部出口路由器RouterA。RouterB的配置与RouterA类似。</p>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;Huawei&gt; system-view</span><br><span class="line">[Huawei] sysname RouterA</span><br><span class="line">[RouterA] interface eth-trunk 1</span><br><span class="line">[RouterA-Eth-Trunk1] undo portswitch</span><br><span class="line">[RouterA-Eth-Trunk1] mode lacp-static</span><br><span class="line">[RouterA-Eth-Trunk1] quit</span><br><span class="line">[RouterA] interface gigabitethernet 2&#x2F;0&#x2F;0</span><br><span class="line">[RouterA-GigabitEthernet2&#x2F;0&#x2F;0] eth-trunk 1</span><br><span class="line">[RouterA-GigabitEthernet2&#x2F;0&#x2F;0] quit</span><br><span class="line">[RouterA] interface gigabitethernet 2&#x2F;0&#x2F;1</span><br><span class="line">[RouterA-GigabitEthernet2&#x2F;0&#x2F;1] eth-trunk 1</span><br><span class="line">[RouterA-GigabitEthernet2&#x2F;0&#x2F;1] quit</span><br></pre></td></tr></table></figure><ol start="2"><li>配置各接口的所属VLAN及IP地址</li></ol><p>   # 配置核心交换机CORE。</p>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[CORE] vlan 100</span><br><span class="line">[CORE] quit</span><br><span class="line">[CORE] interface Eth-Trunk 3</span><br><span class="line">[CORE-Eth-Trunk3] port link-type trunk</span><br><span class="line">[CORE-Eth-Trunk3] port trunk allow-pass vlan 100</span><br><span class="line">[CORE-Eth-Trunk3] quit</span><br><span class="line">[CORE] interface Eth-Trunk 4</span><br><span class="line">[CORE-Eth-Trunk4] port link-type trunk</span><br><span class="line">[CORE-Eth-Trunk4] port trunk allow-pass vlan 100</span><br><span class="line">[CORE-Eth-Trunk4] quit</span><br><span class="line">[CORE] interface vlanif 100</span><br><span class="line">[CORE-Vlanif100] ip address 10.10.100.4 24</span><br><span class="line">[CORE-Vlanif100] quit</span><br></pre></td></tr></table></figure><p>   # 配置总部出口路由器RouterA。RouterB的配置与RouterA类似。</p>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[RouterA] interface Eth-Trunk 1.100</span><br><span class="line">[RouterA-Eth-Trunk1.100] ip address 10.10.100.2 24</span><br><span class="line">[RouterA-Eth-Trunk1.100] dot1q termination vid 100</span><br><span class="line">[RouterA-Eth-Trunk1.100] arp broadcast enable     &#x2F;&#x2F;使能接口可以处理ARP广播报文功能；AR3200系列路由器V200R003C01及之后的版本默认已经使能了该功能，无需配置。</span><br><span class="line">[RouterA-Eth-Trunk1.100] quit</span><br><span class="line">[RouterA] interface gigabitethernet 1&#x2F;0&#x2F;0</span><br><span class="line">[RouterA-GigabitEthernet1&#x2F;0&#x2F;0] ip address 202.10.1.2 24</span><br><span class="line">[RouterA-GigabitEthernet1&#x2F;0&#x2F;0] quit</span><br></pre></td></tr></table></figure><p>   # 配置分支出口路由器RouterC。</p>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;Huawei&gt; system-view</span><br><span class="line">[Huawei] sysname RouterC</span><br><span class="line">[RouterC] interface gigabitethernet 1&#x2F;0&#x2F;0</span><br><span class="line">[RouterC-GigabitEthernet1&#x2F;0&#x2F;0] ip address 203.10.1.2 24</span><br><span class="line">[RouterC-GigabitEthernet1&#x2F;0&#x2F;0] quit</span><br></pre></td></tr></table></figure><ol start="3"><li>部署VRRP。在总部两个出口路由器RouterA和RouterB之间配置VRRP，RouterA为VRRP的Master，RouterB为VRRP的Backup</li></ol><p>   # 配置RouterA。</p>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[RouterA] interface Eth-Trunk 1.100</span><br><span class="line">[RouterA-Eth-Trunk1.100] vrrp vrid 1 virtual-ip 10.10.100.1</span><br><span class="line">[RouterA-Eth-Trunk1.100] vrrp vrid 1 priority 120</span><br><span class="line">[RouterA-Eth-Trunk1.100] vrrp vrid 1 track interface GigabitEthernet1&#x2F;0&#x2F;0 reduced 40</span><br><span class="line">[RouterA-Eth-Trunk1.100] quit</span><br><span class="line"> &#x2F;&#x2F;为了防止RouterA的上行链路中断的时候数据流发送至VRRP的Master以后不能继续上行，配置VRRP的状态和RouterA的上行口进行联动，保证RouterA上行链路中断的时候VRRP状态迅速倒换。</span><br></pre></td></tr></table></figure><p>   # 配置RouterB。</p>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[RouterB] interface Eth-Trunk 1.100</span><br><span class="line">[RouterB-Eth-Trunk1.100] vrrp vrid 1 virtual-ip 10.10.100.1</span><br><span class="line">[RouterB-Eth-Trunk1.100] quit</span><br></pre></td></tr></table></figure><p>   配置完成后，RouterA和RouterB之间应该能建立VRRP的主备份关系，执行<strong>display vrrp</strong>命令可以看到RouterA和RouterB的VRRP状态。</p><p>   # 查看RouterA的VRRP状态为Master。</p>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[RouterA] display vrrp</span><br><span class="line">  Eth-Trunk1.100 | Virtual Router 1</span><br><span class="line">    State : Master</span><br><span class="line">    Virtual IP : 10.10.100.1</span><br><span class="line">    Master IP : 10.10.100.2</span><br><span class="line">    PriorityRun : 120</span><br><span class="line">    PriorityConfig : 120</span><br><span class="line">    MasterPriority : 120</span><br><span class="line">    Preempt : YES   Delay Time : 0 s</span><br><span class="line">    TimerRun : 1 s</span><br><span class="line">    TimerConfig : 1 s</span><br><span class="line">    Auth type : NONE</span><br><span class="line">    Virtual MAC : 0000-5e00-0101</span><br><span class="line">    Check TTL : YES</span><br><span class="line">    Config type : normal-vrrp</span><br><span class="line">    Backup-forward : disabled</span><br><span class="line">    Track IF : GigabitEthernet1&#x2F;0&#x2F;0   Priority reduced : 40</span><br><span class="line">    IF state : UP</span><br><span class="line">    Create time : 2015-05-18 06:53:47 UTC-05:13</span><br><span class="line">    Last change time : 2015-05-18 06:54:14 UTC-05:13</span><br></pre></td></tr></table></figure><p>   # 查看RouterB的VRRP状态为Backup。</p>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[RouterB] display vrrp</span><br><span class="line">  Eth-Trunk1.100 | Virtual Router 1</span><br><span class="line">    State : Backup</span><br><span class="line">    Virtual IP : 10.10.100.1</span><br><span class="line">    Master IP : 10.10.100.2</span><br><span class="line">    PriorityRun : 100</span><br><span class="line">    PriorityConfig : 100</span><br><span class="line">    MasterPriority : 120</span><br><span class="line">    Preempt : YES   Delay Time : 0 s</span><br><span class="line">    TimerRun : 1 s</span><br><span class="line">    TimerConfig : 1 s</span><br><span class="line">    Auth type : NONE</span><br><span class="line">    Virtual MAC : 0000-5e00-0101</span><br><span class="line">    Check TTL : YES</span><br><span class="line">    Config type : normal-vrrp</span><br><span class="line">    Backup-forward : disabled</span><br><span class="line">    Create time : 2015-05-18 06:53:52 UTC-05:13</span><br><span class="line">    Last change time : 2015-05-18 06:57:12 UTC-05:13</span><br></pre></td></tr></table></figure><ol start="4"><li><p>部署路由</p><ol><li>部署缺省路由，用于引导各个设备的上行流量</li></ol></li></ol><pre><code>  \# 在核心交换机CORE上配置一条缺省路由，下一跳指向VRRP的虚地址。  &lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[CORE] ip route-static 0.0.0.0 0.0.0.0 10.10.100.1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;  \# 在总部及分支出口路由器上各配置一条缺省路由，下一跳指向运行商网络设备的对接地址（公网网关）。  &lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[RouterA] ip route-static 0.0.0.0 0.0.0.0 202.10.1.1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;  &lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[RouterB] ip route-static 0.0.0.0 0.0.0.0 202.10.2.1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;  &lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[RouterC] ip route-static 0.0.0.0 0.0.0.0 203.10.1.1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;</code></pre><ol start="2"><li>部署OSPF。在总部两个出口路由器RouterA、RouterB以及总部核心交换机CORE之间部署OSPF，用于两个出口路由器RouterA和RouterB学习用户网段的回程路由</li></ol><pre><code>  \# 配置总部出口路由器RouterA。  &lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[RouterA] ospf 1 router-id 10.1.1.1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterA-ospf-1] area 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterA-ospf-1-area-0.0.0.0] network 10.10.100.0 0.0.0.255&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterA-ospf-1-area-0.0.0.0] quit&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;  \# 配置总部出口路由器RouterB。  &lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[RouterB] ospf 1 router-id 10.2.2.2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterB-ospf-1] area 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterB-ospf-1-area-0.0.0.0] network 10.10.100.0 0.0.0.255&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterB-ospf-1-area-0.0.0.0] quit&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;  \# 配置总部核心交换机CORE。  &lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[CORE] ospf 1 router-id 10.3.3.3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[CORE-ospf-1] area 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[CORE-ospf-1-area-0.0.0.0] network 10.10.100.0 0.0.0.255&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[CORE-ospf-1-area-0.0.0.0] network 10.10.10.0 0.0.0.255      &amp;#x2F;&amp;#x2F;将用户网段发布到OSPF里面&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[CORE-ospf-1-area-0.0.0.0] network 10.10.20.0 0.0.0.255      &amp;#x2F;&amp;#x2F;将用户网段发布到OSPF里面&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[CORE-ospf-1-area-0.0.0.0] network 10.10.30.0 0.0.0.255     &amp;#x2F;&amp;#x2F;将Web服务器网段发布到OSPF里面&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[CORE-ospf-1-area-0.0.0.0] quit&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;  \# 配置完成后，RouterA、RouterB和Core之间应该建立OSPF邻居关系，执行**display ospf peer**命令可以查看OSPF邻居状态为Full，以CORE为例，OSPF邻居状态如下。  &lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[CORE] display ospf peer&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   OSPF Process 1 with Router ID 10.3.3.3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     Neighbors &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; Area 0.0.0.0 interface 10.10.100.4(Vlanif100)&amp;#39;s neighbors&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; Router ID: 10.1.1.1         Address: 10.10.100.2     &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   State: Full  Mode:Nbr is  Slave  Priority: 1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   DR: 10.10.100.4  BDR: 10.10.100.3  MTU: 0    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   Dead timer due in 40  sec &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   Retrans timer interval: 5 &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   Neighbor is up for 00:26:37     &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   Authentication Sequence: [ 0 ] &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; Router ID: 10.2.2.2         Address: 10.10.100.3     &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   State: Full  Mode:Nbr is  Slave  Priority: 1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   DR: 10.10.100.4  BDR: 10.10.100.3  MTU: 0    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   Dead timer due in 36  sec &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   Retrans timer interval: 5 &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   Neighbor is up for 00:26:37     &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   Authentication Sequence: [ 0 ] &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;</code></pre><ol start="3"><li>配置外网到内网服务器公网地址的静态路由（回程路由）</li></ol><pre><code>  \# 在和总部出口对接的运营商路由器RouterD上配置两条目的地址为服务器公网地址的静态路由，下一跳分别指向两个出口路由器RouterA、RouterB的上行口IP地址。为了保证路由和VRRP同步切换，设置下一跳为RouterA的这条路由优先，当这条路由失效的时候下一跳指向RouterB的路由生效。  &lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[RouterD] ip route-static 202.10.100.0 255.255.255.0 202.10.1.2 preference 40     &amp;#x2F;&amp;#x2F;下一跳为RouterA的这条路由优先&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterD] ip route-static 202.10.100.0 255.255.255.0 202.10.2.2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;  当总部出口路由器RouterA的上行链路中断的时候会触发两个动作：  1. 两台总部出口路由器VRRP主备切换，这个通过VRRP状态联动总部出口路由器上行口状态来实现。  2. 和总部出口对接的运营商路由器RouterD到达内网服务器的路由进行主备切换，这个通过RouterD配置主备路由实现。  这两个动作保证了当出口路由器RouterA的上行链路中断的时候内网VRRP状态和公网回程主备路由同时切换，保证了来回路径双向可靠性。</code></pre><ol start="5"><li><p>部署NAT Outbound</p><ol><li>在总部及分支出口路由器上定义需要进行NAT转换的数据流</li></ol></li></ol><pre><code>  总部仅部门A允许访问Internet，源IP地址是10.10.10.0/24；分支所有用户都允许访问Internet，源IP地址是10.10.200.0/24。  \# 配置总部出口路由器RouterA。RouterB的配置和RouterA类似。  &lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[RouterA] acl 3000&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterA-acl-adv-3000] rule 5 deny ip source 10.10.10.0 0.0.0.255 destination 10.10.200.0 0.0.0.255       &amp;#x2F;&amp;#x2F;需要IPSec保护的数据流&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterA-acl-adv-3000] rule 10 deny ip source 10.10.20.0 0.0.0.255 destination 10.10.200.0 0.0.0.255      &amp;#x2F;&amp;#x2F;需要IPSec保护的数据流&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterA-acl-adv-3000] rule 15 permit ip source 10.10.10.0 0.0.0.255       &amp;#x2F;&amp;#x2F;需要进行NAT转换的数据流&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterA-acl-adv-3000] quit&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &amp;#x2F;&amp;#x2F;对于华为AR3200系列路由器，如果接口上同时配置了IPSec和NAT，则先执行NAT。所以为了避免把IPSec保护的数据流进行NAT转换，需要NAT引用的ACL规则deny掉需要IPSec保护的数据流，即对“IPSec感兴趣的数据流”做NAT豁免。&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;  \# 配置分支出口路由器RouterC。  &lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[RouterC] acl 3000&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterC-acl-adv-3000] rule 5 deny ip source 10.10.200.0 0.0.0.255 destination 10.10.10.0 0.0.0.255&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterC-acl-adv-3000] rule 10 deny ip source 10.10.200.0 0.0.0.255 destination 10.10.20.0 0.0.0.255&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterC-acl-adv-3000] rule 15 permit ip source 10.10.200.0 0.0.0.255&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterC-acl-adv-3000] quit&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &amp;#x2F;&amp;#x2F;同样需要配置对“IPSec感兴趣的数据流”做NAT豁免&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;</code></pre><ol start="2"><li>在总部及分支出口路由器的上行口上配置NAT转换</li></ol><pre><code>  \# 配置RouterA。RouterB及RouterC的配置与RouterA类似。  &lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[RouterA] interface GigabitEthernet1&amp;#x2F;0&amp;#x2F;0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterA-GigabitEthernet1&amp;#x2F;0&amp;#x2F;0] nat outbound 3000&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterA-GigabitEthernet1&amp;#x2F;0&amp;#x2F;0] quit&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;</code></pre><ol start="3"><li>检查配置结果</li></ol><pre><code>  \# 配置完成后可以通过**display nat outbound**命令查看NAT转换的配置信息，以RouterA为例详细信息如下。  &lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[RouterA] display nat outbound&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; NAT Outbound Information:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; --------------------------------------------------------------------------&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; Interface                     Acl     Address-group&amp;#x2F;IP&amp;#x2F;Interface      Type&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; --------------------------------------------------------------------------&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; GigabitEthernet1&amp;#x2F;0&amp;#x2F;0         3000                     202.10.1.2    easyip  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; --------------------------------------------------------------------------&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Total : 1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;</code></pre><ol start="6"><li>部署NAT Server</li></ol><p>   总部有Web服务器，需在两个出口路由器RouterA和RouterB上都配置NAT Server，实现外网用户访问内网Web服务器。</p><p>   # 配置RouterA。</p>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[RouterA] interface GigabitEthernet1&#x2F;0&#x2F;0</span><br><span class="line">[RouterA-GigabitEthernet1&#x2F;0&#x2F;0] nat server protocol tcp global 202.10.100.3 www inside 10.10.30.2 8080</span><br><span class="line">[RouterA-GigabitEthernet1&#x2F;0&#x2F;0] quit</span><br></pre></td></tr></table></figure><p>   # 配置RouterB。</p>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[RouterB] interface GigabitEthernet1&#x2F;0&#x2F;0</span><br><span class="line">[RouterB-GigabitEthernet1&#x2F;0&#x2F;0] nat server protocol tcp global 202.10.100.3 www inside 10.10.30.2 8080</span><br><span class="line">[RouterB-GigabitEthernet1&#x2F;0&#x2F;0] quit</span><br></pre></td></tr></table></figure><p>   # 配置完成后可以通过<strong>display nat server</strong>命令查看NAT Server的配置信息，以RouterA为例详细信息如下。</p>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[RouterA] display nat server</span><br><span class="line"></span><br><span class="line">  Nat Server Information:</span><br><span class="line">  Interface  : GigabitEthernet1&#x2F;0&#x2F;0</span><br><span class="line">    Global IP&#x2F;Port     : 202.10.100.3&#x2F;80(www) </span><br><span class="line">    Inside IP&#x2F;Port     : 10.10.30.2&#x2F;8080</span><br><span class="line">    Protocol : 6(tcp)   </span><br><span class="line">    VPN instance-name  : ----                            </span><br><span class="line">    Acl number         : ----</span><br><span class="line">    Description : ----</span><br><span class="line"></span><br><span class="line">  Total :    1</span><br></pre></td></tr></table></figure><ol start="7"><li><p>部署IPSec VPN，实现总部和分支之间通过Internet实现私网互通，并且数据通信具有安全保护</p><ol><li>配置ACL，定义需要IPSec保护的数据流</li></ol></li></ol><pre><code>  \# 配置总部出口路由器RouterA。  &lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[RouterA] acl 3001&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterA-acl-adv-3001] rule 5 permit ip source 10.10.10.0 0.0.0.255 destination 10.10.200.0 0.0.0.255       &amp;#x2F;&amp;#x2F;需要IPSec保护的数据流&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterA-acl-adv-3001] rule 10 permit ip source 10.10.20.0 0.0.0.255 destination 10.10.200.0 0.0.0.255       &amp;#x2F;&amp;#x2F;需要IPSec保护的数据流&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterA-acl-adv-3001] quit&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;  \# 配置总部出口路由器RouterB。  &lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[RouterB] acl 3001&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterB-acl-adv-3001] rule 5 permit ip source 10.10.10.0 0.0.0.255 destination 10.10.200.0 0.0.0.255&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterB-acl-adv-3001] rule 10 permit ip source 10.10.20.0 0.0.0.255 destination 10.10.200.0 0.0.0.255&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterB-acl-adv-3001] quit&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;  \# 配置分支出口路由器RouterC。  &lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[RouterC] acl 3001&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterC-acl-adv-3001] rule 5 permit ip source 10.10.200.0 0.0.0.255 destination 10.10.10.0 0.0.0.255&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterC-acl-adv-3001] rule 10 permit ip source 10.10.200.0 0.0.0.255 destination 10.10.20.0 0.0.0.255&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterC-acl-adv-3001] quit&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;</code></pre><ol start="2"><li>配置IPSec安全提议</li></ol><pre><code>  \# 配置总部出口路由器RouterA。总部出口路由器RouterB以及分支出口路由器RouterC的配置和RouterA类似。  &lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[RouterA] ipsec proposal tran1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterA-ipsec-proposal-tran1] esp authentication-algorithm sha2-256      &amp;#x2F;&amp;#x2F;设置ESP协议采用的认证算法&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterA-ipsec-proposal-tran1] esp encryption-algorithm aes-128      &amp;#x2F;&amp;#x2F;设置ESP协议采用的加密算法&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterA-ipsec-proposal-tran1] quit&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;</code></pre><ol start="3"><li>配置IKE安全提议</li></ol><pre><code>  \# 配置总部出口路由器RouterA。总部出口路由器RouterB以及分支出口路由器RouterC的配置和RouterA类似。  &lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[RouterA] ike proposal 5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterA-ike-proposal-5] encryption-algorithm aes-cbc-128&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterA-ike-proposal-5] quit&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;</code></pre><ol start="4"><li>配置IKE对等体</li></ol><pre><code>  \# 配置总部出口路由器RouterA。  &lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[RouterA] ike peer vpn v1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterA-ike-peer-vpn] pre-shared-key cipher huawei123&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterA-ike-peer-vpn] ike-proposal 5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterA-ike-peer-vpn] dpd type periodic     &amp;#x2F;&amp;#x2F;配置周期性对等体存活检测&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterA-ike-peer-vpn] dpd idle-time 10     &amp;#x2F;&amp;#x2F;设置对等体存活检测空闲时间为10秒&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterA-ike-peer-vpn] remote-address 203.10.1.2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterA-ike-peer-vpn] quit&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;  \# 配置总部出口路由器RouterB。  &lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[RouterB] ike peer vpn v1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterB-ike-peer-vpn] pre-shared-key cipher huawei123&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterB-ike-peer-vpn] ike-proposal 5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterB-ike-peer-vpn] dpd type periodic&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterB-ike-peer-vpn] dpd idle-time 10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterB-ike-peer-vpn] remote-address 203.10.1.2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterB-ike-peer-vpn] quit&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;  \# 配置分支出口路由器RouterC。  &lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[RouterC] ike peer vpnr1 v1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterC-ike-peer-vpnr1] pre-shared-key cipher huawei123&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterC-ike-peer-vpnr1] ike-proposal 5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterC-ike-peer-vpnr1] dpd type periodic&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterC-ike-peer-vpnr1] dpd idle-time 10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterC-ike-peer-vpnr1] remote-address 202.10.1.2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterC-ike-peer-vpnr1] quit&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterC] ike peer vpnr2 v1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterC-ike-peer-vpnr2] pre-shared-key cipher huawei123&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterC-ike-peer-vpnr2] ike-proposal 5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterC-ike-peer-vpnr2] dpd type periodic&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterC-ike-peer-vpnr2] dpd idle-time 10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterC-ike-peer-vpnr2] remote-address 202.10.2.2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterC-ike-peer-vpnr2] quit&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;</code></pre><ol start="5"><li>配置安全策略</li></ol><pre><code>  \# 配置总部出口路由器RouterA。  &lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[RouterA] ipsec policy ipsec_vpn 10 isakmp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterA-ipsec-policy-isakmp-ipsec_vpn-10] security acl 3001&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterA-ipsec-policy-isakmp-ipsec_vpn-10] ike-peer vpn&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterA-ipsec-policy-isakmp-ipsec_vpn-10] proposal tran1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterA-ipsec-policy-isakmp-ipsec_vpn-10] quit&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;  \# 配置总部出口路由器RouterB。  &lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[RouterB] ipsec policy ipsec_vpn 10 isakmp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterB-ipsec-policy-isakmp-ipsec_vpn-10] security acl 3001&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterB-ipsec-policy-isakmp-ipsec_vpn-10] ike-peer vpn&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterB-ipsec-policy-isakmp-ipsec_vpn-10] proposal tran1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterB-ipsec-policy-isakmp-ipsec_vpn-10] quit&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;  \# 配置分支出口路由器RouterC。  &lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[RouterC] ipsec policy ipsec_vpn 10 isakmp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterC-ipsec-policy-isakmp-ipsec_vpn-10] security acl 3001&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterC-ipsec-policy-isakmp-ipsec_vpn-10] ike-peer vpnr1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterC-ipsec-policy-isakmp-ipsec_vpn-10] proposal tran1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterC-ipsec-policy-isakmp-ipsec_vpn-10] quit&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterC] ipsec policy ipsec_vpn 20 isakmp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterC-ipsec-policy-isakmp-ipsec_vpn-20] security acl 3001&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterC-ipsec-policy-isakmp-ipsec_vpn-20] ike-peer vpnr2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterC-ipsec-policy-isakmp-ipsec_vpn-20] proposal tran1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterC-ipsec-policy-isakmp-ipsec_vpn-20] quit&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;</code></pre><ol start="6"><li>接口上引用安全策略组</li></ol><pre><code>  \# 在总部出口路由器RouterA的接口上引用安全策略组。  &lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[RouterA] interface GigabitEthernet1&amp;#x2F;0&amp;#x2F;0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterA-GigabitEthernet1&amp;#x2F;0&amp;#x2F;0] ipsec policy ipsec_vpn&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterA-GigabitEthernet1&amp;#x2F;0&amp;#x2F;0] quit&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;  \# 在总部出口路由器RouterB的接口上引用安全策略组。  &lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[RouterB] interface GigabitEthernet1&amp;#x2F;0&amp;#x2F;0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterB-GigabitEthernet1&amp;#x2F;0&amp;#x2F;0] ipsec policy ipsec_vpn&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterB-GigabitEthernet1&amp;#x2F;0&amp;#x2F;0] quit&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;  \# 在分支出口路由器RouterC的接口上引用安全策略组。  &lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[RouterC] interface GigabitEthernet1&amp;#x2F;0&amp;#x2F;0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterC-GigabitEthernet1&amp;#x2F;0&amp;#x2F;0] ipsec policy ipsec_vpn&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[RouterC-GigabitEthernet1&amp;#x2F;0&amp;#x2F;0] quit&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;</code></pre><ol start="7"><li>检查配置结果</li></ol><pre><code>  \# 配置完成后，可以执行**display ike sa**命令查看由IKE建立的安全联盟信息，以RouterC为例，由IKE建立的安全联盟信息如下。  &lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[RouterC] display ike sa&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Conn-ID  Peer            VPN   Flag(s)                Phase  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  ---------------------------------------------------------------&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        7    202.10.2.2      0     RD|ST                  2     &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        4    202.10.2.2      0     RD                     2     &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        2    202.10.2.2      0     RD                     1     &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        6    202.10.1.2      0     RD|ST                  2     &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        5    202.10.1.2      0     RD                     2     &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        3    202.10.1.2      0     RD                     1     &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Flag Description:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  RD--READY   ST--STAYALIVE   RL--REPLACED   FD--FADING   TO--TIMEOUT&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  HRT--HEARTBEAT   LKG--LAST KNOWN GOOD SEQ NO.   BCK--BACKED UP&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;  \# 配置完成后，可以执行**display ipsec sa**命令查看安全联盟的相关信息，以RouterC为例，安全联盟信息如下。  &lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;101&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;102&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;103&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;104&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;105&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;106&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;107&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;108&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;109&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;110&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;111&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;112&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;113&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;114&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;115&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;116&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;117&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;118&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;119&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;120&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;121&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;122&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;123&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;124&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;125&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;126&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[RouterC] display ipsec sa&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Interface: GigabitEthernet1&amp;#x2F;0&amp;#x2F;0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; Path MTU: 1500&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&amp;#x3D;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -----------------------------&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  IPSec policy name: &amp;quot;ipsec_vpn&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Sequence number  : 10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Acl Group        : 3001&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Acl rule         : 5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Mode             : ISAKMP&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -----------------------------&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Connection ID     : 5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Encapsulation mode: Tunnel&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Tunnel local      : 203.10.1.2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Tunnel remote     : 202.10.1.2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Flow source       : 10.10.200.0&amp;#x2F;255.255.255.0 0&amp;#x2F;0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Flow destination  : 10.10.10.0&amp;#x2F;255.255.255.0 0&amp;#x2F;0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Qos pre-classify  : Disable&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [Outbound ESP SAs] &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      SPI: 969156085 (0x39c425f5)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      Proposal: ESP-ENCRYPT-AES-128 SHA2-256-128&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      SA remaining key duration (bytes&amp;#x2F;sec): 1887313920&amp;#x2F;1521&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      Max sent sequence-number: 8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      UDP encapsulation used for NAT traversal: N&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [Inbound ESP SAs] &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      SPI: 1258341975 (0x4b00c657)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      Proposal: ESP-ENCRYPT-AES-128 SHA2-256-128&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      SA remaining key duration (bytes&amp;#x2F;sec): 1887436080&amp;#x2F;1521&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      Max received sequence-number: 10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      Anti-replay window size: 32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      UDP encapsulation used for NAT traversal: N&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -----------------------------&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  IPSec policy name: &amp;quot;ipsec_vpn&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Sequence number  : 10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Acl Group        : 3001&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Acl rule         : 10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Mode             : ISAKMP&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -----------------------------&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Connection ID     : 6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Encapsulation mode: Tunnel&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Tunnel local      : 203.10.1.2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Tunnel remote     : 202.10.1.2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Flow source       : 10.10.200.0&amp;#x2F;255.255.255.0 0&amp;#x2F;0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Flow destination  : 10.10.20.0&amp;#x2F;255.255.255.0 0&amp;#x2F;0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Qos pre-classify  : Disable&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [Outbound ESP SAs] &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      SPI: 4217384908 (0xfb602fcc)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      Proposal: ESP-ENCRYPT-AES-128 SHA2-256-128&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      SA remaining key duration (bytes&amp;#x2F;sec): 1887283200&amp;#x2F;1522&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      Max sent sequence-number: 10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      UDP encapsulation used for NAT traversal: N&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [Inbound ESP SAs] &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      SPI: 654720480 (0x27063de0)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      Proposal: ESP-ENCRYPT-AES-128 SHA2-256-128&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      SA remaining key duration (bytes&amp;#x2F;sec): 1887436080&amp;#x2F;1522&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      Max received sequence-number: 10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      Anti-replay window size: 32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      UDP encapsulation used for NAT traversal: N&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -----------------------------&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  IPSec policy name: &amp;quot;ipsec_vpn&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Sequence number  : 20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Acl Group        : 3001&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Acl rule         : 5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Mode             : ISAKMP&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -----------------------------&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Connection ID     : 4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Encapsulation mode: Tunnel&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Tunnel local      : 203.10.1.2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Tunnel remote     : 202.10.2.2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Flow source       : 10.10.200.0&amp;#x2F;255.255.255.0 0&amp;#x2F;0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Flow destination  : 10.10.10.0&amp;#x2F;255.255.255.0 0&amp;#x2F;0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Qos pre-classify  : Disable&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [Outbound ESP SAs] &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      SPI: 240759500 (0xe59b2cc)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      Proposal: ESP-ENCRYPT-AES-128 SHA2-256-128&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      SA remaining key duration (bytes&amp;#x2F;sec): 1887436800&amp;#x2F;1521&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      Max sent sequence-number: 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      UDP encapsulation used for NAT traversal: N&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [Inbound ESP SAs] &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      SPI: 3888073495 (0xe7bf4b17)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      Proposal: ESP-ENCRYPT-AES-128 SHA2-256-128&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      SA remaining key duration (bytes&amp;#x2F;sec): 1887436800&amp;#x2F;1521&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      Max received sequence-number: 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      Anti-replay window size: 32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      UDP encapsulation used for NAT traversal: N&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -----------------------------&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  IPSec policy name: &amp;quot;ipsec_vpn&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Sequence number  : 20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Acl Group        : 3001&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Acl rule         : 10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Mode             : ISAKMP&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  -----------------------------&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Connection ID     : 7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Encapsulation mode: Tunnel&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Tunnel local      : 203.10.1.2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Tunnel remote     : 202.10.2.2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Flow source       : 10.10.200.0&amp;#x2F;255.255.255.0 0&amp;#x2F;0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Flow destination  : 10.10.20.0&amp;#x2F;255.255.255.0 0&amp;#x2F;0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Qos pre-classify  : Disable&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [Outbound ESP SAs] &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      SPI: 2751917383 (0xa406ed47)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      Proposal: ESP-ENCRYPT-AES-128 SHA2-256-128&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      SA remaining key duration (bytes&amp;#x2F;sec): 1887436800&amp;#x2F;1522&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      Max sent sequence-number: 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      UDP encapsulation used for NAT traversal: N&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [Inbound ESP SAs] &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      SPI: 739146604 (0x2c0e7b6c)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      Proposal: ESP-ENCRYPT-AES-128 SHA2-256-128&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      SA remaining key duration (bytes&amp;#x2F;sec): 1887436800&amp;#x2F;1522&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      Max received sequence-number: 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      Anti-replay window size: 32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      UDP encapsulation used for NAT traversal: N&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;</code></pre><ol start="8"><li>检查配置结果</li></ol><p>   # 通过<strong>ping</strong>命令验证总部和分支之间的连通性。</p>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">PC1&gt;ping 10.10.200.2</span><br><span class="line"></span><br><span class="line">Ping 10.10.200.2: 32 data bytes, Press Ctrl_C to break</span><br><span class="line">From 10.10.200.2: bytes&#x3D;32 seq&#x3D;1 ttl&#x3D;126 time&#x3D;140 ms</span><br><span class="line">From 10.10.200.2: bytes&#x3D;32 seq&#x3D;2 ttl&#x3D;126 time&#x3D;235 ms</span><br><span class="line">From 10.10.200.2: bytes&#x3D;32 seq&#x3D;3 ttl&#x3D;126 time&#x3D;266 ms</span><br><span class="line">From 10.10.200.2: bytes&#x3D;32 seq&#x3D;4 ttl&#x3D;126 time&#x3D;140 ms</span><br><span class="line">From 10.10.200.2: bytes&#x3D;32 seq&#x3D;5 ttl&#x3D;126 time&#x3D;141 ms</span><br><span class="line"></span><br><span class="line">--- 10.10.200.2 ping statistics ---</span><br><span class="line">  5 packet(s) transmitted</span><br><span class="line">  5 packet(s) received</span><br><span class="line">  0.00% packet loss</span><br><span class="line">  round-trip min&#x2F;avg&#x2F;max &#x3D; 140&#x2F;184&#x2F;266 ms</span><br></pre></td></tr></table></figure>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">PC3&gt;ping 10.10.200.2</span><br><span class="line"></span><br><span class="line">Ping 10.10.200.2: 32 data bytes, Press Ctrl_C to break</span><br><span class="line">From 10.10.200.2: bytes&#x3D;32 seq&#x3D;1 ttl&#x3D;126 time&#x3D;156 ms</span><br><span class="line">From 10.10.200.2: bytes&#x3D;32 seq&#x3D;2 ttl&#x3D;126 time&#x3D;297 ms</span><br><span class="line">From 10.10.200.2: bytes&#x3D;32 seq&#x3D;3 ttl&#x3D;126 time&#x3D;156 ms</span><br><span class="line">From 10.10.200.2: bytes&#x3D;32 seq&#x3D;4 ttl&#x3D;126 time&#x3D;141 ms</span><br><span class="line">From 10.10.200.2: bytes&#x3D;32 seq&#x3D;5 ttl&#x3D;126 time&#x3D;109 ms</span><br><span class="line"></span><br><span class="line">--- 10.10.200.2 ping statistics ---</span><br><span class="line">  5 packet(s) transmitted</span><br><span class="line">  5 packet(s) received</span><br><span class="line">  0.00% packet loss</span><br><span class="line">  round-trip min&#x2F;avg&#x2F;max &#x3D; 109&#x2F;171&#x2F;297 ms</span><br></pre></td></tr></table></figure><p>   可以看到，PC1和PC5、PC3和PC5之间都是可以互通的，公司总部和分支之间可以通过运营商网络组建的私网VPN进行互通。</p><p>   # 验证企业总部各部门与公网之间的连通性，以企业总部的公网网关202.10.1.1作为测试地址。</p>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">PC1&gt;ping 202.10.1.1</span><br><span class="line"></span><br><span class="line">Ping 202.10.1.1: 32 data bytes, Press Ctrl_C to break</span><br><span class="line">From 202.10.1.1: bytes&#x3D;32 seq&#x3D;1 ttl&#x3D;253 time&#x3D;235 ms</span><br><span class="line">From 202.10.1.1: bytes&#x3D;32 seq&#x3D;2 ttl&#x3D;253 time&#x3D;109 ms</span><br><span class="line">From 202.10.1.1: bytes&#x3D;32 seq&#x3D;3 ttl&#x3D;253 time&#x3D;79 ms</span><br><span class="line">From 202.10.1.1: bytes&#x3D;32 seq&#x3D;4 ttl&#x3D;253 time&#x3D;63 ms</span><br><span class="line">From 202.10.1.1: bytes&#x3D;32 seq&#x3D;5 ttl&#x3D;253 time&#x3D;63 ms</span><br><span class="line"></span><br><span class="line">--- 202.10.1.1 ping statistics ---</span><br><span class="line">  5 packet(s) transmitted</span><br><span class="line">  5 packet(s) received</span><br><span class="line">  0.00% packet loss</span><br><span class="line">  round-trip min&#x2F;avg&#x2F;max &#x3D; 63&#x2F;109&#x2F;235 ms</span><br></pre></td></tr></table></figure>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">PC3&gt;ping 202.10.1.1</span><br><span class="line"></span><br><span class="line">Ping 202.10.1.1: 32 data bytes, Press Ctrl_C to break</span><br><span class="line">Request timeout!</span><br><span class="line">Request timeout!</span><br><span class="line">Request timeout!</span><br><span class="line">Request timeout!</span><br><span class="line">Request timeout!</span><br><span class="line"></span><br><span class="line">--- 202.10.1.1 ping statistics ---</span><br><span class="line">  5 packet(s) transmitted</span><br><span class="line">  0 packet(s) received</span><br><span class="line">  100.00% packet loss</span><br></pre></td></tr></table></figure><p>   可以看到，部门A（PC1）的用户可以访问公网，部门B（PC3）的用户不能访问公网。</p><h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><ul><li><p>总部核心交换机CORE的配置文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">sysname CORE</span><br><span class="line">#</span><br><span class="line">vlan batch 100</span><br><span class="line">#</span><br><span class="line">interface Vlanif100</span><br><span class="line"> ip address 10.10.100.4 255.255.255.0</span><br><span class="line">#</span><br><span class="line">interface Eth-Trunk3</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 100</span><br><span class="line"> mode lacp</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line">interface Eth-Trunk4</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 100</span><br><span class="line"> mode lacp</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0&#x2F;0&#x2F;3</span><br><span class="line"> eth-trunk 3</span><br><span class="line">#</span><br><span class="line"